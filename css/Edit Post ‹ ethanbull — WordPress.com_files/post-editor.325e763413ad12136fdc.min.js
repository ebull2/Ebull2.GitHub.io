(window.webpackJsonp=window.webpackJsonp||[]).push([[33,89,118],{"./client/blocks/shortcode/index.js":function(e,t,s){"use strict";var n=s("./node_modules/@babel/runtime/helpers/extends.js"),i=s.n(n),o=s("./node_modules/react-redux/es/index.js"),a=s("./node_modules/classnames/index.js"),r=s.n(a),c=s("./node_modules/prop-types/index.js"),l=s.n(c),d=s("./node_modules/react/index.js"),p=s.n(d),u=s("./node_modules/lodash/lodash.js"),m=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),h=s.n(m);const g=(e,t,s)=>Object(u.get)(e.shortcodes.requesting,[t,s],!1),b=(e,t,s)=>Object(u.get)(e.shortcodes.items,[t,s]);var f=s("./client/lib/wp/browser.js");class y extends d.Component{componentWillMount(){this.request(this.props)}componentWillReceiveProps(e){this.props.siteId===e.siteId&&this.props.shortcode===e.shortcode||this.request(e)}request(e){e.requestingShortcode||e.fetchShortcode(e.siteId,e.shortcode)}render(){return null}}h()(y,"propTypes",{siteId:l.a.number.isRequired,shortcode:l.a.string.isRequired,requestingShortcode:l.a.bool,fetchShortcode:l.a.func});var E=Object(o.b)((e,t)=>{let s=t.siteId,n=t.shortcode;return{requestingShortcode:g(e,s,n)}},{fetchShortcode:function(e,t){return s=>(s({type:"SHORTCODE_REQUEST",siteId:e,shortcode:t}),f.a.undocumented().site(e).shortcodes({shortcode:t}).then(n=>{s({type:"SHORTCODE_REQUEST_SUCCESS",siteId:e,shortcode:t}),s({type:"SHORTCODE_RECEIVE",siteId:e,shortcode:t,data:n})}).catch(n=>{s({type:"SHORTCODE_REQUEST_FAILURE",siteId:e,shortcode:t,error:n})}))}})(y),v=s("./client/lib/embed-frame-markup/index.jsx"),j=s("./client/components/resizable-iframe/index.jsx");class _ extends p.a.Component{constructor(){super(...arguments),h()(this,"state",{html:""}),h()(this,"updateHtmlState",e=>{this.setState({html:Object(v.a)(e)})}),h()(this,"onFrameLoad",e=>{e.target.contentWindow.postMessage(JSON.stringify({content:this.state.html}),"*"),this.props.onLoad(e)})}componentDidMount(){this.updateHtmlState(this.props)}componentWillReceiveProps(e){Object(u.isEqual)(this.props,e)||this.updateHtmlState(e)}shouldComponentUpdate(e,t){return t.html!==this.state.html}render(){const e=r()("shortcode-frame",this.props.className);if(!this.state.html)return null;const t=Math.random(),s=r()({"allow-scripts":!0,"allow-same-origin":this.props.allowSameOrigin});return p.a.createElement(j.a,i()({key:t},Object(u.omit)(this.props,"body","scripts","styles","allowSameOrigin"),{src:"https://wpcomwidgets.com/render/",onLoad:this.onFrameLoad,frameBorder:"0",sandbox:s,className:e}))}}h()(_,"displayName","ShortcodeFrame"),h()(_,"propTypes",{body:l.a.string,scripts:l.a.object,style:l.a.object,onLoad:l.a.func,className:l.a.string,allowSameOrigin:l.a.bool}),h()(_,"defaultProps",{onLoad:()=>{},allowSameOrigin:!1});const x=e=>{const t=e.siteId,s=e.className,n=e.children,o=e.filterRenderResult,a=e.shortcode,c=r()("shortcode",s);let l={};return a&&(a.body=a.result,l=o(Object(u.omit)(a,"shortcode"))),p.a.createElement(d.Fragment,null,p.a.createElement(E,{siteId:t,shortcode:n}),p.a.createElement(_,i()({},Object(u.omit)(e,"siteId","filterRenderResult","shortcode","dispatch"),l,{className:c})))};x.propTypes={siteId:l.a.number.isRequired,children:l.a.string.isRequired,filterRenderResult:l.a.func.isRequired,className:l.a.string,shortcode:l.a.object,allowSameOrigin:l.a.bool},x.defaultProps={filterRenderResult:u.identity,allowSameOrigin:!1};t.a=Object(o.b)((e,t)=>{let s=t.siteId,n=t.children;return{shortcode:b(e,s,n)}},null)(x)},"./client/blocks/term-form-dialog/index.jsx":function(e,t,s){"use strict";var n=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),i=s.n(n),o=s("./node_modules/prop-types/index.js"),a=s.n(o),r=s("./node_modules/react/index.js"),c=s.n(r),l=s("./node_modules/react-redux/es/index.js"),d=s("./packages/i18n-calypso/dist/esm/index.js"),p=s("./node_modules/lodash/lodash.js"),u=s("./client/components/dialog/index.jsx"),m=s("./client/blocks/term-tree-selector/terms.jsx"),h=s("./client/components/forms/form-input-validation/index.jsx"),g=s("./client/components/forms/form-textarea/index.jsx"),b=s("./client/components/forms/form-text-input/index.jsx"),f=s("./client/components/forms/form-section-heading/index.jsx"),y=s("./client/components/forms/form-toggle/index.jsx"),E=s("./client/components/forms/form-label/index.jsx"),v=s("./client/components/forms/form-legend/index.jsx"),j=s("./client/components/forms/form-fieldset/index.jsx"),_=s("./client/lib/viewport/index.js"),x=s("./client/state/ui/selectors.js"),w=s("./client/state/post-types/taxonomies/selectors.js"),S=s("./client/state/terms/selectors.js"),C=s("./client/state/terms/actions.js"),I=s("./client/state/analytics/actions.js");class O extends r.Component{constructor(e){super(e),i()(this,"onSearch",e=>{this.setState({searchTerm:e})}),i()(this,"closeDialog",()=>{this.state.saving||this.props.onClose()}),i()(this,"onParentChange",e=>{this.setState({selectedParent:[e.ID],isTopLevel:!1},this.isValid)}),i()(this,"onTopLevelChange",()=>{const e=this.state.isTopLevel?p.noop:this.isValid;this.setState(e=>{return{isTopLevel:!e.isTopLevel,selectedParent:[]}},e)}),i()(this,"onNameChange",e=>{this.setState({name:e.target.value})}),i()(this,"onDescriptionChange",e=>{this.setState({description:e.target.value})}),i()(this,"validateInput",e=>{13===e.keyCode?this.saveTerm():this.isValid()}),i()(this,"saveTerm",()=>{const e=this.getFormValues();if(!this.isValid()||this.state.saving)return;this.setState({saving:!0});const t=this.props,s=t.siteId,n=t.taxonomy,i={mc:"edited_".concat(n),ga:"Edited ".concat(n)},o=!this.props.term,a=o?this.props.addTerm(s,n,e):this.props.updateTerm(s,n,this.props.term.ID,this.props.term.slug,e);o&&(i.mc="created_".concat(n),i.ga="Created New ".concat(n)),this.props.bumpStat("taxonomy_manager",i.mc),this.props.recordGoogleEvent("Taxonomy Manager",i.ga),a.then(e=>{this.setState({saving:!1}),this.props.onSuccess(e),this.closeDialog()})}),this.state=this.constructor.initialState}init(e){if(!e.term)return e.searchTerm&&e.searchTerm.trim().length?void this.setState(Object(p.assign)({},this.constructor.initialState,{name:e.searchTerm}),this.isValid):void this.setState(this.constructor.initialState);const t=e.term,s=t.name,n=t.description,i=t.parent,o=void 0!==i&&i;this.setState(Object(p.assign)({},this.constructor.initialState,{name:s,description:n,isTopLevel:!o,selectedParent:o?[o]:[]}))}componentWillReceiveProps(e){(this.props.term!==e.term||this.props.showDialog!==e.showDialog&&e.showDialog)&&this.init(e)}componentDidMount(){this.init(this.props)}getFormValues(){const e={name:this.state.name.trim()};if(this.props.isHierarchical&&(e.parent=this.state.selectedParent.length?this.state.selectedParent[0]:0),this.props.showDescriptionInput){const t=this.state.description.trim();e.description=t}return e}isValid(){const e={},t=this.getFormValues();t.name.length||(e.name=this.props.translate("Name required",{textOnly:!0}));const s=t.name.toLowerCase();Object(p.find)(this.props.terms,e=>e.name.toLowerCase()===s&&(!this.props.term||e.ID!==this.props.term.ID))&&(e.name=this.props.translate("Name already exists",{context:"Terms: Add term error message - duplicate term name exists",comment:'Term here refers to a hierarchical taxonomy, e.g. "Category"',textOnly:!0})),!this.props.isHierarchical||this.state.isTopLevel||t.parent||(e.parent=this.props.translate('Parent item required when "Top level" is unchecked',{context:"Terms: Add term error message",comment:'Term here refers to a hierarchical taxonomy, e.g. "Category"',textOnly:!0}));const n=!Object.keys(e).length;return this.setState({errors:e,isValid:n}),n}renderParentSelector(){const e=this.props,t=e.labels,s=e.siteId,n=e.taxonomy,i=e.translate,o=e.terms,a=this.state,r=a.isTopLevel,l=a.searchTerm,d=a.selectedParent,u={};l&&l.length&&(u.search=l);const g=Object(p.get)(this.props.term,"ID"),b=!!this.state.errors.parent;return g&&o&&1===o.length?null:c.a.createElement(j.a,null,c.a.createElement(E.a,null,c.a.createElement(y.a,{checked:r,onChange:this.onTopLevelChange}),c.a.createElement("span",null,i("Top level %(term)s",{args:{term:t.singular_name},context:"Terms: New term being created is top level",comment:'term is the singular_name label of a hierarchical taxonomy, e.g. "Category"'})),r&&c.a.createElement("span",{className:"term-form-dialog__top-level-description"},i("Disable to select a %(parentTerm)s",{args:{parentTerm:t.parent_item},comment:'parentTerm is the parent_item label of a hierarchical taxonomy, e.g. "Parent Category"'}))),!r&&c.a.createElement("div",{className:"term-form-dialog__parent-tree-selector"},c.a.createElement(v.a,null,i("Choose a %(parentTerm)s",{args:{parentTerm:t.parent_item},comment:'parentTerm is the parent_item label of a hierarchical taxonomy, e.g. "Parent Category"'})),c.a.createElement(m.a,{siteId:s,taxonomy:n,isError:b,onSearch:this.onSearch,onChange:this.onParentChange,query:u,selected:d,hideTermAndChildren:g}),b&&c.a.createElement(h.a,{isError:!0,text:this.state.errors.parent})))}render(){const e=this.props,t=e.isHierarchical,s=e.labels,n=e.term,i=e.translate,o=e.showDescriptionInput,a=e.showDialog,r=this.state,l=r.name,d=r.description,p=!n,m=i(p?"Add":"Update"),y=[{action:"cancel",label:i("Cancel")},{action:p?"add":"update",label:this.state.saving?i("Saving…"):m,isPrimary:!0,disabled:!this.state.isValid||this.state.saving,onClick:this.saveTerm}],E=!!this.state.errors.name;return c.a.createElement(u.a,{autoFocus:!1,isVisible:a,buttons:y,onClose:this.closeDialog,additionalClassNames:"term-form-dialog"},c.a.createElement(f.a,null,p?s.add_new_item:s.edit_item),c.a.createElement(j.a,null,c.a.createElement(b.a,{autoFocus:a&&!Object(_.e)(),placeholder:s.new_item_name,ref:"termName",isError:E,onKeyUp:this.validateInput,value:l,onChange:this.onNameChange}),E&&c.a.createElement(h.a,{isError:!0,text:this.state.errors.name})),o&&c.a.createElement(j.a,null,c.a.createElement(v.a,null,i("Description",{context:"Terms: Term description label",comment:'Term here refers to a hierarchical taxonomy, e.g. "Category"'})),c.a.createElement(g.a,{ref:"termDescription",onKeyUp:this.validateInput,value:d,onChange:this.onDescriptionChange})),t&&this.renderParentSelector())}}i()(O,"initialState",{description:"",name:"",selectedParent:[],isTopLevel:!0,isValid:!1,errors:{},saving:!1}),i()(O,"propTypes",{labels:a.a.object,onClose:a.a.func,onSuccess:a.a.func,postType:a.a.string,searchTerm:a.a.string,showDescriptionInput:a.a.bool,showDialog:a.a.bool,siteId:a.a.number,taxonomy:a.a.string,term:a.a.object,terms:a.a.array,translate:a.a.func,recordGoogleEvent:a.a.func,bumpStat:a.a.func}),i()(O,"defaultProps",{onClose:p.noop,onSuccess:p.noop,showDescriptionInput:!1,showDialog:!1}),t.a=Object(l.b)((e,t)=>{const s=t.taxonomy,n=t.postType,i=Object(x.e)(e),o=Object(w.b)(e,i,n,s),a=Object(p.get)(o,"labels",{}),r=Object(p.get)(o,"hierarchical",!1);return{terms:Object(S.c)(e,i,s),isHierarchical:r,labels:a,siteId:i}},{addTerm:C.a,updateTerm:C.d,recordGoogleEvent:I.g,bumpStat:I.a})(Object(d.localize)(O))},"./client/blocks/term-tree-selector/index.jsx":function(e,t,s){"use strict";var n=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),i=s.n(n),o=s("./node_modules/prop-types/index.js"),a=s.n(o),r=s("./node_modules/react/index.js"),c=s.n(r),l=s("./node_modules/classnames/index.js"),d=s.n(l),p=s("./client/blocks/term-tree-selector/terms.jsx"),u=s("./node_modules/react-redux/es/index.js"),m=s("./node_modules/lodash/lodash.js"),h=s("./client/components/gridicon/index.jsx"),g=s("./client/components/button/index.jsx"),b=s("./client/blocks/term-form-dialog/index.jsx"),f=s("./client/components/data/query-taxonomies/index.jsx"),y=s("./client/state/ui/selectors.js"),E=s("./client/state/post-types/taxonomies/selectors.js"),v=s("./client/state/terms/selectors.js");class j extends r.Component{constructor(e){super(e),i()(this,"openDialog",e=>{e.preventDefault(),this.setState({showDialog:!0})}),i()(this,"closeDialog",()=>{this.setState({showDialog:!1})}),this.state={showDialog:!1}}render(){const e=this.props,t=e.siteId,s=e.labels,n=e.onSuccess,i=e.postType,o=e.terms,a=e.taxonomy,r=o?o.length:0,l=d()("term-tree-selector__add-term",{"is-compact":r<8});return c.a.createElement("div",{className:l},t&&c.a.createElement(f.a,{siteId:t,postType:i}),c.a.createElement(g.a,{borderless:!0,compact:!0,onClick:this.openDialog},c.a.createElement(h.a,{icon:"folder"})," ",s.add_new_item),c.a.createElement(b.a,{showDialog:this.state.showDialog,onClose:this.closeDialog,postType:i,taxonomy:a,onSuccess:n}))}}i()(j,"propTypes",{labels:a.a.object,onSuccess:a.a.func,taxonomy:a.a.string,terms:a.a.array,postType:a.a.string}),i()(j,"defaultProps",{onSuccess:m.noop});var _=Object(u.b)((e,t)=>{let s=t.taxonomy,n=t.postType;const i=Object(y.e)(e),o=Object(E.b)(e,i,n,s),a=Object(m.get)(o,"labels",{});return{siteId:i,terms:Object(v.c)(e,i,s),labels:a}})(j);s.d(t,"a",function(){return x});class x extends c.a.Component{constructor(){super(...arguments),i()(this,"state",{search:""}),i()(this,"onSearch",e=>{e!==this.state.search&&this.setState({search:e})})}componentWillReceiveProps(e){e.taxonomy!==this.props.taxonomy&&this.setState({search:""})}render(){const e=this.props,t=e.className,s=e.taxonomy,n=e.onChange,i=e.selected,o=e.createLink,a=e.multiple,r=e.height,l=e.compact,u=e.addTerm,m=e.postType,h=e.onAddTermSuccess,g=e.podcastingCategoryId,b=d()(t),f=this.state.search,y={};return f&&f.length&&(y.search=f),c.a.createElement("div",{className:b,ref:"wrapper"},c.a.createElement(p.a,{taxonomy:s,onSearch:this.onSearch,onChange:n,query:y,selected:i,createLink:o,multiple:a,height:r,compact:l,podcastingCategoryId:g}),u&&c.a.createElement(_,{taxonomy:s,postType:m,onSuccess:h}))}}i()(x,"displayName","TermTreeSelector"),i()(x,"propTypes",{multiple:a.a.bool,className:a.a.string,onChange:a.a.func.isRequired,selected:a.a.array,createLink:a.a.string,analyticsPrefix:a.a.string,taxonomy:a.a.string,height:a.a.number,compact:a.a.bool,addTerm:a.a.bool,postType:a.a.string,onAddTermSuccess:a.a.func,podcastingCategoryId:a.a.number}),i()(x,"defaultProps",{analyticsPrefix:"Category Selector",selected:[],taxonomy:"category",onChange:()=>{},height:300,addTerm:!1,postType:"post",onAddTermSuccess:()=>{}})},"./client/blocks/term-tree-selector/terms.jsx":function(e,t,s){"use strict";var n=s("./node_modules/@babel/runtime/helpers/objectSpread.js"),i=s.n(n),o=s("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),a=s.n(o),r=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),c=s.n(r),l=s("./node_modules/react/index.js"),d=s.n(l),p=s("./node_modules/prop-types/index.js"),u=s.n(p),m=s("./node_modules/react-redux/es/index.js"),h=s("./node_modules/classnames/index.js"),g=s.n(h),b=s("./packages/i18n-calypso/dist/esm/index.js"),f=s("./node_modules/react-virtualized/dist/es/AutoSizer/index.js"),y=s("./node_modules/react-virtualized/dist/es/List/index.js"),E=s("./node_modules/lodash/lodash.js"),v=s("./client/lib/analytics/index.js");class j extends d.a.PureComponent{render(){const e=this.props.createLink;let t;return e&&(t=this.props.translate("You may want to {{a}}create a new item{{/a}}.",{context:"Term Selector: term search/listing results",comment:"This is used when no terms match the given search, or if there are no terms at all.",components:{a:d.a.createElement("a",{className:"create-link",href:e,target:"_blank",rel:"noopener noreferrer"})}})),d.a.createElement("span",{className:"is-empty-content"},this.props.translate("No results. Please try a different search.")," ",t)}}c()(j,"displayName","TermTreeSelectorNoResults"),c()(j,"propTypes",{createLink:u.a.string});var _=Object(b.localize)(j),x=s("./client/components/gridicon/index.jsx");class w extends d.a.Component{render(){return d.a.createElement("div",{className:"term-tree-selector__search"},d.a.createElement(x.a,{icon:"search",size:18}),d.a.createElement("input",{type:"search",placeholder:this.props.translate("Search…",{textOnly:!0}),value:this.props.searchTerm,onChange:this.props.onSearch}))}}c()(w,"displayName","TermTreeSelectorSearch"),c()(w,"propTypes",{searchTerm:u.a.string,onSearch:u.a.func.isRequired});var S=Object(b.localize)(w),C=s("./client/lib/formatting/index.js"),I=s("./client/components/data/query-terms/index.jsx"),O=s("./client/state/ui/selectors.js"),T=s("./client/state/terms/selectors.js"),P=s("./client/components/podcast-indicator/index.jsx"),k=s("./client/components/data/query-site-settings/index.js"),D=s("./client/state/selectors/get-podcasting-category-id.js");const N=500,R=100,M=10,L=25;class A extends l.Component{constructor(){var e;super(...arguments),e=this,c()(this,"state",this.constructor.initialState),c()(this,"recomputeRowHeights",()=>{this.list&&(this.list.recomputeRowHeights(),this.isSmall()&&this.forceUpdate())}),c()(this,"getPageForIndex",e=>{const t=this.props,s=t.query,n=t.lastPage,i=s.number||R,o=Math.ceil(e/i);return Math.max(Math.min(o,n||1/0),1)}),c()(this,"setRequestedPages",e=>{let t=e.startIndex,s=e.stopIndex;const n=this.state.requestedPages,i=Object(E.difference)(Object(E.range)(this.getPageForIndex(t-M),this.getPageForIndex(s+M)+1),n);i.length&&this.setState({requestedPages:n.concat(i)})}),c()(this,"setItemRef",(e,t)=>{if(!t||!e)return;const s=this.itemHeights[e.ID]||L,n=t.clientHeight;this.itemHeights[e.ID]=n,s!==n&&this.queueRecomputeRowHeights()}),c()(this,"hasNoSearchResults",()=>!this.props.loading&&this.props.terms&&!this.props.terms.length&&!!this.state.searchTerm.length),c()(this,"hasNoTerms",()=>!this.props.loading&&this.props.terms&&!this.props.terms.length),c()(this,"getItem",e=>{if(this.props.terms)return this.props.terms[e]}),c()(this,"isSmall",()=>!(!this.props.terms||this.state.searchTerm)&&this.props.terms.length<this.props.searchThreshold),c()(this,"isRowLoaded",e=>{let t=e.index;return this.props.lastPage||!!this.getItem(t)}),c()(this,"getTermChildren",e=>{const t=this.props.terms;return Object(E.filter)(t,t=>{return t.parent===e})}),c()(this,"getItemHeight",function(t){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t?t.parent&&!s&&Object(E.includes)(e.termIds,t.parent)?0:t.ID===e.props.hideTermAndChildren?0:e.itemHeights[t.ID]?e.itemHeights[t.ID]:Object(E.reduce)(e.getTermChildren(t.ID),(t,s)=>t+e.getItemHeight(s,!0),L):L}),c()(this,"getRowHeight",e=>{let t=e.index;return this.getItemHeight(this.getItem(t))}),c()(this,"getCompactContainerHeight",()=>Object(E.range)(0,this.getRowCount()).reduce((e,t)=>e+this.getRowHeight({index:t}),0)),c()(this,"getRowCount",()=>{let e=0;return this.props.terms&&(e+=this.props.terms.length),!this.props.loading&&this.props.terms||(e+=1),e}),c()(this,"onSearch",e=>{const t=e.target.value;this.state.searchTerm&&!t&&this.props.onSearch(""),t!==this.state.searchTerm&&(this.hasPerformedSearch||(this.hasPerformedSearch=!0,v.default.ga.recordEvent(this.props.analyticsPrefix,"Performed Term Search")),this.setState({searchTerm:t}),this.debouncedSearch())}),c()(this,"setListRef",e=>{this.list=e}),c()(this,"renderItem",function(t){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t.parent&&!s&&Object(E.includes)(e.termIds,t.parent))return;if(t.ID===e.props.hideTermAndChildren)return;const n=e.getTermChildren(t.ID),i=e.props,o=i.multiple,a=i.defaultTermId,r=i.translate,c=i.selected,l=i.taxonomy,p=i.podcastingCategoryId,u=t.ID,m="category"===l&&p===u,h=Object(C.b)(t.name)||r("Untitled"),g=Object(E.includes)(c,u),b=o?"checkbox":"radio",f=o&&g&&a&&1===c.length&&a===u,y=d.a.createElement("input",{type:b,value:u,onChange:function(){for(var s=arguments.length,n=new Array(s),i=0;i<s;i++)n[i]=arguments[i];return e.props.onChange(t,...n)},disabled:f,checked:g});return d.a.createElement("div",{key:u,ref:function(){for(var s=arguments.length,n=new Array(s),i=0;i<s;i++)n[i]=arguments[i];return e.setItemRef(t,...n)},className:"term-tree-selector__list-item"},d.a.createElement("label",null,y,d.a.createElement("span",{className:"term-tree-selector__label"},h,m&&d.a.createElement(P.a,{size:18}))),n.length>0&&d.a.createElement("div",{className:"term-tree-selector__nested-list"},n.map(t=>e.renderItem(t,!0))))}),c()(this,"renderNoResults",()=>{if(this.hasNoSearchResults()||this.hasNoTerms())return d.a.createElement("div",{key:"no-results",className:"term-tree-selector__list-item is-empty"},(this.hasNoSearchResults()||!this.props.emptyMessage)&&d.a.createElement(_,{createLink:this.props.createLink}),this.hasNoTerms()&&this.props.emptyMessage)}),c()(this,"renderRow",e=>{let t=e.index;const s=this.getItem(t);return s?this.renderItem(s):d.a.createElement("div",{key:"placeholder",className:"term-tree-selector__list-item is-placeholder"},d.a.createElement("label",null,d.a.createElement("input",{type:this.props.multiple?"checkbox":"radio",disabled:!0,className:"term-tree-selector__input"}),d.a.createElement("span",{className:"term-tree-selector__label"},this.props.translate("Loading…"))))}),c()(this,"cellRendererWrapper",e=>{let t=e.key,s=e.style,n=a()(e,["key","style"]);return d.a.createElement("div",{key:t,style:s},this.renderRow(n))})}componentWillMount(){this.itemHeights={},this.hasPerformedSearch=!1,this.list=null,this.termIds=Object(E.map)(this.props.terms,"ID"),this.getTermChildren=Object(E.memoize)(this.getTermChildren),this.queueRecomputeRowHeights=Object(E.debounce)(this.recomputeRowHeights),this.debouncedSearch=Object(E.debounce)(()=>{this.props.onSearch(this.state.searchTerm)},N)}componentWillReceiveProps(e){e.taxonomy!==this.props.taxonomy&&this.setState(this.constructor.initialState),this.props.terms!==e.terms&&(this.getTermChildren.cache.clear(),this.termIds=Object(E.map)(e.terms,"ID"))}componentDidUpdate(e){(!Object(E.isEqual)(e.selected,this.props.selected)||e.loading&&!this.props.loading||!e.terms&&this.props.terms)&&this.list.forceUpdateGrid(),this.props.terms!==e.terms&&this.recomputeRowHeights()}render(){const e=this.getRowCount(),t=this.isSmall(),s=this.state.searchTerm.length,n=(s>0||!t)&&(this.props.terms||!this.props.terms&&s>0),o=this.props,a=o.className,r=o.isError,c=o.loading,l=o.siteId,p=o.taxonomy,u=o.query,m=o.height,h=g()("term-tree-selector",a,{"is-loading":c,"is-small":t,"is-error":r,"is-compact":this.props.compact});return d.a.createElement("div",{className:h},this.state.requestedPages.map(e=>d.a.createElement(I.a,{key:"query-".concat(e),siteId:l,taxonomy:p,query:i()({},u,{page:e})})),"category"===p&&l&&d.a.createElement(k.a,{siteId:l}),n&&d.a.createElement(S,{searchTerm:this.state.searchTerm,onSearch:this.onSearch}),d.a.createElement(f.a,{disableHeight:!0},s=>{let n=s.width;return d.a.createElement(y.a,{ref:this.setListRef,width:n,height:t?this.getCompactContainerHeight():m,onRowsRendered:this.setRequestedPages,rowCount:e,estimatedRowSize:L,rowHeight:this.getRowHeight,rowRenderer:this.cellRendererWrapper,noRowsRenderer:this.renderNoResults,className:"term-tree-selector__results"})}))}}c()(A,"propTypes",{hideTermAndChildren:u.a.number,terms:u.a.array,taxonomy:u.a.string,multiple:u.a.bool,selected:u.a.array,search:u.a.string,siteId:u.a.number,translate:u.a.func,defaultTermId:u.a.number,lastPage:u.a.number,onSearch:u.a.func,onChange:u.a.func,isError:u.a.bool,height:u.a.number}),c()(A,"defaultProps",{analyticsPrefix:"Category Selector",searchThreshold:8,loading:!0,terms:Object.freeze([]),onSearch:()=>{},onChange:()=>{},onNextPage:()=>{},height:300}),c()(A,"initialState",{searchTerm:"",requestedPages:Object.freeze([1])});t.a=Object(m.b)((e,t)=>{const s=Object(O.e)(e),n=t.taxonomy,i=t.query;let o=t.podcastingCategoryId;return void 0===o&&"category"===n&&(o=Object(D.a)(e,s)),{loading:Object(T.g)(e,s,n,i),terms:Object(T.d)(e,s,n,i),lastPage:Object(T.e)(e,s,n,i),siteId:s,query:i,podcastingCategoryId:o}})(Object(b.localize)(A))},"./client/blocks/user-mentions/suggestion-list.jsx":function(e,t,s){"use strict";var n=s("./node_modules/prop-types/index.js"),i=s.n(n),o=s("./node_modules/react/index.js"),a=s.n(o),r=s("./node_modules/lodash/lodash.js"),c=s("./client/components/popover/menu.jsx"),l=s("./client/components/popover/menu-item.jsx");const d=e=>{let t=e.avatarUrl,s=e.fullName,n=e.query;const i=(e,t)=>{const s={username:"(^".concat(n,")(\\w*)\\s*"),fullName:"(^.*?)(\\b".concat(n,")(.*)")},i=new RegExp(s[t],"ig").exec(e);return i?i.map((e,t)=>0===t?"":n.toLowerCase()===e.toLowerCase()?a.a.createElement("mark",{className:"user-mentions__highlight",key:t},e):e):[e]},o=i(e.username,"username"),r=i(s,"fullName");return o.unshift("@"),a.a.createElement("div",null,a.a.createElement("img",{className:"user-mentions__avatar",src:t,alt:""}),a.a.createElement("span",{className:"user-mentions__username"},o),a.a.createElement("small",{className:"user-mentions__fullname"},r))};d.propTypes={avatarUrl:i.a.string,fullName:i.a.string,query:i.a.string,username:i.a.string},d.defaultProps={avatarUrl:"",fullName:"",query:"",username:""};var p=d;const u=e=>{let t=e.onClick,s=e.onClose,n=e.popoverContext,i=e.popoverPosition,o=e.query,d=e.selectedSuggestionId,u=e.suggestions;return a.a.createElement(c.a,{className:"user-mentions__suggestions",context:n,isVisible:!0,autoPosition:!1,position:"bottom right",onClose:s,customPosition:i},u.map(e=>a.a.createElement(l.a,{className:"user-mentions__suggestion",key:e.ID,isSelected:e.ID===d,onClick:Object(r.bind)(t,null,e)},a.a.createElement(p,{avatarUrl:e.image_URL,username:e.user_login,fullName:e.display_name,query:o}))))};u.propTypes={onClick:i.a.func,onClose:i.a.func,query:i.a.string,popoverContext:i.a.object,popoverPosition:i.a.shape({top:i.a.number,left:i.a.number,positionClass:i.a.oneOf(["top","right","bottom","left"])}),selectedSuggestionId:i.a.number,suggestions:i.a.array},u.defaultProps={onClick:()=>{},onClose:()=>{},query:"",popoverContext:{},popoverPosition:null,selectedSuggestionId:0,suggestions:[]};t.a=u},"./client/components/accordion/index.jsx":function(e,t,s){"use strict";var n=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),i=s.n(n),o=s("./node_modules/react/index.js"),a=s.n(o),r=s("./node_modules/prop-types/index.js"),c=s.n(r),l=s("./node_modules/lodash/lodash.js"),d=s("./node_modules/classnames/index.js"),p=s.n(d),u=s("./client/components/gridicon/index.jsx"),m=s("./client/components/tooltip/index.jsx");const h={info:"info",warning:"notice",error:"notice"};class g extends o.PureComponent{constructor(){super(...arguments),i()(this,"state",{}),i()(this,"setTooltipContext",e=>{e&&this.setState({tooltipContext:e})}),this.showTooltip=this.toggleTooltip.bind(this,!0),this.hideTooltip=this.toggleTooltip.bind(this,!1)}toggleTooltip(e){this.setState({isTooltipVisible:e})}render(){const e=this.props,t=e.type,s=e.text,n=e.url,i=e.position;return a.a.createElement("a",{href:n,onClick:this.props.onClick,ref:this.setTooltipContext,onMouseEnter:this.showTooltip,onMouseLeave:this.hideTooltip,className:p()("accordion__status","is-".concat(t))},a.a.createElement(u.a,{icon:h[t]}),s&&a.a.createElement(m.a,{position:i,isVisible:this.state.isTooltipVisible,context:this.state.tooltipContext},s))}}i()(g,"propTypes",{type:c.a.oneOf(["info","warning","error"]),text:c.a.node,url:c.a.string,position:c.a.string,onClick:c.a.func}),i()(g,"defaultProps",{type:"info",onClick:()=>{}});s("./client/components/accordion/style.scss");s.d(t,"a",function(){return b});class b extends o.Component{constructor(e){super(...arguments),i()(this,"toggleExpanded",()=>{this.setExpandedStatus(!this.state.isExpanded)}),i()(this,"setExpandedStatus",e=>{this.setState({isExpanded:e}),this.props.onToggle(e)}),this.state={isExpanded:e.initialExpanded,hasExpanded:!1}}static getDerivedStateFromProps(e,t){return t.isExpanded||e.forceExpand?{hasExpanded:!0}:null}render(){const e=this.props,t=e.className,s=e.icon,n=e.title,i=e.subtitle,o=e.status,r=e.children,c=e.e2eTitle,l=this.state.isExpanded||this.props.forceExpand,d=this.state.hasExpanded,m=p()("accordion",t,{"is-expanded":l,"has-icon":!!s,"has-subtitle":!!i,"has-status":!!o});return a.a.createElement("div",{className:m,"data-e2e-title":c,"data-tip-target":"accordion-".concat(c)},a.a.createElement("header",{className:"accordion__header"},a.a.createElement("button",{type:"button",onClick:this.toggleExpanded,className:"accordion__toggle"},s&&a.a.createElement("span",{className:"accordion__icon"},s),a.a.createElement("span",{className:"accordion__title"},n),i&&a.a.createElement("span",{className:"accordion__subtitle"},i),a.a.createElement("span",{className:"accordion__arrow"},a.a.createElement(u.a,{icon:"dropdown"}))),o&&a.a.createElement(g,o)),d&&a.a.createElement("div",{className:"accordion__content"},a.a.createElement("div",{className:"accordion__content-wrap"},r)))}}i()(b,"propTypes",{initialExpanded:c.a.bool,forceExpand:c.a.bool,onToggle:c.a.func,title:c.a.string.isRequired,subtitle:c.a.string,status:c.a.object,icon:c.a.element,e2eTitle:c.a.string}),i()(b,"defaultProps",{initialExpanded:!1,forceExpand:!1,onToggle:l.noop})},"./client/components/accordion/section.jsx":function(e,t,s){"use strict";s.d(t,"a",function(){return r});var n=s("./node_modules/react/index.js"),i=s.n(n),o=s("./node_modules/classnames/index.js"),a=s.n(o);class r extends n.Component{render(){return i.a.createElement("section",{className:a()("accordion__section",this.props.className)},this.props.children)}}},"./client/components/accordion/style.scss":function(e,t,s){},"./client/components/data/media-library-selected-data/index.jsx":function(e,t,s){"use strict";s.d(t,"a",function(){return u});var n=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),i=s.n(n),o=s("./node_modules/react/index.js"),a=s.n(o),r=s("./node_modules/prop-types/index.js"),c=s.n(r),l=s("./client/lib/media/library-selected-store.js"),d=s("./client/lib/react-pass-to-children/index.js");function p(e){return{mediaLibrarySelectedItems:l.a.getAll(e)}}class u extends a.a.Component{constructor(){super(...arguments),i()(this,"state",p(this.props.siteId)),i()(this,"updateState",()=>{this.setState(p(this.props.siteId))})}componentDidMount(){l.a.on("change",this.updateState)}componentWillUnmount(){l.a.off("change",this.updateState)}componentWillReceiveProps(e){this.props.siteId!==e.siteId&&this.setState(p(e.siteId))}render(){return Object(d.a)(this,this.state)}}i()(u,"displayName","MediaLibrarySelectedData"),i()(u,"propTypes",{siteId:c.a.number.isRequired})},"./client/components/data/query-media/index.jsx":function(e,t,s){"use strict";var n=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),i=s.n(n),o=s("./node_modules/prop-types/index.js"),a=s.n(o),r=s("./node_modules/react/index.js"),c=s("./node_modules/react-pure-render/shallowEqual.js"),l=s.n(c),d=s("./node_modules/react-redux/es/index.js"),p=s("./client/state/media/actions.js");const u={requestMedia:p.e,requestMediaItem:p.f};class m extends r.Component{componentDidMount(){this.request()}componentDidUpdate(e){this.props.siteId===e.siteId&&this.props.mediaId===e.mediaId&&l()(this.props.query,e.query)||this.request()}request(){const e=this.props,t=e.siteId,s=e.mediaId,n=e.query;!!s?this.props.requestMediaItem(t,s):this.props.requestMedia(t,n)}render(){return null}}i()(m,"propTypes",{siteId:a.a.number.isRequired,query:a.a.object,mediaId:a.a.number,request:a.a.func}),i()(m,"defaultProps",{request:()=>{}}),t.a=Object(d.b)(null,u)(m)},"./client/components/data/query-simple-payments/index.js":function(e,t,s){"use strict";var n=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),i=s.n(n),o=s("./node_modules/react/index.js"),a=s("./node_modules/prop-types/index.js"),r=s.n(a),c=s("./node_modules/react-redux/es/index.js"),l=s("./client/state/simple-payments/product-list/actions.js");class d extends o.Component{componentWillMount(){this.request(this.props)}componentWillReceiveProps(e){e.siteId===this.props.siteId&&e.productId===this.props.productId||this.request(e)}request(e){const t=e.siteId,s=e.productId;t&&0!==s&&(s?e.requestProduct(t,s):e.requestProducts(t))}render(){return null}}i()(d,"propTypes",{productId:r.a.number,siteId:r.a.number.isRequired,requestProduct:r.a.func,requestProducts:r.a.func}),i()(d,"defaultProps",{productId:null}),t.a=Object(c.b)(null,{requestProduct:l.d,requestProducts:l.e})(d)},"./client/components/data/query-site-plans/index.jsx":function(e,t,s){"use strict";var n=s("./node_modules/prop-types/index.js"),i=s.n(n),o=s("./node_modules/react/index.js"),a=s("./node_modules/react-redux/es/index.js"),r=s("./node_modules/redux/es/redux.js"),c=s("./client/state/sites/plans/selectors.js"),l=s("./client/state/sites/plans/actions.js");class d extends o.Component{constructor(e){super(e),this.requestPlans=this.requestPlans.bind(this)}requestPlans(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props;!e.requestingSitePlans&&e.siteId&&e.fetchSitePlans(e.siteId)}componentWillMount(){this.requestPlans()}componentWillReceiveProps(e){!e.requestingSitePlans&&e.siteId&&this.props.siteId!==e.siteId&&this.requestPlans(e)}render(){return null}}d.propTypes={siteId:i.a.number,requestingPlans:i.a.bool,fetchSitePlans:i.a.func},d.defaultProps={fetchSitePlans:()=>{}},t.a=Object(a.b)((e,t)=>({requestingSitePlans:Object(c.l)(e,t.siteId)}),e=>Object(r.b)({fetchSitePlans:l.b},e))(d)},"./client/components/data/query-site-settings/index.js":function(e,t,s){"use strict";var n=s("./node_modules/react/index.js"),i=s("./node_modules/prop-types/index.js"),o=s.n(i),a=s("./node_modules/react-redux/es/index.js"),r=s("./client/state/site-settings/selectors.js"),c=s("./client/state/site-settings/actions.js");class l extends n.Component{componentWillMount(){this.requestSettings(this.props)}componentWillReceiveProps(e){const t=this.props.siteId;e.siteId&&t!==e.siteId&&this.requestSettings(e)}requestSettings(e){const t=e.requestingSiteSettings,s=e.siteId;!t&&s&&e.requestSiteSettings(s)}render(){return null}}l.propTypes={siteId:o.a.number,requestingSiteSettings:o.a.bool,requestSiteSettings:o.a.func},t.a=Object(a.b)((e,t)=>{let s=t.siteId;return{requestingSiteSettings:Object(r.c)(e,s)}},{requestSiteSettings:c.a})(l)},"./client/components/data/query-taxonomies/index.jsx":function(e,t,s){"use strict";var n=s("./node_modules/prop-types/index.js"),i=s.n(n),o=s("./node_modules/react/index.js"),a=s("./node_modules/react-redux/es/index.js"),r=s("./client/lib/wp/browser.js");var c=s("./client/state/post-types/taxonomies/selectors.js");class l extends o.Component{componentWillMount(){this.request(this.props)}componentWillReceiveProps(e){this.props.siteId===e.siteId&&this.props.postType===e.postType||this.request(e)}request(e){!e.requesting&&e.siteId&&e.requestPostTypeTaxonomies(e.siteId,e.postType)}shouldComponentUpdate(){return!1}render(){return null}}l.propTypes={siteId:i.a.number,postType:i.a.string.isRequired,requesting:i.a.bool.isRequired,requestPostTypeTaxonomies:i.a.func.isRequired};t.a=Object(a.b)((e,t)=>({requesting:Object(c.c)(e,t.siteId,t.postType)}),{requestPostTypeTaxonomies:function(e,t){return s=>(s({type:"POST_TYPES_TAXONOMIES_REQUEST",siteId:e,postType:t}),r.a.site(e).postType(t).taxonomiesList().then(n=>{let i=n.taxonomies;s(function(e,t,s){return{type:"POST_TYPES_TAXONOMIES_RECEIVE",siteId:e,postType:t,taxonomies:s}}(e,t,i)),s({type:"POST_TYPES_TAXONOMIES_REQUEST_SUCCESS",siteId:e,postType:t})}).catch(n=>{s({type:"POST_TYPES_TAXONOMIES_REQUEST_FAILURE",siteId:e,postType:t,error:n})}))}})(l)},"./client/components/data/query-terms/index.jsx":function(e,t,s){"use strict";var n=s("./node_modules/prop-types/index.js"),i=s.n(n),o=s("./node_modules/react/index.js"),a=s("./node_modules/react-redux/es/index.js"),r=s("./node_modules/react-pure-render/shallowEqual.js"),c=s.n(r),l=s("./client/state/terms/actions.js"),d=s("./client/state/terms/selectors.js");class p extends o.Component{componentWillMount(){this.request(this.props)}componentWillReceiveProps(e){this.props.siteId===e.siteId&&this.props.taxonomy===e.taxonomy&&c()(this.props.query,e.query)||this.request(e)}request(e){!e.requesting&&e.siteId&&e.requestSiteTerms(e.siteId,e.taxonomy,e.query)}shouldComponentUpdate(){return!1}render(){return null}}p.propTypes={siteId:i.a.number,taxonomy:i.a.string.isRequired,query:i.a.object,requesting:i.a.bool.isRequired,requestSiteTerms:i.a.func.isRequired},p.defaultProps={query:{}},t.a=Object(a.b)((e,t)=>({requesting:Object(d.f)(e,t.siteId,t.taxonomy,t.query)}),{requestSiteTerms:l.c})(p)},"./client/components/data/query-users-suggestions/index.jsx":function(e,t,s){"use strict";var n=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),i=s.n(n),o=s("./node_modules/prop-types/index.js"),a=s.n(o),r=s("./node_modules/react/index.js"),c=s("./node_modules/react-redux/es/index.js"),l=s("./client/state/users/suggestions/selectors.js"),d=s("./client/lib/wp/browser.js");class p extends r.Component{componentWillMount(){this.request(this.props)}componentWillReceiveProps(e){this.props.siteId!==e.siteId&&this.request(e)}request(e){!e.isRequesting&&e.siteId&&e.requestUserSuggestions(e.siteId)}render(){return null}}i()(p,"propTypes",{siteId:a.a.number,isRequesting:a.a.bool,requestUserSuggestions:a.a.func}),i()(p,"defaultProps",{requestUserSuggestions:()=>{},isRequesting:!1});t.a=Object(c.b)((e,t)=>({isRequesting:Object(l.b)(e,t.siteId)}),{requestUserSuggestions:function(e){return t=>(t({type:"USER_SUGGESTIONS_REQUEST",siteId:e}),d.a.users().suggest({site_id:e}).then(s=>{t(function(e,t){return{type:"USER_SUGGESTIONS_RECEIVE",suggestions:t,siteId:e}}(e,s.suggestions)),t({type:"USER_SUGGESTIONS_REQUEST_SUCCESS",siteId:e,data:s})}).catch(s=>t({type:"USER_SUGGESTIONS_REQUEST_FAILURE",siteId:e,error:s})))}})(p)},"./client/components/date-picker/events-tooltip.jsx":function(e,t,s){"use strict";var n=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),i=s.n(n),o=s("./node_modules/react/index.js"),a=s.n(o),r=s("./node_modules/prop-types/index.js"),c=s.n(r),l=s("./node_modules/lodash/lodash.js"),d=s("./packages/i18n-calypso/dist/esm/index.js"),p=s("./client/components/tooltip/index.jsx"),u=s("./client/components/gridicon/index.jsx"),m=s("./node_modules/classnames/index.js"),h=s.n(m),g=s("./client/components/social-logo/index.jsx");const b=e=>{let t=e.icon,s=e.socialIcon,n=e.socialIconColor,i=void 0===n||n,o=e.title;return a.a.createElement("div",{className:"date-picker__calendar-event"},(e=>e&&a.a.createElement("span",{className:"date-picker__icon-wrapper date-picker__icon-wrapper-".concat(e)},a.a.createElement(u.a,{icon:e,size:18})))(t),((e,t)=>{if(!e)return null;const s=h()("date-picker__social-icon-wrapper","date-picker__social-icon-wrapper-".concat(e),{"date-picker__social-icon-wrapper-color":t});return a.a.createElement("span",{className:s},a.a.createElement(g.a,{icon:e,size:18}))})(s,i),a.a.createElement("span",{className:"date-picker__event-title"},o))};class f extends o.Component{render(){const e=this.props,t=e.events,s=e.isVisible,n=e.maxEvents;let i=this.props.title;i||(i=this.props.translate("%d post","%d posts",{count:t.length,args:t.length}));const o=!!(t&&t.length&&s),r=t.length-n;let c=this.props.moreEventsLabel;return c||(c=this.props.translate("… and %(moreEvents)d more post","… and %(moreEvents)d more posts",{count:r,args:{moreEvents:r}})),a.a.createElement(p.a,{className:"date-picker__events-tooltip",context:this.props.context,isVisible:o,onClose:l.noop},a.a.createElement("span",null,i),a.a.createElement("hr",{className:"date-picker__division"}),a.a.createElement("ul",null,Object(l.map)(t,(e,t)=>t<n&&a.a.createElement("li",{key:e.id},a.a.createElement(b,{icon:e.icon,socialIcon:e.socialIcon,socialIconColor:e.socialIconColor,title:""===e.title?this.props.translate("{{em}}(No title){{/em}}",{components:{em:a.a.createElement("em",null)}}):e.title}))),r>0&&a.a.createElement("li",null,c)))}}i()(f,"propTypes",{title:c.a.string,events:c.a.array,moment:c.a.func.isRequired,maxEvents:c.a.number,moreEvents:c.a.string}),i()(f,"defaultProps",{events:[],maxEvents:8});t.a=Object(d.localize)(f)},"./client/components/date-picker/index.jsx":function(e,t,s){"use strict";var n=s("./node_modules/@babel/runtime/helpers/objectSpread.js"),i=s.n(n),o=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),a=s.n(o),r=s("./node_modules/react/index.js"),c=s.n(r),l=s("./node_modules/prop-types/index.js"),d=s.n(l),p=s("./node_modules/react-day-picker/DayPicker.js"),u=s.n(p),m=s("./node_modules/lodash/lodash.js"),h=s("./packages/i18n-calypso/dist/esm/index.js"),g=s("./node_modules/classnames/index.js"),b=s.n(g);const f=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:m.noop;return n=>{s(e,t,n)}},y=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:m.noop;return n=>{s(e,t,n)}};var E=e=>{let t=e.date,s=e.modifiers,n=e.onMouseEnter,i=e.onMouseLeave;return c.a.createElement("div",{className:"date-picker__day",onMouseEnter:f(t,s,n),onMouseLeave:y(t,s,i)},t.getDate())};const v=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m.noop;return t=>{t.preventDefault(),e()}};var j=e=>{let t=e.nextMonth,s=e.previousMonth,n=e.onPreviousClick,i=e.onNextClick,o=e.className,a=e.localeUtils,r=e.showPreviousButton,l=void 0===r||r,d=e.showNextButton,p=void 0===d||d;const u=b()("date-picker__nav-bar",{[o]:!!o});return c.a.createElement("div",{className:u},l&&c.a.createElement("button",{className:"date-picker__previous-month button",type:"button","aria-label":Object(h.translate)("Previous month (%s)",{comment:"Aria label for date picker controls",args:a.formatMonthTitle(s)}),onClick:v(n)},a.formatMonthShort(s)),p&&c.a.createElement("button",{className:"date-picker__next-month button",type:"button","aria-label":Object(h.translate)("Next month (%s)",{comment:"Aria label for date picker controls",args:a.formatMonthTitle(t)}),onClick:v(i)},a.formatMonthShort(t)))};class _ extends r.PureComponent{constructor(){super(...arguments),a()(this,"setCalendarDay",Object(m.debounce)((e,t)=>{const s=this.props.moment(e);if(t.disabled)return null;const n={year:s.year(),month:s.month(),date:s.date()},i=(this.props.timeReference||s).set(n);this.props.onSelectDay(i,n,t)},500,{leading:!0,trailing:!1})),a()(this,"renderDay",(e,t)=>c.a.createElement(E,{date:e,modifiers:t,onMouseEnter:this.handleDayMouseEnter,onMouseLeave:this.handleDayMouseLeave})),a()(this,"handleDayMouseEnter",(e,t,s)=>{const n=this.filterEventsByDay(e);this.props.onDayMouseEnter(e,t,s,n)}),a()(this,"handleDayMouseLeave",(e,t,s)=>{const n=this.filterEventsByDay(e);this.props.onDayMouseLeave(e,t,s,n)}),a()(this,"handleDayTouchMove",(e,t,s)=>{const n=this.filterEventsByDay(e);this.props.onDayTouchMove(e,t,s,n)})}isSameDay(e,t){return e=this.props.moment(e),t=this.props.moment(t),e.isSame(t,"day")}filterEventsByDay(e){if(!this.props.events)return[];let t,s;const n=[];for(t=0;t<this.props.events.length;t++)s=this.props.events[t],this.isSameDay(s.date,e)&&(void 0===s.id&&(s.id="event-".concat(t)),n.push(s));return n}getLocaleUtils(){const e=this.props,t=e.moment,s=e.localeUtils,n=t().localeData().firstDayOfWeek(),i=t.weekdaysMin(),o=t.weekdays(),a={formatDay:function(e){return t(e).format("llll")},formatMonthTitle:function(e){return t(e).format("MMMM YYYY")},formatWeekdayShort:function(e){return Object(m.get)(i,e," ")[0]},formatWeekdayLong:function(e){return o[e]},getFirstDayOfWeek:function(){return n},formatMonthShort:function(e){return t(e.toISOString()).format("MMM")}};return Object(m.merge)({},a,s)}getDateInstance(e){return this.props.moment.isMoment(e)?e.toDate():e instanceof Number||"number"==typeof e?new Date(e):e}render(){const e=i()({},this.props.modifiers,{"past-days":{before:new Date},sunday:{daysOfWeek:[0]}});this.props.selectedDay&&(e["is-selected"]=this.getDateInstance(this.props.selectedDay)),this.props.events&&this.props.events.length&&(e.events=Object(m.map)(Object(m.filter)(this.props.events,e=>e.date),e=>this.getDateInstance(e.date)));const t=this.props.numberOfMonths||1,s=e.start&&e.end,n=b()(i()({"date-picker":!0,"date-picker--no-range-selected":!s,"date-picker--range-selected":s,["date-picker--".concat(t,"up")]:!0},this.props.rootClassNames));return c.a.createElement(u.a,{modifiers:e,className:n,disabledDays:this.props.disabledDays,initialMonth:this.props.calendarInitialDate,month:this.props.calendarViewDate,fromMonth:this.props.fromMonth,toMonth:this.props.toMonth,onDayClick:this.setCalendarDay,onDayTouchStart:this.setCalendarDay,onDayTouchEnd:this.setCalendarDay,onDayTouchMove:this.handleDayTouchMove,renderDay:this.renderDay,locale:this.props.locale,localeUtils:this.getLocaleUtils(),onMonthChange:this.props.onMonthChange,showOutsideDays:this.props.showOutsideDays,navbarElement:c.a.createElement(j,null),selectedDays:this.props.selectedDays,numberOfMonths:this.props.numberOfMonths})}}a()(_,"propTypes",{calendarViewDate:d.a.object,calendarInitialDate:d.a.object,showOutsideDays:d.a.bool,numberOfMonths:d.a.number,events:d.a.array,selectedDays:d.a.oneOfType([d.a.instanceOf(Date),d.a.shape({from:d.a.instanceOf(Date),to:d.a.instanceOf(Date)}),d.a.array,d.a.func]),disabledDays:d.a.array,locale:d.a.string,localeUtils:d.a.shape({formatDay:d.a.func,formatMonthTitle:d.a.func,formatWeekdayLong:d.a.func,formatWeekdayShort:d.a.func,getFirstDayOfWeek:d.a.func,getMonths:d.a.func}),modifiers:d.a.object,moment:d.a.func.isRequired,selectedDay:d.a.object,timeReference:d.a.object,onMonthChange:d.a.func,onSelectDay:d.a.func,onDayMouseEnter:d.a.func,onDayMouseLeave:d.a.func,toMonth:d.a.object,fromMonth:d.a.object,onDayTouchStart:d.a.func,onDayTouchEnd:d.a.func,onDayTouchMove:d.a.func,rootClassNames:d.a.object}),a()(_,"defaultProps",{showOutsideDays:!0,calendarViewDate:new Date,calendarInitialDate:new Date,modifiers:{},fromMonth:null,locale:"en",selectedDay:null,onMonthChange:m.noop,onSelectDay:m.noop,onDayMouseEnter:m.noop,onDayMouseLeave:m.noop,onDayTouchStart:m.noop,onDayTouchEnd:m.noop,onDayTouchMove:m.noop,rootClassNames:{}});t.a=Object(h.localize)(_)},"./client/components/ellipsis-menu/index.jsx":function(e,t,s){"use strict";var n=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),i=s.n(n),o=s("./node_modules/prop-types/index.js"),a=s.n(o),r=s("./node_modules/react/index.js"),c=s.n(r),l=s("./node_modules/classnames/index.js"),d=s.n(l),p=s("./packages/i18n-calypso/dist/esm/index.js"),u=s("./node_modules/lodash/lodash.js"),m=s("./client/components/gridicon/index.jsx"),h=s("./client/components/button/index.jsx"),g=s("./client/components/popover/menu.jsx");s("./client/components/ellipsis-menu/style.scss");class b extends r.Component{constructor(){super(...arguments),i()(this,"state",{isMenuVisible:!1}),i()(this,"popoverContext",c.a.createRef()),i()(this,"handleClick",e=>{const t=this.props.onClick,s=this.state.isMenuVisible;t(e),s?this.hideMenu():this.showMenu()}),i()(this,"hideMenu",()=>this.toggleMenu(!1)),i()(this,"showMenu",()=>this.toggleMenu(!0))}toggleMenu(e){this.props.disabled||(this.setState({isMenuVisible:e}),this.props.onToggle(e))}render(){const e=this.props,t=e.toggleTitle,s=e.translate,n=e.position,i=e.children,o=e.disabled,a=e.className,r=e.popoverClassName,l=this.state.isMenuVisible,p=d()("ellipsis-menu",a,{"is-menu-visible":l,"is-disabled":o}),u=d()("ellipsis-menu__menu","popover",r);return c.a.createElement("span",{className:p},c.a.createElement(h.a,{ref:this.popoverContext,onClick:this.handleClick,title:t||s("Toggle menu"),borderless:!0,disabled:o,className:"ellipsis-menu__toggle"},c.a.createElement(m.a,{icon:"ellipsis",className:"ellipsis-menu__toggle-icon"})),c.a.createElement(g.a,{isVisible:l,onClose:this.hideMenu,position:n,context:this.popoverContext.current,className:u},i))}}i()(b,"propTypes",{translate:a.a.func,toggleTitle:a.a.string,position:a.a.string,disabled:a.a.bool,onClick:a.a.func,onToggle:a.a.func,popoverClassName:a.a.string}),i()(b,"defaultProps",{onClick:u.noop,onToggle:u.noop}),t.a=Object(p.localize)(b)},"./client/components/ellipsis-menu/style.scss":function(e,t,s){},"./client/components/email-verification/email-verification-dialog/index.jsx":function(e,t,s){"use strict";var n=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),i=s.n(n),o=s("./node_modules/prop-types/index.js"),a=s.n(o),r=s("./node_modules/react/index.js"),c=s.n(r),l=s("./node_modules/lodash/lodash.js"),d=s("./packages/i18n-calypso/dist/esm/index.js"),p=s("./node_modules/react-redux/es/index.js"),u=s("./client/components/dialog/index.jsx"),m=s("./client/components/button/index.jsx"),h=s("./client/components/spinner/index.jsx"),g=s("./client/state/current-user/selectors.js"),b=s("./client/state/data-layer/wpcom-http/actions.js"),f=s("./client/state/data-layer/wpcom-http/utils.js"),y=s("./client/state/data-layer/handler-registry.js");const E=Object(f.a)({fetch:e=>Object(b.a)({apiVersion:"1.1",method:"POST",path:"/me/send-verification-email"},e),onSuccess:()=>({type:"EMAIL_VERIFY_REQUEST_SUCCESS"}),onError:(e,t)=>({type:"EMAIL_VERIFY_REQUEST_FAILURE",message:t.message})});Object(y.b)("state/data-layer/wpcom/me/send-verification-email/index.js",{EMAIL_VERIFY_REQUEST:[E]});s("./client/components/email-verification/email-verification-dialog/style.scss");class v extends r.Component{constructor(){super(...arguments),i()(this,"handleClose",()=>{this.props.resetVerifyEmailState(),this.props.onClose()})}getResendButtonLabel(){return"sent"===this.props.emailVerificationStatus||"error"===this.props.emailVerificationStatus?this.props.translate("Email Sent"):"requesting"===this.props.emailVerificationStatus?c.a.createElement(h.a,{className:"email-verification-dialog__confirmation-dialog-spinner"}):this.props.translate("Resend Email")}getDialogButtons(){return[c.a.createElement(m.a,{key:"resend",primary:!1,disabled:Object(l.includes)(["requesting","sent","error"],this.props.emailVerificationStatus),onClick:this.props.verifyEmail},this.getResendButtonLabel()),c.a.createElement(m.a,{key:"close",primary:!0,onClick:this.handleClose},this.props.translate("OK"))]}render(){const e={confirmHeading:this.props.translate("Please verify your email address:"),confirmExplanation:this.props.translate("When you first signed up for a WordPress.com account we sent you an email. Please open it and click on the blue button to verify your email address."),confirmReasoning:this.props.translate("Verifying your email allows us to assist you if you ever lose access to your account in the future."),confirmEmail:this.props.translate("{{wrapper}}%(email)s{{/wrapper}} {{emailPreferences}}change{{/emailPreferences}}",{components:{wrapper:c.a.createElement("span",{className:"email-verification-dialog__confirmation-dialog-email-wrapper"}),emailPreferences:c.a.createElement("a",{href:"/me/account"})},args:{email:this.props.email}})};return c.a.createElement(u.a,{isVisible:!0,buttons:this.getDialogButtons(),additionalClassNames:"email-verification-dialog__confirmation-dialog is-narrow"},c.a.createElement("h1",{className:"email-verification-dialog__confirmation-dialog-heading is-variable-height"},e.confirmHeading),c.a.createElement("p",{className:"email-verification-dialog__confirmation-dialog-email"},e.confirmEmail),c.a.createElement("p",{className:"email-verification-dialog__confirmation-dialog-explanation"},e.confirmExplanation),c.a.createElement("p",{className:"email-verification-dialog__confirmation-dialog-reasoning"},e.confirmReasoning))}}v.propTypes={onClose:a.a.func,translate:a.a.func,email:a.a.string,emailVerificationStatus:a.a.string},v.defaultProps={onClose:l.noop};t.a=Object(p.b)(e=>({email:Object(g.f)(e),emailVerificationStatus:Object(l.get)(e,"currentUser.emailVerification.status")}),{verifyEmail:()=>({type:"EMAIL_VERIFY_REQUEST"}),resetVerifyEmailState:()=>({type:"EMAIL_VERIFY_STATE_RESET"})})(Object(d.localize)(v))},"./client/components/email-verification/email-verification-dialog/style.scss":function(e,t,s){},"./client/components/foldable-card/index.jsx":function(e,t,s){"use strict";var n=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),i=s.n(n),o=s("./node_modules/prop-types/index.js"),a=s.n(o),r=s("./node_modules/react/index.js"),c=s.n(r),l=s("./node_modules/classnames/index.js"),d=s.n(l),p=s("./packages/i18n-calypso/dist/esm/index.js"),u=s("./node_modules/lodash/lodash.js"),m=s("./client/components/card/index.jsx"),h=s("./client/components/card/compact.jsx"),g=s("./client/components/gridicon/index.jsx"),b=s("./client/components/screen-reader-text/index.js");s("./client/components/foldable-card/style.scss");class f extends r.Component{constructor(){super(...arguments),i()(this,"state",{expanded:this.props.expanded}),i()(this,"onClick",()=>{this.props.children&&this.setState({expanded:!this.state.expanded}),this.props.onClick&&this.props.onClick(),this.state.expanded?this.props.onClose(this.props.cardKey):this.props.onOpen(this.props.cardKey)})}componentWillReceiveProps(e){e.expanded!==this.props.expanded&&this.setState({expanded:e.expanded})}getClickAction(){if(!this.props.disabled)return this.onClick}getActionButton(){return this.state.expanded&&this.props.actionButtonExpanded||this.props.actionButton}renderActionButton(){const e=this.props.clickableHeader?null:this.getClickAction();if(this.props.actionButton)return c.a.createElement("div",{className:"foldable-card__action",role:"presentation",onClick:e},this.getActionButton());if(this.props.children){const t=24,s=this.props.screenReaderText||this.props.translate("More");return c.a.createElement("button",{disabled:this.props.disabled,type:"button",className:"foldable-card__action foldable-card__expand",onClick:e},c.a.createElement(b.a,null,s),c.a.createElement(g.a,{icon:this.props.icon,size:t}))}}renderContent(){return c.a.createElement("div",{className:"foldable-card__content"},this.props.children)}renderHeader(){const e=this.props.summary?c.a.createElement("span",{className:"foldable-card__summary"},this.props.summary," "):null,t=this.props.expandedSummary?c.a.createElement("span",{className:"foldable-card__summary-expanded"},this.props.expandedSummary," "):null,s=this.props.clickableHeader?this.getClickAction():null,n=d()("foldable-card__header",{"is-clickable":!!this.props.clickableHeader,"has-border":!!this.props.summary});return c.a.createElement("div",{className:n,role:"presentation",onClick:s},c.a.createElement("span",{className:"foldable-card__main"},this.props.header," "),c.a.createElement("span",{className:"foldable-card__secondary"},e,t,this.renderActionButton()))}render(){const e=this.props.compact?h.a:m.a,t=d()("foldable-card",this.props.className,{"is-disabled":!!this.props.disabled,"is-expanded":!!this.state.expanded,"has-expanded-summary":!!this.props.expandedSummary});return c.a.createElement(e,{className:t},this.renderHeader(),this.state.expanded&&this.renderContent())}}i()(f,"displayName","FoldableCard"),i()(f,"propTypes",{actionButton:a.a.element,actionButtonExpanded:a.a.element,cardKey:a.a.string,compact:a.a.bool,disabled:a.a.bool,expandedSummary:a.a.oneOfType([a.a.string,a.a.element]),expanded:a.a.bool,icon:a.a.string,onClick:a.a.func,onClose:a.a.func,onOpen:a.a.func,screenReaderText:a.a.oneOfType([a.a.string,a.a.bool]),summary:a.a.oneOfType([a.a.string,a.a.element])}),i()(f,"defaultProps",{onOpen:u.noop,onClose:u.noop,cardKey:"",icon:"chevron-down",expanded:!1,screenReaderText:!1}),t.a=Object(p.localize)(f)},"./client/components/foldable-card/style.scss":function(e,t,s){},"./client/components/forms/form-currency-input/index.jsx":function(e,t,s){"use strict";var n=s("./node_modules/@babel/runtime/helpers/extends.js"),i=s.n(n),o=s("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),a=s.n(o),r=s("./node_modules/react/index.js"),c=s.n(r),l=s("./node_modules/prop-types/index.js"),d=s.n(l),p=s("./node_modules/classnames/index.js"),u=s.n(p),m=s("./client/components/gridicon/index.jsx"),h=s("./node_modules/lodash/lodash.js"),g=s("./client/components/forms/form-text-input-with-affixes/index.jsx");function b(e,t,s){if(!e)return null;if(!s)return e;const n=Object(h.get)(Object(h.find)(s,t=>t.code===e),"label",e);return c.a.createElement("span",{className:"form-currency-input__affix"},n,c.a.createElement(m.a,{icon:"chevron-down",size:18,className:"form-currency-input__select-icon"}),c.a.createElement("select",{className:"form-currency-input__select",value:e,onChange:t},s.map(e=>{let t=e.code,s=e.label,n=void 0===s?t:s;return c.a.createElement("option",{key:t,value:t},n)})))}function f(e){let t=e.className,s=e.currencySymbolPrefix,n=e.currencySymbolSuffix,o=e.onCurrencyChange,r=e.currencyList,l=e.placeholder,d=void 0===l?"0.00":l,p=a()(e,["className","currencySymbolPrefix","currencySymbolSuffix","onCurrencyChange","currencyList","placeholder"]);const m=u()("form-currency-input",t),h=b(s,o,r),f=b(n,o,r);return c.a.createElement(g.a,i()({},p,{type:"number",className:m,prefix:h,suffix:f,placeholder:d}))}const y=d.a.shape({code:d.a.string.isRequired,label:d.a.string});f.propTypes={currencySymbolPrefix:d.a.oneOfType([d.a.string,d.a.object]),currencySymbolSuffix:d.a.oneOfType([d.a.string,d.a.object]),onCurrencyChange:d.a.func,currencyList:d.a.arrayOf(y)},t.a=f},"./client/components/forms/form-input-validation/index.jsx":function(e,t,s){"use strict";s.d(t,"a",function(){return u});var n=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),i=s.n(n),o=s("./node_modules/react/index.js"),a=s.n(o),r=s("./node_modules/prop-types/index.js"),c=s.n(r),l=s("./node_modules/classnames/index.js"),d=s.n(l),p=s("./client/components/gridicon/index.jsx");class u extends a.a.Component{render(){const e=d()(this.props.className,{"form-input-validation":!0,"is-warning":this.props.isWarning,"is-error":this.props.isError,"is-hidden":this.props.isHidden}),t=this.props.isError||this.props.isWarning?"notice-outline":"checkmark";return a.a.createElement("div",{className:e,role:"alert"},a.a.createElement("span",{id:this.props.id},a.a.createElement(p.a,{size:24,icon:this.props.icon?this.props.icon:t})," ",this.props.text))}}i()(u,"displayName","FormInputValidation"),i()(u,"propTypes",{isError:c.a.bool,isWarning:c.a.bool,text:c.a.node,icon:c.a.string,id:c.a.string}),i()(u,"defaultProps",{isError:!1,id:null})},"./client/components/forms/form-label/index.jsx":function(e,t,s){"use strict";var n=s("./node_modules/@babel/runtime/helpers/extends.js"),i=s.n(n),o=s("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),a=s.n(o),r=s("./node_modules/@babel/runtime/helpers/objectSpread.js"),c=s.n(r),l=s("./node_modules/react/index.js"),d=s.n(l),p=s("./node_modules/prop-types/index.js"),u=s.n(p),m=s("./node_modules/classnames/index.js"),h=s.n(m),g=s("./packages/i18n-calypso/dist/esm/index.js"),b=s("./node_modules/lodash/lodash.js");const f=e=>{let t=e.children,s=e.required,n=e.optional,o=e.translate,r=e.className,l=a()(e,["children","required","optional","translate","className"]);return t=d.a.Children.toArray(t)||[],s&&t.push((e=>d.a.createElement("small",{className:"form-label__required"},e("Required")))(o)),n&&t.push((e=>d.a.createElement("small",{className:"form-label__optional"},e("Optional")))(o)),d.a.createElement("label",i()({},Object(b.omit)(l,"moment","numberFormat"),{className:h()(r,"form-label")}),t.length?(e=>e.map((e,t)=>Object(b.isObject)(e)?c()({},e,{key:t}):e))(t):null)};f.propTypes={required:u.a.bool},t.a=Object(g.localize)(f)},"./client/components/forms/form-legend/index.jsx":function(e,t,s){"use strict";var n=s("./node_modules/@babel/runtime/helpers/extends.js"),i=s.n(n),o=s("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),a=s.n(o),r=s("./node_modules/react/index.js"),c=s.n(r),l=s("./node_modules/classnames/index.js"),d=s.n(l);t.a=(e=>{let t=e.className,s=e.children,n=a()(e,["className","children"]);return c.a.createElement("legend",i()({},n,{className:d()(t,"form-legend")}),s)})},"./client/components/forms/form-radio/index.jsx":function(e,t,s){"use strict";var n=s("./node_modules/@babel/runtime/helpers/extends.js"),i=s.n(n),o=s("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),a=s.n(o),r=s("./node_modules/react/index.js"),c=s.n(r),l=s("./node_modules/classnames/index.js"),d=s.n(l);t.a=(e=>{let t=e.className,s=a()(e,["className"]);return c.a.createElement("input",i()({},s,{type:"radio",className:d()(t,"form-radio")}))})},"./client/components/forms/form-section-heading/index.jsx":function(e,t,s){"use strict";var n=s("./node_modules/@babel/runtime/helpers/extends.js"),i=s.n(n),o=s("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),a=s.n(o),r=s("./node_modules/react/index.js"),c=s.n(r),l=s("./node_modules/classnames/index.js"),d=s.n(l);t.a=(e=>{let t=e.className,s=e.children,n=a()(e,["className","children"]);return c.a.createElement("h3",i()({},n,{className:d()(t,"form-section-heading")}),s)})},"./client/components/forms/form-select/index.jsx":function(e,t,s){"use strict";var n=s("./node_modules/@babel/runtime/helpers/extends.js"),i=s.n(n),o=s("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),a=s.n(o),r=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),c=s.n(r),l=s("./node_modules/react/index.js"),d=s.n(l),p=s("./node_modules/classnames/index.js"),u=s.n(p);class m extends d.a.Component{render(){const e=this.props,t=e.inputRef,s=e.className,n=e.isError,o=a()(e,["inputRef","className","isError"]),r=u()(s,"form-select",{"is-error":n});return d.a.createElement("select",i()({},o,{ref:t,className:r}),this.props.children)}}c()(m,"defaultProps",{isError:!1}),t.a=m},"./client/components/forms/form-setting-explanation/index.jsx":function(e,t,s){"use strict";s.d(t,"a",function(){return h});var n=s("./node_modules/@babel/runtime/helpers/extends.js"),i=s.n(n),o=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),a=s.n(o),r=s("./node_modules/react/index.js"),c=s.n(r),l=s("./node_modules/prop-types/index.js"),d=s.n(l),p=s("./node_modules/classnames/index.js"),u=s.n(p),m=s("./node_modules/lodash/lodash.js");class h extends c.a.Component{render(){const e=u()(this.props.className,"form-setting-explanation",{"no-validate":this.props.noValidate,"is-indented":this.props.isIndented});return c.a.createElement("p",i()({},Object(m.omit)(this.props,"className","noValidate","isIndented"),{className:e}),this.props.children)}}a()(h,"displayName","FormSettingExplanation"),a()(h,"propTypes",{noValidate:d.a.bool,isIndented:d.a.bool,className:d.a.string}),a()(h,"defaultProps",{noValidate:!1,isIndented:!1})},"./client/components/forms/form-text-input-with-affixes/index.jsx":function(e,t,s){"use strict";s.d(t,"a",function(){return h});var n=s("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),i=s.n(n),o=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),a=s.n(o),r=s("./node_modules/react/index.js"),c=s.n(r),l=s("./node_modules/prop-types/index.js"),d=s.n(l),p=s("./node_modules/classnames/index.js"),u=s.n(p),m=s("./client/components/forms/form-text-input/index.jsx");class h extends c.a.Component{render(){const e=this.props,t=e.noWrap,s=e.prefix,n=e.suffix,o=i()(e,["noWrap","prefix","suffix"]);return c.a.createElement("div",{className:u()("form-text-input-with-affixes",{"no-wrap":t})},s&&c.a.createElement("span",{className:"form-text-input-with-affixes__prefix"},s),c.a.createElement(m.a,o),n&&c.a.createElement("span",{className:"form-text-input-with-affixes__suffix"},n))}}a()(h,"displayName","FormTextInputWithAffixes"),a()(h,"propTypes",{noWrap:d.a.bool,prefix:d.a.node,suffix:d.a.node})},"./client/components/forms/sortable-list/index.jsx":function(e,t,s){"use strict";var n=s("./node_modules/@babel/runtime/helpers/extends.js"),i=s.n(n),o=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),a=s.n(o),r=s("./node_modules/react/index.js"),c=s.n(r),l=s("./node_modules/prop-types/index.js"),d=s.n(l),p=s("./packages/i18n-calypso/dist/esm/index.js"),u=s("./node_modules/lodash/lodash.js"),m=s("./node_modules/classnames/index.js"),h=s.n(m),g=s("./node_modules/debug/src/browser.js"),b=s.n(g),f=s("./client/components/gridicon/index.jsx"),y=s("./client/components/screen-reader-text/index.js"),E=s("./client/lib/touch-detect/index.js");const v=b()("calypso:forms:sortable-list");class j extends c.a.Component{constructor(){super(...arguments),a()(this,"state",{activeIndex:null,activeOrder:null,position:null}),a()(this,"getPositionForCursorElement",(e,t)=>({top:t.clientY-e.clientHeight/2,left:t.clientX-e.clientWidth/2})),a()(this,"compareCursorVerticalToElement",(e,t)=>{const s=e.getBoundingClientRect();return t.clientY<s.top?-1:t.clientY>s.bottom?1:0}),a()(this,"isCursorBeyondElementThreshold",(e,t,s,n)=>{const i=e.getBoundingClientRect();switch(t){case"top":return n.clientY<=i.top+i.height/2;case"right":return n.clientX>=i.left+i.width/2&&("top"===s||n.clientY>=i.top)&&("bottom"===s||n.clientY<=i.bottom);case"bottom":return n.clientY>=i.top+i.height/2;case"left":return n.clientX<=i.left+i.width/2&&("top"===s||n.clientY>=i.top)&&("bottom"===s||n.clientY<=i.bottom);default:return!1}}),a()(this,"getAdjustedElementIndex",e=>this.state.activeOrder?this.state.activeOrder[e]:e),a()(this,"getCursorElementIndex",e=>{let t,s=this.compareCursorVerticalToElement(this.refs.list,e),n=this.getAdjustedElementIndex(this.state.activeIndex),i=this.refs["wrap-shadow-"+this.state.activeIndex].getBoundingClientRect();return t=Object(u.findIndex)(this.props.children,(t,o)=>{let a,r,c;return o!==this.state.activeIndex&&(r=this.getAdjustedElementIndex(o),"horizontal"===this.props.direction&&(1===s&&this.refs["wrap-"+o].getBoundingClientRect().top>=i.top?c="bottom":-1===s&&this.refs["wrap-"+o].getBoundingClientRect().bottom<=i.bottom&&(c="top")),r<n?a=this.isCursorBeyondElementThreshold(this.refs["wrap-"+o],"horizontal"===this.props.direction?"left":"top",c,e):r>n&&(a=a||this.isCursorBeyondElementThreshold(this.refs["wrap-"+o],"horizontal"===this.props.direction?"right":"bottom",c,e)),a)}),this.getAdjustedElementIndex(t)}),a()(this,"moveItem",e=>{let t="previous"===e?-1:1,s=Object.keys(this.props.children).map(Number);s[this.state.activeIndex+t]=this.state.activeIndex,s[this.state.activeIndex]=this.state.activeIndex+t,this.props.onChange(s),this.setState({activeIndex:s[this.state.activeIndex]})}),a()(this,"onMouseDown",(e,t)=>{this.setState({activeIndex:e,position:this.getPositionForCursorElement(t.currentTarget.firstChild,t)})}),a()(this,"onMouseMove",e=>{let t,s;if(null!==this.state.activeIndex&&this.props.allowDrag&&!Object(E.a)()){if(t=this.state.activeOrder,(s=this.getCursorElementIndex(e))>=0)if(this.state.activeIndex===s)t=null;else{for(let e=0,n=(t=Object.keys(this.props.children).map(Number)).length;e<n;e++)e>=s&&e<this.state.activeIndex?t[e]=e+1:e<=s&&e>this.state.activeIndex&&(t[e]=e-1);t[this.state.activeIndex]=s}this.setState({position:this.getPositionForCursorElement(this.refs["wrap-"+this.state.activeIndex].firstChild,e),activeOrder:t})}}),a()(this,"onMouseUp",()=>{this.state.activeOrder&&this.props.onChange(this.state.activeOrder),this.setState({activeIndex:null,activeOrder:null,position:null})}),a()(this,"onClick",e=>{this.setState({activeIndex:e})}),a()(this,"getOrderedListItemElements",()=>c.a.Children.map(this.props.children,function(e,t){let s,n=this.state.activeIndex===t,o=this.props.allowDrag&&!Object(E.a)(),a=o?["onMouseDown","onMouseUp"]:["onClick"],r={order:this.getAdjustedElementIndex(t)},l=h()({"sortable-list__item":!0,"is-active":n,"is-draggable":o});return a=Object(u.fromPairs)(a.map(function(e){return[e,this[e].bind(null,t)]},this)),n&&Object(u.assign)(r,this.state.position),s=c.a.createElement("li",i()({ref:"wrap-"+t,key:"wrap-"+t},a,{className:l,style:r}),e),n&&o?[c.a.createElement("li",{ref:"wrap-shadow-"+t,key:"wrap-shadow-"+t,className:"sortable-list__item is-shadow",style:r},e),s]:s},this)),a()(this,"getNavigationElement",()=>{if(!this.props.allowDrag||Object(E.a)())return c.a.createElement("div",{className:"sortable-list__navigation"},c.a.createElement("button",{type:"button",onClick:this.moveItem.bind(null,"previous"),className:"sortable-list__navigation-button is-previous",disabled:null===this.state.activeIndex||0===this.state.activeIndex},c.a.createElement(y.a,null,this.props.translate("Move previous")),c.a.createElement(f.a,{icon:"chevron-down",size:24})),c.a.createElement("button",{type:"button",onClick:this.moveItem.bind(null,"next"),className:"sortable-list__navigation-button is-next",disabled:null===this.state.activeIndex||this.state.activeIndex===this.props.children.length-1},c.a.createElement(y.a,null,this.props.translate("Move next")),c.a.createElement(f.a,{icon:"chevron-up",size:24})))})}componentWillMount(){v("Mounting "+this.constructor.displayName+" React component.")}componentDidMount(){Object(E.a)()||(document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp))}componentWillUnmount(){document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp)}render(){const e=h()({"sortable-list":!0,"is-horizontal":"horizontal"===this.props.direction,"is-vertical":"vertical"===this.props.direction});return c.a.createElement("div",{className:e},c.a.createElement("ol",{ref:"list",className:"sortable-list__list"},this.getOrderedListItemElements()),this.getNavigationElement())}}a()(j,"propTypes",{direction:d.a.oneOf(["horizontal","vertical"]),allowDrag:d.a.bool,onChange:d.a.func}),a()(j,"defaultProps",{direction:"horizontal",allowDrag:!0,onChange:u.noop}),t.a=Object(p.localize)(j)},"./client/components/gallery-shortcode/index.jsx":function(e,t,s){"use strict";s.d(t,"a",function(){return j});var n=s("./node_modules/@babel/runtime/helpers/extends.js"),i=s.n(n),o=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),a=s.n(o),r=s("./node_modules/prop-types/index.js"),c=s.n(r),l=s("./node_modules/react/index.js"),d=s.n(l),p=s("./node_modules/classnames/index.js"),u=s.n(p),m=s("./node_modules/debug/src/browser.js"),h=s.n(m),g=s("./node_modules/lodash/lodash.js"),b=s("./client/blocks/shortcode/index.js"),f=s("./client/lib/shortcode/index.js"),y=s("./client/lib/media/utils.js"),E=s("./client/lib/media/constants.js");const v=h()("calypso:gallery-shortcode");class j extends d.a.Component{constructor(){super(...arguments),a()(this,"filterRenderResult",e=>{if(!e.body&&!e.scripts&&!e.styles)return e;const t=Object(g.assign)({},e,{scripts:{"tiled-gallery":{src:"https://s0.wp.com/wp-content/mu-plugins/tiled-gallery/tiled-gallery.js"}},styles:{"tiled-gallery":{src:"https://s0.wp.com/wp-content/mu-plugins/tiled-gallery/tiled-gallery.css"},"gallery-styles":{src:"https://widgets.wp.com/gallery-preview/style.css"}}});return"slideshow"===this.getAttributes().type&&Object(g.assign)(t,{scripts:{"jquery-cycle":{src:"https://s0.wp.com/wp-content/mu-plugins/shortcodes/js/jquery.cycle.min.js"},"jetpack-slideshow":{src:"https://s0.wp.com/wp-content/mu-plugins/shortcodes/js/slideshow-shortcode.js",extra:'var jetpackSlideshowSettings = { "spinner": "https://s0.wp.com/wp-content/mu-plugins/shortcodes/img/slideshow-loader.gif" };'}},styles:{"jetpack-slideshow":{src:"https://s0.wp.com/wp-content/mu-plugins/shortcodes/css/slideshow-shortcode.css"}}}),t}),a()(this,"getAttributes",()=>{const e=Object(g.pick)(this.props,"items","type","columns","orderBy","link","size");return this.props.children&&Object(g.assign)(e,Object(f.b)(this.props.children).attrs.named),e}),a()(this,"getShortcode",()=>this.props.children?this.props.children:Object(y.e)(this.getAttributes()))}render(){const e=this.getShortcode();if(!e)return null;const t=u()("gallery-shortcode",this.props.className);return v(e),d.a.createElement(b.a,i()({},Object(g.omit)(this.props,Object.keys(this.constructor.propTypes)),{siteId:this.props.siteId,filterRenderResult:this.filterRenderResult,className:t}),e)}}a()(j,"propTypes",{siteId:c.a.number.isRequired,children:c.a.string,items:c.a.array,type:c.a.string,columns:c.a.number,orderBy:c.a.string,link:c.a.string,size:c.a.string,className:c.a.string}),a()(j,"defaultProps",E.b)},"./client/components/header-cake/index.jsx":function(e,t,s){"use strict";var n=s("./node_modules/prop-types/index.js"),i=s.n(n),o=s("./node_modules/react/index.js"),a=s.n(o),r=s("./node_modules/classnames/index.js"),c=s.n(r),l=s("./client/components/card/index.jsx"),d=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),p=s.n(d),u=s("./packages/i18n-calypso/dist/esm/index.js"),m=s("./client/components/gridicon/index.jsx"),h=s("./node_modules/lodash/lodash.js"),g=s("./client/components/button/index.jsx"),b=s("./client/lib/viewport/index.js");s("./client/components/header-cake/style.scss");const f={windowWidth:480,characterLength:8};class y extends o.Component{constructor(){super(...arguments),p()(this,"state",{windowWidth:Object(b.c)()}),p()(this,"handleWindowResize",()=>{this.setState({windowWidth:Object(b.c)()})})}componentDidMount(){this.resizeThrottled=Object(h.throttle)(this.handleWindowResize,100),window.addEventListener("resize",this.resizeThrottled)}componentWillUnmount(){window.removeEventListener("resize",this.resizeThrottled)}hideText(e){return!this.props.alwaysShowActionText&&(this.state.windowWidth<=f.windowWidth&&e.length>=f.characterLength||this.state.windowWidth<=300)}render(){const e=this.props,t=e.href,s=e.icon,n=e.onClick,i=e.spacer,o=e.text,r=e.translate,l=void 0===o?r("Back"):o,d=c()({"header-cake__back":!0,"is-spacer":i,"is-action":!!s});return a.a.createElement(g.a,{compact:!0,borderless:!0,className:d,href:t,onClick:n,disabled:i},a.a.createElement(m.a,{icon:s||"arrow-left",size:18}),!this.hideText(l)&&l)}}p()(y,"propTypes",{onClick:i.a.func,href:i.a.string,text:i.a.string,spacer:i.a.bool,alwaysShowActionText:i.a.bool}),p()(y,"defaultProps",{spacer:!1,disabled:!1,alwaysShowActionText:!1});var E=Object(u.localize)(y);s.d(t,"a",function(){return v});class v extends o.Component{render(){const e=this.props,t=e.backText,s=e.backHref,n=e.actionButton,i=e.actionText,o=e.actionIcon,r=e.actionHref,d=e.actionOnClick,p=e.alwaysShowActionText,u=c()("header-cake",this.props.className,{"is-compact":this.props.isCompact});return a.a.createElement(l.a,{className:u},a.a.createElement(E,{text:t,href:s,onClick:this.props.onClick}),a.a.createElement("div",{className:"header-cake__title",role:"presentation",onClick:this.props.onTitleClick},this.props.children),n||a.a.createElement(E,{text:i||t,href:r||s,onClick:d,icon:o,alwaysShowActionText:p,spacer:!d}))}}v.displayName="HeaderCake",v.propTypes={onClick:i.a.func,onTitleClick:i.a.func,backText:i.a.string,backHref:i.a.string,actionButton:i.a.element,actionText:i.a.string,actionHref:i.a.string,actionIcon:i.a.string,actionOnClick:i.a.func,alwaysShowActionText:i.a.bool},v.defaultProps={isCompact:!1,alwaysShowActionText:!1}},"./client/components/header-cake/style.scss":function(e,t,s){},"./client/components/info-popover/index.jsx":function(e,t,s){"use strict";s.d(t,"a",function(){return h});var n=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),i=s.n(n),o=s("./node_modules/react/index.js"),a=s.n(o),r=s("./node_modules/prop-types/index.js"),c=s.n(r),l=s("./client/components/gridicon/index.jsx"),d=s("./node_modules/classnames/index.js"),p=s.n(d),u=s("./client/components/popover/index.jsx"),m=s("./client/lib/analytics/index.js");class h extends o.Component{constructor(){super(...arguments),i()(this,"state",{showPopover:!1}),i()(this,"handleClick",e=>{e.preventDefault(),e.stopPropagation(),this.setState({showPopover:!this.state.showPopover},this.recordStats)}),i()(this,"handleClose",()=>this.setState({showPopover:!1},this.recordStats)),i()(this,"recordStats",()=>{const e=this.props,t=e.gaEventCategory,s=e.popoverName;if(t&&s){const e=this.state.showPopover?" Opened":" Closed";m.default.ga.recordEvent(t,"InfoPopover: "+s+e)}})}render(){return a.a.createElement("span",{onClick:this.handleClick,ref:"infoPopover",className:p()("info-popover",{is_active:this.state.showPopover},this.props.className)},a.a.createElement(l.a,{icon:this.props.icon,size:this.props.iconSize}),a.a.createElement(u.a,{autoRtl:this.props.autoRtl,id:this.props.id,isVisible:this.state.showPopover,context:this.refs&&this.refs.infoPopover,ignoreContext:this.props.ignoreContext,position:this.props.position,onClose:this.handleClose,className:p()("popover","info-popover__tooltip",this.props.className),rootClassName:this.props.rootClassName},this.props.children))}}i()(h,"propTypes",{autoRtl:c.a.bool,className:c.a.string,gaEventCategory:c.a.string,icon:c.a.string,iconSize:c.a.number,id:c.a.string,ignoreContext:c.a.shape({getDOMNode:c.a.func}),popoverName:c.a.string,position:c.a.oneOf(["top","top right","right","bottom right","bottom","bottom left","left","top left"]),rootClassName:c.a.string}),i()(h,"defaultProps",{autoRtl:!0,icon:"info-outline",iconSize:18,position:"bottom"})},"./client/components/input-chrono/index.jsx":function(e,t,s){"use strict";var n=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),i=s.n(n),o=s("./node_modules/prop-types/index.js"),a=s.n(o),r=s("./packages/i18n-calypso/dist/esm/index.js"),c=s("./node_modules/react/index.js"),l=s.n(c),d=s("./node_modules/chrono-node/src/chrono.js"),p=s.n(d);s("./client/components/input-chrono/style.scss");const u=["en","jp"];class m extends l.a.Component{constructor(){super(...arguments),i()(this,"state",{value:this.props.value}),i()(this,"focused",!1),i()(this,"handleChange",e=>{this.setState({value:e.target.value})}),i()(this,"handleBlur",e=>{this.setDateText(e),this.focused=!1}),i()(this,"handleFocus",()=>{this.focused=!0}),i()(this,"onKeyDown",e=>{13===e.keyCode&&this.setDateText(e)}),i()(this,"setDateText",e=>{const t=p.a.parseDate(e.target.value);t&&(this.setState({value:this.props.moment(t).calendar()}),this.props.onSet(this.props.moment(t)))}),i()(this,"isLangSupported",e=>u.indexOf(e)>=0)}componentWillReceiveProps(e){this.focused||this.props.value===e.value||this.setState({value:e.value})}render(){return l.a.createElement("div",{className:"input-chrono"},this.isLangSupported(this.props.lang)?l.a.createElement("input",{className:"input-chrono__input",value:this.state.value,placeholder:this.props.placeholder,onKeyDown:this.onKeyDown,onChange:this.handleChange,onFocus:this.handleFocus,onBlur:this.handleBlur}):l.a.createElement("div",{className:"input-chrono__text"},this.state.value))}}i()(m,"displayName","InputChrono"),i()(m,"propTypes",{value:a.a.string,lang:a.a.string,onSet:a.a.func,placeholder:a.a.string}),i()(m,"defaultProps",{value:"",lang:"",placeholder:"",onSet:()=>{}}),t.a=Object(r.localize)(m)},"./client/components/input-chrono/style.scss":function(e,t,s){},"./client/components/localized-moment/index.js":function(e,t,s){"use strict";s.d(t,"b",function(){return l}),s.d(t,"a",function(){return d});var n=s("./node_modules/@babel/runtime/helpers/extends.js"),i=s.n(n),o=s("./node_modules/react/index.js"),a=s.n(o),r=s("./node_modules/@wordpress/compose/build-module/index.js"),c=s("./client/components/localized-moment/context.js");const l=Object(r.a)(e=>(function(t){return a.a.createElement(c.a.Consumer,null,s=>a.a.createElement(e,i()({},t,s)))}),"WithLocalizedMoment"),d=()=>{return a.a.useContext(c.a).moment}},"./client/components/podcast-indicator/index.jsx":function(e,t,s){"use strict";var n=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),i=s.n(n),o=s("./node_modules/classnames/index.js"),a=s.n(o),r=s("./node_modules/prop-types/index.js"),c=s.n(r),l=s("./node_modules/react/index.js"),d=s.n(l),p=s("./packages/i18n-calypso/dist/esm/index.js"),u=s("./client/components/gridicon/index.jsx"),m=s("./client/components/tooltip/index.jsx");s("./client/components/podcast-indicator/style.scss");class h extends d.a.Component{constructor(){super(...arguments),i()(this,"state",{tooltipVisible:!1}),i()(this,"tooltipContext",d.a.createRef()),i()(this,"showTooltip",()=>{this.setState({tooltipVisible:!0})}),i()(this,"hideTooltip",()=>{this.setState({tooltipVisible:!1})})}render(){const e=this.props,t=e.size,s=e.tooltipType,n=e.translate;let i=null;switch(s){case"category":i=n("Posts in this category are included in your Podcast feed");break;case"episode":i=n("Included in your Podcast feed")}const o=a()("podcast-indicator",this.props.className,{"is-compact":this.props.isCompact});return d.a.createElement("span",{className:o},d.a.createElement(u.a,{icon:"microphone",size:t,ref:this.tooltipContext,onMouseEnter:this.showTooltip,onMouseLeave:this.hideTooltip}),i&&d.a.createElement(m.a,{className:"podcast-indicator__tooltip",context:this.tooltipContext.current,isVisible:this.state.tooltipVisible,position:"bottom left"},i))}}i()(h,"propTypes",{size:c.a.number,tooltipType:c.a.oneOf(["category","episode",null])}),i()(h,"defaultProps",{size:18,tooltipType:"category"}),t.a=Object(p.localize)(h)},"./client/components/podcast-indicator/style.scss":function(e,t,s){},"./client/components/popover/menu-item.jsx":function(e,t,s){"use strict";s.d(t,"a",function(){return b});var n=s("./node_modules/@babel/runtime/helpers/extends.js"),i=s.n(n),o=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),a=s.n(o),r=s("./node_modules/prop-types/index.js"),c=s.n(r),l=s("./node_modules/react/index.js"),d=s.n(l),p=s("./node_modules/classnames/index.js"),u=s.n(p),m=s("./node_modules/lodash/lodash.js"),h=s("./client/components/gridicon/index.jsx"),g=s("./client/components/external-link/index.jsx");class b extends l.Component{constructor(){super(...arguments),a()(this,"handleMouseOver",e=>{this.props.focusOnHover&&e.target.focus(),this.props.onMouseOver()})}render(){const e=this.props,t=e.children,s=e.className,n=e.href,o=e.icon,a=e.isSelected,r=e.isExternalLink,c=Object(m.omit)(this.props,"icon","focusOnHover","isSelected","isExternalLink","className","itemComponent"),l=u()("popover__menu-item",s,{"is-selected":a});let p=this.props.itemComponent;return r&&n?(p=g.a,c.icon=!0):n&&(p="a"),d.a.createElement(p,i()({role:"menuitem",onMouseOver:this.handleMouseOver,tabIndex:"-1",className:l},c),o&&d.a.createElement(h.a,{icon:o,size:18}),t)}}a()(b,"propTypes",{href:c.a.string,className:c.a.string,isSelected:c.a.bool,icon:c.a.string,focusOnHover:c.a.bool,onMouseOver:c.a.func,isExternalLink:c.a.bool,itemComponent:c.a.oneOfType([c.a.func,c.a.string])}),a()(b,"defaultProps",{isSelected:!1,focusOnHover:!0,onMouseOver:m.noop,itemComponent:"button"})},"./client/components/post-schedule/index.jsx":function(e,t,s){"use strict";var n=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),i=s.n(n),o=s("./node_modules/prop-types/index.js"),a=s.n(o),r=s("./node_modules/react/index.js"),c=s.n(r),l=s("./node_modules/moment/moment.js"),d=s.n(l),p=s("./node_modules/classnames/index.js"),u=s.n(p),m=s("./node_modules/react-redux/es/index.js"),h=s("./client/components/input-chrono/index.jsx"),g=s("./client/components/date-picker/index.jsx"),b=s("./client/components/data/query-site-settings/index.js"),f=s("./client/components/date-picker/events-tooltip.jsx"),y=s("./client/state/current-user/selectors.js"),E=s("./packages/i18n-calypso/dist/esm/index.js"),v=s("./node_modules/lodash/lodash.js"),j=(s("./node_modules/moment-timezone/index.js"),s("./client/components/segmented-control/index.jsx")),_=s("./client/components/segmented-control/item.jsx"),x=s("./client/components/info-popover/index.jsx"),w=s("./client/components/localized-moment/index.js"),S=s("./client/state/selectors/get-site-setting.js"),C=s("./client/lib/viewport/index.js"),I=s("./client/components/post-schedule/utils.js");class O extends r.Component{constructor(){var e;super(...arguments),e=this,i()(this,"adjustHour",e=>this.handleKeyDown(e,"hour")),i()(this,"adjustMinute",e=>this.handleKeyDown(e,"minute")),i()(this,"setAm",e=>this.setAmPm(e,"AM")),i()(this,"setPm",e=>this.setAmPm(e,"PM")),i()(this,"amPmRef",c.a.createRef()),i()(this,"hourRef",c.a.createRef()),i()(this,"minRef",c.a.createRef()),i()(this,"setTime",function(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.getTimeValues();const n=e.props.moment(e.props.date).set(s);e.props.onChange(n,s)})}handleKeyDown(e,t){const s=e.keyCode-39,n=this.getTimeValues();if(-1!==s&&1!==s)return null;let i=Number(e.target.value);"hour"===t?(this.props.is12hour&&this.amPmRef.current&&(i=this.convertTo24Hour(i)),i=(i=(i-=s)>23?0:i)<0?23:i):i=(i=(i-=s)>59?0:i)<0?59:i,n[t]=i,this.setTime(e,n)}getTimeValues(){const e={},t=Object(I.g)(this.hourRef.current.value);let s=Object(I.g)(this.minRef.current.value);return!1!==t&&t<24&&(e.hour=Number(t)),this.props.is12hour&&this.amPmRef.current&&((void 0===e.hour||"PM"===this.amPmRef.current.value&&e.hour>12)&&(e.hour=Number(this.hourRef.current.value.substr(-1))),e.hour=this.convertTo24Hour(e.hour)),!1!==s&&(s>60&&(s=this.hourRef.current.value.substr(-1)),e.minute=Number(s)),e}setAmPm(e,t){this.amPmRef.current.value=t,this.setTime(e)}convertTo24Hour(e){return"PM"===this.amPmRef.current.value&&e<12?e+=12:"AM"===this.amPmRef.current.value&&12===e&&(e=0),e}renderTimezoneSection(){const e=this.props,t=e.date,s=e.gmtOffset,n=e.siteId,i=e.siteSlug,o=e.timezone,a=e.moment,r=e.translate;if(!o&&!Object(I.f)(s))return;let l,d;if(o){const e=t.clone().tz(o);d=e.format("Z"),l=e.utcOffset()-a(t).utcOffset()}else if(Object(I.f)(s)){l=t.clone().utcOffset(s).utcOffset()-a().utcOffset()}if(!l)return;const p=Object(C.e)()?"top":"right",u=r("This site timezone (%(timezoneText)s) will be used for publishing. You can change it in {{a}}General Settings{{/a}}.",{args:{timezoneText:o?"".concat(o.replace(/_/gi," ")," ").concat(d):"UTC".concat(Object(I.c)(s))},components:{a:c.a.createElement("a",{href:"/settings/general/".concat(i||n)})}});return c.a.createElement("span",null,c.a.createElement("div",{className:"post-schedule__clock-timezone"},r("This site timezone is %(diff)sh from your local timezone.",{args:{diff:Object(I.d)(l)}}),c.a.createElement(x.a,{className:"post-schedule__timezone-info",position:p},u)))}render(){const e=this.props,t=e.date,s=e.is12hour,n=e.translate;return c.a.createElement("div",{className:"post-schedule__clock"},c.a.createElement("input",{className:"post-schedule__clock-time",name:"post-schedule__clock_hour",ref:this.hourRef,value:t.format(s?"hh":"HH"),onChange:this.setTime,onKeyDown:this.adjustHour,type:"text"}),c.a.createElement("span",{className:"post-schedule__clock-divisor"},":"),c.a.createElement("input",{className:"post-schedule__clock-time",name:"post-schedule__clock_minute",ref:this.minRef,value:t.format("mm"),onChange:this.setTime,onKeyDown:this.adjustMinute,type:"text"}),s&&c.a.createElement("span",null,c.a.createElement("input",{type:"hidden",ref:this.amPmRef,name:"post-schedule__clock_am-pm",value:t.format("A")}),c.a.createElement(j.a,{compact:!0},c.a.createElement(_.a,{value:"am",onClick:this.setAm,selected:"AM"===t.format("A")},n("AM")),c.a.createElement(_.a,{value:"pm",onClick:this.setPm,selected:"PM"===t.format("A")},n("PM")))),this.renderTimezoneSection())}}O.propTypes={date:a.a.object.isRequired,timezone:a.a.string,gmtOffset:a.a.number,siteId:a.a.number,siteSlug:a.a.string,onChange:a.a.func},O.defaultProps={onChange:v.noop};var T=Object(v.flowRight)(Object(m.b)((e,t)=>{let s=t.siteId;return{is12hour:Object(I.e)(Object(S.a)(e,s,"time_format"))}}),E.localize,w.b)(O),P=s("./client/components/gridicon/index.jsx");class k extends c.a.Component{render(){return c.a.createElement("div",{className:"post-schedule__year-controls"},c.a.createElement("button",{className:"post-schedule__year-control-up",onClick:()=>{this.props.onYearChange(1)}},c.a.createElement(P.a,{icon:"chevron-up",size:14})),c.a.createElement("button",{className:"post-schedule__year-control-down",onClick:()=>{this.props.onYearChange(-1)}},c.a.createElement(P.a,{icon:"chevron-down",size:14})))}}i()(k,"displayName","PostScheduleHeaderControls"),i()(k,"propTypes",{onYearChange:a.a.func}),i()(k,"defaultProps",{onYearChange:()=>{}});class D extends c.a.Component{constructor(){super(...arguments),i()(this,"state",{showYearControls:!1}),i()(this,"setToCurrentMonth",()=>{const e=this.props,t=e.moment,s=e.date;(0,e.onDateChange)(t(s).month(t().month()))}),i()(this,"setToCurrentYear",()=>{const e=this.props,t=e.moment,s=e.date;(0,e.onDateChange)(t(s).year(t().year()))}),i()(this,"setYear",e=>{const t=this.props,s=t.moment,n=t.date,i=t.onDateChange,o=s(n).add(e,"y");if(0>o.year()||o.year()>9999)return null;i(o)})}render(){const e=u()("post-schedule__header",{"is-input-chrono-displayed":this.props.inputChronoDisplayed});return c.a.createElement("div",{className:e},c.a.createElement("span",{className:"post-schedule__header-month",onClick:this.setToCurrentMonth},this.props.date.clone().format("MMM")),c.a.createElement("div",{className:"post-schedule__header-year",onMouseEnter:()=>{this.setState({showYearControls:!0})},onMouseLeave:()=>{this.setState({showYearControls:!1})}},c.a.createElement("span",{onClick:this.setToCurrentYear},this.props.date.clone().format("YYYY")),this.state.showYearControls&&c.a.createElement(k,{onYearChange:this.setYear})))}}i()(D,"propTypes",{date:a.a.object,inputChronoDisplayed:a.a.bool,onDateChange:a.a.func}),i()(D,"defaultProps",{inputChronoDisplayed:!0,onDateChange:()=>{}});var N=Object(w.b)(D);s("./client/components/post-schedule/style.scss");const R=()=>{};class M extends r.Component{constructor(){super(...arguments),i()(this,"state",{calendarViewDate:d()(this.props.selectedDay?this.props.selectedDay:new Date),tooltipContext:null,showTooltip:!1}),i()(this,"setCurrentMonth",e=>{e=d()(e),this.props.onMonthChange(e),this.setState({calendarViewDate:e})}),i()(this,"setViewDate",e=>{this.setState({calendarViewDate:d()(e)})}),i()(this,"updateDate",e=>{const t=Object(I.a)(e,this.props.timezone,this.props.gmtOffset);this.setState({calendarViewDate:e,isFutureDate:t.isAfter()}),this.props.onDateChange(t)}),i()(this,"handleOnDayMouseEnter",(e,t,s,n)=>{const i=this.getEventsFromPosts(this.props.posts);if(!i||!i.length)return this.props.onDayMouseEnter(e,t,s,n);this.setState({eventsByDay:n,tooltipContext:s.target,showTooltip:!0})}),i()(this,"handleOnDayMouseLeave",(e,t,s,n)=>{const i=this.getEventsFromPosts(this.props.posts);if(!i||!i.length)return this.props.onDayMouseLeave(e,t,s,n);this.setState({eventsByDay:[],tooltipContext:null,showTooltip:!1})})}UNSAFE_componentWillMount(){if(!this.props.selectedDay)return this.setState({localizedDate:null,isFutureDate:!1});const e=this.getDateToUserLocation(this.props.selectedDay);this.setState({localizedDate:e,isFutureDate:e.isAfter()})}UNSAFE_componentWillReceiveProps(e){if(this.props.selectedDay!==e.selectedDay)return e.selectedDay?void this.setState({localizedDate:this.getDateToUserLocation(e.selectedDay)}):this.setState({localizedDate:null})}getLocaleUtils(){return{formatMonthTitle:function(){}}}events(){return this.props.events.concat(this.getEventsFromPosts(this.props.posts))}getEventsFromPosts(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map(e=>{const t=this.getDateToUserLocation(e.date);return{id:e.ID,title:e.title,date:t.toDate()}})}getDateToUserLocation(e){return Object(I.b)(e||new Date,this.props.timezone,this.props.gmtOffset)}getCurrentDate(){return d()(this.state.localizedDate||this.getDateToUserLocation())}renderInputChrono(){const e=this.getCurrentDate();let t;if(this.state.localizedDate){const s=d()().startOf("day"),n=d()(e).startOf("day").diff(s,"days");t=-7<=n&&n<=6?e.calendar():e.format("L LT")}return c.a.createElement("div",{className:"post-schedule__input-chrono"},c.a.createElement(h.a,{value:t,placeholder:e.calendar(),lang:this.props.userLocale,onSet:this.updateDate}),c.a.createElement("hr",{className:"post-schedule__hr"}))}renderClock(){let e=this.state.localizedDate;return e||(e=this.getDateToUserLocation(new Date)),c.a.createElement(T,{date:e,timezone:this.props.timezone,gmtOffset:this.props.gmtOffset,siteId:this.props.site?this.props.site.ID:null,siteSlug:this.props.site?this.props.site.slug:null,onChange:this.updateDate})}render(){const e=!this.props.events||!this.props.events.length,t=u()("post-schedule",{"is-future-date":this.state.isFutureDate});return c.a.createElement("div",{className:t},this.props.site&&c.a.createElement(b.a,{siteId:this.props.site.ID}),c.a.createElement(N,{date:this.state.calendarViewDate,onDateChange:this.setViewDate,inputChronoDisplayed:this.props.displayInputChrono}),this.props.displayInputChrono&&this.renderInputChrono(),c.a.createElement(g.a,{events:this.events(),localeUtils:this.getLocaleUtils(),disabledDays:this.props.disabledDays,showOutsideDays:this.props.showOutsideDays,modifiers:this.props.modifiers,selectedDay:this.state.localizedDate?this.state.localizedDate.toDate():null,timeReference:this.getCurrentDate(),calendarViewDate:this.state.calendarViewDate.toDate(),onMonthChange:this.setCurrentMonth,onSelectDay:this.updateDate,onDayMouseEnter:this.handleOnDayMouseEnter,onDayMouseLeave:this.handleOnDayMouseLeave}),this.renderClock(),e&&c.a.createElement(f.a,{events:this.state.eventsByDay,context:this.state.tooltipContext,isVisible:this.state.showTooltip}))}}i()(M,"propTypes",{events:a.a.array,posts:a.a.array,timezone:a.a.string,gmtOffset:a.a.number,site:a.a.object,displayInputChrono:a.a.bool,onDateChange:a.a.func,onMonthChange:a.a.func,onDayMouseEnter:a.a.func,onDayMouseLeave:a.a.func,userLocale:a.a.string}),i()(M,"defaultProps",{posts:[],events:[],displayInputChrono:!0,onDateChange:R,onMonthChange:R,onDayMouseEnter:R,onDayMouseLeave:R});t.a=Object(m.b)(e=>({userLocale:Object(y.h)(e)}))(M)},"./client/components/post-schedule/style.scss":function(e,t,s){},"./client/components/post-schedule/utils.js":function(e,t,s){"use strict";s.d(t,"e",function(){return o}),s.d(t,"f",function(){return a}),s.d(t,"b",function(){return d}),s.d(t,"a",function(){return p}),s.d(t,"d",function(){return u}),s.d(t,"c",function(){return m}),s.d(t,"g",function(){return h});var n=s("./node_modules/moment-timezone/index.js"),i=s.n(n);const o=e=>e&&/[gh]|[aA]$/.test(e),a=e=>"number"==typeof e,r=(e,t,s)=>(e=i()(e),t?e.tz(t):a(s)&&e.utcOffset(s),e),c=e=>i()(e.format?e.format():e),l=(e,t,s)=>{const n=c(e),i=r(e,t,s);return n.utcOffset()-i.utcOffset()},d=(e,t,s)=>t||a(s)?c(e).subtract(l(e,t,s),"minute"):i()(e),p=(e,t,s)=>(e=r(e,t,s).add(l(e,t,s),"minute"),!t&&a(s)&&e.utcOffset(s),e),u=e=>{const t=Math.trunc(e/60),s=e>0?"+":"";if(!(e/60%1))return s+String(t);const n=(e=Math.abs(e%60))<10?"0"+e:e;return"".concat(s).concat(t,":").concat(n)},m=e=>u(60*e),h=e=>("0"!==(e=String(e))&&"00"!==e&&("0"===e[0]||Number(e)>99)&&(e=Number(e.substr(1))),!(isNaN(Number(e))||Number(e)<0||e.length>2)&&Number(e))},"./client/components/redux-forms/redux-form-fieldset/index.jsx":function(e,t,s){"use strict";s.d(t,"a",function(){return b});var n=s("./node_modules/@babel/runtime/helpers/extends.js"),i=s.n(n),o=s("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),a=s.n(o),r=s("./node_modules/prop-types/index.js"),c=s.n(r),l=s("./node_modules/react/index.js"),d=s.n(l),p=s("./node_modules/redux-form/es/Field.js"),u=s("./client/components/forms/form-fieldset/index.jsx"),m=s("./client/components/forms/form-label/index.jsx"),h=s("./client/components/forms/form-input-validation/index.jsx"),g=s("./client/components/forms/form-setting-explanation/index.jsx");const b=e=>{let t=e.inputComponent,s=e.input,n=e.meta,o=e.label,r=e.explanation,c=a()(e,["inputComponent","input","meta","label","explanation"]);const l=!(!n.touched||!n.error);return d.a.createElement(u.a,null,o&&d.a.createElement(m.a,{htmlFor:s.name},o),d.a.createElement(t,i()({id:s.name,isError:l},s,c)),l&&d.a.createElement(h.a,{isError:!0,text:n.error}),r&&d.a.createElement(g.a,null,r))},f=e=>{let t=e.component,s=a()(e,["component"]);return d.a.createElement(p.a,i()({component:b,inputComponent:t},s))};f.propTypes={name:c.a.string.isRequired,component:c.a.func.isRequired,label:c.a.node,explanation:c.a.node},t.b=f},"./client/components/remove-button/index.jsx":function(e,t,s){"use strict";var n=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),i=s.n(n),o=s("./client/components/gridicon/index.jsx"),a=s("./node_modules/prop-types/index.js"),r=s.n(a),c=s("./node_modules/react/index.js"),l=s.n(c),d=s("./packages/i18n-calypso/dist/esm/index.js"),p=s("./client/components/button/index.jsx"),u=s("./client/components/screen-reader-text/index.js");s("./client/components/remove-button/style.scss");class m extends l.a.Component{render(){const e=this.props,t=e.onRemove,s=e.translate;return l.a.createElement(p.a,{onClick:t,compact:!0,className:"remove-button"},l.a.createElement(u.a,null,s("Remove")),l.a.createElement(o.a,{icon:"cross",size:24,className:"remove-button__icon"}))}}i()(m,"propTypes",{onRemove:r.a.func.isRequired,translate:r.a.func.isRequired}),t.a=Object(d.localize)(m)},"./client/components/remove-button/style.scss":function(e,t,s){},"./client/components/resizable-iframe/index.jsx":function(e,t,s){"use strict";s.d(t,"a",function(){return y});var n=s("./node_modules/@babel/runtime/helpers/extends.js"),i=s.n(n),o=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),a=s.n(o),r=s("./node_modules/react-dom/index.js"),c=s.n(r),l=s("./node_modules/prop-types/index.js"),d=s.n(l),p=s("./node_modules/react/index.js"),u=s.n(p),m=s("./node_modules/debug/src/browser.js"),h=s.n(m),g=s("./node_modules/lodash/lodash.js");const b=h()("calypso:resizable-iframe"),f=()=>{};class y extends u.a.Component{constructor(){super(...arguments),a()(this,"state",{width:0,height:0}),a()(this,"getFrameBody",()=>c.a.findDOMNode(this.refs.iframe).contentDocument.body),a()(this,"maybeConnect",()=>{if(!this.isFrameAccessible())return;const e=this.getFrameBody();if(null!==e.getAttribute("data-resizable-iframe-connected"))return;const t=document.createElement("script");t.innerHTML="\n\t\t\t( function() {\n\t\t\t\tvar observer;\n\n\t\t\t\tif ( ! window.MutationObserver || ! document.body || ! window.top ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfunction sendResize() {\n\t\t\t\t\twindow.top.postMessage( {\n\t\t\t\t\t\taction: 'resize',\n\t\t\t\t\t\twidth: document.body.offsetWidth,\n\t\t\t\t\t\theight: document.body.offsetHeight\n\t\t\t\t\t}, '*' );\n\t\t\t\t}\n\n\t\t\t\tobserver = new MutationObserver( sendResize );\n\t\t\t\tobserver.observe( document.body, {\n\t\t\t\t\tattributes: true,\n\t\t\t\t\tattributeOldValue: false,\n\t\t\t\t\tcharacterData: true,\n\t\t\t\t\tcharacterDataOldValue: false,\n\t\t\t\t\tchildList: true,\n\t\t\t\t\tsubtree: true\n\t\t\t\t} );\n\n\t\t\t\twindow.addEventListener( 'load', sendResize, true );\n\n\t\t\t\t// Hack: Remove viewport unit styles, as these are relative\n\t\t\t\t// the iframe root and interfere with our mechanism for\n\t\t\t\t// determining the unconstrained page bounds.\n\t\t\t\tfunction removeViewportStyles( ruleOrNode ) {\n\t\t\t\t\t[ 'width', 'height', 'minHeight', 'maxHeight' ].forEach( function( style ) {\n\t\t\t\t\t\tif ( /^\\d+(vmin|vmax|vh|vw)$/.test( ruleOrNode.style[ style ] ) ) {\n\t\t\t\t\t\t\truleOrNode.style[ style ] = '';\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\t\t\t\t}\n\n\t\t\t\tArray.prototype.forEach.call( document.querySelectorAll( '[style]' ), removeViewportStyles );\n\t\t\t\tArray.prototype.forEach.call( document.styleSheets, function( stylesheet ) {\n\t\t\t\t\tArray.prototype.forEach.call( stylesheet.cssRules || stylesheet.rules, removeViewportStyles );\n\t\t\t\t} );\n\n\t\t\t\tdocument.body.style.position = 'absolute';\n\t\t\t\tdocument.body.setAttribute( 'data-resizable-iframe-connected', '' );\n\n\t\t\t\tsendResize();\n\t\t\t} )();\n\t\t",e.appendChild(t)}),a()(this,"isFrameAccessible",()=>{try{return!!this.getFrameBody()}catch(e){return!1}}),a()(this,"checkMessageForResize",e=>{const t=c.a.findDOMNode(this.refs.iframe);let s=e.data||{};if("string"==typeof s)try{s=JSON.parse(s)}catch(e){}if(!t||t.contentWindow!==e.source)return;b("Received message: %o",s);const n=s,i=n.action,o=n.width,a=n.height,r=this.state,l=r.width,d=r.height;"resize"!==i||l===o&&d===a||(this.setState({width:o,height:a}),this.props.onResize())}),a()(this,"onLoad",e=>{this.maybeConnect(),this.props.onLoad(e)})}componentWillMount(){b("Mounting "+this.constructor.displayName+" React component.")}componentDidMount(){window.addEventListener("message",this.checkMessageForResize,!1),this.maybeConnect()}componentDidUpdate(){this.maybeConnect()}componentWillUnmount(){window.removeEventListener("message",this.checkMessageForResize)}render(){return u.a.createElement("iframe",i()({ref:"iframe"},Object(g.omit)(this.props,["onResize"]),{onLoad:this.onLoad,width:this.props.width||this.state.width,height:this.props.height||this.state.height}))}}a()(y,"displayName","ResizableIframe"),a()(y,"propTypes",{src:d.a.string,width:d.a.oneOfType([d.a.string,d.a.number]),height:d.a.oneOfType([d.a.string,d.a.number]),onLoad:d.a.func,onResize:d.a.func}),a()(y,"defaultProps",{onLoad:f,onResize:f})},"./client/components/social-logo/index.jsx":function(e,t,s){"use strict";var n=s("./node_modules/@babel/runtime/helpers/extends.js"),i=s.n(n),o=s("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),a=s.n(o),r=s("./node_modules/classnames/index.js"),c=s.n(r),l=s("./node_modules/react/index.js"),d=s.n(l),p=s("./node_modules/prop-types/index.js"),u=s.n(p),m=s("./node_modules/social-logos/svg-sprite/social-logos.svg"),h=s.n(m);function g(e){const t=e.size,s=void 0===t?24:t,n=e.icon,o=e.onClick,r=e.className,l=a()(e,["size","icon","onClick","className"]),p="social-logo-".concat(n),u=c()("social-logo",p,n,r);return d.a.createElement("svg",i()({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",className:u,height:s,width:s,onClick:o},l),d.a.createElement("use",{xlinkHref:"".concat(h.a,"#").concat(n)}))}g.propTypes={icon:u.a.string.isRequired,size:u.a.number,onClick:u.a.func,className:u.a.string},t.a=d.a.memo(g)},"./client/components/spinner-line/index.jsx":function(e,t,s){"use strict";s.d(t,"a",function(){return l});var n=s("./node_modules/prop-types/index.js"),i=s.n(n),o=s("./node_modules/react/index.js"),a=s.n(o),r=s("./node_modules/classnames/index.js"),c=s.n(r);s("./client/components/spinner-line/style.scss");class l extends o.PureComponent{render(){const e=c()("spinner-line",this.props.className);return a.a.createElement("hr",{className:e})}}l.propTypes={className:i.a.string}},"./client/components/spinner-line/style.scss":function(e,t,s){},"./client/components/text-diff/index.jsx":function(e,t,s){"use strict";var n=s("./node_modules/react/index.js"),i=s.n(n),o=s("./node_modules/prop-types/index.js"),a=s.n(o),r=s("./node_modules/classnames/index.js"),c=s.n(r),l=s("./node_modules/lodash/lodash.js");const d=(e,t,s)=>{const n=e.orig,o=e.final,a=e.value,r=e.op,d=n||o||a,p=c()({"text-diff__additions":"add"===r,"text-diff__context":"copy"===r,"text-diff__deletions":"del"===r});return i.a.createElement("span",{className:p,key:t},s?(e=>!Object(l.isArray)(e)||Object(l.isEmpty)(e)?e:e.join("\n\n"))(d):d)},p=Object(l.partialRight)(d,!0),u=e=>{let t=e.operations,s=e.splitLines;return Object(l.map)(t,s?p:d)};u.propTypes={operations:a.a.arrayOf(a.a.shape({op:a.a.oneOf(["add","copy","del"]),value:a.a.string.isRequired})),splitLines:a.a.bool},t.a=u},"./client/components/textarea-autosize/index.jsx":function(e,t,s){"use strict";s.d(t,"a",function(){return g});var n=s("./node_modules/@babel/runtime/helpers/extends.js"),i=s.n(n),o=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),a=s.n(o),r=s("./node_modules/react/index.js"),c=s.n(r),l=s("./node_modules/prop-types/index.js"),d=s.n(l),p=s("./node_modules/classnames/index.js"),u=s.n(p),m=s("./node_modules/autosize/dist/autosize.js"),h=s.n(m);s("./client/components/textarea-autosize/style.scss");class g extends r.Component{componentDidMount(){h()(this.refs.textarea)}componentWillUnmount(){h.a.destroy(this.refs.textarea)}componentDidUpdate(e){this.props.value!==e.value&&this.resize()}resize(){h.a.update(this.refs.textarea)}render(){const e=u()("textarea-autosize",this.props.className);return c.a.createElement("textarea",i()({ref:"textarea"},this.props,{className:e}))}}a()(g,"propTypes",{className:d.a.string})},"./client/components/textarea-autosize/style.scss":function(e,t,s){},"./client/components/time-since/index.jsx":function(e,t,s){"use strict";s.d(t,"a",function(){return u});var n=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),i=s.n(n),o=s("./node_modules/react/index.js"),a=s.n(o),r=s("./node_modules/moment/moment.js"),c=s.n(r),l=s("./client/lib/human-date/index.js"),d=s("./client/lib/interval/index.js"),p=s("./client/lib/react-smart-set-state/index.js");class u extends o.PureComponent{constructor(){super(...arguments),i()(this,"smartSetState",p.a),i()(this,"update",e=>{const t=this.props.dateFormat;e=e||this.props.date,this.smartSetState({humanDate:Object(l.a)(e,t),fullDate:c()(e).format("llll")})})}componentWillMount(){this.update()}componentWillReceiveProps(e){this.update(e.date)}render(){return a.a.createElement("time",{className:this.props.className,dateTime:this.props.date,title:this.state.fullDate},a.a.createElement(d.e,{period:d.d,onTick:this.update}),this.state.humanDate)}}},"./client/components/tinymce/i18n.js":function(e,t,s){"use strict";var n=s("./packages/i18n-calypso/dist/esm/index.js"),i=s.n(n);t.a={Formats:i.a.translate("Formats",{context:"TinyMCE"}),Headings:i.a.translate("Headings",{context:"TinyMCE"}),"Heading 1":i.a.translate("Heading 1"),"Heading 2":i.a.translate("Heading 2"),"Heading 3":i.a.translate("Heading 3"),"Heading 4":i.a.translate("Heading 4"),"Heading 5":i.a.translate("Heading 5"),"Heading 6":i.a.translate("Heading 6"),Blocks:i.a.translate("Blocks",{context:"TinyMCE",comment:"block tags"}),Paragraph:i.a.translate("Paragraph"),Blockquote:i.a.translate("Blockquote"),Div:i.a.translate("Div",{context:"HTML tag"}),Pre:i.a.translate("Pre",{context:"HTML tag"}),Preformatted:i.a.translate("Preformatted",{context:"HTML tag"}),Address:i.a.translate("Address",{context:"HTML tag"}),Inline:i.a.translate("Inline",{context:"HTML elements"}),Underline:i.a.translate("Underline"),Strikethrough:i.a.translate("Strikethrough"),Subscript:i.a.translate("Subscript"),Superscript:i.a.translate("Superscript"),"Clear formatting":i.a.translate("Clear formatting"),Bold:i.a.translate("Bold"),Italic:i.a.translate("Italic"),"Source code":i.a.translate("Source code"),"Font Family":i.a.translate("Font Family"),"Font Sizes":i.a.translate("Font Sizes"),"Align center":i.a.translate("Align center"),"Align right":i.a.translate("Align right"),"Align left":i.a.translate("Align left"),Justify:i.a.translate("Justify"),"Increase indent":i.a.translate("Increase indent"),"Decrease indent":i.a.translate("Decrease indent"),Cut:i.a.translate("Cut"),Copy:i.a.translate("Copy"),Paste:i.a.translate("Paste"),"Select all":i.a.translate("Select all"),Undo:i.a.translate("Undo"),Redo:i.a.translate("Redo"),Ok:i.a.translate("OK"),Cancel:i.a.translate("Cancel"),Close:i.a.translate("Close"),"Visual aids":i.a.translate("Visual aids"),"Paste is now in plain text mode. Contents will now be pasted as plain text until you toggle this option off.":i.a.translate("Paste is now in plain text mode. Contents will now be pasted as plain text until you toggle this option off.")+"\n\n"+i.a.translate("If you’re looking to paste rich content from Microsoft Word, try turning this option off. The editor will clean up text pasted from Word automatically."),"Rich Text Area. Press ALT-F9 for menu. Press ALT-F10 for toolbar. Press ALT-0 for help":i.a.translate("Rich Text Area. Press Alt-Shift-H for help"),"You have unsaved changes are you sure you want to navigate away?":i.a.translate("The changes you made will be lost if you navigate away from this page."),"Your browser doesn't support direct access to the clipboard. Please use the Ctrl+X/C/V keyboard shortcuts instead.":i.a.translate("Your browser does not support direct access to the clipboard. Please use keyboard shortcuts or your browser’s edit menu instead."),"Bullet list":i.a.translate("Bulleted list"),"Numbered list":i.a.translate("Numbered list"),"Toolbar Toggle":i.a.translate("Toolbar Toggle"),"Insert Read More tag":i.a.translate("Insert Read More tag"),"Insert Page Break tag":i.a.translate("Insert Page Break tag"),"No alignment":i.a.translate("No alignment"),Remove:i.a.translate("Remove"),"Edit ":i.a.translate("Edit"),"Horizontal line":i.a.translate("Horizontal line"),"Text color":i.a.translate("Text color"),"Paste as text":i.a.translate("Paste as text")}},"./client/components/tinymce/plugins/embed/dialog.jsx":function(e,t,s){"use strict";var n=s("./node_modules/@babel/runtime/helpers/objectSpread.js"),i=s.n(n),o=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),a=s.n(o),r=s("./node_modules/prop-types/index.js"),c=s.n(r),l=s("./node_modules/react/index.js"),d=s.n(l),p=s("./node_modules/react-dom/index.js"),u=s.n(p),m=s("./packages/i18n-calypso/dist/esm/index.js"),h=s("./node_modules/lodash/lodash.js"),g=s("./node_modules/react-redux/es/index.js"),b=s("./node_modules/classnames/index.js"),f=s.n(b),y=s("./client/components/button/index.jsx"),E=s("./client/components/dialog/index.jsx"),v=s("./client/components/forms/form-text-input/index.jsx"),j=s("./client/lib/wp/browser.js"),_=s("./client/state/ui/selectors.js"),x=s("./client/components/spinner/index.jsx"),w=s("./client/lib/embed-frame-markup/index.jsx"),S=s("./client/components/resizable-iframe/index.jsx");class C extends d.a.Component{constructor(){super(...arguments),a()(this,"state",{embedUrl:this.props.embedUrl,previewMarkup:[]}),a()(this,"componentWillReceiveProps",e=>{this.state.embedUrl!==e.embedUrl&&this.setState({embedUrl:e.embedUrl})}),a()(this,"componentDidUpdate",(e,t)=>{if(this.state.embedUrl!==t.embedUrl){if(!this.isURLInCache(this.state.embedUrl))return this.setState({isLoading:!0}),void this.debouncedFetchEmbedPreviewMarkup(this.state.embedUrl);this.setHtml()}}),a()(this,"isURLInCache",e=>!!this.state.previewMarkup[e]),a()(this,"parseEmbedEndpointResult",e=>(t,s,n)=>{let o;s&&s.result?o=s:(n&&0===n.status?t={error:"communication_error",message:this.props.translate("Connection issue. Please reload the page and try again")}:t&&!t.message?t.message=this.props.translate("Unknown error"):s&&s.error&&(t=s.error),o={renderMarkup:t,isError:!0}),this.setState({isLoading:!1,previewMarkup:i()({},this.state.previewMarkup,{[e]:o})})}),a()(this,"fetchEmbedPreviewMarkup",e=>{this.isURLInCache(e)||""===e.trim()?this.setState({isLoading:!1}):j.a.undocumented().site(this.props.siteId).embeds({embed_url:e},this.parseEmbedEndpointResult(e))}),a()(this,"onChangeEmbedUrl",e=>{this.setState({embedUrl:e.target.value})}),a()(this,"onUpdate",()=>{this.props.onUpdate(this.state.embedUrl)}),a()(this,"onKeyDownEmbedUrl",e=>{"Enter"===e.key&&(e.preventDefault(),this.onUpdate())}),a()(this,"getError",e=>{switch(e.error){case"invalid_embed_url":return this.props.translate("The Embed URL parameter must be a valid URL.");default:return e.message}}),a()(this,"iframeOnLoad",()=>{this.setState({iframeLoading:!1})}),a()(this,"handleIframeRef",e=>{this.iframe=e,this.setHtml()}),a()(this,"handleViewRef",e=>{this.viewref=e})}componentWillMount(){this.setState({embedUrl:this.props.embedUrl}),this.debouncedFetchEmbedPreviewMarkup=Object(h.debounce)(this.fetchEmbedPreviewMarkup,500),this.isURLInCache(this.state.embedUrl)||(this.setState({isLoading:!0}),this.fetchEmbedPreviewMarkup(this.state.embedUrl))}constrainEmbedDimensions(){if(!this.iframe||!this.viewref)return;const e=u.a.findDOMNode(this.viewref),t=u.a.findDOMNode(this.iframe);if(!t.contentDocument)return;const s=t.contentDocument.querySelector("iframe");if(!s||!s.width)return;const n=parseInt(s.width,10);if(!(n<=e.clientWidth)&&(s.style.width=e.clientWidth+"px",s.height)){const t=parseInt(s.height,10)/n;s.style.height=Math.round(e.clientWidth*t)+"px"}}setHtml(){const e=this.state.embedUrl;if(!this.iframe||!this.isURLInCache(e))return;const t=this.state.previewMarkup[e];if(t.isError)return;const s=u.a.findDOMNode(this.iframe);if(s.removeAttribute("sandbox"),!s.contentDocument)return;this.setState({iframeLoading:!0});const n=Object(h.pick)(t,["result","scripts","styles"]);n.body=n.result;const i=Object(w.a)(n);s.contentDocument.open(),s.contentDocument.write(i),s.contentDocument.body.style.width="100%",s.contentDocument.body.style.overflow="hidden",s.contentDocument.close(),s.setAttribute("sandbox","allow-scripts"),this.constrainEmbedDimensions()}render(){const e=this.props.translate,t=[d.a.createElement(y.a,{onClick:this.props.onCancel},e("Cancel")),d.a.createElement(y.a,{primary:!0,onClick:this.onUpdate},e("Update"))],s=this.state.isLoading||this.state.iframeLoading,n=this.isURLInCache(this.state.embedUrl)?this.state.previewMarkup[this.state.embedUrl]:null,i=n&&n.isError,o=f()("embed__status",{isError:i,isLoading:s}),a=f()("embed__preview",{isLoading:this.state.iframeLoading});return d.a.createElement(E.a,{autoFocus:!1,buttons:t,additionalClassNames:"embed__modal",isVisible:this.props.isVisible,onCancel:this.props.onCancel,onClose:this.props.onCancel},d.a.createElement("div",{className:"embed__header"},d.a.createElement("h3",{className:"embed__title"},e("Embed URL")),d.a.createElement(v.a,{autoFocus:!0,className:"embed__url",defaultValue:this.props.embedUrl,onChange:this.onChangeEmbedUrl,onKeyDown:this.onKeyDownEmbedUrl})),d.a.createElement("div",{className:"embed__preview-container"},(s||i)&&d.a.createElement("div",{className:o},s&&d.a.createElement(x.a,null),i&&d.a.createElement("div",{className:"embed__status-error"},this.getError(n.renderMarkup))),!this.state.isLoading&&n&&!i&&d.a.createElement("div",{ref:this.handleViewRef,className:a},d.a.createElement(S.a,{ref:this.handleIframeRef,onResize:this.props.onResize,onLoad:this.iframeOnLoad,frameBorder:"0",seamless:!0,width:"100%"}))))}}a()(C,"propTypes",{embedUrl:c.a.string,isVisible:c.a.bool,onCancel:c.a.func.isRequired,onUpdate:c.a.func.isRequired,siteId:c.a.number.isRequired,translate:c.a.func.isRequired}),a()(C,"defaultProps",{embedUrl:"",isVisible:!1,isLoading:!1});const I=Object(g.b)((e,t)=>{let s=t.siteId;return{siteId:s||Object(_.e)(e)}})(C);t.a=Object(m.localize)(I)},"./client/components/tinymce/plugins/simple-payments/dialog/index.jsx":function(e,t,s){"use strict";var n=s("./node_modules/@babel/runtime/helpers/objectSpread.js"),i=s.n(n),o=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),a=s.n(o),r=s("./node_modules/prop-types/index.js"),c=s.n(r),l=s("./node_modules/react/index.js"),d=s.n(l),p=s("./node_modules/react-redux/es/index.js"),u=s("./node_modules/redux-form/es/getFormValues.js"),m=s("./packages/i18n-calypso/dist/esm/index.js"),h=s("./node_modules/lodash/lodash.js"),g=s("./client/state/ui/selectors.js"),b=s("./client/state/sites/selectors.js"),f=s("./client/state/selectors/get-simple-payments.js"),y=s("./client/components/data/query-simple-payments/index.js"),E=s("./client/components/data/query-site-plans/index.jsx"),v=s("./client/components/dialog/index.jsx"),j=s("./client/components/button/index.jsx"),_=s("./client/components/notice/index.jsx"),x=s("./client/components/tinymce/plugins/simple-payments/dialog/navigation.jsx"),w=s("./node_modules/@babel/runtime/helpers/extends.js"),S=s.n(w),C=s("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),I=s.n(C),O=s("./node_modules/redux-form/es/isValid.js"),T=s("./node_modules/redux-form/es/isDirty.js"),P=s("./node_modules/redux-form/es/Field.js"),k=s("./node_modules/redux-form/es/Fields.js"),D=s("./node_modules/redux-form/es/reduxForm.js"),N=s("./node_modules/email-validator/index.js"),R=s.n(N),M=s("./packages/format-currency/dist/esm/index.js"),L=s("./client/lib/simple-payments/utils.js"),A=s("./client/components/external-link/index.jsx"),U=s("./client/components/forms/form-text-input/index.jsx"),q=s("./client/components/forms/form-textarea/index.jsx"),F=s("./client/components/forms/form-currency-input/index.jsx"),B=s("./client/components/forms/form-toggle/compact.jsx"),z=s("./client/components/redux-forms/redux-form-fieldset/index.jsx"),V=s("./client/components/gridicon/index.jsx"),H=s("./client/components/async-load/index.jsx"),W=s("./client/components/data/media-library-selected-data/index.jsx"),G=s("./client/post-editor/editor-featured-image/preview-container.jsx"),Y=s("./client/components/remove-button/index.jsx"),K=s("./client/state/media/actions.js"),$=s("./client/lib/media/actions.js"),Q=function(e){Promise.resolve().then(s.bind(null,"./client/post-editor/media-modal/index.jsx")).then(function(t){e(t.default)})};class J extends l.Component{constructor(){super(...arguments),a()(this,"state",{isSelecting:!1}),a()(this,"showMediaModal",e=>{e.key&&"Enter"!==e.key||this.setState({isSelecting:!0})}),a()(this,"setImage",e=>{this.setState({isSelecting:!1},()=>{e&&(this.props.input.onChange(e.items[0].ID),this.props.requestMediaItem(this.props.siteId,e.items[0].ID))})}),a()(this,"removeCurrentImage",e=>{e.stopPropagation(),this.props.input.onChange(!1)}),a()(this,"onImageChange",e=>{this.props.input.onChange(e),$.a.setLibrarySelectedItems(this.props.siteId,[{ID:e}])})}getImagePlaceholder(){return d.a.createElement("div",{className:"dialog__product-image-placeholder",onClick:this.showMediaModal,onKeyDown:this.showMediaModal,role:"button",tabIndex:0},d.a.createElement(V.a,{icon:"add-image",size:36}),this.props.translate("Add an Image"))}getCurrentImage(){const e=this.props.siteId;return d.a.createElement("div",{className:"dialog__product-image",onClick:this.showMediaModal,onKeyDown:this.showMediaModal,role:"button",tabIndex:0},d.a.createElement(G.a,{siteId:e,itemId:this.props.input.value,onImageChange:this.onImageChange,showEditIcon:!0}),d.a.createElement(Y.a,{onRemove:this.removeCurrentImage}))}render(){const e=this.props,t=e.siteId,s=e.translate,n=e.makeDirtyAfterImageEdit,i=this.state.isSelecting;if(t)return d.a.createElement("div",{className:"dialog__product-image-picker"},d.a.createElement(W.a,{siteId:t},d.a.createElement(H.a,{require:Q,siteId:t,onClose:this.setImage,enabledFilters:["images"],visible:i,isBackdropVisible:!1,labels:{confirm:s("Add")},single:!0,imageEditorProps:{doneButtonText:s("Update Payment Button")},onImageEditorDoneHook:n,onRestoreMediaHook:n})),d.a.createElement("div",{className:"dialog__product-image-container"},this.props.input.value&&this.getCurrentImage(),!this.props.input.value&&this.getImagePlaceholder()))}}a()(J,"propTypes",{siteId:c.a.number,translate:c.a.func});var Z=Object(p.b)(e=>({siteId:Object(g.e)(e)}),{requestMediaItem:K.f})(Object(m.localize)(J)),X=s("./client/lib/simple-payments/constants.js");const ee=e=>Object(O.a)("simplePaymentsForm")(e),te=e=>Object(T.a)("simplePaymentsForm")(e),se=X.d.map(e=>{const t=Object(M.getCurrencyDefaults)(e).symbol;return{code:e,label:t===e?e:"".concat(e," ").concat(Object(h.trimEnd)(t,"."))}}),ne=e=>{let t=e.price,s=e.currency,n=I()(e,["price","currency"]);const i=Object(M.getCurrencyDefaults)(s.input.value).precision,o=i>0?Object(h.padEnd)("1.",i+2,"0"):"1";return d.a.createElement(z.a,S()({inputComponent:F.a},t,Object(h.omit)(n,["names"]),{currencySymbolPrefix:s.input.value,onCurrencyChange:s.input.onChange,currencyList:se,placeholder:o}))};var ie=Object(h.flowRight)(m.localize,Object(D.a)({form:"simplePaymentsForm",enableReinitialize:!0,validate:(e,t)=>{const s=t.translate,n=Object(M.getCurrencyDefaults)(e.currency).precision,i={};if(e.title||(i.title=s("People need to know what they're paying for! Please add a brief title.")),e.price&&0!==parseFloat(e.price)){if(Number.isNaN(parseFloat(e.price)))i.price=s("Invalid price");else if(parseFloat(e.price)<0)i.price=s("Your price is negative — now that doesn't sound right, does it?");else if(Object(L.a)(e.price)>n)if(0===n)i.price=s("We know every penny counts, but prices can't contain decimal values.");else{const e=s("%(precision)d decimal place","%(precision)d decimal places",{count:n,args:{precision:n}});i.price=s("Price cannot have more than %(countDecimal)s.",{args:{countDecimal:e}})}}else i.price=s("Everything comes with a price tag these days. Add yours here.");return e.email?R.a.validate(e.email)||(i.email=s("%(email)s is not a valid email address.",{args:{email:e.email}})):i.email=s("We want to make sure payments reach you, so please add an email address."),i}}))(class extends l.Component{render(){const e=this.props,t=e.translate,s=e.makeDirtyAfterImageEdit;return d.a.createElement("form",{className:"editor-simple-payments-modal__form"},d.a.createElement(P.a,{name:"featuredImageId",component:Z,makeDirtyAfterImageEdit:s}),d.a.createElement("div",{className:"editor-simple-payments-modal__form-fields"},d.a.createElement(z.b,{name:"title",label:t("What is this payment for?"),component:U.a,explanation:t("For example: event tickets, charitable donations, training courses, coaching fees, etc.")}),d.a.createElement(z.b,{name:"description",label:t("Description"),component:q.a}),d.a.createElement(k.a,{names:["price","currency"],label:t("Price"),component:ne}),d.a.createElement("div",null,d.a.createElement(z.b,{name:"multiple",type:"checkbox",component:B.a},t("Allow people to buy more than one item at a time.")),d.a.createElement(z.b,{name:"email",label:t("Email"),explanation:t("This is where PayPal will send your money. To claim a payment, you'll need a {{paypalLink}}PayPal account{{/paypalLink}} connected to a bank account.",{components:{paypalLink:d.a.createElement(A.a,{href:"https://paypal.com",target:"_blank"})}}),component:U.a}))))}}),oe=s("./client/components/tinymce/plugins/simple-payments/dialog/list.jsx"),ae=s("./client/state/current-user/selectors.js"),re=s("./client/lib/wp/browser.js"),ce=s("./client/lib/accept/index.js"),le=s("./client/state/data-layer/wpcom/sites/simple-payments/index.js"),de=s("./client/state/simple-payments/product-list/actions.js"),pe=s("./client/lib/plans/constants.js"),ue=s("./client/state/sites/plans/selectors.js"),me=s("./client/blocks/upgrade-nudge/index.jsx"),he=s("./client/lib/analytics/track-component-view/index.jsx"),ge=s("./client/state/analytics/actions.js"),be=s("./client/components/empty-content/index.jsx"),fe=s("./client/components/banner/index.jsx"),ye=s("./client/state/selectors/can-current-user.js");const Ee=e=>Array.isArray(e)&&0===e.length,ve=e=>Object(le.b)((e=>Object(u.a)("simplePaymentsForm")(e))(e)),je=e=>(t,s)=>{const n=ve(s());return re.a.site(e).addPost(n).then(s=>{const n=Object(le.a)(s);return t(Object(ge.k)(Object(ge.b)(Object(ge.i)("calypso_simple_payments_button_create",{price:n.price,currency:n.currency,id:n.ID}),Object(ge.a)("calypso_simple_payments","button_created")),Object(de.c)(e,n))),n})},_e=(e,t)=>(s,n)=>{const i=ve(n());return re.a.site(e).post(t).update(i).then(n=>{const i=Object(le.a)(n);return s(Object(ge.k)(Object(ge.b)(Object(ge.i)("calypso_simple_payments_button_update",{id:t,currency:i.currency,price:i.price}),Object(ge.a)("calypso_simple_payments","button_updated")),Object(de.c)(e,i))),i})},xe=(e,t)=>s=>{const n=re.a.site(e).post(t);return n.delete().then(()=>n.delete()).then(()=>s(Object(ge.k)(Object(ge.b)(Object(ge.i)("calypso_simple_payments_button_delete",{id:t}),Object(ge.a)("calypso_simple_payments","button_deleted")),Object(de.a)(e,t))))};class we extends l.Component{constructor(e){super(e),a()(this,"handleDialogClose",()=>{this.checkUnsavedForm().then(e=>e&&this.props.onClose())}),a()(this,"handleChangeTabs",e=>{"form"===e?this.showButtonForm(null):this.checkUnsavedForm().then(e=>e&&this.showButtonList())}),a()(this,"showButtonForm",e=>{const t=this.getInitialFormFields(e);this.setState({activeTab:"form",editedPaymentId:e,initialFormValues:t})}),a()(this,"handleSelectedChange",e=>this.setState({selectedPaymentId:e})),a()(this,"showError",e=>this._isMounted&&this.setState({errorMessage:e})),a()(this,"dismissError",()=>this._isMounted&&this.setState({errorMessage:null})),a()(this,"handleInsert",()=>{const e=this.props,t=e.siteId,s=e.dispatch,n=e.translate,i=this.state.activeTab;let o;this.setIsSubmitting(!0),(o="list"===i?Promise.resolve(this.state.selectedPaymentId):s(je(t)).then(e=>e.ID)).then(e=>s((t,s)=>Object(f.a)(s(),this.props.siteId,e))).then(e=>{this.props.onInsert({id:e.ID}),s(Object(ge.b)(Object(ge.i)("calypso_simple_payments_button_insert",{id:e.ID}),Object(ge.a)("calypso_simple_payments","button_inserted")))}).catch(()=>this.showError(n("The payment button could not be inserted."))).then(()=>this.setIsSubmitting(!1))}),a()(this,"handleSave",()=>{this.setIsSubmitting(!0);const e=this.props,t=e.siteId,s=e.dispatch,n=e.translate,i=this.state.editedPaymentId;s(_e(t,i)).then(this.handleFormClose).catch(()=>this.showError(n("The payment button could not be updated."))).then(()=>this.setIsSubmitting(!1))}),a()(this,"handleFormClose",()=>{this.isDirectEdit()?this.props.onClose():this.showButtonList()}),a()(this,"handleTrash",e=>{const t=this.props.translate,s=t("Are you sure you want to delete this item? It will be disabled and removed from all locations where it currently appears.");Object(ce.a)(s,s=>{if(!s)return;this.setIsSubmitting(!0);const n=this.props,i=n.siteId;(0,n.dispatch)(xe(i,e)).catch(()=>this.showError(t("The payment button could not be deleted."))).then(()=>this.setIsSubmitting(!1))},t("Delete"),null,{isScary:!0})}),a()(this,"makeDirtyAfterImageEdit",()=>this.setState({isDirtyAfterImageEdit:!0})),this._isMounted=!1;const t=this.props,s=t.editPaymentId,n=t.paymentButtons;this.state={activeTab:s||Ee(n)?"form":"list",editedPaymentId:s,initialFormValues:this.getInitialFormFields(s),selectedPaymentId:null,isSubmitting:!1,errorMessage:null,isDirtyAfterImageEdit:!1}}componentDidUpdate(e){this.props.showDialog&&!e.showDialog&&(this.props.editPaymentId?this.showButtonForm(this.props.editPaymentId):Ee(this.props.paymentButtons)?this.showButtonForm(null):this.showButtonList()),null===e.paymentButtons&&Ee(this.props.paymentButtons)&&this.showButtonForm(null)}componentDidMount(){this._isMounted=!0}componentWillUnmount(){this._isMounted=!1}getInitialFormFields(e){const t=this.constructor.initialFields,s=this.props,n=s.paymentButtons,o=s.currencyCode,a=s.currentUserEmail;if(Object(h.isNumber)(e)){const s=Object(h.find)(n,t=>t.ID===e);if(s)return Object(h.pick)(s,Object.keys(t))}const r=o||X.a,c=Object(h.get)(n,"0.email",a);return i()({},t,{currency:r,email:c})}isDirectEdit(){return Object(h.isNumber)(this.props.editPaymentId)}checkUnsavedForm(){return"form"===this.state.activeTab&&this.props.formIsDirty?new Promise(e=>{const t=this.props.translate;Object(ce.a)(t("Wait! You have unsaved changes. Do you really want to discard them?"),e,t("Discard"),null,{isScary:!0})}):Promise.resolve(!0)}showButtonList(){this.setState({activeTab:"list"})}setIsSubmitting(e){this._isMounted&&this.setState({isSubmitting:e})}getActionButtons(){const e=this.props,t=e.formIsValid,s=e.formIsDirty,n=e.translate,i=e.featuredImageId,o=this.state,a=o.activeTab,r=o.editedPaymentId,c=o.isSubmitting,l=o.isDirtyAfterImageEdit,p=t&&(s||l);let u,m,g,b;"form"===a&&Object(h.isNumber)(r)?(u=this.handleFormClose,m=this.handleSave,g=!p,b=n("Done")):(u=this.props.onClose,m=this.handleInsert,g="form"===a&&!p||"list"===a&&null===this.state.selectedPaymentId,b=n("Insert"));const f=!Object(h.isEmpty)(i)&&!Object(h.isNumber)(i);return[d.a.createElement(j.a,{onClick:u,disabled:c},n("Cancel")),d.a.createElement(j.a,{onClick:m,busy:c,disabled:c||g||f,primary:!0},c?n("Saving…"):b)]}renderEmptyDialog(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const s=this.props,n=s.onClose,i=s.translate,o=s.showDialog;return d.a.createElement(v.a,{isVisible:o,onClose:n,buttons:[d.a.createElement(j.a,{onClick:n},i("Close"))],additionalClassNames:"editor-simple-payments-modal"},d.a.createElement(he.a,{eventName:"calypso_simple_payments_dialog_view"}),!t&&d.a.createElement(x.a,{activeTab:"list",paymentButtons:[],onChangeTabs:h.noop}),e)}returnTrue(){return!0}render(){const e=this.props,t=e.showDialog,s=e.siteId,n=e.siteSlug,i=e.paymentButtons,o=e.currencyCode,a=e.isJetpackNotSupported,r=e.translate,c=e.planHasSimplePaymentsFeature,p=e.shouldQuerySitePlans,u=e.canCurrentUserAddButtons,m=this.state,h=m.activeTab,g=m.initialFormValues,b=m.errorMessage,f="list"===h||"form"===h&&!this.isDirectEdit()&&!Ee(i);return!p&&a?this.renderEmptyDialog(d.a.createElement(be.a,{className:"upgrade-jetpack",illustration:"/calypso/images/illustrations/illustration-jetpack.svg",title:r("Upgrade Jetpack to use Simple Payments"),illustrationWidth:600,action:d.a.createElement(fe.a,{icon:"star",title:r("Upgrade your Jetpack!"),description:r("Simple Payments requires Jetpack version 5.2 or later."),feature:pe.xb,plan:pe.vc,href:"../../plugins/jetpack/"+n})}),!0):p||c?u?d.a.createElement(v.a,{isVisible:t,onClose:this.handleDialogClose,buttons:this.getActionButtons(),additionalClassNames:"editor-simple-payments-modal"},d.a.createElement(he.a,{eventName:"calypso_simple_payments_dialog_view"}),d.a.createElement(y.a,{siteId:s}),(!o||p)&&d.a.createElement(E.a,{siteId:s}),f&&d.a.createElement(x.a,{activeTab:h,paymentButtons:i,onChangeTabs:this.handleChangeTabs}),b&&d.a.createElement(_.b,{status:"is-error",text:b,onDismissClick:this.dismissError}),"form"===h?d.a.createElement(ie,{initialValues:g,showError:this.showError,makeDirtyAfterImageEdit:this.makeDirtyAfterImageEdit}):d.a.createElement(oe.a,{siteId:s,paymentButtons:i,selectedPaymentId:this.state.selectedPaymentId,onSelectedChange:this.handleSelectedChange,onTrashClick:this.handleTrash,onEditClick:this.showButtonForm})):this.renderEmptyDialog(d.a.createElement(be.a,{illustration:"/calypso/images/illustrations/type-e-commerce.svg",illustrationWidth:300,title:r("Want to add a payment button to your site?"),action:d.a.createElement(l.Fragment,null,d.a.createElement("p",null,r("You're a contributor to this site, so you don't currently have permission to do this – only authors, editors, and administrators can add payment buttons.")),d.a.createElement("p",null,r("Contact your site administrator for options! They can change your permissions or add the button for you."))),secondaryAction:d.a.createElement("a",{className:"empty-content__action button",href:"https://support.wordpress.com/simple-payments/"},r("Learn more about Simple Payments"))}),!0):this.renderEmptyDialog(d.a.createElement(be.a,{illustration:"/calypso/images/illustrations/type-e-commerce.svg",illustrationWidth:300,title:r("Want to add a payment button to your site?"),action:d.a.createElement(me.a,{className:"editor-simple-payments-modal__nudge-nudge",title:r("Upgrade your plan to our Premium or Business plan!"),message:r("Get simple payments, advanced social media tools, your own domain, and more."),feature:pe.xb,event:"editor_simple_payments_modal_nudge",shouldDisplay:this.returnTrue}),secondaryAction:d.a.createElement("a",{className:"empty-content__action button",href:"https://support.wordpress.com/simple-payments/"},r("Learn more about Simple Payments"))}),!0)}}a()(we,"propTypes",{showDialog:c.a.bool.isRequired,editPaymentId:c.a.number,onClose:c.a.func.isRequired,onInsert:c.a.func.isRequired,isJetpackNotSupported:c.a.bool,canCurrentUserAddButtons:c.a.bool}),a()(we,"initialFields",{title:"",description:"",price:"",currency:X.a,multiple:!1,email:"",featuredImageId:null});t.a=Object(p.b)((e,t)=>{let s=t.siteId;return s||(s=Object(g.e)(e)),{siteId:s,siteSlug:Object(b.v)(e,s),paymentButtons:Object(f.a)(e,s),currencyCode:Object(ae.d)(e),shouldQuerySitePlans:null===Object(ue.g)(e,s),isJetpackNotSupported:Object(b.J)(e,s)&&!Object(b.H)(e,s,"5.2"),planHasSimplePaymentsFeature:Object(ue.i)(e,s,pe.xb),formIsValid:ee(e),formIsDirty:te(e),currentUserEmail:Object(ae.f)(e),featuredImageId:Object(h.get)(Object(u.a)("simplePaymentsForm")(e),"featuredImageId"),canCurrentUserAddButtons:Object(ye.b)(e,s,"publish_posts")}})(Object(m.localize)(we))},"./client/components/tinymce/plugins/simple-payments/dialog/list.jsx":function(e,t,s){"use strict";var n=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),i=s.n(n),o=s("./node_modules/prop-types/index.js"),a=s.n(o),r=s("./node_modules/react/index.js"),c=s.n(r),l=s("./node_modules/lodash/lodash.js"),d=s("./packages/i18n-calypso/dist/esm/index.js"),p=s("./node_modules/classnames/index.js"),u=s.n(p),m=s("./packages/format-currency/dist/esm/index.js"),h=s("./client/components/card/compact.jsx"),g=s("./client/components/ellipsis-menu/index.jsx"),b=s("./client/components/forms/form-radio/index.jsx"),f=s("./client/lib/catch-js-errors/log.js"),y=s("./client/components/popover/menu-item.jsx"),E=s("./node_modules/react-redux/es/index.js"),v=s("./client/lib/media/utils.js"),j=s("./client/components/data/query-media/index.jsx"),_=s("./client/state/selectors/get-media-item.js");var x=Object(E.b)((e,t)=>{let s=t.siteId,n=t.imageId;return{image:n?Object(_.a)(e,s,n):null}})(e=>{let t=e.siteId,s=e.imageId,n=e.image;if(!t||!s)return null;if(!n)return c.a.createElement("figure",{className:"dialog__editor-simple-payments-modal-figure is-placeholder"},c.a.createElement(j.a,{siteId:t,mediaId:s}));const i=Object(v.s)(n,{size:"medium"});return c.a.createElement("div",{className:"dialog__editor-simple-payments-modal-figure-container"},c.a.createElement("figure",{className:"dialog__editor-simple-payments-modal-figure"},c.a.createElement("img",{className:"dialog__editor-simple-payments-modal-image",src:i,alt:"product"})))}),w=s("./client/lib/simple-payments/constants.js");class S extends r.Component{constructor(){super(...arguments),i()(this,"handleRadioChange",()=>this.props.onSelectedChange(this.props.paymentId)),i()(this,"handleEditClick",()=>this.props.onEditClick(this.props.paymentId)),i()(this,"handleTrashClick",()=>this.props.onTrashClick(this.props.paymentId))}formatPrice(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:w.a;if(isNaN(e))return Object(f.default)("Simple Payments: invalid price value",{siteId:this.props.siteId,paymentId:this.props.paymentId,price:e}),"---- ".concat(t);const s=Object(m.getCurrencyObject)(e,t),n=s.integer,i=s.fraction;return"".concat(n).concat(i," ").concat(t)}render(){const e=this.props,t=e.siteId,s=e.paymentId,n=e.title,i=e.price,o=e.currency,a=e.featuredImageId,r=e.isSelected,l=e.translate,d="simple-payments-list-item-radio-".concat(s),p=u()({"editor-simple-payments-modal__list-label":!0,"is-error":isNaN(i)});return c.a.createElement(h.a,{className:"editor-simple-payments-modal__list-item"},c.a.createElement(b.a,{name:"selection",id:d,value:s,checked:r,onChange:this.handleRadioChange}),c.a.createElement("label",{className:p,htmlFor:d},c.a.createElement("div",{className:"editor-simple-payments-modal__list-name"},n),c.a.createElement("div",null,this.formatPrice(i,o))),c.a.createElement(x,{siteId:t,imageId:a}),c.a.createElement(g.a,{className:"editor-simple-payments-modal__list-menu",popoverClassName:"is-dialog-visible",position:"bottom left"},c.a.createElement(y.a,{icon:"pencil",onClick:this.handleEditClick},l("Edit")),c.a.createElement(y.a,{icon:"trash",onClick:this.handleTrashClick},l("Trash"))))}}i()(S,"propTypes",{onSelectedChange:a.a.func,onEditClick:a.a.func,onTrashClick:a.a.func}),i()(S,"defaultProps",{onSelectedChange:l.noop,onEditClick:l.noop,onTrashClick:l.noop});var C=Object(d.localize)(S);var I=Object(d.localize)(e=>{let t=e.translate;return c.a.createElement(h.a,{className:"editor-simple-payments-modal__list-item is-placeholder"},c.a.createElement("div",{className:"editor-simple-payments-modal__list-label"},c.a.createElement("div",null,c.a.createElement("span",{className:"placeholder-text"},t("Loading payment buttons…"))),c.a.createElement("div",null,c.a.createElement("span",{className:"placeholder-text"},"$1000"))))});class O extends r.Component{renderListItems(){const e=this.props,t=e.siteId,s=e.paymentButtons,n=e.selectedPaymentId,i=e.onSelectedChange,o=e.onEditClick,a=e.onTrashClick;return s?s.map(e=>{let s=e.ID,r=e.title,l=e.price,d=e.currency,p=e.featuredImageId;return c.a.createElement(C,{key:s,siteId:t,paymentId:s,isSelected:n===s,title:r,price:l,currency:d,featuredImageId:p,onSelectedChange:i,onEditClick:o,onTrashClick:a})}):Object(l.range)(2).map(e=>c.a.createElement(I,{key:e}))}render(){return c.a.createElement("div",{className:"editor-simple-payments-modal__list"},this.renderListItems())}}i()(O,"propTypes",{siteId:a.a.number.isRequired,paymentButtons:a.a.array,selectedPaymentId:a.a.number,onSelectedChange:a.a.func,onEditClick:a.a.func,onTrashClick:a.a.func}),i()(O,"defaultProps",{selectedPaymentId:null,onSelectedChange:l.noop,onEditClick:l.noop,onTrashClick:l.noop});t.a=O},"./client/components/tinymce/plugins/simple-payments/dialog/navigation.jsx":function(e,t,s){"use strict";var n=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),i=s.n(n),o=s("./node_modules/prop-types/index.js"),a=s.n(o),r=s("./node_modules/react/index.js"),c=s.n(r),l=s("./packages/i18n-calypso/dist/esm/index.js"),d=s("./client/components/gridicon/index.jsx"),p=s("./client/components/section-header/index.jsx"),u=s("./client/components/header-cake/index.jsx"),m=s("./client/components/button/index.jsx");class h extends r.Component{constructor(){super(...arguments),i()(this,"onChangeTabs",e=>()=>this.props.onChangeTabs(e))}render(){const e=this.props,t=e.paymentButtons,s=e.activeTab,n=e.translate,i="editor-simple-payments-modal__navigation";return"form"===s?c.a.createElement(u.a,{className:i,onClick:this.onChangeTabs("list"),backText:n("Payment Buttons")}):t?c.a.createElement(p.a,{className:i,label:n("Payment Buttons"),count:t.length},c.a.createElement(m.a,{compact:!0,onClick:this.onChangeTabs("form")},c.a.createElement(d.a,{icon:"plus-small"})," ",n("Add New"))):c.a.createElement(p.a,{className:i})}}i()(h,"propTypes",{activeTab:a.a.oneOf(["list","form"]).isRequired,onChangeTabs:a.a.func.isRequired,paymentButtons:a.a.array}),t.a=Object(l.localize)(h)},"./client/components/tinymce/plugins/wplink/plugin.js":function(e,t,s){"use strict";var n=s("./node_modules/react-dom/index.js"),i=s.n(n),o=s("./node_modules/react/index.js"),a=s.n(o),r=s("./node_modules/tinymce/tinymce.js"),c=s.n(r),l=s("./packages/i18n-calypso/dist/esm/index.js"),d=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),p=s.n(d),u=s("./node_modules/prop-types/index.js"),m=s.n(u),h=s("./node_modules/react-redux/es/index.js"),g=s("./node_modules/lodash/lodash.js"),b=s("./client/lib/media-serialization/index.js"),f=s("./client/lib/media/store.js"),y=s("./client/lib/media/utils.js"),E=s("./client/components/dialog/index.jsx"),v=s("./client/components/forms/form-text-input/index.jsx"),j=s("./client/components/forms/form-checkbox/index.jsx"),_=s("./client/components/forms/form-button/index.jsx"),x=s("./client/components/forms/form-fieldset/index.jsx"),w=s("./client/components/forms/form-label/index.jsx"),S=s("./client/my-sites/post-selector/index.jsx"),C=s("./client/state/ui/selectors.js"),I=s("./client/state/posts/selectors.js"),O=s("./client/lib/formatting/index.js"),T=s("./client/state/posts/stats.js"),P=s("./client/components/gridicon/index.jsx");const k=/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i,D=/^(https?|ftp):\/\/[A-Z0-9.-]+\.[A-Z]{2,4}[^ "]*$/i,N=/^(?:[a-z]+:|#|\?|\.|\/)/;class R extends a.a.Component{constructor(){super(...arguments),p()(this,"getLink",()=>{const e=this.props.editor;return e.dom.getParent(e.selection.getNode(),"a")}),p()(this,"getCorrectedUrl",()=>{const e=this.state.url.trim();return k.test(e)?"mailto:"+e:N.test(e)?e:"http://"+e}),p()(this,"updateEditor",()=>{const e=this.props.editor;if(e.focus(),c.a.isIE&&e.selection.moveToBookmark(e.windowManager.bookmark),!this.state.url)return void this.removeLink();const t=this.getLink();let s=this.state.linkText;const n={href:this.getCorrectedUrl(),target:this.state.newWindow?"_blank":""};t?(s&&("innerText"in t?t.innerText=s:t.textContent=s),e.dom.setAttribs(t,n)):s?(s=e.dom.encode(s),e.selection.setNode(e.dom.create("a",n,s))):e.execCommand("mceInsertLink",!1,n),this.closeDialog()}),p()(this,"hasSelectedText",e=>{const t=this.props.editor.selection.getContent();let s;if(/</.test(t)&&(!/^<a [^>]+>[^<]+<\/a>$/.test(t)||-1===t.indexOf("href=")))return!1;if(e){if(0===(s=e.childNodes).length)return!1;for(let e=s.length-1;e>=0;e--)if(3!==s[e].nodeType)return!1}return!0}),p()(this,"getInferredUrl",()=>{const e=this.props.editor.selection.getContent();let t,s;if(k.test(e))return"mailto:"+e;if(D.test(e))return e.replace(/&amp;|&#0?38;/gi,"&");const n=this.props.editor.selection.getNode();if(n&&"IMG"===n.nodeName){if(t=Object(b.a)(n),this.props.site&&t.media.ID)return s=f.a.get(this.props.site.ID,t.media.ID)||t.media,Object(y.s)(s,{size:"full"});if(t.media.URL)return t.media.URL}}),p()(this,"getState",()=>{const e=this.props.editor,t=e.selection.getNode(),s=e.dom.getParent(t,"a[href]"),n=this.hasSelectedText(s),i={isNew:!0,newWindow:!1,showLinkText:!0,linkText:"",url:"",isUserDefinedLinkText:!1};return s?(i.linkText=s.innerText||s.textContent,i.url=e.dom.getAttrib(s,"href"),i.newWindow="_blank"===e.dom.getAttrib(s,"target"),i.isNew=!1):n&&(i.linkText=e.selection.getContent({format:"text"})),s||(i.url=this.getInferredUrl()||""),this.hasSelectedText(s)||(i.showLinkText=!1),i}),p()(this,"closeDialog",()=>{this.props.onClose()}),p()(this,"setUrl",e=>{this.setState({url:e.target.value})}),p()(this,"setLinkText",e=>{this.setState({linkText:e.target.value,isUserDefinedLinkText:!0})}),p()(this,"setNewWindow",e=>{this.setState({newWindow:e.target.checked})}),p()(this,"onInputKeyDown",e=>{"Enter"===e.key&&(e.preventDefault(),this.updateEditor())}),p()(this,"removeLink",()=>{this.props.editor.execCommand("unlink"),this.closeDialog()}),p()(this,"getButtons",()=>{let e;e=this.state.isNew?this.props.translate("Add Link"):this.props.translate("Save");const t=[a.a.createElement(_.a,{key:"save",onClick:this.updateEditor},e),a.a.createElement(_.a,{key:"cancel",isPrimary:!1,onClick:this.closeDialog},this.props.translate("Cancel"))];return this.state.url&&!this.state.isNew&&t.push(a.a.createElement("button",{className:"wplink__remove-link",onClick:this.removeLink},a.a.createElement(P.a,{icon:"link-break"}),this.props.translate("Remove"))),t}),p()(this,"setExistingContent",e=>{const t={url:e.URL};!this.state.isUserDefinedLinkText&&!this.props.editor.selection.getContent()&&!this.getLink()&&Object.assign(t,{linkText:Object(O.b)(e.title)}),this.props.recordEditorStat("link-existing-content"),this.props.recordEditorEvent("Set link to existing content"),this.setState(t)}),p()(this,"getSelectedPostId",()=>{if(!this.state.url||!this.props.sitePosts)return;const e=Object(g.find)(this.props.sitePosts,{URL:this.state.url});return e?e.ID:void 0}),p()(this,"state",this.getState())}componentWillReceiveProps(e){e.visible&&!this.props.visible&&this.setState(this.getState())}render(){return a.a.createElement(E.a,{isVisible:this.props.visible,onClose:this.closeDialog,buttons:this.getButtons(),autoFocus:!1,additionalClassNames:"wplink__dialog"},a.a.createElement(x.a,null,a.a.createElement(w.a,null,a.a.createElement("span",null,this.props.translate("URL")),a.a.createElement(v.a,{ref:"url",autoFocus:!0,onChange:this.setUrl,value:this.state.url,onKeyDown:this.onInputKeyDown})),this.state.showLinkText?a.a.createElement(w.a,null,a.a.createElement("span",null,this.props.translate("Link Text")),a.a.createElement(v.a,{onChange:this.setLinkText,value:this.state.linkText,onKeyDown:this.onInputKeyDown})):null),a.a.createElement(x.a,null,a.a.createElement(w.a,null,a.a.createElement(j.a,{onChange:this.setNewWindow,checked:this.state.newWindow}),a.a.createElement("span",null,this.props.translate("Open link in a new window/tab")))),a.a.createElement(x.a,null,a.a.createElement(w.a,null,a.a.createElement("span",null,this.props.translate("Link to existing content")),this.props.site&&a.a.createElement(S.a,{siteId:this.props.site.ID,type:"any",excludePrivateTypes:!0,status:"publish",orderBy:"date",order:"DESC",selected:this.getSelectedPostId(),onChange:this.setExistingContent,suppressFirstPageLoad:!this.props.firstLoad,emptyMessage:this.props.translate("No posts found")}))))}}p()(R,"propTypes",{visible:m.a.bool,editor:m.a.object,onClose:m.a.func,site:m.a.object,sitePosts:m.a.array,firstLoad:m.a.bool}),p()(R,"defaultProps",{onClose:()=>{},firstLoad:!1});var M=Object(h.b)(e=>{const t=Object(C.d)(e);return{site:t,sitePosts:t?Object(I.m)(e,t.ID):null}},{recordEditorEvent:T.a,recordEditorStat:T.b})(Object(l.localize)(R)),L=s("./client/lib/react-helpers/index.js");
/**
 * Adapted from the WordPress wplink TinyMCE plugin.
 *
 *
 * @format
 * @copyright 2015 by the WordPress contributors.
 * @license See CREDITS.md.
 */
function A(e){let t,s,n;e.on("init",function(){t=e.getContainer().appendChild(document.createElement("div"))}),e.on("remove",function(){i.a.unmountComponentAtNode(t),t.parentNode.removeChild(t),t=null}),e.addCommand("WP_Link",function(){return function s(){let i=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];Object(L.b)(a.a.createElement(M,{visible:i,editor:e,firstLoad:!n,onClose:()=>s(!1)}),t,e.getParam("redux_store")),i&&(n=!0),i||e.focus()}()}),e.addShortcut("access+a","","WP_Link"),e.addShortcut("meta+k","","WP_Link"),e.addButton("link",{icon:"link",tooltip:Object(l.translate)("Insert/edit link"),cmd:"WP_Link",stateSelector:"a[href]"}),e.addButton("unlink",{icon:"unlink",tooltip:"Remove link",cmd:"unlink"}),e.addMenuItem("link",{icon:"link",text:Object(l.translate)("Insert/edit link"),cmd:"WP_Link",stateSelector:"a[href]",context:"insert",prependToContext:!0}),e.on("pastepreprocess",function(t){let s=t.content;e.selection.isCollapsed()||(s=s.replace(/<[^>]+>/g,""),s=c.a.trim(s),/^(?:https?:)?\/\/\S+$/i.test(s)&&(e.execCommand("mceInsertLink",!1,{href:e.dom.decode(s)}),t.preventDefault()))}),c.a.ui.Factory.add("WPLinkPreview",c.a.ui.Control.extend({url:"#",renderHtml:function(){return'<div id="'+this._id+'" class="wp-link-preview"><a href="'+this.url+'" target="_blank" rel="noopener noreferrer" tabindex="-1">'+this.url+"</a></div>"},setURL:function(e){let t,s;this.url!==e&&(this.url=e,-1!==(t=(e=(e=window.decodeURIComponent(e)).replace(/^(?:https?:)?\/\/(?:www\.)?/,"")).indexOf("?"))&&(e=e.slice(0,t)),-1!==(t=e.indexOf("#"))&&(e=e.slice(0,t)),"/"===(e=e.replace(/(?:index)?\.html$/,"")).charAt(e.length-1)&&(e=e.slice(0,-1)),e.length>40&&-1!==(t=e.indexOf("/"))&&-1!==(s=e.lastIndexOf("/"))&&s!==t&&(t+e.length-s<40&&(s=-(40-(t+1))),e=e.slice(0,t+1)+"…"+e.slice(s)),c.a.$(this.getEl().firstChild).attr("href",this.url).text(e))}})),e.addButton("wp_link_preview",{type:"WPLinkPreview",onPostRender:function(){const t=this;e.on("wptoolbar",function(n){const i=e.dom.getParent(n.element,"a");let o,a;i&&(a=(o=e.$(i)).attr("href"))&&!o.find("img").length&&(t.setURL(a),n.element=i,n.toolbar=s)})}}),e.addButton("wp_link_edit",{tooltip:"Edit ",icon:"dashicon dashicons-edit",cmd:"WP_Link"}),e.addButton("wp_link_remove",{tooltip:"Remove",icon:"dashicon dashicons-no",cmd:"unlink"}),e.on("preinit",function(){e.wp&&e.wp._createToolbar&&(s=e.wp._createToolbar(["wp_link_preview","wp_link_edit","wp_link_remove"],!0))})}t.a=function(){c.a.PluginManager.add("wplink",A)}},"./client/components/tinymce/style.scss":function(e,t,s){},"./client/lib/analytics/page-view-tracker/index.jsx":function(e,t,s){"use strict";var n=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),i=s.n(n),o=s("./node_modules/debug/src/browser.js"),a=s.n(o),r=s("./node_modules/prop-types/index.js"),c=s.n(r),l=s("./node_modules/react/index.js"),d=s.n(l),p=s("./node_modules/lodash/lodash.js"),u=s("./node_modules/react-redux/es/index.js"),m=s("./client/lib/route/index.js"),h=s("./client/state/analytics/actions.js"),g=s("./client/state/utils.js"),b=s("./client/state/ui/selectors.js"),f=s("./client/state/sites/selectors.js");const y=a()("calypso:analytics:PageViewTracker");class E extends d.a.Component{constructor(){super(...arguments),i()(this,"state",{timer:null}),i()(this,"queuePageView",()=>{const e=this.props,t=e.delay,s=void 0===t?0:t,n=e.path,i=e.recorder,o=void 0===i?p.noop:i,a=e.hasSelectedSiteLoaded,r=e.title,c=e.properties;if(y('Queuing Page View: "'.concat(r,'" at "').concat(n,'" with ').concat(s,"ms delay")),a&&!this.state.timer)return s?void this.setState({timer:setTimeout(()=>o(n,r),s)}):o(n,r,"default",c)})}componentDidMount(){y("Component has mounted."),this.queuePageView()}componentWillUnmount(){y("Component has unmounted."),clearTimeout(this.state.timer)}componentDidUpdate(e){e.path===this.props.path&&e.selectedSiteId===this.props.selectedSiteId||this.queuePageView()}render(){return null}}i()(E,"displayName","PageViewTracker"),i()(E,"propTypes",{delay:c.a.number,path:c.a.string.isRequired,recorder:c.a.func,hasSelectedSiteLoaded:c.a.bool,selectedSiteId:c.a.number,title:c.a.string.isRequired,properties:c.a.object});const v={recorder:Object(g.f)(h.h,[h.c])};t.a=Object(u.b)(e=>{const t=Object(b.e)(e),s=Object(f.v)(e,t),n="undefined"==typeof window?"":Object(m.d)(Object(p.get)(window,"location.pathname",""));return{hasSelectedSiteLoaded:!n||Object(p.isNumber)(n)&&n===t||n===s,selectedSiteId:t}},v)(E)},"./client/lib/embed-frame-markup/index.jsx":function(e,t,s){"use strict";s.d(t,"a",function(){return c});var n=s("./node_modules/react/index.js"),i=s.n(n),o=s("./node_modules/react-dom/server.browser.js"),a=s("./node_modules/lodash/lodash.js");const r="https://s0.wp.com/wp-includes/js/jquery/jquery.js";function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.body,s=e.scripts,n=e.styles;return t||s||n?Object(o.renderToStaticMarkup)(i.a.createElement("html",null,i.a.createElement("head",null,Object(a.map)(n,(e,t)=>{let s=e.media,n=e.src;return i.a.createElement("link",{key:t,rel:"stylesheet",media:s,href:n})}),i.a.createElement("style",{dangerouslySetInnerHTML:{__html:"a { cursor: default; }"}})),i.a.createElement("body",{style:{margin:0}},i.a.createElement("div",{dangerouslySetInnerHTML:{__html:t}}),i.a.createElement("script",{src:r}),i.a.createElement("script",{dangerouslySetInnerHTML:{__html:"\n\t\t\t\t\t[ 'click', 'dragstart' ].forEach( function( type ) {\n\t\t\t\t\t\tdocument.addEventListener( type, function( event ) {\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\tevent.stopImmediatePropagation();\n\t\t\t\t\t\t}, true );\n\t\t\t\t\t} );\n\t\t\t\t"}}),Object(a.flatMap)(s,(e,t)=>{let s=e.extra,n=e.src;return[s?i.a.createElement("script",{key:t+"-extra",dangerouslySetInnerHTML:{__html:s}}):null,i.a.createElement("script",{key:t,src:n})]})))):""}},"./client/lib/human-date/index.js":function(e,t,s){"use strict";s.d(t,"a",function(){return a});var n=s("./packages/i18n-calypso/dist/esm/index.js"),i=s.n(n);const o=6e4;function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"ll";const s=i.a.moment();e=i.a.moment(e);let n=s.diff(e);if(n<0&&(n=0),n<o)return i.a.translate("just now");if(n<60*o){const e=Math.ceil(n/o);return i.a.translate("%(minutes)dm ago",{args:{minutes:e},comment:"example for a resulting string: 2m ago"})}if(n<60*o*24){const t=s.diff(e,"hours");return i.a.translate("%(hours)dh ago",{args:{hours:t},comment:"example for a resulting string: 5h ago"})}if(n<60*o*24*7){const t=s.diff(e,"days");return i.a.translate("%(days)dd ago",{args:{days:t},comment:"example for a resulting string: 4d ago"})}return e.format(t)}},"./client/lib/interval/index.js":function(e,t,s){"use strict";s.d(t,"c",function(){return c}),s.d(t,"a",function(){return l}),s.d(t,"d",function(){return d}),s.d(t,"b",function(){return p}),s.d(t,"e",function(){return u});var n=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),i=s.n(n),o=s("./node_modules/react/index.js"),a=s("./node_modules/prop-types/index.js"),r=s.n(a);const c=1e3,l=5e3,d=1e4,p=6e4;class u extends o.Component{constructor(){var e;super(...arguments),e=this,i()(this,"tick",()=>{this.props.onTick()}),i()(this,"start",function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.props;e.interval=setInterval(e.tick,t.period)}),i()(this,"stop",()=>{this.interval=clearInterval(this.interval)})}componentDidMount(){this.start()}componentWillUnmount(){this.stop()}componentWillReceiveProps(e){e.period!==this.props.period&&(this.stop(),this.start(e))}render(){return null}}i()(u,"propTypes",{onTick:r.a.func.isRequired,period:r.a.number.isRequired})},"./client/lib/media-serialization/index.js":function(e,t,s){"use strict";var n={};s.r(n),s.d(n,"deserialize",function(){return x});var i={};s.r(i),s.d(i,"deserialize",function(){return T});var o={};s.r(o),s.d(o,"deserialize",function(){return N});var a={};s.r(a),s.d(a,"deserialize",function(){return R});var r={};s.r(r),s.d(r,"deserialize",function(){return M});var c={};s.r(c),s.d(c,"deserialize",function(){return L});var l=s("./node_modules/lodash/lodash.js");const d="DOM",p="STRING",u="SHORTCODE",m="OBJECT",h="API",g="UNKNOWN",b={IMAGE:"IMAGE",VIDEO:"VIDEO",AUDIO:"AUDIO",UNKNOWN:"UNKNOWN"};var f=s("./client/lib/media/utils.js");const y=["closed","self-closing","single"];var E=function(e){return"string"==typeof e?p:"object"==typeof e&&"string"==typeof e.nodeName?d:e&&e.tag&&Object(l.includes)(y,e.type)?u:e&&e.type&&Object(l.includes)(b,e.type)?m:Object(f.g)(e)?h:g};const v=/\bsize-(\w+)\b/,j=/\bwp-image-((media-)?\d+)\b/,_=/\balign(left|center|right|none)\b/;function x(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{media:{},appearance:{}};switch(e.nodeName){case"IMG":t=function(e,t){return t.type=b.IMAGE,t.media.URL=e.getAttribute("src"),t.media.alt=e.getAttribute("alt"),t.media.transient=e.hasAttribute("data-istransient"),["width","height"].forEach(s=>{let n="natural"+s[0].toUpperCase()+s.slice(1),i=e.getAttribute(s)||e[n]||e[s];i&&isFinite(i)&&(t.media[s]=parseInt(i,10))}),v.test(e.className)&&(t.appearance.size=e.className.match(v)[1]),_.test(e.className)&&(t.appearance.align=e.className.match(_)[1]),j.test(e.className)&&(t.media.ID=e.className.match(j)[1],isFinite(t.media.ID)&&(t.media.ID=parseInt(t.media.ID,10))),t}(e,t)}return t}var w=s("./client/lib/shortcode/index.js"),S=s("./client/lib/post-normalizer/utils.js"),C=function(e){let t;if(document.implementation&&document.implementation.createHTMLDocument)t=document.implementation.createHTMLDocument("").body;else try{return Object(S.b)(e).firstChild}catch(e){}return(t=t||document.createElement("div")).innerHTML=e,t.firstChild};function I(e,t){const s=Object(w.b)(e);return s?U(s,t):t}function O(e,t){const s=C(e);return s instanceof window.Element?U(s,t):t}function T(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{media:{},appearance:{}};return[I,O].reduce((s,n)=>Object.assign(s,n(e,t)),{})}const P=/((?:<a [^>]+>)?<img [^>]+>(?:<\/a>)?)([\s\S]*)/i,k=/attachment_(\d+)/,D=/align(\w+)/;function N(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{media:{},appearance:{}};switch(e.tag){case"caption":t=function(e,t){if(e.attrs&&e.attrs.named&&(D.test(e.attrs.named.align)&&(t.appearance.align=e.attrs.named.align.match(D)[1]),k.test(e.attrs.named.id)&&(t.media.ID=parseInt(e.attrs.named.id.match(k)[1],10)),t.media.width&&isFinite(e.attrs.named.width)&&(t.media.width=parseInt(e.attrs.named.width,10))),!e.content)return t;const s=e.content.match(P);return s&&s[2]&&(t.media.caption=s[2].trim()),s?U(s[1],t):t}(e,t)}return t}function R(e){return e}function M(e){const t={media:Object(l.assign)({transient:!1},e),appearance:{}};switch(Object(f.g)(e)){case"image":t.type=b.IMAGE;break;case"audio":t.type=b.AUDIO;break;case"video":t.type=b.VIDEO}return t}function L(){return{type:b.UNKNOWN,media:{},appearance:{}}}var A={dom:n,string:i,shortcode:o,object:a,api:r,unknown:c};function U(e,t){const s=E(e);return A[s.toLowerCase()].deserialize(e,t)}s.d(t,"a",function(){return U})},"./client/lib/media/library-selected-store.js":function(e,t,s){"use strict";var n=s("./node_modules/lodash/lodash.js"),i=s("./client/lib/media/store.js"),o=s("./client/dispatcher/index.js"),a=s("./client/lib/mixins/emitter/index.js");const r={_media:{}};function c(e,t){r._media[e]=Object(n.map)(t,"ID")}function l(e,t){!function(e){e in r._media||(r._media[e]=[])}(e),r._media[e].push(t.ID)}function d(e,t,s){let n;s||(s=t.ID),s&&e in r._media&&-1!==(n=r._media[e].indexOf(s))&&r._media[e].splice(n,1,t.ID)}function p(e,t){let s;e in r._media&&-1!==(s=r._media[e].indexOf(t.ID))&&r._media[e].splice(s,1)}Object(a.a)(r),r.get=function(e,t){return i.a.get(e,t)},r.getAll=function(e){return e in r._media?r._media[e].map(t=>i.a.get(e,t)).filter(e=>e&&(e.guid||e.transient)):[]},r.dispatchToken=o.a.register(function(e){const t=e.action;switch(o.a.waitFor([i.a.dispatchToken]),t.type){case"CHANGE_MEDIA_SOURCE":c(t.siteId,[]),r.emit("change");break;case"SET_MEDIA_LIBRARY_SELECTED_ITEMS":if(t.error||!t.siteId||!t.data||!Array.isArray(t.data))break;c(t.siteId,t.data),r.emit("change");break;case"CREATE_MEDIA_ITEM":!t.error&&t.siteId&&t.data&&(l(t.siteId,t.data),r.emit("change"));break;case"RECEIVE_MEDIA_ITEM":if(t.error&&t.siteId&&t.id&&(p(t.siteId,{ID:t.id}),r.emit("change")),!t.siteId||!t.data||t.error)break;d(t.siteId,t.data,t.id),r.emit("change");break;case"RECEIVE_MEDIA_ITEMS":!t.error&&t.siteId&&t.data&&t.data.media&&(s=t.siteId,t.data.media.forEach(function(e){d(s,e)}),r.emit("change"));break;case"REMOVE_MEDIA_ITEM":if(!t.siteId||!t.data||t.error)break;p(t.siteId,t.data),r.emit("change")}var s}),t.a=r},"./client/lib/react-helpers/index.js":function(e,t,s){"use strict";s.d(t,"a",function(){return l}),s.d(t,"b",function(){return d});var n=s("./node_modules/react-dom/index.js"),i=s.n(n),o=s("./node_modules/react/index.js"),a=s.n(o),r=s("./node_modules/react-redux/es/index.js"),c=s("./client/components/localized-moment/context.js");function l(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return t.join(" › ")}function d(e,t,s){const n="string"==typeof t?document.getElementById(t):t;return i.a.render(a.a.createElement(r.a,{store:s},a.a.createElement(c.b,null,e)),n)}},"./client/lib/react-pass-to-children/index.js":function(e,t,s){"use strict";var n=s("./node_modules/lodash/lodash.js"),i=s("./node_modules/react/index.js"),o=s.n(i);t.a=function(e,t){let s,i=Object(n.assign)({},e.props,t);return delete i.children,o.a.Children.count(e.props.children)>1?(s=o.a.Children.map(e.props.children,function(e){return o.a.isValidElement(e)?o.a.cloneElement(e,i):e}),o.a.createElement("div",null,s)):o.a.cloneElement(e.props.children,i)}},"./client/lib/scroll-to/index.js":function(e,t,s){"use strict";s.d(t,"a",function(){return l});var n=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),i=s.n(n);const o=new Map;function a(e){return e=e&&void 0!==e.scrollTop?e:window,function(t,s){e===window?e.scrollTo(t,s):(e.scrollTop=s,e.scrollLeft=t)}}class r{constructor(e){i()(this,"finish",()=>{this.updater(this.end.x,this.end.y),this.onComplete&&this.onComplete(),o.delete(this.container)}),i()(this,"step",e=>{if(this.nextFrame=null,!this.startTime)return this.startTime=e,void this.animate();if(e-this.startTime>=this.duration)return void this.finish();const t=(e-this.startTime)/this.duration,s=this.easing(t),n=Math.round(this.start.x+(this.end.x-this.start.x)*s),i=Math.round(this.start.y+(this.end.y-this.start.y)*s);n===this.x&&i===this.y||(this.x=n,this.y=i,this.updater(n,i)),this.animate()}),this.x=e.x,this.y=e.y,this.startTime=null,this.duration=e.duration,this.start=e.start,this.end=e.end,this.onStart=e.onStart,this.onComplete=e.onComplete,this.updater=e.updater,this.easing=e.easing,this.container=e.container}animate(){this.nextFrame=requestAnimationFrame(this.step)}cancel(){this.nextFrame&&(cancelAnimationFrame(this.nextFrame),this.nextFrame=null),this.finishTimeout&&(clearTimeout(this.finishTimeout),this.finishTimeout=null)}jumpTo(e,t){this.cancel(),this.end={x:e,y:t},this.updater(e,t),this.finishTimeout=setTimeout(this.finish,this.duration)}}function c(e){const t=e-1;return Math.sqrt(1-t*t)}function l(e){const t=e.container||window;if(o.has(t)){return void o.get(t).jumpTo(e.x,e.y)}const s=function(e){return e&&void 0!==e.scrollTop?{x:e.scrollLeft,y:e.scrollTop}:{x:window.pageXOffset||document.documentElement.scrollLeft,y:window.pageYOffset||document.documentElement.scrollTop}}(t),n=new r({start:s,end:{x:e.x,y:e.y},container:t,easing:e.easing||c,duration:e.duration||500,updater:a(t),x:s.x,y:s.y,onStart:e.onStart,onComplete:e.onComplete});return o.set(t,n),n.animate(),e.onStart&&e.onStart(),n}},"./client/lib/seo/index.js":function(e,t,s){"use strict";s.d(t,"a",function(){return o});var n=s("./node_modules/lodash/lodash.js");const i=["Yoast SEO","Yoast SEO Premium","All In One SEO Pack","All in One SEO Pack Pro"],o=e=>(e=>e.filter(e=>{let t=e.name;return Object(n.includes)(i,t)}).map(e=>({name:e.name,slug:e.slug})))(e)[0]},"./client/lib/simple-payments/constants.js":function(e,t,s){"use strict";s.d(t,"c",function(){return n}),s.d(t,"b",function(){return i}),s.d(t,"a",function(){return o}),s.d(t,"d",function(){return a});const n="jp_pay_product",i=100,o="USD",a=[o,"EUR","AUD","BRL","CAD","CZK","DKK","HKD","HUF","ILS","JPY","MYR","MXN","TWD","NZD","NOK","PHP","PLN","GBP","RUB","SGD","SEK","CHF","THB"]},"./client/lib/simple-payments/utils.js":function(e,t,s){"use strict";s.d(t,"b",function(){return i}),s.d(t,"a",function(){return o});s("./node_modules/lodash/trimEnd.js"),s("./packages/format-currency/dist/esm/index.js");var n=s("./client/lib/simple-payments/constants.js");const i=e=>e.type===n.c&&"publish"===e.status,o=e=>{const t=(""+e).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return t?Math.max(0,(t[1]?t[1].length:0)-(t[2]?+t[2]:0)):0}},"./client/my-sites/post-selector/index.jsx":function(e,t,s){"use strict";var n=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),i=s.n(n),o=s("./node_modules/prop-types/index.js"),a=s.n(o),r=s("./node_modules/react/index.js"),c=s.n(r),l=s("./node_modules/lodash/lodash.js"),d=s("./node_modules/@babel/runtime/helpers/objectSpread.js"),p=s.n(d),u=s("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),m=s.n(u),h=s("./packages/i18n-calypso/dist/esm/index.js"),g=s("./node_modules/react-redux/es/index.js"),b=s("./node_modules/classnames/index.js"),f=s.n(b),y=s("./node_modules/dom-helpers/util/scrollbarSize.js"),E=s.n(y),v=s("./node_modules/react-virtualized/dist/es/List/index.js"),j=s("./node_modules/react-virtualized/dist/es/AutoSizer/index.js");class _ extends c.a.Component{render(){let e,t;return t=this.props.translate("No results. Please try a different search."),this.props.createLink&&(e=this.props.translate("You may want to {{a}}create a new page{{/a}}.",{context:"Menus: item search/listing results",comment:"This is used when no posts or pages match the given search.",components:{a:c.a.createElement("a",{className:"create-link",href:this.props.createLink,target:"_blank",rel:"noopener noreferrer"})}})),c.a.createElement("span",{className:"is-empty-content"},t," ",e)}}i()(_,"displayName","PostSelectorNoResults"),i()(_,"propTypes",{createLink:a.a.string});var x=Object(h.localize)(_),w=s("./client/lib/analytics/index.js"),S=s("./client/components/gridicon/index.jsx");class C extends c.a.Component{render(){return c.a.createElement("div",{className:"post-selector__search"},c.a.createElement(S.a,{icon:"search",size:18}),c.a.createElement("input",{type:"search",placeholder:this.props.translate("Search…",{textOnly:!0}),value:this.props.searchTerm,onChange:this.props.onSearch}))}}i()(C,"displayName","PostSelectorSearch"),i()(C,"propTypes",{searchTerm:a.a.string,onSearch:a.a.func.isRequired});var I=Object(h.localize)(C),O=s("./client/lib/formatting/index.js"),T=s("./client/state/posts/selectors.js"),P=s("./client/state/post-types/selectors.js"),k=s("./client/state/sites/selectors.js"),D=s("./client/components/data/query-post-types/index.jsx"),N=s("./client/components/data/query-posts/index.jsx");const R=800,M=25,L=20,A=10;class U extends c.a.Component{constructor(){var e;super(...arguments),e=this,i()(this,"state",{searchTerm:"",requestedPages:[1]}),i()(this,"recomputeRowHeights",()=>{this.list&&(this.list.recomputeRowHeights(),this.isCompact()&&this.forceUpdate())}),i()(this,"setListRef",e=>{this.list=e}),i()(this,"setItemRef",(e,t)=>{if(!t||!e)return;const s=this.itemHeights[e.global_ID]||M,n=t.clientHeight;this.itemHeights[e.global_ID]=n,s!==n&&this.queueRecomputeRowHeights()}),i()(this,"hasNoSearchResults",()=>!this.props.loading&&this.props.posts&&!this.props.posts.length&&this.state.searchTerm),i()(this,"hasNoPosts",()=>!this.props.loading&&this.props.posts&&!this.props.posts.length),i()(this,"getItem",e=>{if(this.props.posts)return this.props.posts[e]}),i()(this,"isCompact",()=>!(!this.props.posts||this.state.searchTerm||this.hasNoPosts())&&this.props.posts.length<this.props.searchThreshold),i()(this,"isTypeLabelsVisible",()=>"boolean"==typeof this.props.showTypeLabels?this.props.showTypeLabels:"any"===this.props.queryWithVersion.type),i()(this,"isLastPage",()=>{const e=this.props,t=e.lastPage,s=e.loading,n=this.state.requestedPages;return Object(l.includes)(n,t)&&!s}),i()(this,"getPostChildren",e=>{const t=this.props.posts;return Object(l.filter)(t,t=>{let s=t.parent;return s&&s.ID===e})}),i()(this,"getItemHeight",function(t){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t?t.parent&&!s&&Object(l.includes)(e.postIds,t.parent.ID)?0:e.itemHeights[t.global_ID]?e.itemHeights[t.global_ID]:Object(l.reduce)(e.getPostChildren(t.ID),(t,s)=>t+e.getItemHeight(s,!0),M):M}),i()(this,"getRowHeight",e=>{let t=e.index;return this.getItemHeight(this.getItem(t))}),i()(this,"getCompactContainerHeight",()=>Object(l.range)(0,this.getRowCount()).reduce((e,t)=>e+this.getRowHeight({index:t}),0)),i()(this,"getPageForIndex",e=>{const t=this.props,s=t.queryWithVersion,n=t.lastPage,i=s.number||L,o=Math.ceil(e/i);return Math.max(Math.min(o,n||1/0),1)}),i()(this,"getRowCount",()=>{let e=0;return this.props.posts&&(e+=this.props.posts.length),this.isLastPage()||(e+=1),e}),i()(this,"setRequestedPages",e=>{let t=e.startIndex,s=e.stopIndex;const n=this.state.requestedPages,i=Object(l.difference)(Object(l.range)(this.getPageForIndex(t-A),this.getPageForIndex(s+A)+1),n);i.length&&this.setState({requestedPages:n.concat(i)})}),i()(this,"onSearch",e=>{const t=e.target.value;this.state.searchTerm&&!t&&this.props.onSearch(""),t!==this.state.searchTerm&&(this.hasPerformedSearch||(this.hasPerformedSearch=!0,w.default.ga.recordEvent(this.props.analyticsPrefix,"Performed Post Search")),this.setState({searchTerm:t}),this.debouncedSearch())}),i()(this,"renderItem",function(t){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.props.excludePost===t.ID||t.parent&&!s&&Object(l.includes)(e.postIds,t.parent.ID))return;const n=e.getPostChildren(t.ID);return c.a.createElement("div",{key:t.global_ID,ref:function(){for(var s=arguments.length,n=new Array(s),i=0;i<s;i++)n[i]=arguments[i];return e.setItemRef(t,...n)},className:"post-selector__list-item"},c.a.createElement("label",null,c.a.createElement("input",{name:"posts",type:e.props.multiple?"checkbox":"radio",value:t.ID,onChange:function(){for(var s=arguments.length,n=new Array(s),i=0;i<s;i++)n[i]=arguments[i];return e.props.onChange(t,...n)},checked:e.props.selected===t.ID,className:"post-selector__input"}),c.a.createElement("span",{className:"post-selector__label"},Object(O.b)(t.title||e.props.translate("Untitled")),e.isTypeLabelsVisible()&&c.a.createElement("span",{className:"post-selector__label-type",style:{paddingRight:e.isCompact()?0:E()()}},Object(O.b)(Object(l.get)(e.props.postTypes,[t.type,"labels","singular_name"],""))))),n.length>0&&c.a.createElement("div",{className:"post-selector__nested-list"},n.map(t=>e.renderItem(t,!0))))}),i()(this,"renderEmptyContent",()=>{let e;if(this.hasNoSearchResults()?e=c.a.createElement(x,{createLink:this.props.createLink,noResultsMessage:this.props.noResultsMessage}):this.hasNoPosts()&&(e=this.props.emptyMessage),e)return c.a.createElement("div",{key:"no-results",className:"post-selector__list-item is-empty"},e)}),i()(this,"renderRow",e=>{let t=e.index;const s=this.getItem(t);return s?this.renderItem(s):c.a.createElement("div",{key:"placeholder",className:"post-selector__list-item is-placeholder"},c.a.createElement("label",null,c.a.createElement("input",{type:this.props.multiple?"checkbox":"radio",disabled:!0,className:"post-selector__input"}),c.a.createElement("span",{className:"post-selector__label"},this.props.translate("Loading…"))))}),i()(this,"cellRendererWrapper",e=>{let t=e.key,s=e.style,n=m()(e,["key","style"]);return c.a.createElement("div",{key:t,style:s},this.renderRow(n))})}componentWillMount(){this.itemHeights={},this.hasPerformedSearch=!1,this.postIds=Object(l.map)(this.props.posts,"ID"),this.getPostChildren=Object(l.memoize)(this.getPostChildren),this.queueRecomputeRowHeights=Object(l.debounce)(this.recomputeRowHeights),this.debouncedSearch=Object(l.debounce)(()=>{this.props.onSearch(this.state.searchTerm)},R)}componentWillReceiveProps(e){Object(l.isEqual)(this.props.queryWithVersion,e.queryWithVersion)&&this.props.siteId===e.siteId||this.setState({requestedPages:[1]}),this.props.posts!==e.posts&&(this.getPostChildren.cache.clear(),this.postIds=Object(l.map)(e.posts,"ID"))}componentDidUpdate(e){(e.selected!==this.props.selected||e.loading&&!this.props.loading)&&this.list.forceUpdateGrid(),this.props.posts!==e.posts&&this.recomputeRowHeights()}render(){const e=this.props,t=e.className,s=e.siteId,n=e.queryWithVersion,i=e.suppressFirstPageLoad,o=e.posts,a=e.postTypes,r=this.state,d=r.requestedPages,u=r.searchTerm,m=this.isCompact(),h=this.isTypeLabelsVisible(),g=u.length>0||!m,b=f()("post-selector",t,{"is-compact":m,"is-type-labels-visible":h}),y=Object(l.filter)(d,e=>1!==e||!i||!o);return c.a.createElement("div",{className:b},y.map(e=>c.a.createElement(N.a,{key:"page-".concat(e),siteId:s,query:p()({},n,{page:e})})),h&&s&&!a&&c.a.createElement(D.a,{siteId:s}),g&&c.a.createElement(I,{searchTerm:u,onSearch:this.onSearch}),c.a.createElement("div",{className:"post-selector__results"},c.a.createElement(j.a,{key:JSON.stringify(n),disableHeight:m},e=>{let t=e.height,s=e.width;return c.a.createElement(v.a,{ref:this.setListRef,width:s,height:m?this.getCompactContainerHeight():t,onRowsRendered:this.setRequestedPages,noRowsRenderer:this.renderEmptyContent,rowCount:this.getRowCount(),estimatedRowSize:M,rowHeight:this.getRowHeight,rowRenderer:this.cellRendererWrapper})})))}}i()(U,"displayName","PostSelectorPosts"),i()(U,"propTypes",{siteId:a.a.number.isRequired,query:a.a.object,queryWithVersion:a.a.object,posts:a.a.array,lastPage:a.a.number,loading:a.a.bool,emptyMessage:a.a.string,createLink:a.a.string,selected:a.a.number,excludePost:a.a.number,onSearch:a.a.func,onChange:a.a.func,multiple:a.a.bool,showTypeLabels:a.a.bool}),i()(U,"defaultProps",{analyticsPrefix:"Post Selector",searchThreshold:8,loading:!0,emptyMessage:"",posts:[],onSearch:()=>{},onChange:()=>{}});var q=Object(g.b)((e,t)=>{const s=t.siteId,n=t.query,i=!Object(k.J)(e,s)||Object(k.H)(e,s,"5.0")?"1.2":void 0,o=p()({},n,{apiVersion:i});return{posts:Object(T.i)(e,s,o),found:Object(T.j)(e,s,o),lastPage:Object(T.k)(e,s,o),loading:Object(T.t)(e,s,o),postTypes:Object(P.b)(e,s),queryWithVersion:o}})(Object(h.localize)(U));s.d(t,"a",function(){return F});class F extends c.a.PureComponent{constructor(){super(...arguments),i()(this,"state",{search:""}),i()(this,"onSearch",e=>{e!==this.state.search&&this.setState({search:e})}),i()(this,"getQuery",()=>{const e=this.props,t=e.type,s=e.status,n=e.excludeTree,i=e.orderBy,o=e.order,a=e.excludePrivateTypes,r=this.state.search;return Object(l.reduce)({type:t,status:s,excludeTree:n,orderBy:i,order:o,excludePrivateTypes:a,search:r},(e,t,s)=>null==t?e:("orderBy"===s&&""!==r&&(t="date"),"order"===s&&""!==r&&(t="DESC"),e[Object(l.snakeCase)(s)]=t,e),{})})}render(){const e=this.props,t=e.siteId,s=e.multiple,n=e.onChange,i=e.emptyMessage,o=e.createLink,a=e.selected,r=e.excludeTree,l=e.showTypeLabels,d=e.suppressFirstPageLoad;return c.a.createElement(q,{siteId:t,query:this.getQuery(),onSearch:this.onSearch,multiple:s,onChange:n,emptyMessage:i,createLink:o,selected:a,excludePost:r,showTypeLabels:l,suppressFirstPageLoad:d})}}i()(F,"displayName","PostSelector"),i()(F,"propTypes",{type:a.a.string,excludePrivateTypes:a.a.bool,siteId:a.a.number.isRequired,status:a.a.string,multiple:a.a.bool,onChange:a.a.func,selected:a.a.number,excludeTree:a.a.number,emptyMessage:a.a.string,createLink:a.a.string,orderBy:a.a.oneOf(["title","date","modified","comment_count","ID"]),order:a.a.oneOf(["ASC","DESC"]),showTypeLabels:a.a.bool,suppressFirstPageLoad:a.a.bool}),i()(F,"defaultProps",{type:"post",status:"publish,private",multiple:!1,orderBy:"title",order:"ASC",suppressFirstPageLoad:!1})},"./client/post-editor/edit-post-status/style.scss":function(e,t,s){},"./client/post-editor/editor-action-bar/style.scss":function(e,t,s){},"./client/post-editor/editor-categories-tags/style.scss":function(e,t,s){},"./client/post-editor/editor-confirmation-sidebar/style.scss":function(e,t,s){},"./client/post-editor/editor-delete-post/style.scss":function(e,t,s){},"./client/post-editor/editor-diff-viewer/style.scss":function(e,t,s){},"./client/post-editor/editor-drawer/label.jsx":function(e,t,s){"use strict";s.d(t,"a",function(){return c});var n=s("./node_modules/prop-types/index.js"),i=s.n(n),o=s("./node_modules/react/index.js"),a=s.n(o),r=s("./client/components/info-popover/index.jsx");s("./client/post-editor/editor-drawer/label.scss");function c(e){let t=e.children,s=e.labelText,n=e.helpText;return a.a.createElement("label",{className:"editor-drawer__label"},a.a.createElement("span",{className:"editor-drawer__label-text"},s,n&&a.a.createElement(r.a,{position:"top left"},n)),t)}c.propTypes={helpText:i.a.string,labelText:i.a.string}},"./client/post-editor/editor-drawer/label.scss":function(e,t,s){},"./client/post-editor/editor-drawer/style.scss":function(e,t,s){},"./client/post-editor/editor-featured-image/dropzone.jsx":function(e,t,s){"use strict";var n=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),i=s.n(n),o=s("./node_modules/react/index.js"),a=s.n(o),r=s("./node_modules/react-redux/es/index.js"),c=s("./node_modules/lodash/lodash.js"),l=s("./packages/i18n-calypso/dist/esm/index.js"),d=s("./client/components/drop-zone/index.jsx"),p=s("./client/lib/media/actions.js"),u=s("./client/lib/media/store.js"),m=s("./client/lib/media/utils.js"),h=()=>a.a.createElement("svg",{width:"55",height:"42",viewBox:"0 0 55 42",xmlns:"http://www.w3.org/2000/svg"},a.a.createElement("title",null,"Featured Image"),a.a.createElement("g",{fillRule:"nonzero",fill:"#542B06"},a.a.createElement("path",{d:"M22 11c0-1.656 1.344-3 3-3s3 1.344 3 3-1.344 3-3 3-3-1.344-3-3zm18-7v12.33l-3.173 8.29-12.01.637L31.992 32H4c-2.21 0-4-1.79-4-4V4c0-2.21 1.79-4 4-4h32c2.21 0 4 1.79 4 4zm-4 0H4v14.888L12 10l11.79 13.1 3.174-3.7c1.596-1.864 4.48-1.864 6.074 0L36 22.852V4z"}),a.a.createElement("path",{d:"M41 16.667l3.443 9.27 9.89.406-7.762 6.136L49.24 42 41 36.52 32.76 42l2.67-9.52-7.763-6.14 9.89-.404"}))),g=s("./client/state/media/actions.js"),b=s("./client/state/posts/actions.js"),f=s("./client/state/ui/selectors.js"),y=s("./client/state/ui/editor/selectors.js"),E=s("./client/state/analytics/actions.js");t.a=Object(r.b)(e=>({siteId:Object(f.e)(e),postId:Object(y.f)(e),site:Object(f.d)(e)}),{editPost:b.e,deleteMedia:g.a,receiveMedia:g.d,recordTracksEvent:E.i})(Object(l.localize)(class extends o.Component{constructor(){super(...arguments),i()(this,"onFilesDrop",e=>{const t=Object(c.head)(Object(m.d)(e,"image"));if(!t)return!1;const s=Object(c.uniqueId)("featured-image"),n=this.props,i=n.siteId,o=n.site,a=()=>{const e=u.a.get(i,s),t=e&&Object(m.k)(e);e?this.props.receiveMedia(i,e):this.props.deleteMedia(i,s),t||(u.a.off("change",a),e&&this.props.recordTracksEvent("calypso_editor_featured_image_upload",{source:"dropzone",type:"dragdrop"})),this.props.editPost(i,this.props.postId,{featured_image:e.ID})};u.a.on("change",a),p.a.add(o,{ID:s,fileContents:t,fileName:t.name})})}render(){return a.a.createElement(d.a,{className:"editor-featured-image__dropzone",dropZoneName:"featuredImage",icon:a.a.createElement(h,null),textLabel:this.props.translate("Set as Featured Image"),onFilesDrop:this.onFilesDrop})}}))},"./client/post-editor/editor-featured-image/index.jsx":function(e,t,s){"use strict";var n=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),i=s.n(n),o=s("./node_modules/react/index.js"),a=s.n(o),r=s("./node_modules/prop-types/index.js"),c=s.n(r),l=s("./node_modules/classnames/index.js"),d=s.n(l),p=s("./client/components/gridicon/index.jsx"),u=s("./node_modules/react-redux/es/index.js"),m=s("./node_modules/lodash/lodash.js"),h=s("./client/components/data/media-library-selected-data/index.jsx"),g=s("./client/post-editor/media-modal/index.jsx"),b=s("./client/lib/media/actions.js"),f=s("./client/state/posts/stats.js"),y=s("./client/post-editor/editor-featured-image/preview-container.jsx"),E=s("./client/post-editor/editor-featured-image/dropzone.jsx"),v=s("./client/state/selectors/is-drop-zone-visible.js"),j=s("./client/components/button/index.jsx"),_=s("./client/components/remove-button/index.jsx"),x=s("./client/state/selectors/get-media-item.js"),w=s("./client/state/posts/utils.js"),S=s("./client/components/data/query-media/index.jsx"),C=s("./packages/i18n-calypso/dist/esm/index.js"),I=s("./client/state/analytics/actions.js"),O=s("./client/state/ui/selectors.js"),T=s("./client/state/ui/editor/selectors.js"),P=s("./client/state/posts/selectors.js"),k=s("./client/state/posts/actions.js");s("./client/post-editor/editor-featured-image/style.scss");class D extends o.Component{constructor(){super(...arguments),i()(this,"state",{isSelecting:!1}),i()(this,"showMediaModal",()=>{const e=this.props,t=e.siteId,s=e.featuredImage;s&&b.a.setLibrarySelectedItems(t,[s]),this.setState({isSelecting:!0})}),i()(this,"hideMediaModal",()=>{this.setState({isSelecting:!1})}),i()(this,"setImage",e=>{this.hideMediaModal(),this.props.onImageSelected(),e&&(this.props.editPost(this.props.siteId,this.props.postId,{featured_image:e.items[0].ID}),this.props.recordEditorStat("featured_image_set"),this.props.recordEditorEvent("Featured image set"),this.props.recordTracksEvent("calypso_editor_featured_image_upload",{source:"medialibrary",type:"click"}))}),i()(this,"removeImage",()=>{this.props.editPost(this.props.siteId,this.props.postId,{featured_image:""}),this.props.recordEditorStat("featured_image_removed"),this.props.recordEditorEvent("Featured image removed")}),i()(this,"onImageChange",e=>{e!==this.props.featuredImageId&&this.props.editPost(this.props.siteId,this.props.postId,{featured_image:e})})}renderMediaModal(){if(this.props.siteId)return a.a.createElement(h.a,{siteId:this.props.siteId},a.a.createElement(g.default,{visible:this.props.selecting||this.state.isSelecting,onClose:this.setImage,siteId:this.props.siteId,labels:{confirm:this.props.translate("Set Featured Image")},enabledFilters:["images"],single:!0}))}renderCurrentImage(){const e=this.props,t=e.siteId,s=e.featuredImageId;if(s)return a.a.createElement(y.a,{siteId:t,itemId:s,maxWidth:this.props.maxWidth,onImageChange:this.onImageChange})}render(){const e=this.props,t=e.siteId,s=e.featuredImageId,n=d()("editor-featured-image",{"is-assigned":!!s,"has-active-drop-zone":this.props.hasDropZone&&this.props.isDropZoneVisible});return a.a.createElement("div",{className:n},s&&a.a.createElement(S.a,{siteId:t,mediaId:s}),this.renderMediaModal(),a.a.createElement("div",{className:"editor-featured-image__inner-content"},a.a.createElement(j.a,{className:"editor-featured-image__current-image",onClick:this.showMediaModal,borderless:!0,compact:!0,"data-tip-target":"editor-featured-image-current-image"},this.renderCurrentImage(),a.a.createElement(p.a,{icon:"pencil",className:"editor-featured-image__edit-icon"})),s&&a.a.createElement(_.a,{onRemove:this.removeImage})),this.props.hasDropZone&&a.a.createElement(E.a,null))}}i()(D,"propTypes",{featuredImage:c.a.object,hasDropZone:c.a.bool,isDropZoneVisible:c.a.bool,maxWidth:c.a.number,recordTracksEvent:c.a.func,selecting:c.a.bool,translate:c.a.func,onImageSelected:c.a.func}),i()(D,"defaultProps",{hasDropZone:!1,isDropZoneVisible:!1,maxWidth:450,onImageSelected:m.noop}),t.a=Object(u.b)(e=>{const t=Object(O.e)(e),s=Object(T.f)(e),n=Object(P.a)(e,t,s),i=Object(w.g)(n);return{siteId:t,postId:s,featuredImageId:i,featuredImage:Object(x.a)(e,t,i),isDropZoneVisible:Object(v.a)(e,"featuredImage")}},{editPost:k.e,recordEditorStat:f.b,recordEditorEvent:f.a,recordTracksEvent:I.i})(Object(C.localize)(D))},"./client/post-editor/editor-featured-image/preview-container.jsx":function(e,t,s){"use strict";var n=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),i=s.n(n),o=s("./node_modules/prop-types/index.js"),a=s.n(o),r=s("./node_modules/react/index.js"),c=s.n(r),l=s("./node_modules/lodash/lodash.js"),d=s("./client/lib/media/actions.js"),p=s("./client/lib/media/store.js"),u=s("./node_modules/react-redux/es/index.js"),m=s("./node_modules/classnames/index.js"),h=s.n(m),g=s("./client/components/gridicon/index.jsx"),b=s("./client/lib/media/utils.js"),f=s("./client/components/spinner/index.jsx"),y=s("./client/components/spinner-line/index.jsx"),E=s("./client/components/image-preloader/index.jsx"),v=s("./client/state/ui/selectors.js");class j extends r.Component{constructor(){var e;super(...arguments),e=this,i()(this,"state",this.constructor.initialState),i()(this,"isReceivingPersistedImage",(e,t)=>{const s=this.props.siteId;if(s!==t.siteId)return!1;const n=this.props.image;if(!n||!n.transient||!t.image)return!1;const i=p.a.get(s,n.ID);return i&&i.ID===t.image.ID}),i()(this,"src",function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.props;if(t.image)return Object(b.s)(t.image,{maxWidth:e.props.maxWidth,size:"post-thumbnail"})}),i()(this,"clearState",()=>{Object(l.some)(this.state)&&this.setState(this.constructor.initialState)})}componentWillReceiveProps(e){const t=this.src();if(!t||t===this.src(e))return;const s={height:this.refs.preview.clientHeight};this.isReceivingPersistedImage(this.props,e)&&(s.transientSrc=t),this.setState(s)}render(){const e=this.state.height,t=h()("editor-featured-image__preview",{"is-transient":Object(l.get)(this.props.image,"transient"),"has-assigned-height":!!e});let s;return s=this.state.transientSrc?c.a.createElement("img",{src:this.state.transientSrc,className:"editor-featured-image__preview-image",alt:"placeholder"}):c.a.createElement(y.a,null),c.a.createElement("div",{ref:"preview",className:t,style:{height:e}},c.a.createElement(f.a,null),c.a.createElement(E.a,{placeholder:s,src:this.src(),onLoad:this.clearState,className:"editor-featured-image__preview-image"}),this.props.showEditIcon&&c.a.createElement(g.a,{icon:"pencil",className:"editor-featured-image__edit-icon"}))}}i()(j,"propTypes",{siteId:a.a.number,image:a.a.object,maxWidth:a.a.number,showEditIcon:a.a.bool}),i()(j,"initialState",{height:null,transientSrc:null,showEditIcon:!1});var _=Object(u.b)(e=>({siteId:Object(v.e)(e)}))(j);s.d(t,"a",function(){return x});class x extends c.a.Component{constructor(){super(...arguments),i()(this,"state",{image:null}),i()(this,"fetchImage",()=>{this.updateImageState(()=>{this.state.image||Object(l.defer)(()=>{d.a.fetch(this.props.siteId,this.props.itemId)})})}),i()(this,"updateImageState",e=>{const t=p.a.get(this.props.siteId,this.props.itemId);this.setState({image:t},()=>{"function"==typeof e&&e()}),Object(l.defer)(()=>{this.props.onImageChange&&t&&t.ID&&this.props.onImageChange(t.ID)})})}componentDidMount(){this.fetchImage(),p.a.on("change",this.updateImageState)}componentDidUpdate(e){const t=this.props,s=t.siteId,n=t.itemId;s===e.siteId&&n===e.itemId||this.fetchImage()}componentWillUnmount(){p.a.off("change",this.updateImageState)}render(){return c.a.createElement(_,{image:this.state.image,maxWidth:this.props.maxWidth,showEditIcon:!0})}}i()(x,"displayName","EditorFeaturedImagePreviewContainer"),i()(x,"propTypes",{siteId:a.a.number.isRequired,itemId:a.a.oneOfType([a.a.number,a.a.string]).isRequired,maxWidth:a.a.number,onImageChange:a.a.func,showEditIcon:a.a.bool})},"./client/post-editor/editor-featured-image/style.scss":function(e,t,s){},"./client/post-editor/editor-forbidden/style.scss":function(e,t,s){},"./client/post-editor/editor-ground-control/style.scss":function(e,t,s){},"./client/post-editor/editor-gutenberg-blocks-warning-dialog/style.scss":function(e,t,s){},"./client/post-editor/editor-gutenberg-opt-in-dialog/style.scss":function(e,t,s){},"./client/post-editor/editor-gutenberg-opt-in-notice/style.scss":function(e,t,s){},"./client/post-editor/editor-gutenberg-opt-in-sidebar/style.scss":function(e,t,s){},"./client/post-editor/editor-html-toolbar/style.scss":function(e,t,s){},"./client/post-editor/editor-media-modal/index.jsx":function(e,t,s){"use strict";var n=s("./node_modules/@babel/runtime/helpers/extends.js"),i=s.n(n),o=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),a=s.n(o),r=s("./node_modules/prop-types/index.js"),c=s.n(r),l=s("./node_modules/react/index.js"),d=s.n(l),p=s("./node_modules/react-redux/es/index.js"),u=s("./node_modules/lodash/lodash.js"),m=s("./client/components/data/media-library-selected-data/index.jsx"),h=s("./client/post-editor/media-modal/index.jsx"),g=s("./client/lib/media/utils.js"),b=s("./client/post-editor/media-modal/markup.js"),f=s("./client/state/analytics/actions.js"),y=s("./client/state/ui/selectors.js"),E=s("./client/state/ui/editor/save-blockers/actions.js");class v extends l.Component{constructor(){super(...arguments),a()(this,"onClose",e=>{if(e)return this.props.isGutenberg?this.props.onClose(e):this.insertMedia(e);this.props.onClose()})}insertMedia(e){let t=e.type,s=e.items,n=e.settings;const i=this.props.site;let o,a;const r=Object(u.partial)(b.a.get,i);switch(t){case"gallery":o="individual"===Object(u.get)(n,"type")?Object(u.map)(n.items,r).join(""):Object(g.e)(n),a="insert_gallery";break;case"media":default:o=Object(u.map)(s,r).join(""),a="insert_item"}Object(u.some)(s,"transient")&&this.props.blockSave("MEDIA_MODAL_TRANSIENT_INSERT"),o&&(this.props.onInsertMedia(o),a&&this.props.bumpStat("editor_media_actions",a)),this.props.onClose()}render(){const e=this.props.site;return d.a.createElement(m.a,{siteId:Object(u.get)(e,"ID")},d.a.createElement(h.default,i()({},this.props,{onClose:this.onClose})))}}a()(v,"propTypes",{site:c.a.object,onInsertMedia:c.a.func,onClose:c.a.func,isGutenberg:c.a.bool}),a()(v,"defaultProps",{onInsertMedia:()=>{},onClose:()=>{}}),t.a=Object(p.b)(e=>({site:Object(y.d)(e)}),{blockSave:E.a,bumpStat:f.a})(v)},"./client/post-editor/editor-more-options/copy-post.scss":function(e,t,s){},"./client/post-editor/editor-more-options/slug.scss":function(e,t,s){},"./client/post-editor/editor-notice/style.scss":function(e,t,s){},"./client/post-editor/editor-page-order/style.scss":function(e,t,s){},"./client/post-editor/editor-page-parent/style.scss":function(e,t,s){},"./client/post-editor/editor-page-templates/style.scss":function(e,t,s){},"./client/post-editor/editor-permalink/style.scss":function(e,t,s){},"./client/post-editor/editor-post-type-unsupported/style.scss":function(e,t,s){},"./client/post-editor/editor-post-type/style.scss":function(e,t,s){},"./client/post-editor/editor-preview/style.scss":function(e,t,s){},"./client/post-editor/editor-publish-date/style.scss":function(e,t,s){},"./client/post-editor/editor-revisions-list/style.scss":function(e,t,s){},"./client/post-editor/editor-revisions/dialog.jsx":function(e,t,s){"use strict";var n=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),i=s.n(n),o=s("./node_modules/react/index.js"),a=s.n(o),r=s("./node_modules/react-redux/es/index.js"),c=s("./node_modules/prop-types/index.js"),l=s.n(c),d=s("./packages/i18n-calypso/dist/esm/index.js"),p=s("./node_modules/lodash/lodash.js"),u=s("./client/state/ui/selectors.js"),m=s("./client/state/ui/editor/selectors.js"),h=s("./client/lib/create-selector/index.js");var g=Object(h.a)((e,t,s,n)=>Object(p.get)(e.posts.revisions.diffs,[t,s,"revisions",n],null),e=>[e.posts.revisions.diffs]);var b=e=>Object(p.get)(e,"posts.revisions.selection.revisionId");function f(e){const t=Object(u.e)(e),s=Object(m.f)(e),n=b(e);return g(e,t,s,n)}function y(e){return Object(p.get)(e,"posts.revisions.ui.isDialogVisible",!1)}var E=s("./client/state/analytics/actions.js"),v=s("./client/state/posts/revisions/actions.js");var j=Object(h.a)((e,t,s)=>Object(p.orderBy)(Object(p.values)(Object(p.get)(e.posts.revisions.diffs,[t,s,"revisions"],{})),"post_modified_gmt","desc"),e=>[e.posts.revisions.diffs]);var _=Object(h.a)((e,t,s)=>Object(p.uniq)(Object(p.map)(Object(p.get)(e.posts.revisions.diffs,[t,s,"revisions"],{}),e=>parseInt(e.post_author,10))),e=>[e.posts.revisions.diffs]);function x(e,t,s,n,i){const o="".concat(n||0,":").concat(i||0);return Object(p.get)(e.posts.revisions.diffs,[t,s,o,"diff"],{})}var w=Object(h.a)((e,t,s)=>{const n=j(e,t,s),i={};for(let o=0;o<n.length;o++){const a=Object(p.get)(n,[o,"id"],0),r=a&&Object(p.get)(n,[o-1,"id"]),c=a&&Object(p.get)(n,[o+1,"id"]);i[a]={diff:x(e,t,s,c,a),nextRevisionId:r,prevRevisionId:c}}return i},e=>[e.posts.revisions.diffs]),S=s("./node_modules/classnames/index.js"),C=s.n(S),I=s("./client/components/gridicon/index.jsx");var O=e=>Object(p.get)(e,"posts.revisions.ui.diffView","unified"),T=s("./client/components/text-diff/index.jsx"),P=s("./client/lib/scroll-to/index.js"),k=s("./client/lib/viewport/index.js");s("./client/post-editor/editor-diff-viewer/style.scss");const D=e=>Object(p.get)(e,"offsetTop",0)+Object(p.get)(e,"offsetHeight",0)/2;class N extends o.PureComponent{constructor(){var e;super(...arguments),e=this,i()(this,"state",{changeOffsets:[],scrollTop:0,viewportHeight:0}),i()(this,"isBigViewport",!1),i()(this,"lastScolledRevisionId",null),i()(this,"tryScrollingToFirstChangeOrTop",()=>{this.props.selectedRevisionId&&this.props.selectedRevisionId!==this.lastScolledRevisionId&&(this.lastScolledRevisionId=this.props.selectedRevisionId,this.recomputeChanges(()=>{this.centerScrollingOnOffset(this.state.changeOffsets[0]||0,!1)}))}),i()(this,"recomputeChanges",e=>{let t=".text-diff__additions, .text-diff__deletions";this.isBigViewport&&"split"===this.props.diffView&&(t=".editor-diff-viewer__secondary-pane .text-diff__additions, .editor-diff-viewer__main-pane .text-diff__deletions");const s=this.node.querySelectorAll(t);this.setState({changeOffsets:Object(p.map)(s,D),viewportHeight:Object(p.get)(this.node,"offsetHeight",0),scrollTop:Object(p.get)(this.node,"scrollTop",0)},e)}),i()(this,"debouncedRecomputeChanges",Object(p.debounce)(()=>{this.isBigViewport=Object(k.f)(">1040px"),this.recomputeChanges(null)},500)),i()(this,"centerScrollingOnOffset",function(t){let s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=Math.max(0,t-e.state.viewportHeight/2);s?Object(P.a)({container:e.node,x:0,y:n}):e.node.scrollTop=n}),i()(this,"handleScroll",e=>{this.setState({scrollTop:Object(p.get)(e.target,"scrollTop",0)})}),i()(this,"throttledScrollHandler",Object(p.throttle)(this.handleScroll,100)),i()(this,"handleScrollableRef",e=>{e?(this.node=e,this.node.addEventListener("scroll",this.throttledScrollHandler)):(this.node.removeEventListener("scroll",this.throttledScrollHandler),this.node=null)}),i()(this,"scrollAbove",()=>{this.centerScrollingOnOffset(Object(p.last)(this.changesAboveViewport)),this.props.recordTracksEvent("calypso_editor_post_revisions_scroll_hint_used",{direction:"above"})}),i()(this,"scrollBelow",()=>{this.centerScrollingOnOffset(Object(p.first)(this.changesBelowViewport)),this.props.recordTracksEvent("calypso_editor_post_revisions_scroll_hint_used",{direction:"below"})})}componentDidMount(){this.tryScrollingToFirstChangeOrTop(),"undefined"!=typeof window&&(window.addEventListener("resize",this.debouncedRecomputeChanges),this.isBigViewport=Object(k.f)(">1040px"))}componentWillUnmount(){"undefined"!=typeof window&&window.removeEventListener("resize",this.debouncedRecomputeChanges)}componentDidUpdate(){this.tryScrollingToFirstChangeOrTop()}componentWillReceiveProps(e){e.selectedRevisionId!==this.props.selectedRevisionId&&this.setState({changeOffsets:[]}),e.diffView!==this.props.diffView&&this.recomputeChanges(null)}render(){const e=this.props,t=e.diff,s=e.diffView,n=C()("editor-diff-viewer",{"is-loading":!Object(p.has)(t,"post_content")&&!Object(p.has)(t,"post_title"),"is-split":"split"===s}),i=this.state.scrollTop+this.state.viewportHeight;this.changesAboveViewport=Object(p.filter)(this.state.changeOffsets,e=>e<this.state.scrollTop),this.changesBelowViewport=Object(p.filter)(this.state.changeOffsets,e=>e>i);const o=this.state.viewportHeight>470,r=this.changesAboveViewport.length,c=this.changesBelowViewport.length;return a.a.createElement("div",{className:n},a.a.createElement("div",{className:"editor-diff-viewer__scrollable",ref:this.handleScrollableRef},a.a.createElement("div",{className:"editor-diff-viewer__main-pane"},a.a.createElement("h1",{className:"editor-diff-viewer__title"},a.a.createElement(T.a,{operations:t.post_title})),a.a.createElement("pre",{className:"editor-diff-viewer__content"},a.a.createElement(T.a,{operations:t.post_content,splitLines:!0}))),"split"===s&&a.a.createElement("div",{className:"editor-diff-viewer__secondary-pane"},a.a.createElement("h1",{className:"editor-diff-viewer__title"},a.a.createElement(T.a,{operations:t.post_title})),a.a.createElement("pre",{className:"editor-diff-viewer__content"},a.a.createElement(T.a,{operations:t.post_content,splitLines:!0})))),o&&r>0&&a.a.createElement("div",{className:"editor-diff-viewer__hint-above",onClick:this.scrollAbove},a.a.createElement(I.a,{className:"editor-diff-viewer__hint-icon",size:18,icon:"arrow-up"}),this.props.translate("%(numberOfChanges)d change","%(numberOfChanges)d changes",{args:{numberOfChanges:r},count:r})),o&&c>0&&a.a.createElement("div",{className:"editor-diff-viewer__hint-below",onClick:this.scrollBelow},a.a.createElement(I.a,{className:"editor-diff-viewer__hint-icon",size:18,icon:"arrow-down"}),this.props.translate("%(numberOfChanges)d change","%(numberOfChanges)d changes",{args:{numberOfChanges:c},count:c})))}}i()(N,"propTypes",{postId:l.a.number.isRequired,selectedRevisionId:l.a.number,siteId:l.a.number.isRequired,diff:l.a.shape({post_content:l.a.array,post_title:l.a.array,totals:l.a.object}).isRequired,diffView:l.a.string,recordTracksEvent:l.a.func.isRequired,translate:l.a.func.isRequired});var R=Object(p.flow)(d.localize,Object(r.b)((e,t)=>{let s=t.siteId,n=t.postId,i=t.selectedRevisionId;return{revision:g(e,s,n,i,"display"),diffView:O(e)}},{recordTracksEvent:E.i}))(N),M=s("./node_modules/react-dom/index.js"),L=s.n(M);const A=e=>{let t=e.numRevisions,s=e.translate;return a.a.createElement("div",{className:"editor-revisions-list__header"},a.a.createElement("span",{className:"editor-revisions-list__count"},!!t&&s("%(revisions)d revision","%(revisions)d revisions",{count:t,args:{revisions:t}})))};A.propTypes={numRevisions:l.a.number.isRequired,translate:l.a.func.isRequired};var U=Object(d.localize)(A),q=s("./client/components/segmented-control/index.jsx"),F=s("./client/components/segmented-control/item.jsx");const B=e=>{let t=e.translate,s=e.diffView,n=e.viewSplit,i=e.viewUnified;return a.a.createElement(q.a,{compact:!0,className:"editor-revisions-list__view-buttons"},a.a.createElement(F.a,{className:"editor-revisions-list__unified-button",onClick:i,selected:"unified"===s},t("Unified")),a.a.createElement(F.a,{className:"editor-revisions-list__split-button",onClick:n,selected:"split"===s},t("Split")))};B.propTypes={viewSplit:l.a.func.isRequired,viewUnified:l.a.func.isRequired,translate:l.a.func.isRequired};const z={viewUnified:v.g,viewSplit:v.f};var V=Object(r.b)(e=>({diffView:O(e)}),z)(Object(d.localize)(B)),H=s("./client/components/button/index.jsx"),W=s("./client/components/button-group/index.jsx");const G=e=>{let t=e.nextIsDisabled,s=e.prevIsDisabled,n=e.selectNextRevision,i=e.selectPreviousRevision;return a.a.createElement(W.a,{className:"editor-revisions-list__navigation"},a.a.createElement(H.a,{compact:!0,className:"editor-revisions-list__prev-button",type:"button",onClick:i,disabled:s},a.a.createElement(I.a,{icon:"chevron-down"})),a.a.createElement(H.a,{compact:!0,className:"editor-revisions-list__next-button",type:"button",onClick:n,disabled:t},a.a.createElement(I.a,{icon:"chevron-up"})))};G.propTypes={selectNextRevision:l.a.func.isRequired,selectPreviousRevision:l.a.func.isRequired,nextIsDisabled:l.a.bool,prevIsDisabled:l.a.bool};var Y=G;function K(e,t){return e.posts.revisions.authors.items[t]}var $=s("./client/state/sites/selectors.js"),Q=s("./client/components/time-since/index.jsx");class J extends o.PureComponent{constructor(){super(...arguments),i()(this,"selectRevision",()=>{this.props.selectPostRevision(this.props.revision.id)})}render(){const e=this.props,t=e.authorName,s=e.revision,n=e.revisionChanges,i=e.isMultiUserSite,o=e.translate,r=Object(p.get)(n,"add",0),c=Object(p.get)(n,"del",0),l={added:r&&o("%(changes)d word added","%(changes)d words added",{args:{changes:r},count:r}),removed:c&&o("%(changes)d word removed","%(changes)d words removed",{args:{changes:c},count:c})};return a.a.createElement("button",{className:"editor-revisions-list__button",onClick:this.selectRevision,type:"button"},a.a.createElement("span",{className:"editor-revisions-list__date"},a.a.createElement(Q.a,{date:Object(p.get)(s,"post_modified_gmt"),dateFormat:"lll"})),t&&i&&a.a.createElement("span",{className:"editor-revisions-list__author"},t),a.a.createElement("div",{className:"editor-revisions-list__changes"},r>0&&a.a.createElement("span",{className:"editor-revisions-list__additions","aria-label":l.added,title:l.added},a.a.createElement("b",null,"+"),r),c>0&&a.a.createElement("span",{className:"editor-revisions-list__deletions","aria-label":l.removed,title:l.removed},a.a.createElement("b",null,"-"),c),0===r&&0===c&&a.a.createElement("span",{className:"editor-revisions-list__minor-changes"},o("minor",{context:"post revisions: minor changes"}))))}}J.propTypes={postId:l.a.number,revision:l.a.object.isRequired,revisionChanges:l.a.object.isRequired,siteId:l.a.number.isRequired,authorName:l.a.string,isMultiUserSite:l.a.bool.isRequired,selectPostRevision:l.a.func.isRequired,translate:l.a.func.isRequired};var Z=Object(p.flow)(d.localize,Object(r.b)((e,t)=>{let s=t.revision,n=t.siteId;return{authorName:Object(p.get)(K(e,Object(p.get)(s,"post_author")),"display_name",""),isMultiUserSite:!Object($.Q)(e,n)}},{selectPostRevision:v.e}))(J),X=s("./client/lib/keyboard-shortcuts/index.js");s("./client/post-editor/editor-revisions-list/style.scss");class ee extends o.PureComponent{constructor(){super(...arguments),i()(this,"selectRevision",e=>{this.props.selectPostRevision(e)}),i()(this,"trySelectingLatestRevision",()=>{const e=this.props.latestRevisionId;e&&this.selectRevision(e)}),i()(this,"selectNextRevision",()=>{const e=this.props.nextRevisionId;e&&this.selectRevision(e)}),i()(this,"selectPreviousRevision",()=>{const e=this.props.prevRevisionId;e&&this.selectRevision(e)})}componentDidMount(){window.scrollTo(0,0),X.a.on("move-selection-up",this.selectNextRevision),X.a.on("move-selection-down",this.selectPreviousRevision),this.props.selectedRevisionId||this.trySelectingLatestRevision()}componentWillUnmount(){X.a.off("move-selection-up",this.selectNextRevision),X.a.off("move-selection-down",this.selectPreviousRevision)}componentDidUpdate(e){this.props.selectedRevisionId||this.trySelectingLatestRevision(),this.props.selectedRevisionId!==e.selectedRevisionId&&this.scrollToSelectedItem()}scrollToSelectedItem(){const e=L.a.findDOMNode(this),t=e.querySelector(".editor-revisions-list__scroller"),s=e.querySelector(".editor-revisions-list__revision.is-selected"),n=e.querySelector(".editor-revisions-list__list");if(!(t&&s&&n))return;const i=s.getBoundingClientRect(),o=i.top,a=i.right,r=i.bottom,c=i.left,l=n.getBoundingClientRect(),d=l.top,p=l.left,u=l.width,m=l.height,h=t.getBoundingClientRect(),g=h.top,b=h.bottom,f=h.height,y=h.left,E=h.right,v=h.width;if(u>m){const e=c<y,s=a>E,n=c-p,i=Math.abs(v-(a-p));(e||s)&&(t.scrollLeft=e?n:i)}else{const e=o<g,s=r>b,n=o-d,i=Math.abs(f-(r-d));(e||s)&&(t.scrollTop=e?n:i)}}render(){const e=this.props,t=e.comparisons,s=e.nextIsDisabled,n=e.prevIsDisabled,i=e.postId,o=e.revisions,r=e.selectedRevisionId,c=e.siteId,l=C()("editor-revisions-list",{"is-loading":Object(p.isEmpty)(o)});return a.a.createElement("div",{className:l},a.a.createElement(U,{numRevisions:o.length}),a.a.createElement(V,null),a.a.createElement(Y,{nextIsDisabled:s,prevIsDisabled:n,selectNextRevision:this.selectNextRevision,selectPreviousRevision:this.selectPreviousRevision}),a.a.createElement("div",{className:"editor-revisions-list__scroller"},a.a.createElement("ul",{className:"editor-revisions-list__list"},Object(p.map)(o,e=>{const s=C()("editor-revisions-list__revision",{"is-selected":e.id===r}),n=Object(p.get)(t,[e.id,"diff","totals"],{});return a.a.createElement("li",{className:s,key:e.id},a.a.createElement(Z,{postId:i,revision:e,revisionChanges:n,siteId:c}))}))))}}i()(ee,"propTypes",{comparisons:l.a.object,postId:l.a.number,siteId:l.a.number,revisions:l.a.array.isRequired,selectedRevisionId:l.a.number,nextIsDisabled:l.a.bool,prevIsDisabled:l.a.bool});var te=Object(r.b)((e,t)=>{let s=t.comparisons,n=t.revisions,i=t.selectedRevisionId;const o=Object(p.get)(s,[i],{}),a=o.nextRevisionId,r=o.prevRevisionId,c=Object(p.get)(Object(p.head)(n),"id"),l=c===i,d=!l&&Object(p.get)(Object(p.last)(n),"id")===i,u=l||1===n.length;return{latestRevisionId:c,prevIsDisabled:d||1===n.length,nextIsDisabled:u,nextRevisionId:a,prevRevisionId:r}},{selectPostRevision:v.e})(ee),se=s("./client/state/posts/selectors.js");class ne extends o.Component{componentDidMount(){this.request()}componentDidUpdate(e){this.props.siteId===e.siteId&&this.props.postId===e.postId||this.request()}request(){const e=this.props,t=e.comparisons,s=e.postId,n=e.postType,i=e.siteId;this.props.requestPostRevisions(i,s,n,t)}render(){return null}}ne.propTypes={comparisons:l.a.array,postId:l.a.number,siteId:l.a.number,postType:l.a.string,requestPostRevisions:l.a.func};var ie=Object(r.b)((e,t)=>{let s=t.postId,n=t.siteId;return{postType:Object(se.c)(e,n,s,"type")}},{requestPostRevisions:v.d})(ne),oe=s("./node_modules/react-pure-render/shallowEqual.js"),ae=s.n(oe),re=s("./node_modules/@babel/runtime/helpers/objectSpread.js"),ce=s.n(re),le=s("./client/state/data-layer/wpcom-http/utils.js"),de=s("./client/state/data-layer/wpcom-http/actions.js"),pe=s("./client/state/data-layer/handler-registry.js");const ue=e=>Object(p.omitBy)({ID:e.id,display_name:e.name,username:e.slug},p.isUndefined),me=e=>{const t=e.siteId,s=e.ids,n=e.page,i=void 0===n?1:n,o=e.perPage,a=void 0===o?10:o;return Object(de.a)({path:"/sites/".concat(t,"/users"),method:"GET",apiNamespace:"wp/v2",query:{include:s,page:i,per_page:a}},e)},he=Object(le.a)({fetch:me,onSuccess:(e,t)=>s=>{s(function(e){return{type:"POST_REVISION_AUTHORS_RECEIVE",users:e}}(Object(p.map)(t,ue)));const n=e.page,i=void 0===n?1:n,o=e.perPage,a=void 0===o?10:o;Object(p.get)(Object(le.b)(e),"X-WP-TotalPages",0)>i&&s(me(ce()({},Object(p.omit)(e,"meta"),{page:i+1,perPage:a})))},onError:p.noop});Object(pe.b)("state/data-layer/wpcom/sites/users/index.js",{POST_REVISIONS_AUTHORS_REQUEST:[he]});class ge extends o.Component{componentDidMount(){this.request()}componentDidUpdate(e){ae()(this.props.userIds,e.userIds)&&this.props.siteId===e.siteId||this.request()}request(){const e=this.props,t=e.siteId,s=e.userIds;s.length&&this.props.requestPostRevisionAuthors(t,s)}render(){return null}}i()(ge,"propTypes",{requestPostRevisionAuthors:l.a.func,siteId:l.a.number,userIds:l.a.arrayOf(l.a.number)});var be=Object(r.b)(null,{requestPostRevisionAuthors:(e,t)=>({type:"POST_REVISIONS_AUTHORS_REQUEST",ids:t,siteId:e})})(ge);s("./client/post-editor/editor-revisions/style.scss");class fe extends o.Component{componentDidMount(){this.props.recordTracksEvent("calypso_editor_post_revisions_open")}render(){const e=this.props,t=e.authorsIds,s=e.comparisons,n=e.postId,i=e.revisions,o=e.selectedDiff,r=e.selectedRevisionId,c=e.siteId;return a.a.createElement("div",{className:"editor-revisions"},a.a.createElement(ie,{postId:n,siteId:c,selectedRevisionId:r}),a.a.createElement(be,{siteId:c,userIds:t}),a.a.createElement(R,{diff:o,postId:n,selectedRevisionId:r,siteId:c}),a.a.createElement(te,{comparisons:s,postId:n,revisions:i,selectedRevisionId:r,siteId:c}))}}fe.propTypes={authorsIds:l.a.array.isRequired,comparisons:l.a.object,postId:l.a.number.isRequired,revisions:l.a.array.isRequired,selectedDiff:l.a.object,selectedRevisionId:l.a.number,siteId:l.a.number.isRequired,recordTracksEvent:l.a.func.isRequired,translate:l.a.func.isRequired};var ye=Object(p.flow)(d.localize,Object(r.b)(e=>{const t=Object(m.f)(e),s=Object(u.e)(e),n=j(e,s,t),i=b(e),o=w(e,s,t),a=Object(p.get)(o,[i,"diff"],{});return{authorsIds:_(e,s,t),comparisons:o,postId:t,revisions:n,selectedDiff:a,selectedRevisionId:i,siteId:s}},{recordTracksEvent:E.i}))(fe),Ee=s("./client/components/dialog/index.jsx"),ve=s("./client/components/close-on-escape/index.jsx");class je extends o.PureComponent{constructor(){super(...arguments),i()(this,"onLoadClick",()=>{const e=this.props,t=e.loadRevision,s=e.revision,n=e.closeDialog;t(s),n(),this.props.recordTracksEvent("calypso_editor_post_revisions_load_revision")}),i()(this,"dialogButtons",()=>{const e=this.props,t=e.postId,s=e.revision,n=e.siteId,i=e.translate;return[{action:"cancel",compact:!0,label:i("Cancel")},{action:"load",compact:!0,disabled:!(s&&t&&n),isPrimary:!0,label:i("Load",{context:"Load revision in editor"}),onClick:this.onLoadClick}]})}componentWillMount(){this.toggleBodyClass({isVisible:this.props.isVisible}),this.props.selectPostRevision(null)}componentWillUpdate(e){let t=e.isVisible;this.toggleBodyClass({isVisible:t})}toggleBodyClass(e){let t=e.isVisible;if("object"!=typeof document||!Object(p.get)(document,"body.classList"))return;t?document.body.classList.add("showing-post-revisions-dialog"):document.body.classList.remove("showing-post-revisions-dialog")}render(){const e=this.props,t=e.isVisible,s=e.closeDialog;return a.a.createElement(Ee.a,{buttons:this.dialogButtons(),className:"editor-revisions__dialog",isVisible:t,onClose:s},a.a.createElement(ve.a,{onEscape:s}),a.a.createElement(ye,null))}}i()(je,"propTypes",{loadRevision:l.a.func.isRequired,isVisible:l.a.bool.isRequired,closeDialog:l.a.func.isRequired,recordTracksEvent:l.a.func.isRequired,translate:l.a.func.isRequired});t.a=Object(p.flow)(d.localize,Object(r.b)(e=>({isVisible:y(e),postId:Object(m.f)(e),revision:f(e),siteId:Object(u.e)(e)}),{recordTracksEvent:E.i,closeDialog:v.a,selectPostRevision:v.e}))(je)},"./client/post-editor/editor-revisions/style.scss":function(e,t,s){},"./client/post-editor/editor-sidebar/style.scss":function(e,t,s){},"./client/post-editor/editor-slug/style.scss":function(e,t,s){},"./client/post-editor/editor-status-label/style.scss":function(e,t,s){},"./client/post-editor/editor-sticky/style.scss":function(e,t,s){},"./client/post-editor/editor-term-selector/add-term.scss":function(e,t,s){},"./client/post-editor/editor-theme-help/index.jsx":function(e,t,s){"use strict";var n=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),i=s.n(n),o=s("./node_modules/prop-types/index.js"),a=s.n(o),r=s("./node_modules/react/index.js"),c=s.n(r),l=s("./node_modules/react-redux/es/index.js"),d=s("./packages/i18n-calypso/dist/esm/index.js"),p=s("./client/state/ui/selectors.js"),u=s("./client/state/sites/selectors.js"),m=s("./client/state/posts/stats.js");class h extends r.PureComponent{constructor(){super(...arguments),i()(this,"recordClick",()=>this.props.recordEditorStat("clicked_theme_help_link"))}render(){const e=this.props,t=e.translate,s=e.themeHelpPath,n=e.className;return s?c.a.createElement("a",{className:n,href:s,onClick:this.recordClick},t("Need help setting up your site?")):null}}i()(h,"propTypes",{themeHelpPath:a.a.string,classname:a.a.string}),t.a=Object(l.b)(e=>{const t=Object(p.e)(e);return{themeHelpPath:Object(u.w)(e,t)}},{recordEditorStat:m.b})(Object(d.localize)(h))},"./client/post-editor/editor-title/style.scss":function(e,t,s){},"./client/post-editor/editor-visibility/style.scss":function(e,t,s){},"./client/post-editor/editor-word-count/style.scss":function(e,t,s){},"./client/post-editor/index.js":function(e,t,s){"use strict";s.r(t);var n={};s.r(n),s.d(n,"match",function(){return mt}),s.d(n,"serialize",function(){return ht}),s.d(n,"edit",function(){return gt}),s.d(n,"getComponent",function(){return bt});var i={};s.r(i),s.d(i,"match",function(){return vt}),s.d(i,"serialize",function(){return jt}),s.d(i,"getComponent",function(){return _t});var o=s("./node_modules/page/page.js"),a=s.n(o),r=s("./client/my-sites/controller.js"),c=s("./node_modules/@babel/runtime/helpers/slicedToArray.js"),l=s.n(c),d=s("./node_modules/react-dom/server.browser.js"),p=s.n(d),u=s("./node_modules/react/index.js"),m=s.n(u),h=s("./packages/i18n-calypso/dist/esm/index.js"),g=s.n(h),b=s("./node_modules/qs/lib/index.js"),f=s("./node_modules/valid-url/index.js"),y=s("./node_modules/lodash/lodash.js"),E=s("./client/lib/perfmon/index.js"),v=s("./client/state/posts/actions.js"),j=s("./client/lib/route/index.js"),_=s("./node_modules/@babel/runtime/helpers/extends.js"),x=s.n(_),w=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),S=s.n(w),C=s("./node_modules/react-dom/index.js"),I=s.n(C),O=s("./node_modules/prop-types/index.js"),T=s.n(O),P=s("./node_modules/react-redux/es/index.js"),k=s("./node_modules/classnames/index.js"),D=s.n(k),N=s("./node_modules/tinymce/tinymce.js"),R=s.n(N),M=s("./node_modules/uuid/index.js"),L=s("./client/components/async-load/index.jsx"),A=s("./client/components/gridicon/index.jsx"),U=s("./client/components/tooltip/index.jsx"),q=s("./client/components/button/index.jsx"),F=s("./client/state/posts/stats.js"),B=s("./client/state/ui/selectors.js"),z=s("./client/state/ui/editor/selectors.js"),V=s("./client/state/posts/selectors.js");s("./client/post-editor/editor-sticky/style.scss");class H extends m.a.Component{constructor(){super(...arguments),S()(this,"state",{tooltip:!1}),S()(this,"toggleStickyStatus",()=>{let e,t;this.props.sticky?(e="advanced_sticky_disabled_toolbar",t="Off"):(e="advanced_sticky_enabled_toolbar",t="On"),this.props.recordEditorStat(e),this.props.recordEditorEvent("Changed Sticky Setting",t),this.props.editPost(this.props.siteId,this.props.postId,{sticky:!this.props.sticky}),this.setState({tooltip:!1})}),S()(this,"enableTooltip",()=>{this.setState({tooltip:!0})}),S()(this,"disableTooltip",()=>{this.setState({tooltip:!1})}),S()(this,"stickyPostButtonRef",m.a.createRef())}render(){const e=this.props,t=e.sticky,s=e.translate,n=D()("editor-sticky",{"is-sticky":t}),i=t?m.a.createElement("span",null,s("Marked as sticky")):m.a.createElement("div",null,s("Mark as sticky"),m.a.createElement("span",{className:"editor-sticky__explanation"},s("Stick post to the front page")));return m.a.createElement(q.a,{borderless:!0,className:n,onClick:this.toggleStickyStatus,onMouseEnter:this.enableTooltip,onMouseLeave:this.disableTooltip,"aria-label":s("Stick post to the front page"),ref:this.stickyPostButtonRef},m.a.createElement(A.a,{icon:"bookmark"}),m.a.createElement(U.a,{className:"editor-sticky__tooltip",context:this.stickyPostButtonRef.current,isVisible:this.state.tooltip,position:"bottom left"},i))}}S()(H,"displayName","EditorSticky"),S()(H,"propTypes",{postId:T.a.number,siteId:T.a.number,sticky:T.a.bool});var W=Object(P.b)(e=>{const t=Object(z.f)(e),s=Object(B.e)(e);return{postId:t,siteId:s,sticky:Object(V.c)(e,s,t,"sticky")}},{editPost:v.e,recordEditorStat:F.b,recordEditorEvent:F.a})(Object(h.localize)(H)),G=s("./client/state/posts/utils.js"),Y=s("./client/lib/formatting/index.js"),K=s("./client/components/data/query-post-types/index.jsx"),$=s("./client/state/post-types/selectors.js");var Q=Object(P.b)(e=>{const t=Object(B.e)(e),s=Object(z.f)(e),n=Object(V.l)(e,t,s);return{siteId:t,currentPost:n,currentPostTypeObject:n&&Object($.a)(e,t,n.type)}})(Object(h.localize)(class extends m.a.Component{constructor(){super(...arguments),S()(this,"state",{viewLinkTooltip:!1}),S()(this,"showViewLinkTooltip",()=>{this.setState({viewLinkTooltip:!0})}),S()(this,"hideViewLinkTooltip",()=>{this.setState({viewLinkTooltip:!1})}),S()(this,"viewLinkTooltipContext",m.a.createRef())}getTooltipLabel(){const e=this.props,t=e.translate,s=e.currentPost,n=e.currentPostTypeObject;return"page"===s.type?t("View page"):"post"===s.type?t("View post"):n?Object(Y.b)(n.labels.view_item):t("View",{context:"verb"})}render(){const e=this.props,t=e.siteId,s=e.currentPost;if(!s||!Object(G.y)(s))return null;const n=s&&!Object(y.includes)(["page","post"],s.type);return m.a.createElement(q.a,{href:s.URL,target:"_blank",rel:"noopener noreferrer",ref:this.viewLinkTooltipContext,onMouseEnter:this.showViewLinkTooltip,onMouseLeave:this.hideViewLinkTooltip,borderless:!0},m.a.createElement(A.a,{icon:"external"}),m.a.createElement(U.a,{className:"editor-action-bar__view-post-tooltip",context:this.viewLinkTooltipContext.current,isVisible:this.state.viewLinkTooltip,position:"bottom left"},m.a.createElement("span",{className:"editor-action-bar__view-label"},t&&n&&m.a.createElement(K.a,{siteId:t}),this.getTooltipLabel())))}}));function J(e){let t=e.translate,s=e.siteId,n=e.typeSlug,i=e.type,o=e.className;const a=D()("editor-status-label__placeholder",o);let r;return r="post"===n?t("Loading Post…"):"page"===n?t("Loading Page…"):i?t("Loading %(postType)s…",{args:{postType:Object(Y.b)(i.labels.singular_name)}}):t("Loading…"),m.a.createElement("button",{className:a},"post"!==n&&"page"!==n&&s&&m.a.createElement(K.a,{siteId:s}),m.a.createElement("strong",null,r))}J.propTypes={translate:T.a.func,siteId:T.a.number,typeSlug:T.a.string,type:T.a.object,className:T.a.string};var Z=Object(P.b)(e=>{const t=Object(B.e)(e),s={siteId:t},n=Object(V.a)(e,t,Object(z.f)(e));return n?Object.assign(s,{typeSlug:n.type,type:Object($.a)(e,t,n.type)}):s})(Object(h.localize)(J));s("./client/post-editor/editor-status-label/style.scss");class X extends m.a.Component{constructor(){super(...arguments),S()(this,"state",{currentTime:Date.now()}),S()(this,"updateCurrentTime",()=>{this.setState({currentTime:Date.now()})})}componentDidMount(){this.currentTimeTimer=setInterval(this.updateCurrentTime,6e4)}componentWillReceiveProps(e){e.post!==this.props.post&&this.updateCurrentTime()}componentWillUnmount(){clearInterval(this.currentTimeTimer)}render(){if(!this.props.post&&!this.props.isNew)return m.a.createElement(Z,{className:"editor-status-label"});const e=D()("editor-status-label","is-plain","is-"+Object(y.get)(this.props.post,"status","draft"));return m.a.createElement("span",{className:e},this.renderLabel())}renderLabel(){const e=this.props,t=e.isNew,s=e.post,n=e.translate,i=e.moment;if(t)return n("New Draft");let o=i(G.f(s));"draft"===s.status&&o.isAfter(this.state.currentTime)&&(o=i(this.state.currentTime));const a=o.from(this.state.currentTime);switch(s.status){case"publish":return n("{{strong}}Published{{/strong}} %(relativeTimeFromNow)s",{args:{relativeTimeFromNow:a},components:{strong:m.a.createElement("strong",null)}});case"private":return n("{{strong}}Published Privately{{/strong}} %(relativeTimeFromNow)s",{args:{relativeTimeFromNow:a},components:{strong:m.a.createElement("strong",null)}});case"draft":return n("{{strong}}Saved{{/strong}} %(relativeTimeFromNow)s",{args:{relativeTimeFromNow:a},components:{strong:m.a.createElement("strong",null)}});case"pending":return n("{{strong}}Pending Review{{/strong}} %(relativeTimeFromNow)s",{args:{relativeTimeFromNow:a},components:{strong:m.a.createElement("strong",null)}});case"future":return n("{{strong}}Scheduled{{/strong}} %(relativeTimeFromNow)s",{args:{relativeTimeFromNow:a},components:{strong:m.a.createElement("strong",null)}});case"trash":return n("{{strong}}Trashed{{/strong}}",{components:{strong:m.a.createElement("strong",null)}})}return""}}S()(X,"propTypes",{post:T.a.object});var ee=Object(P.b)(e=>{const t=Object(B.e)(e),s=Object(z.f)(e),n=Object(V.l)(e,t,s);return{isNew:Object(z.m)(e),post:n}})(Object(h.localize)(X)),te=s("./client/components/podcast-indicator/index.jsx"),se=s("./client/components/data/query-site-settings/index.js"),ne=s("./client/state/selectors/get-podcasting-category-id.js"),ie=s("./client/state/sites/selectors.js"),oe=(s("./client/post-editor/editor-action-bar/style.scss"),function(e){s.e(354).then(s.bind(null,"./client/post-editor/editor-author/index.jsx")).then(function(t){e(t.default)})});class ae extends u.Component{render(){const e=this.props,t=e.isPostPrivateOrPasswordProtected,s=e.isPodcastEpisode,n=e.multiUserSite,i=e.siteId,o="post"===e.type&&!t;return m.a.createElement("div",{className:"editor-action-bar"},i&&m.a.createElement(se.a,{siteId:i}),m.a.createElement("div",{className:"editor-action-bar__cell is-left"},m.a.createElement(ee,null)),m.a.createElement("div",{className:"editor-action-bar__cell is-center"},n&&m.a.createElement(L.a,{require:oe})),m.a.createElement("div",{className:"editor-action-bar__cell is-right"},o&&m.a.createElement(W,null),s&&m.a.createElement(te.a,{className:"editor-action-bar__podcasting-indicator",size:24,tooltipType:"episode"}),m.a.createElement(Q,null)))}}S()(ae,"propTypes",{siteId:T.a.number,multiUserSite:T.a.bool,post:T.a.object,type:T.a.string,isPostPrivateOrPasswordProtected:T.a.bool});var re=Object(P.b)(e=>{const t=Object(B.e)(e),s=!1===Object(ie.Q)(e,t),n=Object(z.f)(e),i=Object(V.a)(e,t,n),o=Object(V.c)(e,t,n,"type"),a=G.x(i)||"password"===G.o(i),r=Object(ne.a)(e,t);let c=!1;if(r){const s=Object(V.c)(e,t,n,"terms"),i=s&&s.category;Object(y.some)(i,{ID:r})&&(c=!0)}return{siteId:t,multiUserSite:s,postId:n,post:i,type:o,isPostPrivateOrPasswordProtected:a,isPodcastEpisode:c}})(ae),ce=s("./client/post-editor/editor-featured-image/index.jsx"),le=s("./client/components/track-input-changes/index.jsx"),de=s("./client/components/forms/form-text-input/index.jsx");s("./client/post-editor/editor-slug/style.scss");class pe extends u.Component{constructor(){super(...arguments),this.state={isSlugFocused:!1},this.onSlugKeyDown=this.onSlugKeyDown.bind(this),this.onSlugChange=this.onSlugChange.bind(this),this.onBlur=this.onBlur.bind(this),this.onFocus=this.onFocus.bind(this),this.focusSlug=this.focusSlug.bind(this),this.recordChangeStats=this.recordChangeStats.bind(this),this.statTracked=!1}onSlugChange(e){const t=this.props,s=t.siteId,n=t.postId;this.props.editPost(s,n,{slug:e.target.value})}onSlugKeyDown(e){if("Enter"===e.key||"Escape"===e.key){const e=this.props,t=e.onEscEnter,s=e.isEditable;this.setState({isSlugFocused:!1},function(){t(),s&&I.a.findDOMNode(this.refs.slugField).blur()})}}onBlur(){this.state.isSlugFocused&&this.setState({isSlugFocused:!1})}onFocus(){this.setState({isSlugFocused:!0})}focusSlug(){this.props.isEditable&&I.a.findDOMNode(this.refs.slugField).focus()}recordChangeStats(){switch(this.props.instanceName){case"post-sidebar":this.props.recordEditorStat("slug-edited-post-sidebar"),this.props.recordEditorEvent("Slug Edited (Post Sidebar)");break;case"post-popover":this.props.recordEditorStat("slug-edited-post-popover"),this.props.recordEditorEvent("Slug Edited (Post Permalink Popover)");break;case"page-sidebar":this.props.recordEditorStat("slug-edited-page-sidebar"),this.props.recordEditorEvent("Slug Edited (Page Sidebar)");break;case"page-permalink":this.props.recordEditorStat("slug-edited-page-permalink"),this.props.recordEditorEvent("Slug Edited (Page Permalink)")}}render(){const e=this.props,t=e.className,s=e.translate,n=e.slug,i=e.children,o=e.path,a=e.isEditable,r=D()("editor-slug",t,{"is-focused":this.state.isSlugFocused});return m.a.createElement("div",{className:r,onClick:this.focusSlug},i,m.a.createElement("span",{className:"editor-slug__url-path",onClick:this.focusSlug},o),a&&m.a.createElement(le.a,{onNewValue:this.recordChangeStats},m.a.createElement(de.a,{ref:"slugField",value:n,onChange:this.onSlugChange,onKeyDown:this.onSlugKeyDown,onBlur:this.onBlur,onFocus:this.onFocus,"aria-label":s("Enter slug")})))}}S()(pe,"propTypes",{path:T.a.string,slug:T.a.string,onEscEnter:T.a.func,className:T.a.string,isEditable:T.a.bool,instanceName:T.a.string,translate:T.a.func,siteId:T.a.number,postId:T.a.number}),S()(pe,"defaultProps",{onEscEnter:()=>{},isEditable:!0,slug:""});var ue=Object(P.b)(e=>{const t=Object(B.e)(e),s=Object(z.f)(e);return{siteId:t,postId:s,slug:Object(V.b)(e,t,s)}},{editPost:v.e,recordEditorStat:F.b,recordEditorEvent:F.a})(Object(h.localize)(pe)),me=s("./client/components/popover/index.jsx"),he=s("./client/components/forms/clipboard-button/index.jsx");s("./client/post-editor/editor-permalink/style.scss");class ge extends u.Component{constructor(){super(...arguments),S()(this,"permalinkToggleReference",m.a.createRef()),this.showPopover=this.showPopover.bind(this),this.showTooltip=this.showTooltip.bind(this),this.onCopy=this.onCopy.bind(this),this.hideTooltip=this.hideTooltip.bind(this),this.closePopover=this.closePopover.bind(this),this.state={showPopover:!1,showCopyConfirmation:!1,tooltip:!1}}componentWillUnmount(){clearTimeout(this.dismissCopyConfirmation)}showPopover(){this.setState({showPopover:!this.state.showPopover,tooltip:!1})}showTooltip(){this.state.showPopover||this.setState({tooltip:!0})}onCopy(){this.setState({showCopyConfirmation:!0}),clearTimeout(this.dismissCopyConfirmation),this.dismissCopyConfirmation=setTimeout(()=>{this.setState({showCopyConfirmation:!1})},4e3)}hideTooltip(){this.setState({tooltip:!1})}closePopover(){this.setState({showPopover:!1})}renderCopyButton(){const e=this.props,t=e.path,s=e.slug,n=e.translate;let i;return i=this.state.showCopyConfirmation?n("Copied!"):n("Copy",{context:"verb"}),m.a.createElement(he.a,{text:t+s,onCopy:this.onCopy,compact:!0},i)}render(){const e=this.props.translate;let t;return t=this.props.isEditable?e("Edit post URL"):e("View post URL"),m.a.createElement("div",{className:"editor-permalink",onMouseEnter:this.showTooltip,onMouseLeave:this.hideTooltip},m.a.createElement(A.a,{className:"editor-permalink__toggle",icon:"link",onClick:this.showPopover,ref:this.permalinkToggleReference}),m.a.createElement(me.a,{isVisible:this.state.showPopover,onClose:this.closePopover,position:"bottom right",context:this.permalinkToggleReference.current,className:"editor-permalink__popover"},m.a.createElement(ue,x()({},Object(y.pick)(this.props,"path","isEditable"),{onEscEnter:this.closePopover,instanceName:"post-popover"})),this.renderCopyButton()),m.a.createElement(U.a,{context:this.permalinkToggleReference.current,isVisible:this.state.tooltip,position:"bottom"},t))}}S()(ge,"propTypes",{path:T.a.string,isEditable:T.a.bool,translate:T.a.func,slug:T.a.string});var be=Object(P.b)(e=>{const t=Object(B.e)(e),s=Object(z.f)(e);return{slug:Object(V.b)(e,t,s)}})(Object(h.localize)(ge)),fe=s("./client/components/textarea-autosize/index.jsx"),ye=s("./client/lib/viewport/index.js");function Ee(e,t){const s=Object(ie.r)(e,t,"permalink_structure");return!!s&&/\/%postname%\/?/.test(s)}s("./client/post-editor/editor-title/style.scss");const ve=/[\r\n]+/g;class je extends u.Component{constructor(){super(...arguments),S()(this,"onChange",e=>{const t=this.props,s=t.siteId,n=t.editedPostId,i=e.target.value.replace(ve," ");this.props.editPost(s,n,{title:i}),this.props.onChange(i)}),S()(this,"resizeAfterNewlineInput",e=>{const t=e.target.value;ve.test(t)&&(e.target.value=t.replace(ve," "),this.refs.titleInput.resize())}),S()(this,"recordChangeStats",()=>{const e=G.v(this.props.post);this.props.recordEditorStat(e?"page_title_changed":"post_title_changed"),this.props.recordEditorEvent(e?"Changed Page Title":"Changed Post Title")})}componentDidUpdate(e){if(Object(ye.e)())return;const t=this.props,s=t.isNew,n=t.siteId;if(s&&!e.isNew||s&&e.siteId!==n){I.a.findDOMNode(this.refs.titleInput).focus()}}render(){const e=this.props,t=e.post,s=e.isPermalinkEditable,n=e.isNew,i=e.tabIndex,o=e.translate,a=D()("editor-title",{"is-loading":!t});return m.a.createElement("div",{className:a},t&&t.ID&&!G.v(t)&&m.a.createElement(be,{path:s?G.j(t):t.URL,isEditable:s}),m.a.createElement(le.a,{onNewValue:this.recordChangeStats},m.a.createElement(fe.a,{tabIndex:i,className:"editor-title__input",placeholder:o("Title"),onChange:this.onChange,onInput:this.resizeAfterNewlineInput,onBlur:this.onBlur,autoFocus:n&&!Object(ye.e)(),value:t&&t.title?t.title:"","aria-label":o("Edit title"),ref:"titleInput",rows:"1"})))}}S()(je,"propTypes",{editPost:T.a.func,isNew:T.a.bool,onChange:T.a.func,post:T.a.object,site:T.a.object,siteId:T.a.number,tabIndex:T.a.number,translate:T.a.func}),S()(je,"defaultProps",{isNew:!0,onChange:()=>{}});var _e=Object(P.b)(e=>{const t=Object(B.e)(e),s=Ee(e,t),n=Object(z.f)(e),i=Object(V.a)(e,t,n);return{editedPostId:n,isPermalinkEditable:s,isNew:Object(z.m)(e),post:i,siteId:t}},{editPost:v.e,recordEditorStat:F.b,recordEditorEvent:F.a})(Object(h.localize)(je));class xe extends u.PureComponent{render(){return this.props.isDisplayed?m.a.createElement(ue,{path:this.props.path,instanceName:"page-permalink"},m.a.createElement(A.a,{icon:"link"})):null}}S()(xe,"propTypes",{isDisplayed:T.a.bool,path:T.a.string});var we=Object(P.b)(e=>{const t=Object(B.e)(e),s=Object(z.f)(e),n=Object(ie.k)(e,t),i=Object(V.a)(e,t,s);return{isDisplayed:t&&G.v(i),path:function(e,t){const s=e?e.URL+"/":null;return t&&t.URL&&t.URL!==s?G.i(t):s}(n,i)}})(xe),Se=s("./node_modules/@babel/runtime/helpers/objectSpread.js"),Ce=s.n(Se),Ie=s("./node_modules/autosize/dist/autosize.js"),Oe=s.n(Ie);s("./node_modules/tinymce/themes/modern/theme.js"),s("./node_modules/tinymce/plugins/colorpicker/plugin.js"),s("./node_modules/tinymce/plugins/directionality/plugin.js"),s("./node_modules/tinymce/plugins/hr/plugin.js"),s("./node_modules/tinymce/plugins/lists/plugin.js"),s("./node_modules/tinymce/plugins/media/plugin.js"),s("./node_modules/tinymce/plugins/paste/plugin.js"),s("./node_modules/tinymce/plugins/tabfocus/plugin.js"),s("./node_modules/tinymce/plugins/textcolor/plugin.js");
/**
 * Adapted from the WordPress wp TinyMCE plugin.
 *
 * @copyright 2015 by the WordPress contributors.
 * @license See CREDITS.md.
 */
function Te(e){var t,s=R.a.DOM,n=R.a.each;e.on("focus",function(){window.wpActiveEditor=e.id}),e.on("BeforeSetContent",function(e){var t;e.content&&(-1!==e.content.indexOf("\x3c!--more")&&(t=Object(h.translate)("Read more…"),e.content=e.content.replace(/<!--more(.*?)-->/g,function(e,s){return'<img src="'+R.a.Env.transparentSrc+'" data-wp-more="more" data-wp-more-text="'+s+'" class="wp-more-tag mce-wp-more" title="'+t+'" data-mce-resize="false" data-mce-placeholder="1" />'})),-1!==e.content.indexOf("\x3c!--nextpage--\x3e")&&(t=Object(h.translate)("Page break"),e.content=e.content.replace(/<!--nextpage-->/g,'<img src="'+R.a.Env.transparentSrc+'" data-wp-more="nextpage" class="wp-more-tag mce-wp-nextpage" title="'+t+'" data-mce-resize="false" data-mce-placeholder="1" />')),e.load&&"raw"!==e.format&&(e.content=Object(Y.g)(e.content)))}),e.on("PostProcess",function(e){e.get&&(e.content=e.content.replace(/<img[^>]+>/g,function(e){var t,s="";return-1!==e.indexOf('data-wp-more="more"')?((t=e.match(/data-wp-more-text="([^"]+)"/))&&(s=t[1]),e="\x3c!--more"+s+"--\x3e"):-1!==e.indexOf('data-wp-more="nextpage"')&&(e="\x3c!--nextpage--\x3e"),e}))}),e.on("ResolveName",function(t){var s;"IMG"===t.target.nodeName&&(s=e.dom.getAttrib(t.target,"data-wp-more"))&&(t.name=s)}),e.addCommand("WP_More",function(t){var s,n,i,o="wp-more-tag",a=e.dom,r=e.selection.getNode();o+=" mce-wp-"+(t=t||"more"),i="more"===t?Object(h.translate)("Read more…"):Object(h.translate)("Next page"),n='<img src="'+R.a.Env.transparentSrc+'" title="'+i+'" class="'+o+'" data-wp-more="'+t+'" data-mce-resize="false" data-mce-placeholder="1" />',"BODY"===r.nodeName||"P"===r.nodeName&&"BODY"===r.parentNode.nodeName?e.insertContent(n):(s=a.getParent(r,function(e){return!(!e.parentNode||"BODY"!==e.parentNode.nodeName)},e.getBody()))&&("P"===s.nodeName?s.appendChild(a.create("p",null,n).firstChild):a.insertAfter(a.create("p",null,n),s),e.nodeChanged())}),e.addCommand("WP_Code",function(){e.formatter.toggle("code")}),e.addCommand("WP_Page",function(){e.execCommand("WP_More","nextpage")}),e.addButton("wp_more",{tooltip:Object(h.translate)("Insert Read More tag"),onclick:function(){e.execCommand("WP_More","more")}}),e.addButton("wp_page",{tooltip:Object(h.translate)("Page break"),onclick:function(){e.execCommand("WP_More","nextpage")}}),e.addButton("wp_help",{tooltip:Object(h.translate)("Keyboard Shortcuts"),cmd:"WP_Help"}),e.addButton("wp_charmap",{icon:"charmap",tooltip:Object(h.translate)("Special Characters"),cmd:"Wpcom_CharMap"}),e.addButton("wp_code",{tooltip:Object(h.translate)("Code"),cmd:"WP_Code",stateSelector:"code"}),e.addMenuItem("wp_more",{text:Object(h.translate)("Insert Read More tag"),icon:"wp_more",context:"insert",onclick:function(){e.execCommand("WP_More","more")}}),e.addMenuItem("wp_page",{text:Object(h.translate)("Page break"),icon:"wp_page",context:"insert",onclick:function(){e.execCommand("WP_More","nextpage")}}),e.on("BeforeExecCommand",function(s){!R.a.Env.webkit||"InsertUnorderedList"!==s.command&&"InsertOrderedList"!==s.command||(t||(t=e.dom.create("style",{type:"text/css"},"#tinymce,#tinymce span,#tinymce li,#tinymce li>span,#tinymce p,#tinymce p>span{font:medium sans-serif;color:#000;line-height:normal;}")),e.getDoc().head.appendChild(t))}),e.on("ExecCommand",function(s){R.a.Env.webkit&&t&&("InsertUnorderedList"===s.command||"InsertOrderedList"===s.command)&&e.dom.remove(t)}),e.on("init",function(){var t=R.a.Env,s=["mceContentBody"],i=e.getDoc(),o=e.dom;R.a.Env.iOS&&o.addClass(i.documentElement,"ios"),"rtl"===e.getParam("directionality")&&(s.push("rtl"),o.setAttrib(i.documentElement,"dir","rtl")),t.ie?9===parseInt(t.ie,10)?s.push("ie9"):8===parseInt(t.ie,10)?s.push("ie8"):t.ie<8&&s.push("ie7"):t.webkit&&s.push("webkit"),s.push("wp-editor"),s.push("color-scheme"),e.getParam("color_scheme")&&s.push("is-"+e.getParam("color_scheme")),n(s,function(e){e&&o.addClass(i.body,e)}),e.on("BeforeSetContent",function(e){e.content&&(e.content=e.content.replace(/<p>\s*<(p|div|ul|ol|dl|table|blockquote|h[1-6]|fieldset|pre)( [^>]*)?>/gi,"<$1$2>").replace(/<\/(p|div|ul|ol|dl|table|blockquote|h[1-6]|fieldset|pre)>\s*<\/p>/gi,"</$1>"))}),e.getParam("wp_paste_filters",!0)&&(e.on("PastePreProcess",function(e){e.content=e.content.replace(/<br class="?Apple-interchange-newline"?>/gi,""),R.a.Env.webkit||(e.content=e.content.replace(/(<[^>]+) style="[^"]*"([^>]*>)/gi,"$1$2"),e.content=e.content.replace(/(<[^>]+) data-mce-style=([^>]+>)/gi,"$1 style=$2"))}),e.on("PastePostProcess",function(e){n(o.select("p",e.node),function(e){o.isEmpty(e)&&o.remove(e)})}))}),e.on("SaveContent",function(t){e.inline||!e.isHidden()?(t.content=t.content.replace(/<p>(?:<br ?\/?>|\u00a0|\uFEFF| )*<\/p>/g,"<p>&nbsp;</p>"),t.content=Object(Y.e)(t.content)):t.content=t.element.value}),e.on("BeforeSetContent",function(e){e.content&&(e.content=e.content.replace(/<p>([^<>]+)<\/p>/gi,function(e,t){return"&nbsp;"!==t&&/\S/.test(t)?e:"<p><br /></p>"}))}),e.on("preInit",function(){e.schema.addValidElements("@[id|accesskey|class|dir|lang|style|tabindex|title|contenteditable|draggable|dropzone|hidden|spellcheck|translate],i,b"),R.a.Env.iOS&&(e.settings.height=300),n({c:"JustifyCenter",r:"JustifyRight",l:"JustifyLeft",j:"JustifyFull",q:"mceBlockQuote",u:"InsertUnorderedList",o:"InsertOrderedList",s:"unlink",m:"WP_Medialib",t:"WP_More",d:"Strikethrough",h:"WP_Help",p:"WP_Page",x:"WP_Code"},function(t,s){e.shortcuts.add("access+"+s,"",t)})}),e.on("preinit",function(){var t,i,o,a,r,c,l=R.a.ui.Factory,d=e.settings,p=e.getContainer(),u=document.getElementById("wpadminbar"),m=document.getElementById(e.id+"_ifr"),h="rtl"===e.getParam("directionality")&&/Chrome/.test(navigator.userAgent);function g(e){t&&(t.hide(),"hide"===e.type||"blur"===e.type?t=!1:"resizewindow"!==e.type&&"scrollwindow"!==e.type||(clearTimeout(o),o=setTimeout(function(){t&&"function"==typeof t.show&&t.show()},250)))}p&&(a=R.a.$(".mce-toolbar-grp",p)[0],r=R.a.$(".mce-statusbar",p)[0]),"content"===e.id&&(c=document.getElementById("post-status-info")),e.shortcuts.add("alt+119","",function(){var e;t&&(e=t.find("toolbar")[0])&&e.focus(!0)}),e.on("nodechange",function(s){var n=e.selection.isCollapsed(),o={element:s.element,parents:s.parents,collapsed:n};e.fire("wptoolbar",o),i=o.selection||o.element,t&&t.hide(),o.toolbar?(t=o.toolbar).show():t=!1}),e.on("focus",function(){t&&t.show()}),s.bind(window,"resize scroll",g),e.on("remove",function(){s.unbind(window,"resize scroll",g)}),e.on("blur hide",g),e.wp=e.wp||{},e.wp._createToolbar=function(t,o){var p,g,b=[];return n(t,function(t){var s;function n(){var n=e.selection;"bullist"===s&&n.selectorChanged("ul > li",function(e,s){for(var n,i=s.parents.length;i--&&"OL"!==(n=s.parents[i].nodeName)&&"UL"!==n;);t.active(e&&"UL"===n)}),"numlist"===s&&n.selectorChanged("ol > li",function(e,s){for(var n,i=s.parents.length;i--&&"OL"!==(n=s.parents[i].nodeName)&&"UL"!==n;);t.active(e&&"OL"===n)}),t.settings.stateSelector&&n.selectorChanged(t.settings.stateSelector,function(e){t.active(e)},!0),t.settings.disabledStateSelector&&n.selectorChanged(t.settings.disabledStateSelector,function(e){t.disabled(e)})}"|"===t?g=null:l.has(t)?(t={type:t},d.toolbar_items_size&&(t.size=d.toolbar_items_size),b.push(t),g=null):(g||(g={type:"buttongroup",items:[]},b.push(g)),e.buttons[t]&&(s=t,"function"==typeof(t=e.buttons[s])&&(t=t()),t.type=t.type||"button",d.toolbar_items_size&&(t.size=d.toolbar_items_size),t=l.create(t),g.items.push(t),e.initialized?n():e.on("init",n)))}),(p=l.create({type:"panel",layout:"stack",classes:"toolbar-grp inline-toolbar-grp",ariaRoot:!0,ariaRemember:!0,items:[{type:"toolbar",layout:"flow",items:b}]})).bottom=o,p.on("show",function(){this.reposition(),h&&e.$(".mce-widget.mce-tooltip",document.body).addClass("wp-hide-mce-tooltip")}),p.on("keydown",function(t){27===t.keyCode&&(this.hide(),e.focus())}),e.on("remove",function(){p.remove()}),p.reposition=function(){if(!i)return this;var e,t,n=window.pageXOffset||document.documentElement.scrollLeft,o=window.pageYOffset||document.documentElement.scrollTop,l=window.innerWidth,d=window.innerHeight,p=m?m.getBoundingClientRect():{top:0,right:l,bottom:d,left:0,width:l,height:d},h=this.getEl(),g=h.offsetWidth,b=h.offsetHeight,f=i.getBoundingClientRect(),y=(f.left+f.right)/2,E=b+8+5,v=u?u.getBoundingClientRect().bottom:0,j=a?a.getBoundingClientRect().bottom:0,_=r?d-r.getBoundingClientRect().top:0,x=c?d-c.getBoundingClientRect().top:0,w=Math.max(0,v,j,p.top),S=Math.max(0,_,x,d-p.bottom),C=f.top+p.top-w,I=d-p.top-f.bottom-S,O=d-w-S,T="";return C>=O||I>=O?this.hide():(this.bottom?I>=E?(T=" mce-arrow-up",e=f.bottom+p.top+o):C>=E&&(T=" mce-arrow-down",e=f.top+p.top+o-b-8):C>=E?(T=" mce-arrow-down",e=f.top+p.top+o-b-8):I>=E&&O/2>f.bottom+p.top-w&&(T=" mce-arrow-up",e=f.bottom+p.top+o),void 0===e&&(e=o+w+5),t=y-g/2+p.left+n,f.left<0||f.right>p.width?t=p.left+n+(p.width-g)/2:g>=l?(T+=" mce-arrow-full",t=0):t<0&&f.left+g>l||t+g>l&&f.right-g<0?t=(l-g)/2:t<p.left+n?(T+=" mce-arrow-left",t=f.left+p.left+n):t+g>p.width+p.left+n&&(T+=" mce-arrow-right",t=f.right-g+p.left+n),h.className=h.className.replace(/ ?mce-arrow-[\w]+/g,"")+T,s.setStyles(h,{left:t,top:e}),this)},p.hide().renderTo(document.body),p}},!0)}
/**
 * WordPress TinyMCE Auto Resize plugin
 *
 * Adapted from WordPress.
 *
 *
 * @format
 * @copyright 2015 by the WordPress contributors.
 * @license See CREDITS.md.
 */
function Pe(e){let t=e.settings,s=0;function n(i){let o,a,r,c,l,d,p,u,m,h,g,b,f=R.a.DOM;(a=e.getDoc())&&(r=a.body,c=a.documentElement,l=t.autoresize_min_height,!r||i&&"setcontent"===i.type&&i.initial||e.plugins.fullscreen&&e.plugins.fullscreen.isFullscreen()?r&&c&&(r.style.overflowY="auto",c.style.overflowY="auto"):(p=e.dom.getStyle(r,"margin-top",!0),u=e.dom.getStyle(r,"margin-bottom",!0),m=e.dom.getStyle(r,"padding-top",!0),g=e.dom.getStyle(r,"border-top-width",!0),b=e.dom.getStyle(r,"border-bottom-width",!0),h=e.getParam("autoresize_bottom_margin",50),(d=r.offsetHeight+parseInt(p,10)+parseInt(u,10)+parseInt(m,10)+parseInt(h,10)+parseInt(g,10)+parseInt(b,10))&&d<c.offsetHeight&&(d=c.offsetHeight),(isNaN(d)||d<=0)&&(d=R.a.Env.ie?r.scrollHeight:R.a.Env.webkit&&0===r.clientHeight?0:r.offsetHeight),d>t.autoresize_min_height&&(l=d),t.autoresize_max_height&&d>t.autoresize_max_height?(l=t.autoresize_max_height,r.style.overflowY="auto",c.style.overflowY="auto"):(r.style.overflowY="hidden",c.style.overflowY="hidden",r.scrollTop=0),l!==s&&(o=l-s,f.setStyle(e.iframeElement,"height",l+"px"),s=l,R.a.isWebKit&&o<0&&n(i),(i&&"keyup"===i.type||i&&"nodechange"===i.type&&i.element&&"BR"===i.element.tagName)&&function(){let t,s,n,i,o;if(0===(t=e.selection.getRng()).startOffset&&0!==t.endOffset||!t.collapsed)return!1;s=t.startContainer,n=e.getBody(),i=s;do{if(o=i,(i=i.parentNode).childNodes[i.childNodes.length-1]!==o)return!1}while(i!==n);return!0}()&&window.scrollTo(0,document.body.scrollHeight))))}function i(e,t,s){setTimeout(function(){n({}),e--?i(e,t,s):s&&s()},t)}e.settings.inline||R.a.Env.iOS||(t.autoresize_min_height=parseInt(e.getParam("autoresize_min_height",e.getElement().offsetHeight),10),t.autoresize_max_height=parseInt(e.getParam("autoresize_max_height",0),10),e.on("init",function(){let t,s;t=e.getParam("autoresize_overflow_padding",1),s=e.getParam("autoresize_bottom_margin",50),!1!==t&&e.dom.setStyles(e.getBody(),{paddingLeft:t,paddingRight:t}),!1!==s&&e.dom.setStyles(e.getBody(),{paddingBottom:s})}),e.on("nodechange setcontent keyup FullscreenStateChanged",n),e.getParam("autoresize_on_init",!0)&&e.on("init",function(){e.dom.addClass(e.getBody(),"wp-autoresize"),i(20,100,function(){i(5,1e3)})}),e.addCommand("wpcomAutoResize",n))}var ke=s("./client/components/dialog/index.jsx"),De=s("./client/components/forms/form-button/index.jsx");class Ne extends m.a.Component{constructor(){super(...arguments),S()(this,"defaultShortcuts",()=>{const e=this.props.translate;return[[{shortcut:"c",action:e("Copy")},{shortcut:"x",action:e("Cut")}],[{shortcut:"v",action:e("Paste")},{shortcut:"a",action:e("Select all")}],[{shortcut:"z",action:e("Undo")},{shortcut:"y",action:e("Redo")}],[{shortcut:"b",action:e("Bold")},{shortcut:"i",action:e("Italic")}],[{shortcut:"u",action:e("Underline")},{shortcut:"k",action:e("Insert/edit link")}]]}),S()(this,"additionalShortcuts",()=>{const e=this.props.translate;return[[{shortcut:1,action:e("Heading 1")},{shortcut:2,action:e("Heading 2")}],[{shortcut:3,action:e("Heading 3")},{shortcut:4,action:e("Heading 4")}],[{shortcut:5,action:e("Heading 5")},{shortcut:6,action:e("Heading 6")}],[{shortcut:"l",action:e("Align left")},{shortcut:"c",action:e("Align center")}],[{shortcut:"r",action:e("Align right")},{shortcut:"j",action:e("Justify")}],[{shortcut:"d",action:e("Strikethrough")},{shortcut:"q",action:e("Blockquote")}],[{shortcut:"u",action:e("Bulleted list")},{shortcut:"o",action:e("Numbered list")}],[{shortcut:"a",action:e("Insert/edit link")},{shortcut:"s",action:e("Remove link")}],[{shortcut:"m",action:e("Insert/edit image")},{shortcut:"t",action:e("Insert Read More tag")}],[{shortcut:"h",action:e("Keyboard Shortcuts")},{shortcut:"x",action:e("Code")}],[{shortcut:"p",action:e("Insert Page Break tag")}]]}),S()(this,"spaceFormatShortcuts",()=>{const e=this.props.translate;return[[{shortcut:"*",action:e("Bulleted list")},{shortcut:"1.",action:e("Numbered list")}],[{shortcut:"-",action:e("Bulleted list")},{shortcut:"1)",action:e("Numbered list")}]]}),S()(this,"enterFormatShortcuts",()=>{const e=this.props.translate;return[[{shortcut:">",action:e("Blockquote")},{shortcut:"##",action:e("Heading 2")}],[{shortcut:"###",action:e("Heading 3")},{shortcut:"####",action:e("Heading 4")}],[{shortcut:"#####",action:e("Heading 5")},{shortcut:"######",action:e("Heading 6")}],[{shortcut:"---",action:e("Horizontal line")}]]}),S()(this,"renderRow",(e,t)=>{const s=[];return Object(y.forEach)(e,e=>{s.push(m.a.createElement("th",{className:"wpcom-help__key",key:e.shortcut},m.a.createElement("kbd",null,e.shortcut))),s.push(m.a.createElement("td",{className:"wpcom-help__action",key:e.action},e.action))}),m.a.createElement("tr",{key:t},s)}),S()(this,"getButtons",()=>[m.a.createElement(De.a,{key:"close",isPrimary:!1,onClick:this.props.onClose},this.props.translate("Close"))]),S()(this,"getKeyLabel",()=>this.props.translate("Key",{context:"Computer key used in keyboard shortcut"})),S()(this,"getActionLabel",()=>this.props.translate("Action",{context:"Action taken when pressing keyboard shortcut"})),S()(this,"getTableHead",()=>m.a.createElement("thead",null,m.a.createElement("tr",null,m.a.createElement("th",{className:"wpcom-help__key"},this.getKeyLabel()),m.a.createElement("th",{className:"wpcom-help__action"},this.getActionLabel()),m.a.createElement("th",{className:"wpcom-help__key"},this.getKeyLabel()),m.a.createElement("th",{className:"wpcom-help__action"},this.getActionLabel()))))}render(){const e=this.props.translate,t=this.props.macosx?e("Default shortcuts. Command + key:",{context:"Mac shortcuts"}):e("Default shortcuts. Ctrl + key:",{context:"Windows shortcuts"}),s=this.props.macosx?e("Additional shortcuts. Control + Option + key:",{context:"Mac shortcuts"}):e("Additional shortcuts. Shift + Alt + key:",{context:"Windows shortcuts"}),n=this.getTableHead();return m.a.createElement(ke.a,{isVisible:this.props.showDialog,buttons:this.getButtons(),additionalClassNames:"wpcom-help__dialog",onClose:this.props.onClose},m.a.createElement("h2",{className:"wpcom-help__heading"},e("Keyboard Shortcuts")),m.a.createElement("p",null,t),m.a.createElement("table",{className:"wpcom-help__table"},n,m.a.createElement("tbody",null,this.defaultShortcuts().map(this.renderRow,this))),m.a.createElement("p",null,s),m.a.createElement("table",{className:"wpcom-help__table"},n,m.a.createElement("tbody",null,this.additionalShortcuts().map(this.renderRow,this))),m.a.createElement("p",null,e("Formatting shortcuts. Start a new paragraph with the shortcut and press Space to apply the formatting.")),m.a.createElement("table",{className:"wpcom-help__table"},m.a.createElement("tbody",null,this.spaceFormatShortcuts().map(this.renderRow,this))),m.a.createElement("p",null,e("Formatting shortcuts. These shortcuts are turned into formatting when you press Enter.")),m.a.createElement("table",{className:"wpcom-help__table"},m.a.createElement("tbody",null,this.enterFormatShortcuts().map(this.renderRow,this))))}}S()(Ne,"propTypes",{onClose:T.a.func,macosx:T.a.bool,showDialog:T.a.bool});var Re=Object(h.localize)(Ne);function Me(e){let t;e.on("init",function(){t=e.getContainer().appendChild(document.createElement("div"))}),e.on("remove",function(){I.a.unmountComponentAtNode(t),t.parentNode.removeChild(t),t=null}),e.addCommand("WP_Help",function(){function s(){e.focus(),n("hide")}function n(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"show";I.a.render(m.a.createElement(Re,{showDialog:"show"===e,onClose:s,macosx:R.a.Env.mac}),t)}n("show")})}
/**
 * Reactified port of the TinyMCE charmap plugin.
 *
 * Adapted from WordPress.
 *
 *
 * @format
 * @copyright 2015 by the WordPress contributors.
 * @license See CREDITS.md.
 * @see https:
 */
class Le extends m.a.Component{constructor(){super(...arguments),S()(this,"defaultCharMap",()=>[["160","no-break space"],["173","soft hyphen"],["34","quotation mark"],["162","cent sign"],["8364","euro sign"],["163","pound sign"],["165","yen sign"],["169","copyright sign"],["174","registered sign"],["8482","trade mark sign"],["8240","per mille sign"],["181","micro sign"],["183","middle dot"],["8226","bullet"],["8230","three dot leader"],["8242","minutes / feet"],["8243","seconds / inches"],["167","section sign"],["182","paragraph sign"],["223","sharp s / ess-zed"],["8249","single left-pointing angle quotation mark"],["8250","single right-pointing angle quotation mark"],["171","left pointing guillemet"],["187","right pointing guillemet"],["8216","left single quotation mark"],["8217","right single quotation mark"],["8220","left double quotation mark"],["8221","right double quotation mark"],["8218","single low-9 quotation mark"],["8222","double low-9 quotation mark"],["60","less-than sign"],["62","greater-than sign"],["8804","less-than or equal to"],["8805","greater-than or equal to"],["8211","en dash"],["8212","em dash"],["175","macron"],["8254","overline"],["164","currency sign"],["166","broken bar"],["168","diaeresis"],["161","inverted exclamation mark"],["191","turned question mark"],["710","circumflex accent"],["732","small tilde"],["176","degree sign"],["8722","minus sign"],["177","plus-minus sign"],["247","division sign"],["8260","fraction slash"],["215","multiplication sign"],["185","superscript one"],["178","superscript two"],["179","superscript three"],["188","fraction one quarter"],["189","fraction one half"],["190","fraction three quarters"],["402","function / florin"],["8747","integral"],["8721","n-ary sumation"],["8734","infinity"],["8730","square root"],["8764","similar to"],["8773","approximately equal to"],["8776","almost equal to"],["8800","not equal to"],["8801","identical to"],["8712","element of"],["8713","not an element of"],["8715","contains as member"],["8719","n-ary product"],["8743","logical and"],["8744","logical or"],["172","not sign"],["8745","intersection"],["8746","union"],["8706","partial differential"],["8704","for all"],["8707","there exists"],["8709","diameter"],["8711","backward difference"],["8727","asterisk operator"],["8733","proportional to"],["8736","angle"],["180","acute accent"],["184","cedilla"],["170","feminine ordinal indicator"],["186","masculine ordinal indicator"],["8224","dagger"],["8225","double dagger"],["192","A - grave"],["193","A - acute"],["194","A - circumflex"],["195","A - tilde"],["196","A - diaeresis"],["197","A - ring above"],["198","ligature AE"],["199","C - cedilla"],["200","E - grave"],["201","E - acute"],["202","E - circumflex"],["203","E - diaeresis"],["204","I - grave"],["205","I - acute"],["206","I - circumflex"],["207","I - diaeresis"],["208","ETH"],["209","N - tilde"],["210","O - grave"],["211","O - acute"],["212","O - circumflex"],["213","O - tilde"],["214","O - diaeresis"],["216","O - slash"],["338","ligature OE"],["352","S - caron"],["217","U - grave"],["218","U - acute"],["219","U - circumflex"],["220","U - diaeresis"],["221","Y - acute"],["376","Y - diaeresis"],["222","THORN"],["224","a - grave"],["225","a - acute"],["226","a - circumflex"],["227","a - tilde"],["228","a - diaeresis"],["229","a - ring above"],["230","ligature ae"],["231","c - cedilla"],["232","e - grave"],["233","e - acute"],["234","e - circumflex"],["235","e - diaeresis"],["236","i - grave"],["237","i - acute"],["238","i - circumflex"],["239","i - diaeresis"],["240","eth"],["241","n - tilde"],["242","o - grave"],["243","o - acute"],["244","o - circumflex"],["245","o - tilde"],["246","o - diaeresis"],["248","o slash"],["339","ligature oe"],["353","s - caron"],["249","u - grave"],["250","u - acute"],["251","u - circumflex"],["252","u - diaeresis"],["253","y - acute"],["254","thorn"],["255","y - diaeresis"],["913","Alpha"],["914","Beta"],["915","Gamma"],["916","Delta"],["917","Epsilon"],["918","Zeta"],["919","Eta"],["920","Theta"],["921","Iota"],["922","Kappa"],["923","Lambda"],["924","Mu"],["925","Nu"],["926","Xi"],["927","Omicron"],["928","Pi"],["929","Rho"],["931","Sigma"],["932","Tau"],["933","Upsilon"],["934","Phi"],["935","Chi"],["936","Psi"],["937","Omega"],["945","alpha"],["946","beta"],["947","gamma"],["948","delta"],["949","epsilon"],["950","zeta"],["951","eta"],["952","theta"],["953","iota"],["954","kappa"],["955","lambda"],["956","mu"],["957","nu"],["958","xi"],["959","omicron"],["960","pi"],["961","rho"],["962","final sigma"],["963","sigma"],["964","tau"],["965","upsilon"],["966","phi"],["967","chi"],["968","psi"],["969","omega"],["8501","alef symbol"],["982","pi symbol"],["8476","real part symbol"],["978","upsilon - hook symbol"],["8472","Weierstrass p"],["8465","imaginary part"],["8592","leftwards arrow"],["8593","upwards arrow"],["8594","rightwards arrow"],["8595","downwards arrow"],["8596","left right arrow"],["8629","carriage return"],["8656","leftwards double arrow"],["8657","upwards double arrow"],["8658","rightwards double arrow"],["8659","downwards double arrow"],["8660","left right double arrow"],["8756","therefore"],["8834","subset of"],["8835","superset of"],["8836","not a subset of"],["8838","subset of or equal to"],["8839","superset of or equal to"],["8853","circled plus"],["8855","circled times"],["8869","perpendicular"],["8901","dot operator"],["8968","left ceiling"],["8969","right ceiling"],["8970","left floor"],["8971","right floor"],["9001","left-pointing angle bracket"],["9002","right-pointing angle bracket"],["9674","lozenge"],["9824","black spade suit"],["9827","black club suit"],["9829","black heart suit"],["9830","black diamond suit"],["8194","en space"],["8195","em space"],["8201","thin space"],["8204","zero width non-joiner"],["8205","zero width joiner"],["8206","left-to-right mark"],["8207","right-to-left mark"]]),S()(this,"renderCell",e=>m.a.createElement("div",{key:e[0],onClick:this.onCellClick,role:"button",title:e[1],className:"wpcom-charmap__character"},String.fromCharCode(parseInt(e[0],10)))),S()(this,"onCellClick",e=>{this.props.editor.execCommand("mceInsertContent",!1,e.target.textContent.trim())}),S()(this,"getButtons",()=>[m.a.createElement(De.a,{isPrimary:!1,"aria-label":this.props.translate("Close special characters dialog"),onClick:this.props.onClose},this.props.translate("Close"))])}render(){return m.a.createElement(ke.a,{isVisible:this.props.showDialog,buttons:this.getButtons(),additionalClassNames:"wpcom-charmap__dialog",onClose:this.props.onClose},m.a.createElement("h2",{className:"wpcom-charmap__heading"},this.props.translate("Special characters")),m.a.createElement("div",{className:"wpcom-charmap__table"},this.defaultCharMap().map(this.renderCell,this)))}}S()(Le,"displayName","CharMap"),S()(Le,"propTypes",{onClose:T.a.func,showDialog:T.a.bool,editor:T.a.object});var Ae=Object(h.localize)(Le);function Ue(e){let t;e.on("init",function(){(t=document.createElement("div")).setAttribute("class","charmap-dialog-container"),e.getContainer().appendChild(t)}),e.on("remove",function(){I.a.unmountComponentAtNode(t),t.parentNode.removeChild(t),t=null}),e.addCommand("Wpcom_CharMap",function(){function s(){e.focus(),n("hide")}function n(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"show";I.a.render(m.a.createElement(Ae,{showDialog:"show"===n,onClose:s,editor:e}),t)}n("show")})}var qe=s("./node_modules/events/events.js"),Fe=s.n(qe),Be=s("./client/lib/shortcode/index.js"),ze=s("./client/components/gallery-shortcode/index.jsx");class Ve extends u.Component{static match(e){const t=Object(Be.a)("gallery",e);if(t)return{index:t.index,content:t.content,options:{shortcode:t.shortcode}}}static serialize(e){return encodeURIComponent(e)}static edit(e,t){e.execCommand("wpcomEditGallery",t)}constructor(e){super(e),this.state={wrapper:null}}componentDidMount(){this.setState({wrapper:I.a.findDOMNode(this.refs.view)}),window.MutationObserver&&(this.observer=new MutationObserver(this.props.onResize),this.observer.observe(I.a.findDOMNode(this.refs.view),{attributes:!0,childList:!0,subtree:!0}))}componentWillUnmount(){this.observer&&this.observer.disconnect()}renderShortcode(){if(this.state.wrapper)return m.a.createElement(ze.a,{siteId:this.props.siteId,width:this.state.wrapper.clientWidth},this.props.content)}render(){return m.a.createElement("div",{ref:"view",className:"wpview-content wpview-type-gallery"},this.renderShortcode())}}Ve.propTypes={siteId:T.a.number,content:T.a.string,onResize:T.a.func},Ve.defaultProps={onResize:()=>{}};var He=Ve,We=s("./node_modules/flux/utils.js"),Ge=s("./client/dispatcher/index.js");const Ye=/\(\?P?<([\w$]+)>/g,Ke=/^([^\w\s\\])(.*)([^\w\s\\])([gim])?$/;var $e=new class extends We.ReduceStore{getInitialState(){return{}}get(e){return this.getState()[e]}reduce(e,t){switch((t=t.action).type){case"FETCH_EMBEDS":e=Object.assign({},e,{[t.siteId]:{status:"LOADING"}});break;case"RECEIVE_EMBEDS":if(t.error)e=Object.assign({},e,{[t.siteId]:{status:"ERROR"}});else{const s=t.embeds.map(e=>{const t=(e=e.replace(Ye,"(")).match(Ke);if(t&&t[1]===t[3])return new RegExp(t[2],t[4]);try{return new RegExp(e)}catch(e){return!1}}).filter(Boolean);e=Object.assign({},e,{[t.siteId]:{status:"LOADED",embeds:s}})}}return e}}(Ge.a);var Qe=new class extends We.ReduceStore{getInitialState(){return{}}get(e){const t=this.getState()[e];return t||{}}reduce(e,t){switch((t=t.action).type){case"STOP_EDITING_POST":e={};break;case"FETCH_EMBED":e=Object.assign({},e,{[t.url]:{status:"LOADING"}});break;case"RECEIVE_EMBED":t.error?e=Object.assign({},e,{[t.url]:{status:"ERROR"}}):t.data&&(e=Object.assign({},e,{[t.url]:{status:"LOADED",body:t.data.result,scripts:t.data.scripts,styles:t.data.styles}}))}return e}}(Ge.a),Je=s("./client/lib/wp/browser.js"),Ze={fetch(e,t){const s=Je.a.undocumented().site(e);let n;t?(Ge.a.handleViewAction({type:"FETCH_EMBED",siteId:e,url:t}),n={embed_url:t,force:"wpcom"}):Ge.a.handleViewAction({type:"FETCH_EMBEDS",siteId:e}),s.embeds(n,function(s,n){t?Ge.a.handleServerAction({type:"RECEIVE_EMBED",siteId:e,url:t,data:n,error:s}):Ge.a.handleServerAction({type:"RECEIVE_EMBEDS",siteId:e,embeds:n?n.embeds:null,error:s})})}},Xe=s("./client/components/resizable-iframe/index.jsx"),et=s("./client/lib/embed-frame-markup/index.jsx");class tt extends u.Component{static getStores(){return[Qe]}static calculateState(e,t){return Qe.get(t.content)}componentDidMount(){this.setState({wrapper:this.refs.view},this.setHtml)}componentDidUpdate(e,t){this.state.body!==t.body&&this.setHtml(),this.constrainEmbedDimensions()}constrainEmbedDimensions(){if(!this.refs.iframe)return;const e=I.a.findDOMNode(this.refs.view),t=I.a.findDOMNode(this.refs.iframe);if(!t.contentDocument)return;const s=t.contentDocument.querySelector("iframe");if(!s||!s.width)return;const n=parseInt(s.width,10);if(!(n<=e.clientWidth)&&(s.style.width=e.clientWidth+"px",s.height)){const t=parseInt(s.height,10)/n;s.style.height=Math.round(e.clientWidth*t)+"px"}}setHtml(){if(!this.state.body||!this.refs.iframe)return;const e=I.a.findDOMNode(this.refs.iframe);if(!e.contentDocument)return;const t=Object(et.a)(Object(y.pick)(this.state,"body","scripts","styles"));e.contentDocument.open(),e.contentDocument.write(t),e.contentDocument.body.style.width="100%",e.contentDocument.body.style.overflow="hidden",e.contentDocument.close()}renderFrame(){if(this.state.wrapper)return m.a.createElement(Xe.a,{ref:"iframe",onResize:this.props.onResize,frameBorder:"0",seamless:!0,width:"100%"})}render(){return m.a.createElement("div",{ref:"view",className:"wpview-content wpview-type-embed"},this.renderFrame())}}tt.propTypes={siteId:T.a.number,content:T.a.string,onResize:T.a.func},tt.defaultProps={onResize:()=>{}};var st=We.Container.create(function(e){const t=e;return(e=function(){for(var e=arguments.length,s=new Array(e),n=0;n<e;n++)s[n]=arguments[n];return new t(...s)}).prototype=t.prototype,e.getStores=t.getStores,e.calculateState=t.calculateState,e}(tt),{withProps:!0});function nt(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.to,s=e.subject,n=e.fields;const i=(void 0===n?[]:n).map(e=>{let t=e.label,s=e.type,n=e.options,i=e.required;if(!t||!s)return;const o={tag:"contact-field",type:"self-closing",attrs:Object(y.pickBy)({label:t,type:s,options:n})};return i&&(o.attrs.required=1),Object(Be.c)(o)}).join("");return Object(Be.c)({tag:"contact-form",type:"closed",content:i,attrs:Object(y.pickBy)({to:t,subject:s})})}function it(e){if(!e)return null;const t=Object(Be.b)(e);return t?(e=>{let t=e.attrs,s=(t=void 0===t?{}:t).named,n=(s=void 0===s?{}:s).to,i=s.subject,o=e.content;const a=[];let r;for(;o&&(r=Object(Be.a)("contact-field",o));){if("attrs"in r.shortcode){const e=r.shortcode.attrs.named,t=e.label,s=e.type,n=e.options,i=e.required,o=Object(y.pickBy)({label:t,type:s,options:n,required:i});"required"in o&&(o.required=!0),a.push(o)}o=o.slice(r.index+r.content.length)}return Object(y.pickBy)({to:n,subject:i,fields:a})})(t):{}}class ot extends m.a.Component{render(){return m.a.createElement("fieldset",x()({},Object(y.omit)(this.props,"className"),{className:"wpview-type-contact-form-field"}),this.props.children)}}S()(ot,"displayName","ContactFormViewPreviewFieldset");class at extends m.a.Component{render(){return this.props.required?m.a.createElement("em",null," (",this.props.translate("required"),")"):null}}S()(at,"displayName","ContactFormViewPreviewRequired");var rt=Object(h.localize)(at);class ct extends m.a.Component{render(){return m.a.createElement("legend",null,this.props.label,m.a.createElement(rt,this.props))}}S()(ct,"displayName","PreviewLegend");const lt=(e,t)=>m.a.createElement(ot,{key:"contact-form-field-"+t},m.a.createElement(ct,e),m.a.createElement("input",{type:"text"})),dt={name:lt,email:lt,url:lt,text:lt,textarea:(e,t)=>m.a.createElement(ot,{key:"contact-form-field-"+t},m.a.createElement(ct,e),m.a.createElement("textarea",null)),checkbox:(e,t)=>m.a.createElement(ot,{key:"contact-form-field-"+t},m.a.createElement("label",null,m.a.createElement("input",{type:"checkbox"}),e.label,m.a.createElement(rt,{required:e.required}))),select:(e,t)=>m.a.createElement(ot,{key:"contact-form-field-"+t},m.a.createElement(ct,e),m.a.createElement("select",null,[].concat(e.options.split(",")).map((e,t)=>m.a.createElement("option",{key:"contact-form-select-option-"+t},e)))),radio:(e,t)=>m.a.createElement(ot,{key:"contact-form-field-"+t},m.a.createElement(ct,e),[].concat(e.options.split(",")).map((e,t)=>m.a.createElement("label",{key:"contact-form-radio-"+t},m.a.createElement("input",{type:"radio"}),m.a.createElement("span",null,e))))};var pt=function(e){return dt.hasOwnProperty(e.type)?dt[e.type].apply(this,arguments):null};const ut=Object(h.localize)(e=>{let t=e.content,s=e.translate;const n=it(t).fields;return m.a.createElement("div",{className:"wpview-content wpview-type-contact-form"},[].concat(n).map(pt),m.a.createElement("button",{disabled:!0},s("Submit")))});function mt(e){const t=Object(Be.a)("contact-form",e);if(t)return{index:t.index,content:t.content,options:{shortcode:t.shortcode}}}function ht(e){return encodeURIComponent(e)}function gt(e,t){e.execCommand("wpcomContactForm",t)}function bt(){return ut}var ft=s("./client/blocks/shortcode/index.js");function yt(e){let t=e.siteId,s=e.content,n=e.width;if(!t||!n)return null;const i=Object(Be.c)(Object(y.merge)({attrs:{named:{w:n}}},Object(Be.b)(s)));return m.a.createElement(ft.a,{siteId:t,width:n,allowSameOrigin:!0},i)}yt.propTypes={siteId:T.a.number,content:T.a.string,width:T.a.number};var Et=Object(P.b)(e=>({siteId:Object(B.e)(e)}))(function(e){var t,s;const n=e.displayName||e.name||"";return s=t=class extends u.PureComponent{constructor(){super(...arguments),this.boundSetWrapperState=this.setWrapperState.bind(this),this.state={wrapper:null}}setWrapperState(e){e&&(this.setState({wrapper:e}),this.disconnectObserver(),this.observer=new MutationObserver(this.props.onResize),this.observer.observe(e,{attributes:!0,childList:!0,subtree:!0}))}componentWillUnmount(){this.disconnectObserver()}disconnectObserver(){this.observer&&this.observer.disconnect()}render(){let t;return this.state.wrapper&&(t={width:this.state.wrapper.clientWidth}),m.a.createElement("div",{ref:this.boundSetWrapperState},m.a.createElement(e,x()({},this.props,t)))}},S()(t,"displayName","ResizableView(".concat(n,")")),S()(t,"propTypes",{onResize:T.a.func}),S()(t,"defaultProps",{onResize:()=>{}}),s}(yt));function vt(e){const t=Object(Be.a)("wpvideo",e);if(t)return{index:t.index,content:t.content,options:{shortcode:t.shortcode}}}function jt(e){return encodeURIComponent(e)}function _t(){return Et}var xt=s("./packages/format-currency/dist/esm/index.js"),wt=s.n(xt),St=s("./client/config/index.js");function Ct(e){let t=e.id,s=e.isMembership;return St.a.isEnabled("memberships")&&s?Object(Be.c)({tag:"membership",type:"single",attrs:{id:t}}):Object(Be.c)({tag:"simple-payment",type:"single",attrs:{id:t}})}function It(e){if(!e)return null;const t=Object(Be.b)(e),s={},n=parseInt(Object(y.get)(t,"attrs.named.id",null));return s.id=isNaN(n)?null:n,s}var Ot=s("./client/state/selectors/get-media-item.js"),Tt=s("./client/state/selectors/get-simple-payments.js"),Pt=s("./client/components/data/query-simple-payments/index.js"),kt=s("./client/components/data/query-site-plans/index.jsx"),Dt=s("./client/components/data/query-media/index.jsx"),Nt=s("./client/state/sites/plans/selectors.js"),Rt=s("./client/lib/plans/constants.js");class Mt extends u.Component{render(){const e=this.props,t=e.productId,s=e.product,n=e.siteId;return m.a.createElement("div",{className:"wpview-content wpview-type-simple-payments"},m.a.createElement(Pt.a,{siteId:n,productId:t}),m.a.createElement(kt.a,{siteId:n}),s&&m.a.createElement(Dt.a,{siteId:n,mediaId:s.featuredImageId}),this.renderContent())}renderContent(){const e=this.props,t=e.translate,s=e.product,n=e.productImage,i=e.planHasSimplePaymentsFeature,o=e.sitePlan;if(!s||!o)return;if(!i)return m.a.createElement("div",{className:"wpview-type-simple-payments__unsupported"},m.a.createElement("div",{className:"wpview-type-simple-payments__unsupported-icon"},m.a.createElement(A.a,{icon:"cross"})),m.a.createElement("p",{className:"wpview-type-simple-payments__unsupported-message"},t("Your plan doesn't include Simple Payments.")));const a=s.title,r=s.description,c=s.price,l=s.currency,d=s.multiple;return m.a.createElement("div",{className:"wpview-type-simple-payments__wrapper"},n&&m.a.createElement("div",{className:"wpview-type-simple-payments__image-part"},m.a.createElement("figure",{className:"wpview-type-simple-payments__image-figure"},m.a.createElement("img",{className:"wpview-type-simple-payments__image",src:n.URL,alt:r}))),m.a.createElement("div",{className:"wpview-type-simple-payments__text-part"},m.a.createElement("div",{className:"wpview-type-simple-payments__title"},a),m.a.createElement("div",{className:"wpview-type-simple-payments__description"},r),m.a.createElement("div",{className:"wpview-type-simple-payments__price-part"},wt()(c,l)),m.a.createElement("div",{className:"wpview-type-simple-payments__pay-part"},d&&m.a.createElement("div",{className:"wpview-type-simple-payments__pay-quantity"},m.a.createElement("input",{className:"wpview-type-simple-payments__pay-quantity-input",type:"text",value:"1",readOnly:!0})),m.a.createElement("div",{className:"wpview-type-simple-payments__pay-paypal-button-wrapper"},m.a.createElement("div",{className:"wpview-type-simple-payments__pay-paypal-button-content"},m.a.createElement("span",{className:"wpview-type-simple-payments__pay-paypal-button-text"},t("Pay with")),m.a.createElement("span",{className:"wpview-type-simple-payments_paypal-logo"}))))))}}(Mt=Object(P.b)((e,t)=>{const s=It(t.content),n=s.id,i=void 0===n?null:n,o=Object(B.e)(e),a=Object(Nt.a)(e,o),r=Object(Tt.a)(e,o,i);return{shortcodeData:s,productId:i,siteId:o,sitePlan:a,product:r,productImage:Object(Ot.a)(e,o,Object(y.get)(r,"featuredImageId")),planHasSimplePaymentsFeature:Object(Nt.i)(e,o,Rt.xb)}})(Object(h.localize)(Mt))).match=(e=>{const t=Object(Be.a)("simple-payment",e);if(t)return{index:t.index,content:t.content,options:{shortcode:t.shortcode}}}),Mt.serialize=(e=>encodeURIComponent(e)),Mt.edit=((e,t)=>{e.execCommand("simplePaymentsButton",t)});var Lt=Mt;const At={gallery:He,embed:new class extends Fe.a{constructor(){super(),this.sitesListener=this.updateSite.bind(this)}onChange(){this.emit("change"),this.fetchSiteEmbeds()}updateSite(e){const t=e||Object(B.e)(this.store.getState());this.hasOwnProperty("siteId")?this.siteId!==t&&(this.siteId=t,this.onChange()):(this.siteId=t,this.fetchSiteEmbeds())}addListener(e,t,s){super.addListener(e,t),"change"===e&&1===this.listeners(e).length&&(this.store=s,this.selectedSiteSubscriberId=Object(y.uniqueId)(),s.dispatch({type:"SELECTED_SITE_SUBSCRIBE",listener:this.sitesListener}),this.embedsListListener=$e.addListener(this.onChange.bind(this)),this.embedsListener=Qe.addListener(this.onChange.bind(this)),this.updateSite())}removeListener(e,t){super.removeListener(e,t),"change"!==e||this.listeners(e).length||(this.store.dispatch({type:"SELECTED_SITE_UNSUBSCRIBE",listener:this.sitesListener}),this.embedsListListener&&this.embedsListListener.remove(),this.embedsListener&&this.embedsListener.remove())}fetchSiteEmbeds(){this.siteId&&!$e.get(this.siteId)&&Ze.fetch(this.siteId)}fetchEmbed(e){this.siteId&&!Qe.get(e).status&&Ze.fetch(this.siteId,e)}match(e){if(!this.siteId)return;const t=$e.get(this.siteId);if(!t||"LOADED"!==t.status)return;const s=/(^|<p>)(https?:\/\/[^\s"]+?)(<\/p>\s*|$)/gi;let n;for(;n=s.exec(e);){const e=n[2];if(t.embeds.some(t=>t.test(e))){if(Qe.get(e).body)return{index:n.index+n[1].length,content:e};Object(y.defer)(()=>this.fetchEmbed(e))}}}serialize(e){return encodeURIComponent(e)}getComponent(){return st}edit(e,t){e.execCommand("embedDialog",t)}},contactForm:n,video:i,simplePayments:Lt};var Ut={setMarkers(e){let t,s=[{content:e}];return Object(y.forEach)(At,function(e,n){t=s.slice(),s=[],Object(y.forEach)(t,function(t){let i,o=t.content;if(t.processed)s.push(t);else{for(;o&&(i=e.match(o));)i.index&&s.push({content:o.substring(0,i.index)}),s.push({content:'<p class="wpview-marker" data-wpview-text="'+e.serialize(i.content,i.options)+'" data-wpview-type="'+n+'">.</p>',processed:!0}),o=o.slice(i.index+i.content.length);o&&s.push({content:o})}})}),(e=Object(y.map)(s,"content").join("")).replace(/<p>\s*<p data-wpview-marker=/g,"<p data-wpview-marker=").replace(/<\/p>\s*<\/p>/g,"</p>")},isEditable:e=>!(!At[e]||!At[e].edit),edit(e,t,s){this.isEditable(e)&&At[e].edit(t,s)},components:Object(y.mapValues)(At,e=>"function"==typeof e.getComponent?e.getComponent():e),emitters:Object(y.values)(At).filter(e=>e instanceof Fe.a)},qt=s("./client/lib/react-helpers/index.js");
/**
 * Adapted from the WordPress wp-view TinyMCE plugin.
 *
 *
 * @format
 * @copyright 2015 by the WordPress contributors.
 * @license See CREDITS.md.
 */
function Ft(e){let t,s,n,i,o,a,r,c,l=e.$,d=R.a.Env,p=R.a.util.VK,u=R.a.dom.TreeWalker,h=!1,b=!0,f=/iPad|iPod|iPhone/.test(navigator.userAgent);function E(){e.nodeChanged()}function v(){if(!function(){const t=l(".wpview-marker");return!!t.length&&(t.each(function(t,s){let n=e.dom.getAttrib(s,"data-wpview-text"),i=e.dom.getAttrib(s,"data-wpview-type");e.dom.replace(e.dom.createFragment('<div class="wpview-wrap" data-wpview-text="'+n+'" data-wpview-type="'+i+'"><p class="wpview-selection-before"> </p><div class="wpview-body" contenteditable="false"></div><p class="wpview-selection-after"> </p></div>'),s)}),!0)}())return;const t=e.getParam("redux_store"),s=Object(B.e)(t.getState());l(".wpview-wrap").each(function(e,n){const i=l(n);if(void 0!==i.attr("data-wpview-rendered"))return;const o=i.attr("data-wpview-type");Object(qt.b)(m.a.createElement(Ut.components[o],{content:j(n),siteId:s,onResize:Object(y.debounce)(E,500)}),i.find(".wpview-body")[0],t),i.attr("data-wpview-rendered","")})}function j(e){return decodeURIComponent(l(e).attr("data-wpview-text")||"")}function _(e){return x(e,"wpview-wrap")}function x(e,t){for(;e&&e.parentNode;){if(e.className&&-1!==(" "+e.className+" ").indexOf(" "+t+" "))return e;e=e.parentNode}return!1}function w(e){e.stopPropagation()}function S(t,s){let n=t?"before":"after",i=t?0:1;P(),e.selection.setCursorLocation(e.dom.select(".wpview-selection-"+n,s)[0],i),e.nodeChanged()}function C(t,s,n){let i=e.dom,o=i.create("p");d.ie&&d.ie<11||(o.innerHTML='<br data-mce-bogus="1">'),s?t.parentNode.insertBefore(o,t):i.insertAfter(o,t),P(),s&&n===p.ENTER?S(s,t):e.selection.setCursorLocation(o,0),e.nodeChanged()}function O(t){e.undoManager.transact(function(){C(t),I.a.unmountComponentAtNode(l(t).find(".wpview-body")[0]),e.dom.remove(t),e.focus()})}function T(s){let n,i=e.dom;s&&(s!==t&&(o||e.getBody().focus(),P(),t=s,i.setAttrib(s,"data-mce-selected",1),n=i.create("div",{class:"wpview-clipboard",contenteditable:"true"},j(s)),e.dom.select(".wpview-body",s)[0].appendChild(n),i.bind(n,"beforedeactivate focusin focusout",w),i.bind(t,"beforedeactivate focusin focusout",w),f?e.selection.select(n):e.selection.select(n,!0)),e.nodeChanged(),e.fire("wpview-selected",s))}function P(){let s,n=e.dom;t&&(s=e.dom.select(".wpview-clipboard",t)[0],n.unbind(s),n.remove(s),n.unbind(t,"beforedeactivate focusin focusout click mouseup",w),n.setAttrib(t,"data-mce-selected",null)),t=null}function k(e,t){return"<p>"+window.decodeURIComponent(t)+"</p>"}function D(e){return e.replace(/<div[^>]+data-wpview-text="([^"]+)"[^>]*>(?:[\s\S]+?wpview-selection-after[^>]+>[^<>]*<\/p>\s*|\.)<\/div>/g,k).replace(/<p [^>]*?data-wpview-text="([^"]+)"[^>]*>[\s\S]*?<\/p>/g,k)}function N(){let t,s;e.isHidden()||(t=e.getContent({format:"raw"}))!==(s=Ut.setMarkers(t))&&e.setContent(s,{format:"raw",isSettingMarkers:!0})}function M(e){l("div.wpview-wrap, p.wpview-marker",e).each(function(e,t){t.innerHTML="."})}function L(e){return e<=47&&e!==p.SPACEBAR&&e!==p.ENTER&&e!==p.DELETE&&e!==p.BACKSPACE&&(e<37||e>40)||e>=224||e>=144&&e<=150||e>=91&&e<=93||e>=112&&e<=135}e.on("BeforeAddUndo",function(e){e.level.content&&(e.level.content=D(e.level.content))}),e.on("BeforeSetContent",function(s){let n;if(s.selection||l(".wpview-wrap .wpview-body").each(function(e,t){I.a.unmountComponentAtNode(t)}),s.content){if(!s.load&&(t&&O(t),(n=e.selection.getNode())&&n!==e.getBody()&&/^\s*https?:\/\/\S+\s*$/i.test(s.content))){if(!(n=e.dom.getParent(n,"p"))||!/^[\s\uFEFF\u00A0]*$/.test(l(n).text()||""))return;n.innerHTML=""}s.isSettingMarkers||(s.content=Ut.setMarkers(s.content))}}),e.on("pastePreProcess",function(e){let t=e.content;if(t){t=R.a.trim(t.replace(/<[^>]+>/g,""));const s=/(https?:\/\/[^<]*)(\.jpg|\.jpeg|\.gif|\.png)\??.*$/i.exec(t);s?e.content='<img src="'.concat(s[1]).concat(s[2],'" style="max-width:100%;" />'):/^https?:\/\/\S+$/i.test(t)&&(e.content=t)}}),e.on("SetContent",function(){v()}),e.on("click",function(t){let s,n,i,o=t.clientX,a=t.clientY,r=e.getBody(),c=r.getBoundingClientRect(),l=r.firstChild,d=r.lastChild;l&&d&&(s=l.getBoundingClientRect(),n=d.getBoundingClientRect(),a<s.top&&(i=_(l))?(S(!0,i),t.preventDefault()):a>n.bottom&&(i=_(d))?(S(!1,i),t.preventDefault()):(o<c.left||o>c.right)&&R.a.each(e.dom.select(".wpview-wrap"),function(e){const s=e.getBoundingClientRect();return!(a<s.top)&&(a>=s.top&&a<=s.bottom?(o<c.left?(S(!0,e),t.preventDefault()):o>c.right&&(S(!1,e),t.preventDefault()),!1):void 0)}))}),e.on("init",function(){let t=!1,s=e.selection,n=window.MutationObserver||window.WebKitMutationObserver;e.on("BeforeSetContent",function(){let t,n,i=_(s.getNode());i&&(!i.nextSibling||_(i.nextSibling)?(n=e.getDoc().createTextNode(""),e.dom.insertAfter(n,i)):n=(t=new u(i.nextSibling,i.nextSibling)).next(),s.select(n),s.collapse(!0))}),e.dom.bind(e.getDoc(),"touchmove",function(){t=!0}),e.on("mousedown mouseup click touchend",function(e){const s=_(e.target);if(b=!1,s)return e.stopImmediatePropagation(),e.preventDefault(),"touchend"===e.type&&t?t=!1:T(s),!1;"touchend"!==e.type&&"mousedown"!==e.type||P(),"touchend"===e.type&&t&&(t=!1)},!0),n&&new n(function(){e.fire("wp-body-class-change")}).observe(e.getBody(),{attributes:!0,attributeFilter:["class"]})}),e.on("preinit show",function(){Ut.emitters.forEach(function(t){t.addListener("change",N,e.getParam("redux_store"))}),N()}),e.on("hide remove",function(){Ut.emitters.forEach(function(e){e.removeListener("change",N)})}),e.on("PreProcess",function(e){M(e.node)},!0),e.on("hide",function(){P(),M()}),e.on("GetContent",function(e){"raw"===e.format&&e.content&&!e.selection&&(e.content=D(e.content))}),e.on("PostProcess",function(e){e.content&&(e.content=e.content.replace(/<div [^>]*?data-wpview-text="([^"]+)"[^>]*>[\s\S]*?<\/div>/g,k).replace(/<p [^>]*?data-wpview-text="([^"]+)"[^>]*>[\s\S]*?<\/p>/g,k))}),e.on("keydown",function(s){let i,o,a,r,c,l,d,u=s.keyCode,m=e.dom,g=e.selection;if(t){if((s.metaKey||s.ctrlKey)&&u!==p.BACKSPACE&&86!==u||u>=112&&u<=123)return void((s.metaKey||s.ctrlKey)&&88===u&&(h=t));if((o=_(g.getNode()))!==t)return void P();u===p.LEFT?(S(!0,o),s.preventDefault()):u===p.UP?(o.previousSibling?_(o.previousSibling)?S(!0,o.previousSibling):(P(),g.select(o.previousSibling,!0),g.collapse()):S(!0,o),s.preventDefault()):u===p.RIGHT?(S(!1,o),s.preventDefault()):u===p.DOWN?(o.nextSibling?_(o.nextSibling)?S(!1,o.nextSibling):(P(),g.setCursorLocation(o.nextSibling,0)):S(!1,o),s.preventDefault()):L(u)||(O(t),u!==p.ENTER&&u!==p.DELETE&&u!==p.BACKSPACE||s.preventDefault())}else{if(s.metaKey||s.ctrlKey||u>=112&&u<=123)return;if(i=g.getNode(),n=i,o=_(i),g.isCollapsed()||((o=_((c=g.getRng()).endContainer))?(l=c.cloneRange(),g.select(o.previousSibling,!0),g.collapse(),d=g.getRng(),l.setEnd(d.endContainer,d.endOffset),g.setRng(l)):(o=_(c.startContainer))&&((l=c.cloneRange()).setStart(o.nextSibling,0),g.setRng(l))),!o)return void(s.keyCode===p.BACKSPACE&&(e.dom.isEmpty(i)?(o=_(i.previousSibling))&&(S(!1,o),e.dom.remove(i),s.preventDefault()):(c=g.getRng())&&0===c.startOffset&&0===c.endOffset&&(o=_(i.previousSibling))&&(S(!1,o),s.preventDefault())));if(!(a=m.hasClass(o,"wpview-selection-before"))&&!(r=m.hasClass(o,"wpview-selection-after")))return;if(L(u))return;r&&u===p.UP||a&&u===p.BACKSPACE?(o.previousSibling?_(o.previousSibling)?S(!1,o.previousSibling):m.isEmpty(o.previousSibling)&&u===p.BACKSPACE?m.remove(o.previousSibling):(g.select(o.previousSibling,!0),g.collapse()):S(!0,o),s.preventDefault()):!r||u!==p.DOWN&&u!==p.RIGHT?!a||u!==p.UP&&u!==p.LEFT?a&&u===p.DOWN?(o.nextSibling?_(o.nextSibling)?S(!0,o.nextSibling):g.setCursorLocation(o.nextSibling,0):S(!1,o),s.preventDefault()):r&&u===p.LEFT||a&&u===p.RIGHT?(T(o),s.preventDefault()):r&&u===p.BACKSPACE?(O(o),s.preventDefault()):r?C(o):a&&C(o,!0,u):(o.previousSibling&&(_(o.previousSibling)?S(u===p.UP,o.previousSibling):(g.select(o.previousSibling,!0),g.collapse())),s.preventDefault()):(o.nextSibling&&(_(o.nextSibling)?S(u===p.RIGHT,o.nextSibling):g.setCursorLocation(o.nextSibling,0)),s.preventDefault()),u===p.ENTER&&s.preventDefault()}}),e.on("keyup",function(){h&&(O(h),h=!1)}),e.on("focus",function(){let t;o=!0,e.dom.addClass(e.getBody(),"has-focus"),b&&(t=_(e.getBody().firstChild))&&S(!0,t),b=!1}),e.on("blur",function(){o=!1,e.dom.removeClass(e.getBody(),"has-focus")}),e.on("NodeChange",function(t){let a=e.dom,r=e.dom.select(".wpview-wrap"),c=t.element.className,l=_(t.element),d=n;if(n=!1,clearInterval(s),R.a.each(r,function(e){e.className&&(e.className=e.className.replace(/ ?\bwpview-(?:selection-before|selection-after|cursor-hide)\b/g,""))}),o&&l)if("wpview-selection-before"!==c&&"wpview-selection-after"!==c||!e.selection.isCollapsed())x(t.element,"wpview-clipboard")||i||(P(),i++,S(!0,l));else{if(i=0,P(),d===l.previousSibling)return void S(!0,l);if(d===l.nextSibling)return void S(!1,l);a.addClass(l,c),s=setInterval(function(){a.hasClass(l,"wpview-cursor-hide")?a.removeClass(l,"wpview-cursor-hide"):a.addClass(l,"wpview-cursor-hide")},500)}}),e.on("BeforeExecCommand",function(){let t,s=e.selection.getNode();s&&((r="wpview-selection-before"===s.className)||"wpview-selection-after"===s.className)&&(t=_(s))&&(C(t,r),a=t)}),e.on("ExecCommand",function(s){let n,i;"embedDialog"!==s.command&&(t&&(n=t,P(),T(n)),a&&((i=a[r?"previousSibling":"nextSibling"])&&"P"===i.nodeName&&e.dom.isEmpty(i)&&(e.dom.remove(i),S(r,a)),a=!1))}),e.on("ResolveName",function(t){e.dom.hasClass(t.target,"wpview-wrap")?(t.name=e.dom.getAttrib(t.target,"data-wpview-type")||"wpview",t.stopPropagation()):_(t.target)&&(t.preventDefault(),t.stopPropagation())}),e.addButton("wp_view_edit",{tooltip:g.a.translate("Edit",{context:"verb"}),icon:"dashicon dashicons-edit",onPostRender:function(){e.on("wptoolbar",function(){let s;t&&(s=e.dom.getAttrib(t,"data-wpview-type"),this.visible(Ut.isEditable(s)))}.bind(this))},onClick:function(){let s;t&&(s=e.dom.getAttrib(t,"data-wpview-type"),Ut.edit(s,e,j(t)))}}),e.addButton("wp_view_remove",{tooltip:g.a.translate("Remove"),icon:"dashicon dashicons-no",onClick:function(){t&&O(t)}}),e.once("preinit",function(){c=e.wp._createToolbar(["wp_view_edit","wp_view_remove"])}),e.on("wptoolbar",function(e){t&&(e.element=t,e.toolbar=c)})}const Bt=new RegExp("(?:<p>\\s*)?(?:<pre>\\s*)?(\\[(code|sourcecode)[^\\]]*\\][\\s\\S]*?\\[\\/\\2\\])(?:\\s*<\\/pre>)?(?:\\s*<\\/p>)?","gi");function zt(e){let t=e.content;return t&&-1!==t.indexOf("[")?t.replace(Bt,function(e,t){return t=t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"),"<p>".concat(t,"</p>")}):t}function Vt(e){e.on("BeforeSetContent",e=>{e.content&&"html"!==e.mode&&(e.content=function(e){let t=e.content,s=e.initial,n=e.load;return t.replace(Bt,function(e,t){return t=(t=t.replace(/\r/,"")).replace(/<br ?\/?>\n?/g,"\n").replace(/<\/?p( [^>]*)?>\n?/g,"\n"),s&&!n||(t=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),"<pre>".concat(t,"</pre>")})}(e))}),e.on("GetContent",e=>{"raw"===e.format&&e.content&&!e.selection&&(e.content=zt(e))}),e.on("PostProcess",e=>{e.content&&(e.content=zt(e))})}
/**
 * Adapted from the WordPress wp-editimage TinyMCE plugin.
 *
 *
 * @format
 * @copyright 2015 by the WordPress contributors.
 * @license See CREDITS.md.
 */
function Ht(e){let t,s,n;const i=R.a.each,o=R.a.Env.iOS;function a(t){return!(!e.dom.getAttrib(t,"data-mce-placeholder")&&!e.dom.getAttrib(t,"data-mce-object"))}function r(t){let s;"DIV"===t.nodeName&&e.dom.hasClass(t,"mceTemp")?s=t:"IMG"!==t.nodeName&&"DT"!==t.nodeName&&"A"!==t.nodeName||(s=e.dom.getParent(t,"div.mceTemp")),s?(s.nextSibling?e.selection.select(s.nextSibling):s.previousSibling?e.selection.select(s.previousSibling):e.selection.select(s.parentNode),e.selection.collapse(!0),e.dom.remove(s)):e.dom.remove(t),e.nodeChanged(),e.undoManager.add()}e.addButton("wp_img_remove",{tooltip:"Remove",icon:"dashicon dashicons-trash",onclick:function(){r(e.selection.getNode())}}),i({alignleft:"Align left",aligncenter:"Align center",alignright:"Align right",alignnone:"No alignment"},function(t,s){const n=s.slice(5);e.addButton("wp_img_"+s,{tooltip:t,icon:"dashicon dashicons-align-"+n,cmd:"alignnone"===s?"wpAlignNone":"Justify"+n.slice(0,1).toUpperCase()+n.slice(1),onPostRender:function(){const t=this;e.on("NodeChange",function(n){if("IMG"!==n.element.nodeName)return;const i=e.dom.getParent(n.element,".wp-caption")||n.element;"alignnone"===s?t.active(!/\balign(left|center|right)\b/.test(i.className)):t.active(e.dom.hasClass(i,s))})}})}),e.once("preinit",function(){t=e.wp._createToolbar(["wp_img_alignleft","wp_img_aligncenter","wp_img_alignright","wp_img_alignnone","wpcom_img_size_decrease","wpcom_img_size_increase","wp_img_caption","wp_img_advanced","wp_img_edit","wp_img_remove"])}),e.on("wptoolbar",function(e){"IMG"!==e.element.nodeName||a(e.element)||(e.toolbar=t)}),o&&e.on("click",function(s){if("IMG"===s.target.nodeName){const t=s.target;window.setTimeout(function(){e.selection.select(t),e.nodeChanged()},200)}else t.hide()}),e.on("init",function(){const t=e.dom,n=e.getParam("wpeditimage_html5_captions")?"html5-captions":"html4-captions";t.addClass(e.getBody(),n),e.on("wpLoadImageForm",function(t){if(e.getParam("wpeditimage_disable_captions"))return;t.data.splice(t.data.length-1,0,{type:"textbox",flex:1,name:"caption",minHeight:60,multiline:!0,scroll:!0,label:"Image caption"})}),e.on("wpNewImageRefresh",function(e){let s,n;(s=t.getParent(e.node,"dl.wp-caption"))&&(s.style.width||(n=(n=parseInt(e.node.clientWidth,10)+10)?n+"px":"50%",t.setStyle(s,"width",n)))}),e.on("wpImageFormSubmit",function(n){const i=n.imgData.data;let o,a,r,c,l,d=n.imgData.node,p=n.imgData.caption,u="",m="",h="";i.id="__wp-temp-img-id",n.imgData.cancel=!0,i.style||(i.style=null),i.src?(p&&(p=function(t){return!t||-1===t.indexOf("<")&&-1===t.indexOf(">")?t:(s||(s=new R.a.html.Serializer({},e.schema)),s.serialize(e.parser.parse(t,{forced_root_block:!1})))}(p=(p=p.replace(/\r\n|\r/g,"\n").replace(/<\/?[a-zA-Z0-9]+( [^<>]+)?>/g,function(e){return e.replace(/[\r\n\t]+/," ")})).replace(/(<br[^>]*>)\s*\n\s*/g,"$1").replace(/\s*\n\s*/g,"<br />"))),d?(l=d.id||null,t.setAttribs(d,i),o=t.getParent(d,"dl.wp-caption"),p?o?(a=t.select("dd.wp-caption-dd",o)[0])&&(a.innerHTML=p):(d.className&&(u=d.className.match(/wp-image-([0-9]+)/),m=d.className.match(/align(left|right|center|none)/)),m?(m=m[0],d.className=d.className.replace(/align(left|right|center|none)/g,"")):m="alignnone",m=' class="wp-caption '+m+'"',u&&(u=' id="attachment_'+u[1]+'"'),(h=i.width||d.clientWidth)&&(h=parseInt(h,10),e.getParam("wpeditimage_html5_captions")||(h+=10),h=' style="width: '+h+'px"'),r=d.parentNode&&"A"===d.parentNode.nodeName?d.parentNode:d,c="<dl "+u+m+h+'><dt class="wp-caption-dt"></dt><dd class="wp-caption-dd">'+p+"</dd></dl>",o=t.create("div",{class:"mceTemp"},c),(a=t.getParent(r,"p"))?a.parentNode.insertBefore(o,a):r.parentNode.insertBefore(o,r),e.$(o).find("dt.wp-caption-dt").append(r),a&&t.isEmpty(a)&&t.remove(a)):o&&(c="A"===d.parentNode.nodeName?t.getOuterHTML(d.parentNode):t.getOuterHTML(d),a=t.create("p",{},c),t.insertAfter(a,o.parentNode),e.selection.select(a),e.nodeChanged(),t.remove(o.parentNode))):(c=t.createHTML("img",i),p?(r=e.selection.getNode(),i.width&&(h=parseInt(i.width,10),e.getParam("wpeditimage_html5_captions")||(h+=10),h=' style="width: '+h+'px"'),c='<dl class="wp-caption alignnone"'+h+'><dt class="wp-caption-dt">'+c+'</dt><dd class="wp-caption-dd">'+p+"</dd></dl>",(a="P"===r.nodeName?r:t.getParent(r,"p"))&&"P"===a.nodeName?(o=t.create("div",{class:"mceTemp"},c),a.parentNode.insertBefore(o,a),e.selection.select(o),e.nodeChanged(),t.isEmpty(a)&&t.remove(a)):e.selection.setContent('<div class="mceTemp">'+c+"</div>")):e.selection.setContent(c)),d=t.get("__wp-temp-img-id"),t.setAttrib(d,"id",l),n.imgData.node=d):d&&((o=t.getParent(d,"div.mceTemp"))?t.remove(o):"A"===d.parentNode.nodeName?t.remove(d.parentNode):t.remove(d),e.nodeChanged())}),e.on("wpLoadImageData",function(s){let n;const i=s.imgData.data,o=s.imgData.node;(n=t.getParent(o,"dl.wp-caption"))&&(n=t.select("dd.wp-caption-dd",n)[0])&&(i.caption=e.serializer.serialize(n).replace(/<br[^>]*>/g,"$&\n").replace(/^<p>/,"").replace(/<\/p>$/,""))}),t.bind(e.getDoc(),"dragstart",function(s){const n=e.selection.getNode();"IMG"===n.nodeName&&t.getParent(n,".wp-caption")&&s.preventDefault()}),R.a.Env.ie&&R.a.Env.ie>10&&t.bind(e.getBody(),"mscontrolselect",function(s){"IMG"===s.target.nodeName&&t.getParent(s.target,".wp-caption")?e.getBody().focus():"DL"===s.target.nodeName&&t.hasClass(s.target,"wp-caption")&&s.target.focus()})}),e.on("ObjectResized",function(t){const s=t.target;"IMG"===s.nodeName&&e.undoManager.transact(function(){let n,i;const o=e.dom;s.className=s.className.replace(/\bsize-[^ ]+/,""),(n=o.getParent(s,".wp-caption"))&&(i=t.width||o.getAttrib(s,"width"))&&(i=parseInt(i,10),e.getParam("wpeditimage_html5_captions")||(i+=10),o.setStyle(n,"width",i+"px"))})}),e.on("pastePostProcess",function(t){e.dom.getParent(e.selection.getNode(),"dd.wp-caption-dd")&&(e.$("img, audio, video, object, embed, iframe, script, style",t.node).remove(),e.$("*",t.node).each(function(t,s){e.dom.isBlock(s)&&(R.a.trim(s.textContent||s.innerText)?(e.dom.insertAfter(e.dom.create("br"),s),e.dom.remove(s,!0)):e.dom.remove(s))}),e.$("br",t.node).each(function(t,s){s.nextSibling&&"BR"!==s.nextSibling.nodeName&&s.previousSibling&&"BR"!==s.previousSibling.nodeName||e.dom.remove(s)}),n=!0)}),e.on("BeforeExecCommand",function(s){let i,o,a,r,c,l;const d=s.command,p=e.dom;if("mceInsertContent"===d){if(i=e.selection.getNode(),l=p.getParent(i,"div.mceTemp")){if(n)return void(n=!1);o=p.create("p"),p.insertAfter(o,l),e.selection.setCursorLocation(o,0),"IMG"!==i.nodeName&&"DT"!==i.nodeName||e.$(l).remove(),e.nodeChanged()}}else if("JustifyLeft"===d||"JustifyRight"===d||"JustifyCenter"===d||"wpAlignNone"===d){if(i=e.selection.getNode(),r="align"+d.slice(7).toLowerCase(),a=e.dom.getParent(i,".wp-caption"),"IMG"!==i.nodeName&&!a)return;i=a||i,c=e.dom.hasClass(i,r)?" alignnone":" "+r,i.className=i.className.replace(/ ?align(left|center|right|none)/g,"")+c,e.nodeChanged(),s.preventDefault(),t&&t.reposition(),e.fire("ExecCommand",{command:d,ui:s.ui,value:s.value})}}),e.on("keydown",function(t){let s,n,i,o;const a=e.selection,c=t.keyCode,l=e.dom,d=R.a.util.VK;if(c===d.ENTER)s=a.getNode(),(n=l.getParent(s,"div.mceTemp"))&&(l.events.cancel(t),R.a.each(l.select("dt, dd",n),function(e){l.isEmpty(e)&&l.remove(e)}),o=R.a.Env.ie&&R.a.Env.ie<11?"":'<br data-mce-bogus="1" />',i=l.create("p",null,o),"DD"===s.nodeName?l.insertAfter(i,n):n.parentNode.insertBefore(i,n),e.nodeChanged(),a.setCursorLocation(i,0));else if((c===d.DELETE||c===d.BACKSPACE)&&("DIV"===(s=a.getNode()).nodeName&&l.hasClass(s,"mceTemp")?n=s:"IMG"!==s.nodeName&&"DT"!==s.nodeName&&"A"!==s.nodeName||(n=l.getParent(s,"div.mceTemp")),n))return l.events.cancel(t),r(s),!1}),R.a.Env.gecko&&e.on("undo redo",function(){"IMG"===e.selection.getNode().nodeName&&e.selection.collapse()}),e.wpSetImgCaption=function(t){return function(t){return t.replace(/(?:<p>)?\[(?:wp_)?caption([^\]]+)\]([\s\S]+?)\[\/(?:wp_)?caption\](?:<\/p>)?/g,function(t,s,n){let i,o,a,r,c,l;const d=R.a.trim;return(i=s.match(/id=['"]([^'"]*)['"] ?/))&&(s=s.replace(i[0],"")),(o=s.match(/align=['"]([^'"]*)['"] ?/))&&(s=s.replace(o[0],"")),(a=s.match(/class=['"]([^'"]*)['"] ?/))&&(s=s.replace(a[0],"")),(l=s.match(/width=['"]([0-9]*)['"] ?/))&&(s=s.replace(l[0],"")),(c=(n=d(n)).match(/((?:<a [^>]+>)?<img [^>]+>(?:<\/a>)?)([\s\S]*)/i))&&c[2]?(r=d(c[2]),c=d(c[1])):(r=d(s).replace(/caption=['"]/,"").replace(/['"]$/,""),c=n),i=i&&i[1]?i[1].replace(/[<>&]+/g,""):"",o=o&&o[1]?o[1]:"alignnone",a=a&&a[1]?" "+a[1].replace(/[<>&]+/g,""):"",!l&&c&&(l=c.match(/width=['"]([0-9]*)['"]/)),l&&l[1]&&(l=l[1]),l&&r?(l=parseInt(l,10),e.getParam("wpeditimage_html5_captions")||(l+=10),'<div class="mceTemp"><dl id="'+i+'" class="wp-caption '+o+a+'" style="width: '+l+'px"><dt class="wp-caption-dt">'+c+'</dt><dd class="wp-caption-dd">'+r+"</dd></dl></div>"):n})}(t)},e.wpGetImgCaption=function(e){return function(e){return e.replace(/<div (?:id="attachment_|class="mceTemp)[^>]*>([\s\S]+?)<\/div>/g,function(e,t){let s="";return-1===t.indexOf("<img ")?(s=t.match(/<dd [^>]+>([\s\S]+?)<\/dd>/i))&&s[1]?"<p>"+s[1]+"</p>":"":(-1===(s=t.replace(/\s*<dl ([^>]+)>\s*<dt [^>]+>([\s\S]+?)<\/dt>\s*<dd [^>]+>([\s\S]*?)<\/dd>\s*<\/dl>\s*/gi,function(e,t,s,n){let i,o,a;a=(a=s.match(/width="([0-9]*)"/))&&a[1]?a[1]:"";const r=(o=(o=t.match(/class="([^"]*)"/))&&o[1]?o[1]:"").match(/align[a-z]+/i)||"alignnone";return a&&n?(i=(i=t.match(/id="([^"]*)"/))&&i[1]?i[1]:"",(o=o.replace(/wp-caption ?|align[a-z]+ ?/gi,""))&&(o=' class="'+o+'"'),'[caption id="'+i+'" align="'+r+'" width="'+a+'"'+o+"]"+s+" "+(n=(n=n.replace(/\r\n|\r/g,"\n").replace(/<[a-zA-Z0-9]+( [^<>]+)?>/g,function(e){return e.replace(/[\r\n\t]+/," ")})).replace(/\s*\n\s*/g,"<br />"))+"[/caption]"):("alignnone"!==r[0]&&(s=s.replace(/><img/,' class="'+r[0]+'"><img')),s)})).indexOf("[caption")&&(s=t.replace(/[\s\S]*?((?:<a [^>]+>)?<img [^>]+>(?:<\/a>)?)(<p>[\s\S]*<\/p>)?[\s\S]*/gi,"<p>$1</p>$2")),s)})}(e)},e.on("BeforeSetContent",function(t){"raw"!==t.format&&(t.content=e.wpSetImgCaption(t.content))}),e.on("PostProcess",function(t){t.get&&(t.content=e.wpGetImgCaption(t.content))}),e.wp=e.wp||{},e.wp.isPlaceholder=a}var Wt=s("./client/components/tinymce/plugins/wplink/plugin.js"),Gt=s("./node_modules/component-closest/index.js"),Yt=s.n(Gt),Kt=s("./client/lib/media/constants.js"),$t=s("./client/lib/media/actions.js"),Qt=s("./client/lib/media/utils.js"),Jt=s("./client/lib/media-serialization/index.js"),Zt=s("./client/post-editor/media-modal/markup.js"),Xt=s("./client/lib/media/store.js"),es=s("./client/post-editor/editor-media-modal/index.jsx"),ts=s("./client/notices/index.js"),ss=s("./client/lib/analytics/index.js"),ns=s("./client/my-sites/media-library/drop-zone.jsx"),is=s("./client/lib/media/library-selected-store.js"),os=s("./client/lib/media/validation-store.js"),as=s("./client/state/ui/editor/save-blockers/actions.js");class rs extends m.a.Component{constructor(){super(...arguments),S()(this,"state",{isDragging:!1}),S()(this,"redirectEditorDragEvent",e=>{window.dispatchEvent(new CustomEvent(e.type,{detail:e})),this.setState({isDragging:!0})}),S()(this,"fakeDragEnterIfNecessary",e=>{this.state.isDragging||this.redirectEditorDragEvent(Object.assign({},e,{type:"dragenter"}))}),S()(this,"stopDragging",()=>{this.setState({isDragging:!1})}),S()(this,"insertMedia",()=>{const e=this.props,t=e.site,s=e.onInsertMedia,n=e.onRenderModal;if(!t)return;const i=is.a.getAll(t.ID);1===i.length&&"image"===Object(Qt.g)(i[0])&&!os.a.hasErrors(t.ID)?(i[0].transient&&this.props.blockSave("MEDIA_MODAL_TRANSIENT_INSERT"),s(Zt.a.get(t,i[0])),$t.a.setLibrarySelectedItems(t.ID,[])):n({visible:!0}),ss.default.mc.bumpStat("editor_upload_via","editor_drop")})}componentDidMount(){const e=this.props.editor;e.dom.bind(e.getWin(),"dragenter",this.redirectEditorDragEvent),window.addEventListener("dragleave",this.stopDragging),e.dom.bind(e.getWin(),"dragleave",this.stopDragging),e.dom.bind(e.getWin(),"dragover",this.fakeDragEnterIfNecessary)}componentWillUnmount(){const e=this.props.editor;window.removeEventListener("dragleave",this.stopDragging),e.getWin()&&(e.dom.unbind(e.getWin(),"dragenter",this.redirectEditorDragEvent),e.dom.unbind(e.getWin(),"dragleave",this.stopDragging),e.dom.unbind(e.getWin(),"dragover",this.fakeDragEnterIfNecessary))}render(){const e=this.props.site;return e?m.a.createElement(ns.a,{site:e,fullScreen:!1,trackStats:!1,onAddMedia:this.insertMedia}):null}}S()(rs,"propTypes",{editor:T.a.object,onInsertMedia:T.a.func,onRenderModal:T.a.func}),S()(rs,"defaultProps",{onInsertMedia:y.noop,onRenderModal:y.noop});var cs=Object(P.b)(e=>({site:Object(B.d)(e)}),{blockSave:as.a})(rs),ls=s("./client/lib/resize-image-url/index.js");const ds=/(<img[^>]*?\ssrc=")([^"]*?)("[^>]*?\/?>)/gi,ps=/(<img[^>]*?\ssrc=")([^"]*?)("[^>]*?)(\sdata-wpmedia-src="([^"]*?)")([^>]*?\/?>)/gi,us="( -webkit-min-device-pixel-ratio: 1.5 ), ( min--moz-device-pixel-ratio: 1.5 ), ( min-resolution: 1.5dppx )",ms=680,hs=function(){if(isFinite(window.devicePixelRatio))return Math.round(ms*window.devicePixelRatio);if(window.matchMedia&&window.matchMedia(us).matches)return Math.round(2*ms);return ms}();function gs(e,t,s,n,i,o,a){return"".concat(t).concat(o).concat(n).concat(a)}function bs(e){const t=Object(Jt.a)(e);return t.media.transient||!t.media.ID?null:{originalUrl:t.media.URL,resizedUrl:Object(ls.a)(t.media.URL,Math.min(t.media.width||1/0,hs))}}function fs(e,t,s,n){if(-1!==e.indexOf("data-wpmedia-src"))return e;const i=bs(e);return null===i?e:"".concat(t).concat(i.resizedUrl,'" data-wpmedia-src="').concat(i.originalUrl).concat(n)}function ys(e){return e.replace(ps,gs)}var Es=function(e){e.on("BeforeSetContent BeforeSetWpcomMedia",e=>{e.content&&"html"!==e.mode&&(e.content=function(e){return e.replace(ds,fs)}(e.content))}),e.on("BeforeSetWpcomMedia",e=>{const t=bs(e.content);null!==t&&(e.resizedImageUrl=t.resizedUrl)}),e.on("GetContent",e=>{"raw"===e.format&&e.content&&!e.selection&&(e.content=ys(e.content))}),e.on("PostProcess",e=>{e.content&&(e.content=ys(e.content))}),e.on("BeforeAddUndo",e=>{e.level.content&&(e.level.content=ys(e.level.content))})},vs=s("./client/components/forms/form-fieldset/index.jsx"),js=s("./client/components/forms/form-label/index.jsx");class _s extends u.Component{constructor(){super(...arguments),this.save=this.save.bind(this)}save(){const e=this.props.item,t=e.media,s=e.appearance,n=Zt.a.get(this.props.selectedSite,Object.assign({},t,{alt:I.a.findDOMNode(this.refs.alt).value}),s);this.props.insertMedia(n)}render(){const e=this.props,t=e.translate,s=e.visible,n=e.item,i=e.onClose,o=[m.a.createElement(q.a,{primary:!0,onClick:this.save},t("Save"))];return m.a.createElement(ke.a,{isVisible:s,buttons:o,onClose:i},m.a.createElement("form",{onSubmit:this.save},m.a.createElement(vs.a,null,m.a.createElement(js.a,null,t("Alt text"),m.a.createElement(de.a,{ref:"alt",defaultValue:n.media.alt})))))}}_s.propTypes={translate:T.a.func,visible:T.a.bool,item:T.a.object,onClose:T.a.func,insertMedia:T.a.func},_s.defaultProps={onClose:()=>{},insertMedia:()=>{}};var xs=Object(P.b)(e=>({selectedSite:Object(B.d)(e)}))(Object(h.localize)(_s)),ws=function(e){const t=e.getParam("redux_store");if(!St.a.isEnabled("post-editor/media-advanced")||!t)return;let s;function n(){let n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],r=arguments.length>1?arguments[1]:void 0;if(s||(s=e.getContainer().appendChild(document.createElement("div"))),!n)return o();Object(qt.b)(m.a.createElement(xs,x()({visible:n,item:r},{onClose:i,insertMedia:a})),s,t)}function i(){n(!1)}function o(){s&&I.a.unmountComponentAtNode(s)}function a(t){e.execCommand("mceInsertContent",!1,t),i()}e.addButton("wp_img_advanced",{tooltip:g.a.translate("Edit",{context:"verb"}),classes:"toolbar-segment-start",onPostRender(){this.innerHtml(p.a.renderToStaticMarkup(m.a.createElement("button",{type:"button",tabIndex:"-1"},m.a.createElement(A.a,{icon:"pencil",size:18}))))},onClick(){const t=e.selection.getStart();!function(e){n(!0,e)}(Object(Jt.a)(t))}}),e.on("remove",o)},Ss=s("./client/state/ui/editor/actions.js"),Cs=s("./client/state/ui/media-modal/constants.js");const Is=/<img\s[^>]*\/?>/gi,Os=["thumbnail","medium","large","full"];let Ts=null,Ps=null;function ks(e){const t=e.getParam("redux_store");if(!t)return;const n=t.dispatch,i=t.getState;let o,a={};const r=()=>Object(B.d)(i());function c(t){e.execCommand("mceInsertContent",!1,t)}function l(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(r()){if(d({visible:!s.visible}),a.modal||(a.modal=e.getContainer().appendChild(document.createElement("div"))),s.visible&&!n.preserveFocus&&e.focus(!1),s.visible){const e=n.view,s=void 0===e?Cs.a.LIST:e;t.dispatch(Object(Ss.l)(s))}Object(qt.b)(m.a.createElement(es.a,x()({},s,{onClose:l.bind(null,{visible:!1}),onInsertMedia:e=>{c(e),l({visible:!1})}})),a.modal,t)}}function d(s){s.visible?(a.dropzone||(a.dropzone=document.createElement("div"),e.getContainer().parentNode.insertBefore(a.dropzone,e.getContainer())),Object(qt.b)(m.a.createElement(cs,{editor:e,onInsertMedia:c,onRenderModal:l}),a.dropzone,t)):a.dropzone&&I.a.unmountComponentAtNode(a.dropzone)}const u=(()=>{const e={};return{isLoaded:function(t){return!!e[t]},onLoad:function(t){e[t]=!0,o()}}})();function h(){let t=e.selection.getStart();"IMG"!==t.nodeName&&(t=t.querySelector("img")),t&&(e.selection.select(t),e.selection.controlSelection.showResizeRect(t))}function b(e){d({visible:"dragend"===e.type})}function f(){const e=r();e&&$t.a.clearValidationErrors(e.ID)}o=Object(y.debounce)(function(){const t=e.selection.getNode();let s,o,a=!1,c=0;const l=r();if(!l)return;const d=!e.isHidden();if(d)o=e.dom.select("img");else{if(!(s=Object(z.i)(i())))return;o=s.match(Is)||[]}o.forEach(function(t){const n=Object(Jt.a)(t);if(!n.media.ID)return;const i=Xt.a.get(l.ID,n.media.ID);let o,r=!1,p=null;if(i&&"deleted"===i.status)return p=e.dom.getParent(t,"div.mceTemp"),e.$(p||t).remove(),void e.nodeChanged();if(i&&i.isDirty){if(!Ts||Ts.ID!==i.ID){Ts=i;const t=e.dom.select("img.wp-image-".concat(i.ID));Ps=t.length}n.media.transient=!0,(p=e.dom.getParent(t,".mceTemp"))&&(i.caption=e.dom.$(".wp-caption-dd",p).text(),r=!0)}if(n.media.transient?(c++,a=!0,e.dom.$(t).toggleClass("is-transient",!0)):e.dom.$(t).toggleClass("is-transient",!1),(!n.media.transient||i&&i.transient)&&!(n.media.transient&&i&&i.isDirty&&i.transient))return;if(c--,i){if(i.ID===n.media.ID&&i.URL===n.media.URL)return;let t=!1;i.isDirty&&(t=i.width<n.media.width||i.height<n.media.height);const s=Object(y.assign)({},i,n.media,Object(y.pick)(i,"ID","URL",t?"width":"",t?"height":""),{transient:!!i.transient}),a=Object(y.assign)({},n.appearance,{forceResize:!i.transient&&n.media.width&&n.media.width!==i.width});r||delete s.caption,o=Zt.a.get(l,s,a),r&&(o=e.wpSetImgCaption(o))}else ts.a.error("An error occurred while uploading the file"),o="";const m={content:o,mode:d?"tinymce":"html"};e.fire("BeforeSetWpcomMedia",m);const h=m.resizedImageUrl||i.URL;if(!u.isLoaded(h)){const e=new Image;return e.src=h,e.onload=u.onLoad.bind(null,h),e.onerror=e.onload,void c++}let g="";r&&p.outerHTML?(g=p.outerHTML,p.outerHTML=m.content):t.outerHTML?(g=t.outerHTML,t.outerHTML=m.content):g=t,s&&(s=s.replace(g,m.content)),e.undoManager.data=e.undoManager.data.map(function(e){return e.content=e.content.replace(g,m.content),e}),Ps>0&&(Ps-=1)}),!c&&Object(z.n)(i(),"MEDIA_MODAL_TRANSIENT_INSERT")&&n(Object(as.b)("MEDIA_MODAL_TRANSIENT_INSERT")),a&&!c&&(d||e.fire("SetTextAreaContent",{content:s}),"IMG"===t.nodeName&&h(),e.fire("change")),Ts&&Ts.isDirty&&0===Ps&&($t.a.edit(l.ID,Ce()({},Ts,{isDirty:!1})),Ps=null)}),e.addCommand("wpcomAddMedia",()=>{f(),l({visible:!0})}),e.addCommand("googleAddMedia",()=>{f(),l({visible:!0,source:"google_photos"})}),e.addCommand("pexelsAddMedia",()=>{f(),l({visible:!0,source:"pexels"})}),e.addButton("wpcom_add_media",{classes:"btn wpcom-icon-button media",cmd:"wpcomAddMedia",title:g.a.translate("Add Media"),onPostRender:function(){this.innerHtml(p.a.renderToStaticMarkup(m.a.createElement("button",{type:"button",role:"presentation",tabIndex:"-1"},m.a.createElement(A.a,{icon:"image-multiple",size:20}))))}}),e.addButton("wp_img_edit",{tooltip:g.a.translate("Edit",{context:"verb"}),classes:"toolbar-segment-start",icon:"dashicon dashicons-edit",onclick:function(){const t=r();if(!t)return;const s=t.ID,n=e.selection.getNode().className.match(/wp-image-(\d+)/),i=n&&parseInt(n[1],10);if(!i)return;const o=Xt.a.get(s,i);$t.a.clearValidationErrors(s),l({visible:!0,labels:{confirm:g.a.translate("Update",{context:"verb"})}},{view:Cs.a.DETAIL}),$t.a.setLibrarySelectedItems(s,[o])}}),e.addButton("wp_img_caption",{tooltip:g.a.translate("Caption",{context:"verb"}),icon:"dashicon dashicons-admin-comments",classes:"toolbar-segment-start toolbar-segment-end",stateSelector:".wp-caption",onclick:function(){const t=e.selection.getStart(),s=Object(Jt.a)(t),n=r();let i;if(!s||!n)return;const o=Yt()(t,".wp-caption");if(o)return e.dom.replace(t,o.parentNode),e.selection.getStart()!==t&&e.selection.select(t),e.selection.controlSelection.showResizeRect(t),void e.nodeChanged();const a=Xt.a.get(n.ID,s.media.ID);i=a&&a.caption?a.caption:g.a.translate("Enter a caption"),["width","height"].forEach(function(e){null===t.getAttribute(e)&&s.media[e]&&t.setAttribute(e,s.media[e])});const c={width:s.media.width};s.media.ID&&(c.id="attachment_"+s.media.ID),s.appearance.align&&(c.align="align"+s.appearance.align);const l=Object(Be.c)({tag:"caption",attrs:c,content:[t.outerHTML,i].join(" ")});e.selection.setContent(l),e.selection.select(e.selection.getStart().querySelector(".wp-caption-dd"),!0),e.selection.controlSelection.hideResizeRect(),this.rootControl.hide()}});const E=(e,t)=>{const s=Ce()({},t,e),n=s.width,i=s.height;return Math.min(n/t.width||1/0,i/t.height||1/0)};function v(t){const s=e.selection.getStart(),n=Object(Jt.a)(s),i=r();if(!n||!i)return;const o=e.dom.getParent(s,".mceTemp");o&&(e.selection.select(o),n.media.caption=e.dom.$(".wp-caption-dd",o).text());let a=Object(y.assign)({},Xt.a.get(i.ID,n.media.ID));delete a.caption,a=Object(y.assign)({},n.media,a);const c=Os.map(e=>E(Object(Qt.i)(e,i),a)),l=Os.indexOf(n.appearance.size),d=-1!==l?c[l]:E(n.media,a),p=(t>0?y.find:y.findLast)(Os,(e,s)=>!(c[s]>1)&&(t>0?c[s]>d:c[s]<d))||Os[Os.length-1],u=Zt.a.get(i,a,Object(y.assign)(n.appearance,{size:p}));e.selection.setContent(u),h(),e.nodeChanged()}function j(e,t){const s=r();if(!t.element||"IMG"!==t.element.nodeName||!s)return;const n=Object(Jt.a)(t.element),i=Object(y.assign)({width:1/0,height:1/0},Xt.a.get(s.ID,n.media.ID)),o=E(n.media,i),a=!!n.media.transient;if(this.classes.toggle("hidden",a),e){const e=o>=1;this.disabled(e)}else{const e=o<=E(Object(Qt.i)(Os[0],s),i)||Os[0]===n.appearance.size;this.disabled(e)}}e.addButton("wpcom_img_size_decrease",{tooltip:g.a.translate("Decrease size"),classes:"toolbar-segment-start img-size-decrease",icon:"dashicon dashicons-minus",onPostRender:function(){e.on("wptoolbar",j.bind(this,!1))},onclick:function(){v(-1)}}),e.addButton("wpcom_img_size_increase",{tooltip:g.a.translate("Increase size"),classes:"toolbar-segment-end img-size-increase",icon:"dashicon dashicons-plus",onPostRender:function(){e.on("wptoolbar",j.bind(this,!0))},onclick:function(){v(1)}}),e.addCommand("WP_Medialib",()=>{l({visible:!0})}),e.addCommand("wpcomEditGallery",function(e){const t=r();if(!t)return;let s=Object(Be.b)(e);"gallery"===s.tag&&((s=Object(y.assign)({},Kt.b,s.attrs.named)).items=s.ids.split(",").map(e=>{e=parseInt(e,10);const s=Xt.a.get(t.ID,e);return s||$t.a.fetch(t.ID,e),Object(y.assign)({ID:e},s)}),delete s.ids,s.columns&&(s.columns=parseInt(s.columns,10)),s.orderby&&(s.orderBy=s.orderby,delete s.orderby),$t.a.setLibrarySelectedItems(t.ID,s.items),l({visible:!0,initialGallerySettings:s,labels:{confirm:g.a.translate("Update",{context:"verb"})}},{preserveFocus:!0,view:Cs.a.GALLERY}))});const _=Object(y.debounce)(function(){e.execCommand("wpcomAutoResize",null,null,{skip_focus:!0})},400,{leading:!0});function w(e){"IMG"===e.target.nodeName&&_()}function S(t){t||e.dom.select(".wp-caption-dd").forEach(function(t){if(t.textContent.trim().length)return;const s=Yt()(t.parentNode,".wp-caption"),n=s.querySelector("img");e.dom.replace(n,s.parentNode)})}if(e.on("click",function(t){if(!t.detail||t.detail<2)return;const s=Yt()(t.target,".wp-caption-dd");s&&e.selection.select(s)}),e.on("keydown",function(t){if(8!==t.keyCode&&46!==t.keyCode)return;const s=e.selection.getStart(!0);if(!e.dom.hasClass(s,"wp-caption-dd"))return;const n=e.selection.getRng();(8===t.keyCode&&0===n.startOffset||46===t.keyCode&&s.textContent.length===n.endOffset)&&t.preventDefault()}),St.a.isEnabled("desktop")){const t=s("electron").ipcRenderer;e.on("contextmenu",function(){t.send("mce-contextmenu",{sender:!0})})}e.on("touchstart touchmove touchend",function(){let t=!1;return function(s){switch(s.type){case"touchstart":t=!1;break;case"touchmove":t=!0;break;case"touchend":t||"IMG"!==s.target.nodeName||(e.selection.select(s.target),s.preventDefault())}}}()),e.on("init",function(){Xt.a.on("change",o),e.getDoc().addEventListener("load",w,!0),e.dom.bind(e.getDoc(),"dragstart dragend",b),e.selection.selectorChanged(".wp-caption",S)}),e.on("init show hide",function(){d({visible:!e.isHidden()})}),e.on("SetContent",function(e){const t=r();t&&(e.content.match(Is)||[]).forEach(function(e){const s=Object(Jt.a)(e);s.media.ID&&!Xt.a.get(t.ID,s.media.ID)&&setTimeout(function(){$t.a.fetch(t.ID,s.media.ID)},0)})}),e.on("remove",function(){Object(y.values)(a).forEach(function(e){I.a.unmountComponentAtNode(e),e.parentNode.removeChild(e)}),a={},Xt.a.off("change",o),e.getDoc().removeEventListener("load",w)}),Es(e),ws(e)}var Ds=s("./client/state/preferences/actions.js"),Ns=s("./client/state/preferences/selectors.js");function Rs(e){const t=e.getParam("redux_store");if(!t)return;const s=t.dispatch,n=t.getState,i=t.subscribe;function o(){return Object(Ns.b)(n(),"editorAdvancedVisible")}let a,r=o();function c(){const t=e.theme.panel.find(".toolbar:not(.menubar)"),s=Object(ye.f)("<960px");let n=0;t.each(function(e,t){const i=s||0===t||r;e.visible(i),i&&(s?n=Math.max(n,e.getEl().clientHeight):n+=e.getEl().clientHeight)}),R.a.DOM.setStyles(e.getContainer(),{"padding-top":n}),a&&a.active(r)}e.addButton("wpcom_advanced",{text:Object(h.translate)("Toggle Advanced"),tooltip:Object(h.translate)("Toggle Advanced"),classes:"btn wpcom-icon-button advanced",cmd:"WPCOM_ToggleAdvancedVisible",onPostRender:function(){a=this,this.innerHtml(p.a.renderToStaticMarkup(m.a.createElement("button",{type:"button",role:"presentation",tabIndex:"-1"},m.a.createElement(A.a,{icon:"ellipsis",size:28}))))}}),e.addCommand("WPCOM_ToggleAdvancedVisible",()=>{s(Object(Ds.b)("editorAdvancedVisible",!r))}),e.on("init",function(){Object(Ns.d)(n())||s(Object(Ds.a)())}),e.on("preInit",function(){e.shortcuts.add("access+z","","WPCOM_ToggleAdvancedVisible")}),e.on("init show",c),window.addEventListener("resize",c),i(()=>{const e=o();e!==r&&(r=e,c())})}function Ms(e){const t=e&&e.settings;if(!(t&&"tabindex"in t))return;const s=Math.min(32767,Number(t.tabindex));Number.isInteger(s)&&e.on("init",function(e){return function(){const t=document.getElementById("".concat(this.id,"_ifr"));t&&t.setAttribute("tabIndex",e)}}(s))}var Ls=s("./node_modules/debug/src/browser.js"),As=s.n(Ls),Us=s("./client/state/analytics/actions.js"),qs=s("./client/components/tinymce/plugins/wpcom-track-paste/sources.js");const Fs=As()("calypso:tinymce-plugins:wpcom-track-paste");function Bs(e){Fs("init");const t=e.getParam("redux_store"),s=e=>"application/x-vnd.google-docs-image-clip+wrapped"===e||"application/x-vnd.google-docs-document-slice-clip+wrapped"===e,n=(e,n)=>{Fs("track paste event");const i=Array.from(n),o=(e=>e.some(s)?qs.a:qs.b)(i);t.dispatch(Object(Us.k)(Object(Us.i)("calypso_editor_content_paste",{mode:e,types:i.join(", "),source:o}),Object(Ss.j)(o)))},i=e=>e.clipboardData&&n("visual-editor",e.clipboardData.types),o=e=>e.clipboardData&&n("html-editor",e.clipboardData.types);e.on("paste",i);const a=e.getParam("textarea");a&&a.addEventListener("paste",o),e.on("remove",()=>{e.off("paste",i),a.removeEventListener("paste",o)})}function zs(e){e.on("init",function(){e.$(".mce-toolbar:not(.mce-menubar)",document.body).each((e,t)=>{t.addEventListener("touchstart",e=>{e.stopImmediatePropagation()})}),e.$([e.$(".mce-inline-toolbar-grp .mce-container-body",document.body),e.$(".mce-toolbar-grp",e.theme.panel.getEl())]).each((t,s)=>{s.on("scroll",Object(y.throttle)(t=>{let s,n=t.target;if(n.scrollLeft===n.scrollWidth-n.clientWidth?s="add":R.a.DOM.hasClass(n,"is-scrolled-full")&&(s="remove"),s){const t=e.$(n);t.hasClass("mce-container-body")||t.add(R.a.DOM.getParent(n,".mce-container-body")),t[s+"Class"]("is-scrolled-full")}},200))}),function(){function t(){e.$(".mce-toolbar-grp",e.theme.panel.getEl()).each((t,s)=>{const n=s.scrollWidth>s.clientWidth;e.$(s).toggleClass("is-scrollable",n)})}window.addEventListener("resize",Object(y.throttle)(t,200)),t(),e.on("wptoolbar",t=>{setTimeout(()=>{if(!t.toolbar||!t.toolbar.visible())return;const s=t.toolbar.getEl(),n=s.firstChild.scrollWidth>s.clientWidth;e.dom.toggleClass(s,"is-scrollable",n)},0)})}()})}var Vs=s("./client/state/current-user/selectors.js");const Hs=As()("calypso:posts:stats"),Ws=Math.random()<=.01||!1;function Gs(e){Ws&&ss.default.mc.bumpStat("editor-button","calypso_"+e),ss.default.ga.recordEvent("Editor","Clicked TinyMCE Button",e),Hs("TinyMCE button click",e,"mc=",Ws)}function Ys(e){function t(t,s){return Yt()(t.target,s,e.container)}function s(s){if(t(s,".mce-colorbutton")&&!t(s,".mce-open"))Gs("forecolor_pick_current");else if(t(s,".mce-listbox"))Gs("format_dropdown");else if(Yt()(s.target,".mce-menu-item")){const t=e.getParam("redux_store");if("en"===(t?Object(Vs.h)(t.getState()):"en")){Gs("format_dropdown_"+Yt()(s.target,".mce-menu-item").textContent.toLowerCase().trim().replace(/[^a-z0-9]+/g,"_"))}else Gs("format_dropdown_non_english")}}Object.keys(e.buttons).forEach(s=>{const n=e.buttons[s],i=n.onPostRender;n.onPostRender=function(){this.on("click",e=>{let n=s.replace(/^(wp|wpcom)_/,"");"forecolor"===s&&(n=t(e,".mce-open")?"forecolor_toggle":t(e,".mce-custom-color-btn")?"forecolor_pick_custom":t(e,".mce-colorbtn-trans")?"forecolor_remove":"forecolor_pick_color"),Gs(n)}),"function"==typeof i&&i.apply(this,Array.prototype.slice.call(arguments))}}),e.on("init",()=>{e.dom.bind(document.body,"click",s)}),e.on("remove",()=>{e.dom.unbind(document.body,"click",s)})}class Ks extends m.a.Component{constructor(){super(...arguments),S()(this,"splitMessage",()=>{return this.props.message.split("\n\n").map((e,t)=>m.a.createElement("p",{key:"alert-"+t},e))}),S()(this,"getButtons",()=>[m.a.createElement(De.a,{isPrimary:!1,"aria-label":this.props.translate("Dismiss alert message"),onClick:this.props.onClose},this.props.translate("OK"))])}render(){return m.a.createElement(ke.a,{isVisible:this.props.isVisible,additionalClassNames:"editor-alert-modal",onClose:this.props.onClose,buttons:this.getButtons()},this.splitMessage())}}S()(Ks,"displayName","Alert"),S()(Ks,"propTypes",{isVisible:T.a.bool.isRequired,onClose:T.a.func.isRequired,message:T.a.string.isRequired});var $s=Object(h.localize)(Ks);function Qs(e){let t;e.on("init",function(){(t=document.createElement("div")).setAttribute("class","alert-container"),e.getContainer().appendChild(t),e.windowManager.alert=((s,n,i)=>{function o(){a("hide"),"function"==typeof n?n.call(i||e.windowManager):e.focus()}function a(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"show";I.a.render(m.a.createElement($s,{isVisible:"show"===n,onClose:o,message:e.editorManager.i18n.translate(s)}),t)}a("show")}),e.notificationManager.open=(t=>{e.windowManager.alert(t.text)})}),e.on("remove",function(){I.a.unmountComponentAtNode(t),t.parentNode.removeChild(t),t=null})}var Js=s("./client/components/section-header/index.jsx"),Zs=s("./client/components/card/index.jsx"),Xs=s("./client/components/forms/form-input-validation/index.jsx"),en=s("./client/components/forms/form-setting-explanation/index.jsx"),tn=s("./node_modules/email-validator/index.js"),sn=s.n(tn);function nn(e){const t=e?e.split(",").map(e=>e.trim()):[];return Object(y.every)(t,sn.a.validate)}class on extends m.a.Component{constructor(){super(...arguments),S()(this,"onToChange",e=>{this.props.onUpdate({to:e.target.value})}),S()(this,"onSubjectChange",e=>{this.props.onUpdate({subject:e.target.value})})}render(){const e=!nn(this.props.to);return m.a.createElement("div",{className:"editor-contact-form-modal-settings"},m.a.createElement(Js.a,{label:this.props.translate("Contact Form Notification Settings")}),m.a.createElement(Zs.a,null,m.a.createElement("p",null,"post"===this.props.postType?this.props.translate("If you don’t make any changes here, feedback will be sent to the author of the post and the subject will be the name of this post."):this.props.translate("If you don’t make any changes here, feedback will be sent to the author of the page and the subject will be the name of this page.")),m.a.createElement(vs.a,null,m.a.createElement(js.a,null,this.props.translate("Enter your email address")),m.a.createElement(de.a,{value:this.props.to,placeholder:this.props.email,isError:e,onChange:this.onToChange}),e&&m.a.createElement(Xs.a,{isError:!0,text:this.props.translate("%(email)s is not a valid email address.",{args:{email:this.props.to}})}),m.a.createElement(en.a,null,this.props.translate("You can enter multiple email addresses in the Email address field, and separate them with commas. A notification email will then be sent to each email address."))),m.a.createElement(vs.a,null,m.a.createElement(js.a,null,this.props.translate("What should the subject line be?")),m.a.createElement(de.a,{value:this.props.subject,placeholder:this.props.title,onChange:this.onSubjectChange}))))}}S()(on,"displayName","ContactFormDialogFormSettings"),S()(on,"propTypes",{to:T.a.string,subject:T.a.string,email:T.a.string,title:T.a.string,onUpdate:T.a.func.isRequired});var an=Object(h.localize)(on),rn=s("./client/components/section-nav/index.jsx"),cn=s("./client/components/section-nav/tabs.jsx"),ln=s("./client/components/section-nav/item.jsx");class dn extends m.a.Component{render(){return m.a.createElement(rn.a,{selectedText:"Form Fields"},m.a.createElement(cn.a,null,["fields","settings"].map(e=>m.a.createElement(ln.a,{key:"contact-form-"+e,selected:this.props.activeTab===e,count:"fields"===e?this.props.fieldCount:null,onClick:()=>this.props.onChangeTabs(e)},"fields"===e?this.props.translate("Form Fields"):this.props.translate("Settings")))))}}S()(dn,"displayName","ContactFormDialogNavigation"),S()(dn,"propTypes",{fieldCount:T.a.number.isRequired,activeTab:T.a.oneOf(["fields","settings"]).isRequired,onChangeTabs:T.a.func.isRequired});var pn=Object(h.localize)(dn),un=s("./client/components/empty-content/index.jsx");const mn={name:()=>g.a.translate("Name"),email:()=>g.a.translate("Email Address"),checkbox:()=>g.a.translate("Checkbox"),select:()=>g.a.translate("Dropdown"),radio:()=>g.a.translate("Radio Button"),text:()=>g.a.translate("Text"),textarea:()=>g.a.translate("Text Area"),url:()=>g.a.translate("Web Address")};var hn=function(e){return mn.hasOwnProperty(e)?mn[e].call():null};class gn extends m.a.Component{constructor(){super(...arguments),S()(this,"getLegend",()=>{if(this.props.options){const e=this.props.options.split(",").length;return this.props.required?this.props.translate('Required field "%(fieldName)s" with %(numOption)d option','Required field "%(fieldName)s" with %(numOption)d options',{count:e,args:{fieldName:hn(this.props.type),numOption:e},comment:"Explains to the user the field settings. If required, type, and how many options it has."}):this.props.translate('Optional field "%(fieldName)s" with %(numOption)d option','Optional field "%(fieldName)s" with %(numOption)d options',{count:e,args:{fieldName:hn(this.props.type),numOption:e},comment:"Explains to the user the field settings. If required, type, and how many options it has."})}return this.props.required?this.props.translate('Required field "%(fieldName)s"',{args:{fieldName:hn(this.props.type)},comment:"Explain to the user the field settings for fields other than dropdown and select list."}):this.props.translate('Optional field "%(fieldName)s"',{args:{fieldName:hn(this.props.type)},comment:"Explain to the user the field settings for fields other than dropdown and select list."})})}render(){return m.a.createElement("div",{className:"editor-contact-form-modal-field-header"},m.a.createElement("div",null,this.props.label),m.a.createElement("div",null,m.a.createElement("small",null,this.getLegend())))}}S()(gn,"displayName","ContactFormDialogFieldHeader"),S()(gn,"propTypes",{label:T.a.string.isRequired,type:T.a.string.isRequired,options:T.a.string,required:T.a.bool});var bn=Object(h.localize)(gn),fn=s("./client/components/foldable-card/index.jsx"),yn=s("./client/components/forms/form-checkbox/index.jsx"),En=s("./client/components/select-dropdown/index.jsx"),vn=s("./client/components/select-dropdown/item.jsx"),jn=s("./client/components/token-field/index.jsx");class _n extends m.a.PureComponent{constructor(){super(...arguments),S()(this,"state",{showTooltip:!1})}render(){return m.a.createElement("div",null,m.a.createElement(q.a,{ref:"removeField",borderless:!0,onMouseEnter:()=>this.setState({showTooltip:!0}),onMouseLeave:()=>this.setState({showTooltip:!1}),onClick:this.props.onRemove},m.a.createElement(A.a,{icon:"trash",className:"editor-contact-form-modal-field__remove"})),m.a.createElement(me.a,{isVisible:this.state.showTooltip,context:this.refs&&this.refs.removeField,onClose:()=>{},position:"bottom",className:"popover tooltip is-dialog-visible"},this.props.translate("Remove Field",{context:"button tooltip"})))}}S()(_n,"displayName","ContactFormDialogFieldRemoveButton"),S()(_n,"propTypes",{onRemove:T.a.func.isRequired});var xn=Object(h.localize)(_n);class wn extends u.PureComponent{constructor(){super(...arguments),this.state={showTooltip:!1},this.handleMouseEnter=this.handleMouseEnter.bind(this),this.handleMouseLeave=this.handleMouseLeave.bind(this)}handleMouseEnter(){this.setState({showTooltip:!0})}handleMouseLeave(){this.setState({showTooltip:!1})}render(){const e=this.props,t=e.expanded,s=e.translate,n=D()("editor-contact-form-modal-field__edit",{"is-expanded":t});return m.a.createElement("div",{className:"editor-contact-form-modal-field__edit-wrapper foldable-card__expand"},m.a.createElement(q.a,{className:"editor-contact-form-modal-field__edit-wrapper-button",ref:"editField",borderless:!0,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave},m.a.createElement(A.a,{icon:"pencil",className:n})),m.a.createElement(me.a,{isVisible:this.state.showTooltip,context:this.refs&&this.refs.editField,onClose:y.noop,position:"bottom",className:"popover tooltip is-dialog-visible"},s("Edit Field",{context:"button tooltip"})))}}S()(wn,"propTypes",{expanded:T.a.bool.isRequired});var Sn=Object(h.localize)(wn);const Cn=["checkbox","select","email","name","radio","text","textarea","url"];class In extends m.a.PureComponent{constructor(){super(...arguments),S()(this,"renderOptions",()=>{if("radio"!==this.props.type&&"select"!==this.props.type)return;let e=this.props.options;const t=!(e=e?e.split(","):[])||0===e.length;return m.a.createElement(vs.a,null,m.a.createElement(js.a,null,this.props.translate("Options")),m.a.createElement(jn.a,{value:e,onChange:e=>this.props.onUpdate({options:e.join()})}),t&&m.a.createElement(Xs.a,{isError:!0,text:this.props.translate("Options can not be empty.")}),m.a.createElement(en.a,null,"Insert an option and press enter."))}),S()(this,"onLabelChange",e=>{this.props.onUpdate({label:e.target.value})}),S()(this,"handleCardOpen",()=>{this.props.onUpdate({isExpanded:!0})}),S()(this,"handleCardClose",()=>{this.props.onUpdate({isExpanded:!1})})}render(){const e=!this.props.label,t=m.a.createElement(xn,{onRemove:this.props.onRemove});return m.a.createElement(fn.a,{header:m.a.createElement(bn,Object(y.omit)(this.props,["onUpdate"])),summary:t,expandedSummary:t,expanded:this.props.isExpanded,onClose:this.handleCardClose,onOpen:this.handleCardOpen,actionButton:m.a.createElement(Sn,{expanded:!1}),actionButtonExpanded:m.a.createElement(Sn,{expanded:!0})},m.a.createElement(vs.a,null,m.a.createElement(js.a,null,this.props.translate("Field Label")),m.a.createElement(de.a,{value:this.props.label,onChange:this.onLabelChange,isError:e}),e&&m.a.createElement(Xs.a,{isError:!0,text:this.props.translate("Field Label can not be empty.")})),m.a.createElement(vs.a,null,m.a.createElement(js.a,null,this.props.translate("Field Type")),m.a.createElement(En.a,{selectedText:hn(this.props.type)},Cn.map(e=>m.a.createElement(vn.a,{key:"field-type-"+e,selected:this.props.type===e,onClick:()=>this.props.onUpdate({type:e})},hn(e))))),m.a.createElement(vs.a,null,m.a.createElement(js.a,null,m.a.createElement(yn.a,{checked:this.props.required,onChange:()=>this.props.onUpdate({required:!this.props.required})}),m.a.createElement("span",null,this.props.translate("Required")))),this.renderOptions())}}S()(In,"displayName","ContactFormDialogField"),S()(In,"propTypes",{label:T.a.string.isRequired,type:T.a.string.isRequired,options:T.a.string,required:T.a.bool,onUpdate:T.a.func.isRequired,onRemove:T.a.func.isRequired,isExpanded:T.a.bool});var On=Object(h.localize)(In);class Tn extends m.a.Component{render(){return this.props.fields.length>0?m.a.createElement("div",{className:"editor-contact-form-modal-fields"},this.props.fields.map((e,t)=>m.a.createElement(On,x()({key:t},e,{onRemove:()=>this.props.onFieldRemove(t),onUpdate:e=>this.props.onFieldUpdate(t,e)})))):m.a.createElement(un.a,{title:null,line:this.props.translate("An empty form is no fun! Go ahead and add some fields!"),action:this.props.translate("Add New Field"),actionCallback:this.props.onFieldAdd,isCompact:!0})}}S()(Tn,"displayName","ContactFormDialogFieldList"),S()(Tn,"propTypes",{fields:T.a.array.isRequired,onFieldAdd:T.a.func.isRequired,onFieldRemove:T.a.func.isRequired,onFieldUpdate:T.a.func.isRequired});var Pn=Object(h.localize)(Tn);class kn extends m.a.Component{constructor(){super(...arguments),S()(this,"getActionButtons",()=>{const e=function(e){return!(!Array.isArray(e)||0===e.length)&&Object(y.every)(e,e=>"radio"!==e.type&&"select"!==e.type?!!e.label:!!e.label&&!!e.options)}(this.props.contactForm.fields)&&nn(this.props.contactForm.to),t=[m.a.createElement(De.a,{key:"save","data-e2e-button":"save",disabled:!e,onClick:this.props.onInsert},this.props.isEdit?this.props.translate("Update"):this.props.translate("Insert")),m.a.createElement(De.a,{key:"cancel",isPrimary:!1,"data-e2e-button":"cancel",onClick:this.props.onClose},this.props.translate("Cancel"))];return"fields"===this.props.activeTab?[m.a.createElement("div",{key:"secondaryActions",className:"editor-contact-form-modal__secondary-actions"},m.a.createElement(De.a,{key:"add",isPrimary:!1,"data-e2e-button":"add",onClick:this.props.onFieldAdd},this.props.translate("Add New Field"))),...t]:t})}render(){const e=this.props,t=e.activeTab,s=e.currentUser.email,n=e.post,i=e.contactForm,o=i.to,a=i.subject,r=i.fields,c=e.showDialog,l=e.onChangeTabs,d=e.onClose,p=e.onFieldAdd,u=e.onFieldUpdate,h=e.onFieldRemove,g=e.onSettingsUpdate,b=Object(y.get)(n,"title",null),f=Object(y.get)(n,"type",null),E="fields"===t?m.a.createElement(Pn,{fields:r,onFieldAdd:p,onFieldRemove:h,onFieldUpdate:u}):m.a.createElement(an,{to:o,subject:a,email:s,title:b,postType:f,onUpdate:g});return m.a.createElement(ke.a,{isVisible:c,onClose:d,buttons:this.getActionButtons(),additionalClassNames:"editor-contact-form-modal"},m.a.createElement(pn,{activeTab:t,onChangeTabs:l,fieldCount:r.length}),E)}}S()(kn,"displayName","ContactFormDialog"),S()(kn,"propTypes",{activeTab:T.a.oneOf(["fields","settings"]).isRequired,showDialog:T.a.bool.isRequired,isEdit:T.a.bool.isRequired,contactForm:T.a.shape({to:T.a.string,subject:T.a.string,fields:T.a.array.isRequired}).isRequired,onInsert:T.a.func.isRequired,onChangeTabs:T.a.func.isRequired,onClose:T.a.func.isRequired,onFieldAdd:T.a.func.isRequired,onFieldRemove:T.a.func.isRequired,onFieldUpdate:T.a.func.isRequired,onSettingsUpdate:T.a.func.isRequired});var Dn=Object(P.b)(e=>{const t=Object(B.e)(e),s=Object(z.f)(e);return{post:Object(V.a)(e,t,s),currentUser:Object(Vs.b)(e),contactForm:e.ui.editor.contactForm}})(Object(h.localize)(kn));function Nn(){return{type:"EDITOR_CONTACT_FORM_FIELD_ADD"}}function Rn(e){return{type:"EDITOR_CONTACT_FORM_FIELD_REMOVE",index:e}}function Mn(e,t){return{type:"EDITOR_CONTACT_FORM_FIELD_UPDATE",index:e,field:t}}function Ln(e){return{type:"EDITOR_CONTACT_FORM_SETTINGS_UPDATE",settings:e}}function An(e){let t;const s=e.getParam("redux_store");e.on("init",()=>{t=e.getContainer().appendChild(document.createElement("div"))}),e.on("remove",()=>{Object(C.unmountComponentAtNode)(t),t.parentNode.removeChild(t),t=null}),e.addCommand("wpcomContactForm",n=>{let i=!1;n?(s.dispatch(function(e){return{type:"EDITOR_CONTACT_FORM_LOAD",contactForm:e}}(it(n))),i=!0):s.dispatch({type:"EDITOR_CONTACT_FORM_CLEAR"}),function n(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"show",a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"fields";Object(qt.b)(Object(u.createElement)(Dn,{showDialog:"show"===o,activeTab:a,isEdit:i,onInsert(){const t=s.getState();e.execCommand("mceInsertContent",!1,nt(t.ui.editor.contactForm)),n("hide")},onChangeTabs(e){n("show",e)},onClose(){s.dispatch({type:"EDITOR_CONTACT_FORM_CLEAR"}),e.focus(),n("hide")},onFieldAdd(){s.dispatch({type:"EDITOR_CONTACT_FORM_FIELD_ADD"})},onFieldRemove(e){s.dispatch(Rn(e))},onFieldUpdate(e,t){s.dispatch(Mn(e,t))},onSettingsUpdate(e){s.dispatch(Ln(e))}}),t,s)}()}),e.addButton("wpcom_add_contact_form",{classes:"btn wpcom-icon-button contact-form",title:g.a.translate("Add Contact Form"),cmd:"wpcomContactForm",onPostRender(){this.innerHtml(Object(d.renderToStaticMarkup)(m.a.createElement("button",{type:"button",role:"presentation"},m.a.createElement(A.a,{icon:"mention"}))))}})}var Un=s("./client/components/tinymce/plugins/simple-payments/dialog/index.jsx");function qn(e){let t;const s=e.getParam("redux_store");e.on("init",()=>{t=e.getContainer().appendChild(document.createElement("div"))}),e.on("remove",()=>{Object(C.unmountComponentAtNode)(t),t.parentNode.removeChild(t),t=null}),e.addCommand("simplePaymentsButton",n=>{let i=null;if(n){const e=It(n);i=e.id||null}!function n(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"show";Object(qt.b)(Object(u.createElement)(Un.a,{showDialog:"show"===o,editPaymentId:i,onInsert(t){e.execCommand("mceInsertContent",!1,Ct(t)),n("hide")},onClose(){e.focus(),n("hide")}}),t,s)}()})}function Fn(){this.ignore_types=["Bias Language","Cliches","Complex Expression","Diacritical Marks","Double Negatives","Hidden Verbs","Jargon Language","Passive voice","Phrases to Avoid","Redundant Expression"],this.ignore_strings={},this.i18n={}}function Bn(e){this.tokens=e,this.index=0,this.count=0,this.last=0}Fn.prototype.setIgnoreStrings=function(e){const t=this;"string"==typeof e&&(e=e.split(/,\s*/g)),this.map(e,function(e){t.ignore_strings[e]=1})},Fn.prototype.showTypes=function(e){let t=e.split(/,\s*/g),s={},n=[];s["Double Negatives"]=1,s["Hidden Verbs"]=1,s["Passive voice"]=1,s["Bias Language"]=1,s.Cliches=1,s["Complex Expression"]=1,s["Diacritical Marks"]=1,s["Jargon Language"]=1,s["Phrases to Avoid"]=1,s["Redundant Expression"]=1,this.map(t,function(e){s[e]=void 0}),this.map(this.ignore_types,function(e){void 0!==s[e]&&n.push(e)}),this.ignore_types=n},Fn.prototype.makeError=function(e,t,s,n){const i={};return i.type=s,i.string=e,i.tokens=t,new RegExp("\\b"+e+"\\b").test(e)?i.regexp=new RegExp("(?!"+e+"<)\\b"+e.replace(/\s+/g,n)+"\\b"):new RegExp(e+"\\b").test(e)?i.regexp=new RegExp("(?!"+e+"<)"+e.replace(/\s+/g,n)+"\\b"):new RegExp("\\b"+e).test(e)?i.regexp=new RegExp("(?!"+e+"<)\\b"+e.replace(/\s+/g,n)):i.regexp=new RegExp("(?!"+e+"<)"+e.replace(/\s+/g,n)),i.used=!1,i},Fn.prototype.addToErrorStructure=function(e,t,s,n){const i=this;this.map(t,function(t){const o=t.word.split(/\s+/),a=t.pre,r=o[0];void 0===e["__"+r]&&(e["__"+r]={},e["__"+r].pretoks={},e["__"+r].defaults=[]),""===a?e["__"+r].defaults.push(i.makeError(t.word,o,s,n,a)):(void 0===e["__"+r].pretoks["__"+a]&&(e["__"+r].pretoks["__"+a]=[]),e["__"+r].pretoks["__"+a].push(i.makeError(t.word,o,s,n,a)))})},Fn.prototype.buildErrorStructure=function(e,t,s){const n=this._getSeparators(),i={};return this.addToErrorStructure(i,e,"hiddenSpellError",n),this.addToErrorStructure(i,s,"hiddenGrammarError",n),this.addToErrorStructure(i,t,"hiddenSuggestion",n),i},Fn.prototype._getSeparators=function(){let e,t="";const s='"s!#$%&()*+,./:;<=>?@[\\]^_{|}';for(e=0;e<s.length;e++)t+="\\"+s.charAt(e);return"(?:(?:[ "+t+"])|(?:\\-\\-))+"},Fn.prototype.processXML=function(e){let t,s,n,i,o,a,r,c,l,d,p,u,m,g,b,f;for(t={},this.map(this.ignore_types,function(e){t[e]=1}),this.suggestions=[],s=e.getElementsByTagName("error"),n=[],i=[],o=[],a=0;a<s.length;a++)if(null!==s[a].getElementsByTagName("string").item(0).firstChild&&(r=s[a].getElementsByTagName("string").item(0).firstChild.data,c=s[a].getElementsByTagName("type").item(0).firstChild.data,l=s[a].getElementsByTagName("description").item(0).firstChild.data,d=null!==s[a].getElementsByTagName("precontext").item(0).firstChild?s[a].getElementsByTagName("precontext").item(0).firstChild.data:"",void 0===this.ignore_strings[r])){if((p={}).description=l,p.suggestions=[],p.matcher=new RegExp("^"+r.replace(/\s+/,this._getSeparators())+"$"),p.context=d,p.string=r,p.type=c,this.suggestions.push(p),null!==s[a].getElementsByTagName("suggestions").item(0))for(u=s[a].getElementsByTagName("suggestions").item(0).getElementsByTagName("option"),m=0;m<u.length;m++)p.suggestions.push(u[m].firstChild.data);null!==s[a].getElementsByTagName("url").item(0)&&(g=s[a].getElementsByTagName("url").item(0).firstChild.data,p.moreinfo=g+"&theme=tinymce"),void 0===t[l]&&("suggestion"===c&&o.push({word:r,pre:d}),"grammar"===c&&n.push({word:r,pre:d})),"spelling"!==c&&"Homophone"!==l||i.push({word:r,pre:d}),"Cliches"===l&&(p.description="Clichés"),"Spelling"===l&&(p.description=Object(h.translate)("Spelling",{comment:"Proofreading error description"})),"Repeated Word"===l&&(p.description=Object(h.translate)("Repeated Word",{comment:"Proofreading error description"})),"Did you mean..."===l&&(p.description=Object(h.translate)("Did you mean…",{comment:"Proofreading error description"}))}return{errors:b=(f=i.length+n.length+o.length)>0?this.buildErrorStructure(i,o,n):void 0,count:f,suggestions:this.suggestions}},Fn.prototype.findSuggestion=function(e){let t,s,n=e.innerHTML,i=(this.getAttrib(e,"pre")+"").replace(/[\\,!\\?\\."\s]/g,""),o=this.suggestions.length;for(s=0;s<o;s++)if((""===i||i===this.suggestions[s].context)&&this.suggestions[s].matcher.test(n)){t=this.suggestions[s];break}return t},Bn.prototype.next=function(){let e=this.tokens[this.index];return this.count=this.last,this.last+=e.length+1,this.index++,""!==e&&("'"===e[0]&&(e=e.substring(1,e.length)),"'"===e[e.length-1]&&(e=e.substring(0,e.length-1))),e},Bn.prototype.hasNext=function(){return this.index<this.tokens.length},Bn.prototype.hasNextN=function(e){return this.index+e<this.tokens.length},Bn.prototype.skip=function(e,t){this.index+=e,this.last+=t,this.index<this.tokens.length&&(this.count=this.last-this.tokens[this.index].length)},Bn.prototype.getCount=function(){return this.count},Bn.prototype.peek=function(e){let t,s=[],n=this.index+e;for(t=this.index;t<n;t++)s.push(this.tokens[t]);return s},Fn.prototype.markMyWords=function(e,t){let s,n,i=new RegExp(this._getSeparators()),o=[],a=0,r=this,c=this._isTinyMCE?' data-mce-bogus="1"':"",l='<span class="mceItemHidden"'+c+">&nbsp;</span>";function d(e,t,s){let n,i=e.nodeValue,o=i.search(t),a=i.match(t),c=[];return o<0||!a.length?[e]:(o>0&&c.push(document.createTextNode(i.substr(0,o))),c.push(r.create(a[0].replace(t,s))),(n=o+a[0].length)<i.length&&c.push(document.createTextNode(i.substr(n))),c)}return this._walk(e,function(e){3!==e.nodeType||r.isMarkedNode(e)||o.push(e)}),this.map(o,function(e){let o,p,u,m,h,g,b,f,y,E,v,j,_,x,w,S,C,I,O={};if(3===e.nodeType){for(o=e.nodeValue,p=e.nodeValue.split(i),u="",m=[],n=new Bn(p);n.hasNext();){if(h=n.next(),void 0!==(g=t["__"+h])&&void 0!==g.pretoks){function T(e){void 0!==e&&!e.used&&void 0===O["__"+e.string]&&e.regexp.test(E)&&(O["__"+e.string]=1,m.push([e.regexp,'<span class="'+e.type+'" pre="'+u+'"'+c+">$&</span>"]),e.used=!0,f=!0)}b=g.defaults,g=g.pretoks["__"+u],f=!1,y=o.substr(0,n.getCount()),E=o.substr(y.length,o.length),void 0!==g&&(u+=" ",r.map(g,T)),f||(u="",r.map(b,T))}u=h}if(m.length>0){for(v=e,j=0;j<m.length;j++){function P(e){let t,n;if(3===e.nodeType){if(a++,r.isIE()&&e.nodeValue.length>0&&" "===e.nodeValue.substr(0,1))return r.create(l+e.nodeValue.substr(1,e.nodeValue.length-1).replace(_,x),!1);if(s)return r.create(e.nodeValue.replace(_,x),!1);if(t=r.create("<span />"),void 0===s&&(s="function"!=typeof t.appendChild))return r.remove(t),r.create(e.nodeValue.replace(_,x),!1);for(n=d(e,_,x),w=0;w<n.length;w++)t.appendChild(n[w]);return e=t}for(S=r.contents(e),C=0;C<S.length;C++)if(3===S[C].nodeType&&_.test(S[C].nodeValue))return I=r.isIE()&&S[C].nodeValue.length>0&&" "===S[C].nodeValue.substr(0,1)?r.create(l+S[C].nodeValue.substr(1,S[C].nodeValue.length-1).replace(_,x),!0):r.create(S[C].nodeValue.replace(_,x),!0),r.replaceWith(S[C],I),r.removeParent(I),a++,e;return e}_=m[j][0],x=m[j][1],v=P(v)}r.replaceWith(e,v)}}}),a},Fn.prototype._walk=function(e,t){let s;for(s=0;s<e.length;s++)t.call(t,e[s]),this._walk(this.contents(e[s]),t)},Fn.prototype.removeWords=function(e,t){let s=0;const n=this;return this.map(this.findSpans(e).reverse(),function(e){let i;e&&(n.isMarkedNode(e)||n.hasClass(e,"mceItemHidden")||n.isEmptySpan(e))&&("&nbsp;"===e.innerHTML?(i=document.createTextNode(" "),n.replaceWith(e,i)):t&&e.innerHTML!==t||(n.removeParent(e),s++))}),s},Fn.prototype.isEmptySpan=function(e){return""===this.getAttrib(e,"class")&&""===this.getAttrib(e,"style")&&""===this.getAttrib(e,"id")&&!this.hasClass(e,"Apple-style-span")&&""===this.getAttrib(e,"mce_name")},Fn.prototype.isMarkedNode=function(e){return this.hasClass(e,"hiddenGrammarError")||this.hasClass(e,"hiddenSpellError")||this.hasClass(e,"hiddenSuggestion")},Fn.prototype.applySuggestion=function(e,t){let s;"(omit)"===t?this.remove(e):(s=this.create(t),this.replaceWith(e,s),this.removeParent(s))},Fn.prototype.hasErrorMessage=function(e){return void 0!==e&&null!==e.getElementsByTagName("message").item(0)},Fn.prototype.getErrorMessage=function(e){return e.getElementsByTagName("message").item(0)},Fn.prototype.isIE=function(){return"Microsoft Internet Explorer"===navigator.appName};var zn=Fn,Vn=s("./node_modules/store/dist/store.modern.js"),Hn=s.n(Vn),Wn=s("./client/lib/preferences/constants.js"),Gn=s("./client/lib/user/utils.js");const Yn=Je.a.undocumented(),Kn={};let $n=0;function Qn(){return Hn.a.get(Wn.a.LOCALSTORAGE_KEY)}Kn.mergePreferencesToLocalStorage=function(e){const t=Qn()||{};Object(y.forOwn)(e,function(e,s){null===e?delete t[s]:t[s]=e}),Hn.a.set(Wn.a.LOCALSTORAGE_KEY,t)},Kn.fetch=function(){const e=Qn();Gn.default.isLoggedIn()&&(Ge.a.handleViewAction({type:"FETCH_ME_SETTINGS"}),e&&Ge.a.handleServerAction({type:"RECEIVE_ME_SETTINGS",data:{[Wn.a.USER_SETTING_KEY]:e}}),Yn.me().settings().get(function(e,t){!e&&t&&Kn.mergePreferencesToLocalStorage(t[Wn.a.USER_SETTING_KEY]),Ge.a.handleServerAction({type:"RECEIVE_ME_SETTINGS",error:e,data:t})}))},Kn.set=function(e,t){let s={},n={};s[e]=t,n[Wn.a.USER_SETTING_KEY]=s,Ge.a.handleViewAction({type:"UPDATE_ME_SETTINGS",data:n}),Kn.mergePreferencesToLocalStorage(s),$n++,Yn.me().settings().update(JSON.stringify(n),function(e,t){--$n||Ge.a.handleServerAction({type:"RECEIVE_ME_SETTINGS",error:e,data:t})})},Kn.remove=function(e){Kn.set(e,null)};var Jn=Kn,Zn=s("./client/lib/preferences/store.js");const Xn="service.afterthedeadline.com",ei=["en","pt","de","es","fr"],ti="editorProofreadIgnore";function si(e){let t,s,n,i,o=R.a.each;const a=R.a.ui.Menu.extend({init(e){e.context="contextmenu",e.autofix=!1,this.throttledReposition=Object(y.throttle)(this.reposition.bind(this),200),this.on("autohide",e=>e.preventDefault()),this.boundHideIfNotMarked=this.hideIfNotMarked.bind(this),this._super(e)},hideIfNotMarked(e){r(e.target)||this.hide()},hide(){this._super(),this.remove(),window.removeEventListener("scroll",this.throttledReposition),e.off("SpellcheckEnd click touchstart focusout",this.boundHideIfNotMarked)},postRender(){this._super(),this.reposition(),window.addEventListener("scroll",this.throttledReposition),e.on("SpellcheckEnd click touchstart focusout",this.boundHideIfNotMarked)},reposition(){const t=e.dom.getRoot(),s=R.a.DOM.getPos(e.getContentAreaContainer()),n=e.dom.getPos(this.settings.target);"BODY"===t.nodeName?(n.x-=t.ownerDocument.documentElement.scrollLeft||t.scrollLeft,n.y-=t.ownerDocument.documentElement.scrollTop||t.scrollTop):(n.x-=t.scrollLeft,n.y-=t.scrollTop),s.x+=n.x,s.y+=n.y,this.moveTo(s.x,s.y+this.settings.target.offsetHeight)}});function r(e){return e.className&&/\bhidden(GrammarError|SpellError|Suggestion)\b/.test(e.className)}function c(){e.dom.select("span.hiddenSpellError, span.hiddenGrammarError, span.hiddenSuggestion").length||(t&&t.hide(),d())}function l(t,s,n){n?o(e.dom.select("span.hiddenSpellError, span.hiddenGrammarError, span.hiddenSuggestion"),function(e){(e.innerText||e.textContent)===s&&i.remove(e,!0)}):e.dom.remove(t,!0),c()}function d(){let t,n=new RegExp("mceItemHidden|hidden(((Grammar|Spell)Error)|Suggestion)"),i=e.dom.select("span"),o=i.length;for(;o--;)(t=i[o]).className&&n.test(t.className)&&e.dom.remove(t,!0);e.setContent(e.getContent({format:"raw"}),{format:"raw"}),s=!1,e.nodeChanged(),e.fire("SpellcheckEnd")}function p(t,s,n){e.setProgressState(!0);const i=new XMLHttpRequest;i.open("POST","https://".concat(function(){const e=Object(h.getLocaleSlug)(),t=Object(y.find)(ei,t=>e===t||0===e.indexOf(t+"-"));return t?"".concat(t,".").concat(Xn):Xn}(),"/").concat(t)),i.addEventListener("readystatechange",()=>{4===i.readyState&&(e.setProgressState(),200===i.status&&n(""+i.responseText,i))});const o=e.getParam("atd_rpc_id");i.send(Object(b.stringify)({data:s,key:o}))}function u(s){let i=[],r=s.innerText||s.textContent,d=n.findSuggestion(s);d?(i.push({text:d.description,classes:"atd-menu-title",disabled:!0}),d.suggestions.length&&(i.push({text:"-"}),o(d.suggestions,function(e){i.push({text:e,onclick:function(){n.applySuggestion(s,e),c()}})}))):i.push({text:Object(h.translate)("No suggestions",{comment:"Editor proofreading no suggestions"}),classes:"atd-menu-title",disabled:!0}),d&&d.moreinfo&&(i.push({text:"-"}),i.push({text:Object(h.translate)("Explain…",{comment:"Editor proofreading menu item"}),onclick:function(){e.windowManager.open({title:Object(h.translate)("Explain…",{comment:"Editor proofreading menu item"}),url:d.moreinfo,width:480,height:380,inline:!0})}})),i.push.apply(i,[{text:"-"},{text:Object(h.translate)("Ignore suggestion",{comment:"Editor proofreading menu item"}),onclick:function(){l(s,r)}}]),e.getParam("atd_ignore_enable")?i.push({text:Object(h.translate)("Ignore always",{comment:"Editor proofreading menu item"}),onclick:function(){!function(e){const t=Zn.a.get(ti)||[];-1===t.indexOf(e)&&t.push(e),Jn.set(ti,t)}(r),l(s,r,!0)}}):i.push({text:Object(h.translate)("Ignore all",{comment:"Editor proofreading menu item"}),onclick:function(){l(s,r,!0)}}),(t=new a({items:i,target:s})).renderTo(document.body),t.on("hide",()=>{t=null})}e.on("init",function(){i=e.dom,(n=new zn).map=o,n._isTinyMCE=!0,n.getAttrib=function(e,t){return i.getAttrib(e,t)},n.findSpans=function(e){return void 0===e?i.select("span"):i.select("span",e)},n.hasClass=function(e,t){return i.hasClass(e,t)},n.contents=function(e){return e.childNodes},n.replaceWith=function(e,t){return i.replace(t,e)},n.create=function(e){return i.create("span",{class:"mceItemHidden","data-mce-bogus":1},e)},n.removeParent=function(e){return i.remove(e,!0),e},n.remove=function(e){i.remove(e)},n.setIgnoreStrings(e.getParam("atd_ignore_strings",[]).join(",")),n.showTypes(e.getParam("atd_show_types","")),e.addCommand("mceWritingImprovementTool",function(t){let i,o=0;"function"!=typeof t&&(t=function(){}),void 0!==window.AtD_proofread_click_count&&window.AtD_proofread_click_count++,s?d():p("checkDocument",e.getContent({format:"raw"}),function(a,r){var c;(e.setProgressState(),200===r.status&&"html"!==r.responseText.substr(1,4)&&r.responseXML)?null===r.responseXML.getElementsByTagName("message").item(0)?((i=n.processXML(r.responseXML)).count>0&&(c=i.errors,o=n.markMyWords(n.contents(e.getBody()),c)),o?(s=!0,e.fire("SpellcheckStart")):e.windowManager.alert(Object(h.translate)("No writing errors were found.",{comment:"Editor proofreading success prompt"})),t(o)):e.windowManager.alert(r.responseXML.getElementsByTagName("message").item(0).firstChild.data,t(0)):e.windowManager.alert(Object(h.translate)("There was a problem communicating with the Proofreading service. Try again in one minute.",{comment:"Editor proofreading error"}),t(0))})}),!1!==e.settings.content_css&&i.addStyle(".hiddenSpellError{border-bottom:2px solid red;cursor:default;}.hiddenGrammarError{border-bottom:2px solid green;cursor:default;}.hiddenSuggestion{border-bottom:2px solid blue;cursor:default;}"),e.on("click",function(t){r(t.target)&&(t.preventDefault(),e.selection.select(t.target),u(t.target))})}),(()=>{function t(){const e=Zn.a.get(ti);e&&n.setIgnoreStrings(e)}e.getParam("atd_ignore_enable")&&(void 0===Zn.a.getAll()&&Jn.fetch(),e.on("init",()=>{Zn.a.on("change",t)}),e.on("remove",()=>{Zn.a.off("change",t)}))})(),e.on("SpellcheckStart SpellcheckEnd",t=>{e.contentDocument.body.spellcheck="spellcheckend"===t.type,e.contentDocument.body.spellcheck||(e.contentDocument.body.focus(),e.contentDocument.body.blur())}),e.addMenuItem("spellchecker",{text:Object(h.translate)("Proofread Writing",{comment:"Editor proofreading toolbar tooltip"}),context:"tools",cmd:"mceWritingImprovementTool",onPostRender:function(){const t=this;e.on("SpellcheckStart SpellcheckEnd",function(){t.active(s)})}}),e.addButton("spellchecker",{tooltip:Object(h.translate)("Proofread Writing",{comment:"Editor proofreading button tooltip"}),cmd:"mceWritingImprovementTool",onPostRender:function(){const t=this;e.on("SpellcheckStart SpellcheckEnd",function(){t.active(s)})}}),e.on("remove",function(){t&&(t.remove(),t=null)})}
/**
 * Adapted from the WordPress wptextpattern TinyMCE plugin.
 *
 *
 * Text pattern plugin for TinyMCE
 *
 *
 * This plugin can automatically format text patterns as you type. It includes two patterns:
 *  - Unordered list (`* ` and `- `).
 *  - Ordered list (`1. ` and `1) `).
 *
 * If the transformation in unwanted, the user can undo the change by pressing backspace,
 * using the undo shortcut, or the undo button in the toolbar.
 *
 * @format
 * @copyright 2015 by the WordPress contributors.
 * @license See CREDITS.md.
 * @since 4.3.0
 */
function ni(e){const t=R.a.util.VK,s=[{regExp:/^[*-]\s/,cmd:"InsertUnorderedList"},{regExp:/^1[.)]\s/,cmd:"InsertOrderedList"}],n=[{start:"##",format:"h2"},{start:"###",format:"h3"},{start:"####",format:"h4"},{start:"#####",format:"h5"},{start:"######",format:"h6"},{start:">",format:"blockquote"},{regExp:/^(-){3,}$/,element:"hr"}],i=[{start:"`",end:"`",format:"code"}];let o;const a=[];function r(){const t=e.selection.getRng();let s=t.startContainer;const n=t.startOffset;let r,c,l,d,p;s&&3===s.nodeType&&s.data.length&&n&&-1!==R.a.inArray(a,s.data.charAt(n-1))&&(r=function(e){let t,s=i.length;for(;s--;)if(l=i[s],-1!==(t=e.data.indexOf(l.end)))return t}(s),c=s.data.lastIndexOf(l.end),r!==c&&-1!==c&&(c-r<=l.start.length||-1===s.data.slice(r+l.start.length,c).indexOf(l.start.slice(0,1))&&(d=e.formatter.get(l.format))&&d[0].inline&&(e.undoManager.add(),e.undoManager.transact(function(){s.insertData(n,"​"),s=s.splitText(r),p=s.splitText(n-r),s.deleteData(0,l.start.length),s.deleteData(s.data.length-l.end.length,l.end.length),e.formatter.apply(l.format,{},s),e.selection.setCursorLocation(p,1)}),setTimeout(function(){o="space",e.once("selectionchange",function(){let e;p&&-1!==(e=p.data.indexOf("​"))&&p.deleteData(e,e+1)})}))))}function c(t){let s,n=e.dom.getParent(t,"p");if(n){for(;(s=n.firstChild)&&3!==s.nodeType;)n=s;if(s)return s.data||(s=s.nextSibling&&3===s.nextSibling.nodeType?s.nextSibling:null),s}}function l(){let t,n,i=e.selection.getRng(),a=i.startContainer;a&&c(a)===a&&(t=a.parentNode,n=a.data,R.a.each(s,function(s){const r=n.match(s.regExp);if(r&&i.startOffset===r[0].length)return e.undoManager.add(),e.undoManager.transact(function(){a.deleteData(0,r[0].length),t.innerHTML||t.appendChild(document.createElement("br")),e.selection.setCursorLocation(t),e.execCommand(s.cmd)}),setTimeout(function(){o="space"}),!1}))}R.a.each(i,function(e){R.a.each((e.start+e.end).split(""),function(e){-1===R.a.inArray(a,e)&&a.push(e)})}),e.on("selectionchange",function(){o=null}),e.on("keydown",function(s){(o&&27===s.keyCode||"space"===o&&s.keyCode===t.BACKSPACE)&&(e.undoManager.undo(),s.preventDefault(),s.stopImmediatePropagation()),s.keyCode!==t.ENTER||t.modifierPressed(s)||function(){let t,s,i,a=e.selection.getRng().startContainer,r=c(a),l=n.length;if(!r)return;t=r.data;for(;l--;)if(n[l].start){if(0===t.indexOf(n[l].start)){s=n[l];break}}else if(n[l].regExp&&n[l].regExp.test(t)){s=n[l];break}if(!s)return;if(r===a&&R.a.trim(t)===s.start)return;e.once("keyup",function(){e.undoManager.add(),e.undoManager.transact(function(){var t;s.format?(e.formatter.apply(s.format,{},r),r.replaceData(0,r.data.length,(t=r.data.slice(s.start.length))?t.replace(/^\s+/,""):"")):s.element&&(i=r.parentNode&&r.parentNode.parentNode)&&i.replaceChild(document.createElement(s.element),r.parentNode)}),setTimeout(function(){o="enter"})})}(),s.keyCode!==t.SPACEBAR||s.ctrlKey||s.metaKey||s.altKey?s.keyCode>47&&!(s.keyCode>=91&&s.keyCode<=93)&&setTimeout(r):setTimeout(l)},!0)}function ii(e){let t,s=!1,n=!1;function i(s){n=s,e.dom.toggleClass(t,"is-pinned",n)}const o=Object(y.throttle)(()=>{t&&(n&&window.pageYOffset<t.offsetTop?i(!1):!n&&window.pageYOffset>t.offsetTop&&i(!0))},50),a=Object(y.throttle)(n=>{const a=!e.isHidden(),r="remove"!==n.type&&a&&Object(ye.f)(">660px");r!==s&&(window[(r?"add":"remove")+"EventListener"]("scroll",o),(s=r)?(t=e.getContainer(),o()):i(!1))},200);e.on("init show hide remove",a),window.addEventListener("resize",a)}const oi=e=>{let t=e.icon,s=e.label,n=e.e2e;return m.a.createElement("div",{className:"wpcom-insert-menu__menu"},m.a.cloneElement(t,{className:"wpcom-insert-menu__menu-icon"}),m.a.createElement("span",{className:"wpcom-insert-menu__menu-label","data-e2e-insert-type":n},s))},ai=[{name:"insert_media_item",item:m.a.createElement(oi,{icon:m.a.createElement(A.a,{icon:"image"}),label:g.a.translate("Media"),e2e:"media"}),cmd:"wpcomAddMedia"}];function ri(e){ai.forEach(t=>e.addMenuItem(t.name,{classes:"wpcom-insert-menu__menu-item",cmd:t.cmd,onPostRender(){this.innerHtml(Object(d.renderToString)(t.item))}})),e.addButton("wpcom_insert_menu",{type:"menubutton",title:g.a.translate("Add content"),classes:"btn wpcom-insert-menu insert-menu",menu:ai.map(t=>{let s=t.name;return e.menuItems[s]}),onPostRender(){l()(this.$el[0].children,1)[0].innerHTML=Object(d.renderToString)(m.a.createElement(oi,{icon:m.a.createElement(A.a,{icon:"add-outline"}),label:g.a.translate("Add")}))}})}St.a.isEnabled("external-media")&&(St.a.isEnabled("external-media/google-photos")&&ai.push({name:"insert_from_google",item:m.a.createElement(oi,{icon:m.a.createElement(A.a,{icon:"shutter"}),label:g.a.translate("Google Photos library"),e2e:"google-media"}),cmd:"googleAddMedia"}),St.a.isEnabled("external-media/free-photo-library")&&ai.push({name:"insert_from_pexels",item:m.a.createElement(oi,{icon:m.a.createElement(A.a,{icon:"image-multiple"}),label:g.a.translate("Free photo library"),e2e:"stock-media-pexels"}),cmd:"pexelsAddMedia"})),ai.push({name:"insert_contact_form",item:m.a.createElement(oi,{icon:m.a.createElement(A.a,{icon:"mention"}),label:g.a.translate("Contact form"),e2e:"contact-form"}),cmd:"wpcomContactForm"}),ai.push({name:"insert_payment_button",item:m.a.createElement(oi,{icon:m.a.createElement(A.a,{icon:"money"}),label:g.a.translate("Payment button"),e2e:"payment-button"}),cmd:"simplePaymentsButton"}),St.a.isEnabled("memberships")&&ai.push({name:"insert_memberships_button",item:m.a.createElement(oi,{icon:m.a.createElement(A.a,{icon:"money"}),label:g.a.translate("Recurring Payment"),e2e:"memberships"}),cmd:"membershipsButton"});var ci=s("./client/components/tinymce/plugins/embed/dialog.jsx");function li(e){let t;e.addCommand("embedDialog",()=>(function s(){let n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const i=e.selection.getNode(),o=e.getParam("redux_store"),a={embedUrl:i.innerText||i.textContent,isVisible:n,onCancel:()=>s(!1),onUpdate:t=>{e.execCommand("mceInsertContent",!1,t),s(!1)}};Object(qt.b)(m.a.createElement(ci.a,a),t,o),n||e.focus()})()),e.on("init",()=>{t=e.getContainer().appendChild(document.createElement("div"))}),e.on("remove",()=>{I.a.unmountComponentAtNode(t),t.parentNode.removeChild(t),t=null})}function di(e){const t=e.getParam("redux_store"),s="paste-embed-wrapper";let n=null;if(!t)return;function i(s,n){if(n&&e){if(c()){const t=r(),s=e.dom.create("p",{},n.result);t.parentNode.insertBefore(s,t),e.dom.remove(t)}else{let i=Object(z.i)(t.getState());if(!Object(y.includes)(i,s))return;i=i.replace(s,n.result),e.fire("SetTextAreaContent",{content:i})}e.fire("change")}}function o(e){let t;e.clipboardData?t=e.clipboardData.getData("text/plain"):window.clipboardData&&(t=window.clipboardData.getData("Text")),function(e){return e&&/^<[\s\S]+>$/.test(e.trim())}(t)&&(c()?n=t:a(t))}function a(s){return Je.a.undocumented().site(Object(B.e)(t.getState())).embedReversal(s).then(Object(y.partial)(i,s)).catch(()=>{const t=r();t&&c()&&e.dom.remove(t,!0)}).finally(()=>n=null)}function r(){return e.getBody().querySelector("#"+s)}function c(){return e&&!e.isHidden()}e.on("paste",o),e.on("PastePostProcess",function(t){if(n){const i=e.dom.create("div",{id:s});for(;t.node.firstChild;){const e=t.node.firstChild;t.node.removeChild(e),i.appendChild(e)}t.node.appendChild(i),a(n)}});const l=e.getParam("textarea");l&&l.addEventListener("paste",o)}class pi extends u.Component{constructor(){super(...arguments),S()(this,"state",{imageAlt:"",imageTitle:"",imageUrl:""}),S()(this,"setImageAlt",e=>{this.setState({imageAlt:e.target.value})}),S()(this,"setImageTitle",e=>{this.setState({imageTitle:e.target.value})}),S()(this,"setImageUrl",e=>{this.setState({imageUrl:e.target.value})}),S()(this,"onCloseDialog",()=>{this.setState({imageAlt:"",imageTitle:"",imageUrl:""}),this.props.onClose()}),S()(this,"onInsertImage",()=>{const e=this.state,t=e.imageAlt,s=e.imageTitle,n=e.imageUrl;this.props.onInsert({alt:t,src:n,title:s}),this.onCloseDialog()})}render(){const e=this.props,t=e.shouldDisplay,s=e.translate,n=this.state,i=n.imageAlt,o=n.imageTitle,a=n.imageUrl,r=[{action:"cancel",label:s("Cancel")},{action:"add-image",isPrimary:!0,label:s("Add Image"),onClick:this.onInsertImage}];return m.a.createElement(ke.a,{isVisible:t,buttons:r,onClose:this.onCloseDialog,additionalClassNames:"editor-html-toolbar__dialog"},m.a.createElement(vs.a,null,m.a.createElement(js.a,{htmlFor:"image_url"},s("URL")),m.a.createElement(de.a,{autoFocus:!0,id:"image_url",name:"image_url",onChange:this.setImageUrl,value:a})),m.a.createElement(vs.a,null,m.a.createElement(js.a,{htmlFor:"image_title"},s("Title")),m.a.createElement(de.a,{id:"image_title",name:"image_title",onChange:this.setImageTitle,value:o})),m.a.createElement(vs.a,null,m.a.createElement(js.a,{htmlFor:"image_alt"},s("Alt Text")),m.a.createElement(de.a,{id:"image_alt",name:"image_alt",onChange:this.setImageAlt,alue:i})))}}S()(pi,"propTypes",{onClose:T.a.func,onInsert:T.a.func,shouldDisplay:T.a.bool,translate:T.a.func});var ui=Object(h.localize)(pi),mi=s("./client/my-sites/post-selector/index.jsx");const hi=/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i,gi=/^(https?|ftp):\/\/[A-Z0-9.-]+\.[A-Z]{2,4}[^ "]*$/i,bi=/^(?:[a-z]+:|#|\?|\.|\/)/;class fi extends u.Component{constructor(){super(...arguments),S()(this,"state",{linkNewTab:!1,linkText:"",linkUrl:"",selectedPost:{id:null,url:null}}),S()(this,"bindLinkUrlRef",e=>{this.linkUrl=e}),S()(this,"setLinkUrl",e=>{const t=this.state.selectedPost;this.setState({linkUrl:e.target.value,selectedPost:t.url===e.target.value?t:{id:null,url:null}})}),S()(this,"setLinkText",e=>{this.setState({linkText:e.target.value})}),S()(this,"setLinkNewTab",e=>{this.setState({linkNewTab:e.target.checked})}),S()(this,"onSelectPost",e=>{this.setState({linkUrl:e.URL,selectedPost:{id:e.ID,url:e.URL}})}),S()(this,"onCloseDialog",()=>{this.setState({linkNewTab:!1,linkText:"",linkUrl:"",selectedPost:{id:null,url:null}}),this.props.onClose()}),S()(this,"onInsertLink",()=>{const e=this.state,t=e.linkNewTab,s=e.linkText;this.props.onInsert({href:this.correctUrl(),target:t?"_blank":""},s),this.onCloseDialog()})}componentWillReceiveProps(e){this.setState({linkUrl:this.inferUrl(e.selectedText),linkText:e.selectedText})}correctUrl(){const e=this.state.linkUrl.trim();return hi.test(e)?"mailto:".concat(e):bi.test(e)?e:"http://".concat(e)}inferUrl(e){return hi.test(e)?"mailto:"+e:gi.test(e)?e.replace(/&amp;|&#0?38;/gi,"&"):""}render(){const e=this.props,t=e.shouldDisplay,s=e.siteId,n=e.translate,i=this.state,o=i.linkNewTab,a=i.linkText,r=i.linkUrl,c=i.selectedPost,l=[{action:"cancel",label:n("Cancel")},{action:"add-link",isPrimary:!0,label:n("Add Link"),onClick:this.onInsertLink}];return m.a.createElement(ke.a,{isVisible:t,buttons:l,onClose:this.onCloseDialog,additionalClassNames:"editor-html-toolbar__dialog"},m.a.createElement(vs.a,null,m.a.createElement(js.a,{htmlFor:"link_url"},n("URL")),m.a.createElement(de.a,{autoFocus:!0,id:"link_url",name:"link_url",onChange:this.setLinkUrl,ref:this.bindLinkUrlRef,value:r})),m.a.createElement(vs.a,null,m.a.createElement(js.a,{htmlFor:"link_text"},n("Link Text")),m.a.createElement(de.a,{id:"link_text",name:"link_text",onChange:this.setLinkText,value:a})),m.a.createElement(vs.a,null,m.a.createElement(js.a,null,m.a.createElement(yn.a,{checked:o,name:"link_new_tab",onChange:this.setLinkNewTab}),m.a.createElement("span",null,n("Open link in a new window/tab")))),m.a.createElement(vs.a,null,m.a.createElement(js.a,null,m.a.createElement("span",null,n("Link to existing content"))),m.a.createElement(mi.a,{emptyMessage:n("No posts found"),onChange:this.onSelectPost,order:"DESC",orderBy:"date",selected:c.id,showTypeLabels:!0,siteId:s,type:"any",excludePrivateTypes:!0})))}}S()(fi,"propTypes",{onClose:T.a.func,onInsert:T.a.func,selectedText:T.a.string,shouldDisplay:T.a.bool,siteId:T.a.number,translate:T.a.func});var yi=Object(P.b)(e=>({siteId:Object(B.e)(e)}))(Object(h.localize)(fi)),Ei=s("./client/state/selectors/is-drop-zone-visible.js");s("./client/post-editor/editor-html-toolbar/style.scss");const vi=39;class ji extends u.Component{constructor(){super(...arguments),S()(this,"state",{contactFormDialogTab:"fields",isPinned:!1,isScrollable:!1,isScrolledFull:!1,openTags:[],selectedText:"",showContactFormDialog:!1,showImageDialog:!1,showInsertContentMenu:!1,showLinkDialog:!1,showMediaModal:!1,source:"",showSimplePaymentsDialog:!1,simplePaymentsDialogTab:"addNew"}),S()(this,"bindButtonsRef",e=>{this.buttons=e}),S()(this,"bindInsertContentButtonsRef",e=>{this.insertContentButtons=e}),S()(this,"onWindowResize",()=>{this.disablePinOnSmallScreens(),this.toggleToolbarScrollableOnResize()}),S()(this,"pinToolbarOnScroll",()=>{if(Object(ye.f)("<660px"))return;const e=this.props.content.offsetTop,t=this.state.isPinned;t&&window.pageYOffset<e-vi?this.setState({isPinned:!1}):!t&&window.pageYOffset>e-vi&&this.setState({isPinned:!0})}),S()(this,"disablePinOnSmallScreens",()=>{this.state.isPinned&&Object(ye.f)("<660px")&&this.setState({isPinned:!1})}),S()(this,"toggleToolbarScrollableOnResize",()=>{const e=this.buttons.scrollWidth>this.buttons.clientWidth;e!==this.state.isScrollable&&this.setState({isScrollable:e})}),S()(this,"hideToolbarFadeOnFullScroll",e=>{const t=e.target,s=t.scrollLeft>=t.scrollWidth-t.clientWidth-10;s!==this.state.isScrolledFull&&this.setState({isScrolledFull:s})}),S()(this,"clickOutsideInsertContentMenu",e=>{this.state.showInsertContentMenu&&!this.insertContentButtons.contains(e.target)&&this.setState({showInsertContentMenu:!1})}),S()(this,"updateEditorContent",(e,t,s)=>N.Env.gecko?this.updateEditorContentFirefox(e,t,s):11===N.Env.ie?this.updateEditorContentIE11(e,t,s):this.insertEditorContent(e,t,s)),S()(this,"attributesToString",function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(y.reduce)(e,(e,t,s)=>t?e+" ".concat(s,'="').concat(t,'"'):e,"")}),S()(this,"openHtmlTag",e=>{let t=e.name,s=e.attributes,n=void 0===s?{}:s,i=e.options,o=void 0===i?{}:i;return(o.paragraph?"\n":"")+(o.indent?"\t":"")+"<".concat(t).concat(this.attributesToString(n),">")+(o.paragraph?"\n":"")}),S()(this,"closeHtmlTag",e=>{let t=e.name,s=e.options,n=void 0===s?{}:s;return"</".concat(t,">")+(n.newLineAfter?"\n":"")+(n.paragraph?"\n\n":"")}),S()(this,"onClickBold",()=>{this.insertHtmlTag({name:"strong"})}),S()(this,"onClickItalic",()=>{this.insertHtmlTag({name:"em"})}),S()(this,"onClickLink",(e,t)=>{t?this.insertHtmlTagWithText({name:"a",attributes:e,options:{text:t}}):(this.insertHtmlTagOpenClose({name:"a",attributes:e}),this.setCursorPosition(this.props.content.selectionEnd,-4))}),S()(this,"onClickQuote",()=>{this.insertHtmlTag({name:"blockquote",options:{paragraph:!0}})}),S()(this,"onClickDelete",()=>{const e=this.props.moment().format();this.insertHtmlTag({name:"del",attributes:{datetime:e}})}),S()(this,"onClickInsert",()=>{const e=this.props.moment().format();this.insertHtmlTag({name:"ins",attributes:{datetime:e}})}),S()(this,"onClickImage",e=>{this.insertHtmlTagSelfClosed({name:"img",attributes:e})}),S()(this,"onClickUnorderedList",()=>{this.insertHtmlTag({name:"ul",options:{paragraph:!0}})}),S()(this,"onClickOrderedList",()=>{this.insertHtmlTag({name:"ol",options:{paragraph:!0}})}),S()(this,"onClickListItem",()=>{this.insertHtmlTag({name:"li",options:{indent:!0,newLineAfter:!0}})}),S()(this,"onClickCode",()=>{this.insertHtmlTag({name:"code"})}),S()(this,"onClickMore",()=>{this.insertCustomContent("\x3c!--more--\x3e",{paragraph:!0})}),S()(this,"onClickCloseTags",()=>{const e=Object(y.reduce)(this.state.openTags,(e,t)=>this.closeHtmlTag({name:t})+e,"");this.insertCustomContent(e),this.setState({openTags:[]})}),S()(this,"onInsertMedia",e=>{this.insertCustomContent(e)}),S()(this,"onInsertContactForm",()=>{this.insertCustomContent(nt(this.props.contactForm),{paragraph:!0}),this.closeContactFormDialog()}),S()(this,"openImageDialog",()=>{this.setState({showImageDialog:!0})}),S()(this,"closeImageDialog",()=>{this.setState({showImageDialog:!1})}),S()(this,"openLinkDialog",()=>{const e=this.splitEditorContent().inner;this.setState({selectedText:e,showLinkDialog:!0})}),S()(this,"closeLinkDialog",()=>{this.setState({showLinkDialog:!1})}),S()(this,"toggleInsertContentMenu",()=>{this.setState({showInsertContentMenu:!this.state.showInsertContentMenu})}),S()(this,"openContactFormDialog",()=>{this.setState({contactFormDialogTab:"fields",showContactFormDialog:!0,showInsertContentMenu:!1})}),S()(this,"toggleContactFormDialogTab",()=>{this.setState({contactFormDialogTab:"fields"===this.state.contactFormDialogTab?"settings":"fields"})}),S()(this,"closeContactFormDialog",()=>{this.setState({showContactFormDialog:!1})}),S()(this,"openMediaModal",()=>{this.setState({showInsertContentMenu:!1,showMediaModal:!0,source:""})}),S()(this,"openGoogleModal",()=>{this.setState({showInsertContentMenu:!1,showMediaModal:!0,source:"google_photos"})}),S()(this,"openPexelsModal",()=>{this.setState({showInsertContentMenu:!1,showMediaModal:!0,source:"pexels"})}),S()(this,"closeMediaModal",()=>{this.setState({showMediaModal:!1})}),S()(this,"openSimplePaymentsDialog",()=>{this.setState({simplePaymentsDialogTab:"addNew",showSimplePaymentsDialog:!0,showInsertContentMenu:!1})}),S()(this,"closeSimplePaymentsDialog",()=>{this.setState({showSimplePaymentsDialog:!1})}),S()(this,"changeSimplePaymentsDialogTab",e=>{this.setState({simplePaymentsDialogTab:e})}),S()(this,"insertSimplePayment",e=>{this.insertCustomContent(Ct(e),{paragraph:!0}),this.closeSimplePaymentsDialog()}),S()(this,"onFilesDrop",()=>{const e=this.props.site,t=is.a.getAll(e.ID);1===t.length&&"image"===Object(Qt.g)(t[0])&&!os.a.hasErrors(e.ID)?(t[0].transient&&this.props.blockSave("MEDIA_MODAL_TRANSIENT_INSERT"),this.onInsertMedia(Zt.a.get(e,t[0])),$t.a.setLibrarySelectedItems(e.ID,[])):this.openMediaModal()}),S()(this,"isTagOpen",e=>-1!==this.state.openTags.indexOf(e)),S()(this,"renderAddEverythingDropdown",()=>{const e=this.props.translate,t=D()("editor-html-toolbar__insert-content-dropdown",{"is-visible":this.state.showInsertContentMenu});return m.a.createElement("div",{className:t},m.a.createElement("button",{className:"editor-html-toolbar__insert-content-dropdown-item",onClick:this.openMediaModal},m.a.createElement(A.a,{icon:"image"}),m.a.createElement("span",{"data-e2e-insert-type":"media"},e("Media"))),St.a.isEnabled("external-media/google-photos")&&m.a.createElement("button",{className:"editor-html-toolbar__insert-content-dropdown-item",onClick:this.openGoogleModal},m.a.createElement(A.a,{icon:"shutter"}),m.a.createElement("span",{"data-e2e-insert-type":"google-media"},e("Google Photos library"))),St.a.isEnabled("external-media/free-photo-library")&&m.a.createElement("button",{className:"editor-html-toolbar__insert-content-dropdown-item",onClick:this.openPexelsModal},m.a.createElement(A.a,{icon:"image-multiple"}),m.a.createElement("span",{"data-e2e-insert-type":"pexels"},e("Free photo library"))),m.a.createElement("button",{className:"editor-html-toolbar__insert-content-dropdown-item",onClick:this.openContactFormDialog},m.a.createElement(A.a,{icon:"mention"}),m.a.createElement("span",{"data-e2e-insert-type":"contact-form"},e("Contact form"))),m.a.createElement("button",{className:"editor-html-toolbar__insert-content-dropdown-item",onClick:this.openSimplePaymentsDialog},m.a.createElement(A.a,{icon:"money"}),m.a.createElement("span",{"data-e2e-insert-type":"payment-button"},e("Payment button"))))})}componentDidMount(){this.pinToolbarOnScroll=Object(y.throttle)(this.pinToolbarOnScroll,50),this.hideToolbarFadeOnFullScroll=Object(y.throttle)(this.hideToolbarFadeOnFullScroll,200),this.onWindowResize=Object(y.throttle)(this.onWindowResize,400),window.addEventListener("scroll",this.pinToolbarOnScroll),window.addEventListener("resize",this.onWindowResize),this.buttons.addEventListener("scroll",this.hideToolbarFadeOnFullScroll),document.addEventListener("click",this.clickOutsideInsertContentMenu),this.toggleToolbarScrollableOnResize()}componentWillUnmount(){this.pinToolbarOnScroll.cancel(),this.onWindowResize.cancel(),this.hideToolbarFadeOnFullScroll.cancel(),window.removeEventListener("scroll",this.pinToolbarOnScroll),window.removeEventListener("resize",this.onWindowResize),this.buttons.removeEventListener("scroll",this.hideToolbarFadeOnFullScroll),document.removeEventListener("click",this.clickOutsideInsertContentMenu)}splitEditorContent(){const e=this.props.content,t=e.selectionEnd,s=e.selectionStart,n=e.value;return{before:n.substring(0,s),inner:n.substring(s,t),after:n.substring(t,n.length)}}setCursorPosition(e,t){this.props.content.selectionEnd=this.props.content.selectionStart=e+t}insertEditorContent(e,t,s){const n=this.props,i=n.content,o=n.onToolbarChangeContent;i.focus(),document.execCommand("insertText",!1,t),o(e+t+s)}updateEditorContentFirefox(e,t,s){const n=e+t+s,i=this.props,o=i.content,a=i.content,r=a.selectionEnd,c=a.value,l=i.onToolbarChangeContent;this.props.content.value=n,o.focus(),document.execCommand("insertText",!1,t),l(n),this.setCursorPosition(r,n.length-c.length),this.props.content.focus()}updateEditorContentIE11(e,t,s){const n=e+t+s,i=this.props,o=i.content,a=o.selectionEnd,r=o.value,c=i.onToolbarChangeContent;this.props.content.value=n,c(n),this.setCursorPosition(a,n.length-r.length)}insertHtmlTagOpen(e){const t=this.state.openTags,s=this.splitEditorContent(),n=s.before,i=s.after;this.updateEditorContent(n,this.openHtmlTag(e),i),this.setState({openTags:t.concat(e.name)})}insertHtmlTagClose(e){const t=this.state.openTags,s=this.splitEditorContent(),n=s.before,i=s.after;this.updateEditorContent(n,this.closeHtmlTag(e),i),this.setState({openTags:t.filter(t=>t!==e.name)})}insertHtmlTagOpenClose(e){const t=this.splitEditorContent(),s=t.before,n=t.inner,i=t.after;this.updateEditorContent(s,this.openHtmlTag(e)+n+this.closeHtmlTag(e),i)}insertHtmlTagSelfClosed(e){const t=this.splitEditorContent(),s=t.before,n=t.inner,i=t.after,o="<".concat(e.name).concat(this.attributesToString(e.attributes)," />"),a=e.options&&e.options.paragraph?"\n"+o+"\n\n":o;this.updateEditorContent(s,n+a,i)}insertHtmlTagWithText(e){const t=this.splitEditorContent(),s=t.before,n=t.after;this.updateEditorContent(s,this.openHtmlTag(e)+e.options.text+this.closeHtmlTag(e),n)}insertCustomContent(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=this.splitEditorContent(),n=s.before,i=s.inner,o=s.after,a=t.paragraph?"\n":"";this.updateEditorContent(n,i+a+e+a+a,o)}insertHtmlTag(e){const t=this.props.content;t.selectionEnd===t.selectionStart?this.isTagOpen(e.name)?this.insertHtmlTagClose(e):this.insertHtmlTagOpen(e):this.insertHtmlTagOpenClose(e)}render(){const e=this.props,t=e.site,s=e.translate,n=D()("editor-html-toolbar",{"is-pinned":this.state.isPinned,"is-scrollable":this.state.isScrollable,"is-scrolled-full":this.state.isScrolledFull,"has-active-drop-zone":this.props.isDropZoneVisible}),i={strong:{label:"b",onClick:this.onClickBold},em:{label:"i",onClick:this.onClickItalic},a:{label:"link",onClick:this.openLinkDialog},blockquote:{label:"b-quote",onClick:this.onClickQuote},del:{onClick:this.onClickDelete},ins:{onClick:this.onClickInsert},img:{onClick:this.openImageDialog},ul:{onClick:this.onClickUnorderedList},ol:{onClick:this.onClickOrderedList},li:{onClick:this.onClickListItem},code:{onClick:this.onClickCode},more:{onClick:this.onClickMore},"close-tags":{disabled:!this.state.openTags.length,label:s("close tags"),onClick:this.onClickCloseTags}};return m.a.createElement("div",{className:n},m.a.createElement("div",{className:"editor-html-toolbar__wrapper"},m.a.createElement("div",{className:"editor-html-toolbar__wrapper-buttons"},m.a.createElement("div",{className:"editor-html-toolbar__buttons",ref:this.bindButtonsRef},m.a.createElement("div",{className:"editor-html-toolbar__button-insert-content",ref:this.bindInsertContentButtonsRef},m.a.createElement(q.a,{borderless:!0,className:"editor-html-toolbar__button-insert-content-dropdown",compact:!0,onClick:this.toggleInsertContentMenu},m.a.createElement(A.a,{icon:"add-outline"}),m.a.createElement("span",null,s("Add")))),Object(y.map)(i,(e,t)=>{let s=e.disabled,n=e.label,i=e.onClick;return m.a.createElement(q.a,{borderless:!0,className:"editor-html-toolbar__button-".concat(t," ").concat(this.isTagOpen(t)?"is-tag-open":""),compact:!0,disabled:s,key:t,onClick:i},n||t)})),this.renderAddEverythingDropdown())),m.a.createElement(ui,{onClose:this.closeImageDialog,onInsert:this.onClickImage,shouldDisplay:this.state.showImageDialog}),m.a.createElement(yi,{onClose:this.closeLinkDialog,onInsert:this.onClickLink,selectedText:this.state.selectedText,shouldDisplay:this.state.showLinkDialog}),m.a.createElement(Dn,{activeTab:this.state.contactFormDialogTab,isEdit:!1,onChangeTabs:this.toggleContactFormDialogTab,onClose:this.closeContactFormDialog,onFieldAdd:this.props.fieldAdd,onFieldRemove:this.props.fieldRemove,onFieldUpdate:this.props.fieldUpdate,onInsert:this.onInsertContactForm,onSettingsUpdate:this.props.settingsUpdate,showDialog:this.state.showContactFormDialog}),m.a.createElement(es.a,{onClose:this.closeMediaModal,onInsertMedia:this.onInsertMedia,visible:this.state.showMediaModal,source:this.state.source}),m.a.createElement(ns.a,{onAddMedia:this.onFilesDrop,site:t,fullScreen:!1}),m.a.createElement(Un.a,{showDialog:this.state.showSimplePaymentsDialog,activeTab:this.state.simplePaymentsDialogTab,isEdit:!1,onClose:this.closeSimplePaymentsDialog,onChangeTabs:this.changeSimplePaymentsDialogTab,onInsert:this.insertSimplePayment}))}}S()(ji,"propTypes",{contactForm:T.a.object,content:T.a.object,fieldAdd:T.a.func,fieldRemove:T.a.func,fieldUpdate:T.a.func,isDropZoneVisible:T.a.bool.isRequired,moment:T.a.func,onToolbarChangeContent:T.a.func,settingsUpdate:T.a.func,site:T.a.object,translate:T.a.func});const _i={blockSave:as.a,fieldAdd:Nn,fieldRemove:Rn,fieldUpdate:Mn,settingsUpdate:Ln};var xi=Object(P.b)(e=>({contactForm:Object(y.get)(e,"ui.editor.contactForm",{}),isDropZoneVisible:Object(Ei.a)(e),site:Object(B.d)(e)}),_i)(Object(h.localize)(ji)),wi=s("./client/blocks/user-mentions/suggestion-list.jsx");const Si=e=>{let t=e.username;return m.a.createElement("span",null,"@",t)};Si.propTypes={username:T.a.string.isRequired};var Ci=Si,Ii=s("./client/components/data/query-users-suggestions/index.jsx"),Oi=s("./client/state/users/suggestions/selectors.js");const Ti=R.a.util.VK;class Pi extends u.Component{constructor(){super(...arguments),S()(this,"matchingSuggestions",[]),S()(this,"state",{query:"",showPopover:!1}),S()(this,"popoverContext",m.a.createRef()),S()(this,"insertSuggestion",e=>{let t=e.user_login;if(!t)return;const s=this.props.editor.selection,n=m.a.createElement(Ci,{username:t}),i=s.getRng(),o=document.createRange();o.setStart(i.startContainer,Math.max(i.startOffset-(this.state.query.length+1),0)),o.setEnd(i.endContainer,i.endOffset),s.setRng(o),s.setContent(s.getContent().replace(/@\S*/,p.a.renderToStaticMarkup(n))),this.props.editor.getBody().focus()}),S()(this,"onKeyDown",e=>{let t=e.keyCode,s=e.preventDefault;const n=this.getSelectedSuggestionIndex();if(!Object(y.includes)([Ti.DOWN,Ti.UP],t)||-1===n)return;let i;s(),t===Ti.DOWN?i=(n+1)%this.matchingSuggestions.length:(i=n-1)<0&&(i=this.matchingSuggestions.length-1),this.setState({selectedSuggestionId:this.matchingSuggestions[i].ID})}),S()(this,"onKeyUp",e=>{let t=e.keyCode;if(Object(y.includes)([Ti.DOWN,Ti.UP],t))return;if(Object(y.includes)([Ti.SPACEBAR,27],t))return this.hidePopover();if(t===Ti.ENTER){if(!this.state.showPopover||0===this.matchingSuggestions.length)return;const e=this.getSuggestion();return e&&this.insertSuggestion(e),this.hidePopover()}const s=this.getQueryText();this.setState({showPopover:null!==s,selectedSuggestionId:null,query:s})}),S()(this,"hidePopover",()=>this.setState({showPopover:!1}))}componentDidMount(){const e=this.props.editor,t=this.getPosition(),s=t.left,n=t.top;e.on("keyup",this.onKeyUp),e.on("click",this.hidePopover),this.left=s,this.top=n}componentWillUpdate(e,t){if(!this.state.showPopover&&t.showPopover)return this.updatePosition(t),void this.props.editor.on("keydown",this.onKeyDown);if(!this.state.showPopover||t.showPopover){if(t.showPopover){const e=this.getPosition(),s=e.top,n=e.left,i=this.top>s&&this.left<n,o=this.top<s&&this.left>n;(i||o)&&this.updatePosition(t,{top:s,left:n})}}else this.props.editor.off("keydown",this.onKeyDown)}componentWillUnmount(){const e=this.props.editor;e.off("keydown",this.onKeyDown),e.off("keyup",this.onKeyUp),e.off("click",this.hidePopover)}getMatchingSuggestions(e,t){if(t){t=Object(y.escapeRegExp)(t);const s=new RegExp("^".concat(t,"|\\s").concat(t),"ig");e=e.filter(e=>{let t=e.user_login,n=e.display_name;return s.test("".concat(t," ").concat(n))})}return e.slice(0,10)}getPosition(){let e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state).query;const t=this.props.editor,s=t.selection.getRng(),n=document.createRange();n.setStart(s.startContainer,s.startOffset-e.length),n.setEnd(s.endContainer,s.endOffset);const i=n.getClientRects(),o=i.length>0?Object(y.last)(i):R.a.$(t.selection.getNode()).offset();return Object(y.pick)(o,["left","top"])}updatePosition(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getPosition(e),s=t.left,n=t.top;const i=this.props,o=i.editor,a=i.node,r=Object(y.get)(R.a.$(".mce-toolbar-grp",o.getContainer())[0],"offsetHeight",0),c=o.selection.getRng().getClientRects();let l;l=c.length>0?c[0].height:o.selection.getNode().offsetHeight,this.left=s,this.top=n,a.style.left="".concat(this.left,"px"),a.style.top="".concat(r+this.top+l-10,"px")}getQueryText(){const e=new RegExp("(?:^|\\s)@([A-Za-z0-9_+-]*)$","gi"),t=this.props.editor.selection.getRng(),s=t.startContainer.textContent.slice(0,t.startOffset),n=e.exec(s);return n&&n.length>1?n[1]:null}getSelectedSuggestionIndex(){return this.state.selectedSuggestionId?Object(y.findIndex)(this.matchingSuggestions,e=>{return e.ID===this.state.selectedSuggestionId}):0}getSuggestion(){const e=this.getSelectedSuggestionIndex();return e>-1?this.matchingSuggestions[e]:null}render(){const e=this.props,t=e.siteId,s=e.suggestions,n=this.state,i=n.query,o=n.showPopover;this.matchingSuggestions=this.getMatchingSuggestions(s,i);const a=this.state.selectedSuggestionId||Object(y.get)(Object(y.head)(this.matchingSuggestions),"ID");return m.a.createElement("div",{ref:this.popoverContext},m.a.createElement(Ii.a,{siteId:t}),this.matchingSuggestions.length>0&&o&&m.a.createElement(wi.a,{query:i,suggestions:this.matchingSuggestions,selectedSuggestionId:a,popoverContext:this.popoverContext.current,onClick:this.insertSuggestion,onClose:this.hidePopover}))}}Pi.propTypes={editor:T.a.object.isRequired,node:T.a.object.isRequired,siteId:T.a.number.isRequired,suggestions:T.a.array},Pi.defaultProps={suggestions:[]};var ki=Object(P.b)(e=>{const t=Object(B.e)(e);return{siteId:t,suggestions:Object(Oi.a)(e,t)}})(Pi);const Di=R.a.util.VK.ENTER;function Ni(e){const t=document.createElement("div");let s=!1;e.on("init focus",()=>{const n=e.getParam("redux_store"),i=Object(B.d)(n.getState());s||!i||i.single_user_site||(t.setAttribute("class","mentions__container"),e.getContainer().appendChild(t),Object(qt.b)(m.a.createElement(ki,{editor:e,node:t}),t,n),s=!0),s&&i&&i.single_user_site&&(I.a.unmountComponentAtNode(t),s=!1)}),e.on("keydown",e=>{document.querySelector(".user-mentions__suggestions")&&e.keyCode===Di&&e.preventDefault()})}var Ri=s("./client/lib/create-selector/index.js"),Mi=Object(Ri.a)(function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!t)return null;const n=Object(y.get)(e,"memberships.productList.items.".concat(t),null);if(!n)return null;if(!s)return Object(y.orderBy)(n,"ID","desc");const i=Object(y.find)(n,e=>e.ID===s);return i||null},e=>e.memberships.productList.items),Li=s("./client/state/data-layer/wpcom/sites/memberships/index.js");function Ai(e,t){return{siteId:e,type:"MEMBERSHIPS_PRODUCT_RECEIVE",product:t}}class Ui extends u.Component{request(){this.props.requesting||this.props.siteId&&this.props.requestProducts(this.props.siteId)}componentDidMount(){this.request()}componentDidUpdate(e){this.props.siteId!==e.siteId&&this.request()}render(){return null}}S()(Ui,"propTypes",{siteId:T.a.number.isRequired,requestProducts:T.a.func});var qi=Object(P.b)(null,{requestProducts:e=>({siteId:e,type:"MEMBERSHIPS_PRODUCTS_LIST"})})(Ui),Fi=s("./client/components/notice/index.jsx"),Bi=s("./client/components/tinymce/plugins/simple-payments/dialog/navigation.jsx"),zi=s("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),Vi=s.n(zi),Hi=s("./node_modules/redux-form/es/getFormValues.js"),Wi=s("./node_modules/redux-form/es/isValid.js"),Gi=s("./node_modules/redux-form/es/isDirty.js"),Yi=s("./node_modules/redux-form/es/Fields.js"),Ki=s("./node_modules/redux-form/es/reduxForm.js"),$i=s("./client/components/forms/form-textarea/index.jsx"),Qi=s("./client/components/forms/form-currency-input/index.jsx"),Ji=s("./client/components/redux-forms/redux-form-fieldset/index.jsx"),Zi=s("./client/components/forms/form-select/index.jsx");function Xi(){return e=>(e({type:"MEMBERSHIPS_CONNECTED_ACCOUNTS_LIST"}),Je.a.req.get("/me/connected_accounts/list").then(t=>{const s=t.accounts.reduce((e,t)=>(e[t.connected_destination_account_id]=t,e),{});return e({type:"MEMBERSHIPS_CONNECTED_ACCOUNTS_RECEIVE",accounts:s}),Promise.resolve(s)}))}var eo=Object(P.b)(e=>({isFetching:Object(y.get)(e,["memberships","connectedAccounts","isFetching"],!1)}),{listMembershipsConnectedAccounts:Xi})(class extends u.Component{componentDidMount(){this.props.isFetching||this.props.listMembershipsConnectedAccounts()}render(){return null}}),to=s("./client/lib/sharing/index.js"),so=s("./node_modules/redux-form/es/index.js");function no(e,t){return Object(y.get)(e,["form",t,"values","stripe_account"],"")}function io(e){return Object(y.get)(e,["memberships","connectedAccounts","accounts"],{})}const oo=e=>Object(Hi.a)("membershipsForm")(e),ao=e=>Object(Wi.a)("membershipsForm")(e),ro=e=>Object(Gi.a)("membershipsForm")(e),co=["USD","EUR","AUD","BRL","CAD","CZK","DKK","HKD","HUF","ILS","JPY","MYR","MXN","TWD","NZD","NOK","PHP","PLN","GBP","RUB","SGD","SEK","CHF","THB"].map(e=>{const t=Object(xt.getCurrencyDefaults)(e).symbol;return{code:e,label:t===e?e:"".concat(e," ").concat(Object(y.trimEnd)(t,"."))}});const lo=e=>{let t=e.price,s=e.currency,n=Vi()(e,["price","currency"]);const i=Object(xt.getCurrencyDefaults)(s.input.value).precision,o=i>0?Object(y.padEnd)("1.",i+2,"0"):"1";return m.a.createElement(Ji.a,x()({inputComponent:Qi.a},t,Object(y.omit)(n,["names"]),{currencySymbolPrefix:s.input.value,onCurrencyChange:s.input.onChange,currencyList:co,placeholder:o}))};var po=Object(y.flowRight)(h.localize,Object(Ki.a)({form:"membershipsForm",enableReinitialize:!0,validate:(e,t)=>{const s=t.translate,n=Object(xt.getCurrencyDefaults)(e.currency).precision,i={};if(e.title||(i.title=s("People need to know what they're paying for! Please add a brief title.")),e.price&&0!==parseFloat(e.price)){if(isNaN(parseFloat(e.price)))i.price=s("Invalid price");else if(parseFloat(e.price)<0)i.price=s("Your price is negative — now that doesn't sound right, does it?");else if(function(e){const t=(""+e).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return t?Math.max(0,(t[1]?t[1].length:0)-(t[2]?+t[2]:0)):0}(e.price)>n)if(0===n)i.price=s("We know every penny counts, but prices can't contain decimal values.");else{const e=s("%(precision)d decimal place","%(precision)d decimal places",{count:n,args:{precision:n}});i.price=s("Price cannot have more than %(countDecimal)s.",{args:{countDecimal:e}})}}else i.price=s("Everything comes with a price tag these days. Add yours here.");return e.renewal_schedule||(i.renewal_schedule="Please choose a renewal schedule"),e.stripe_account||(i.stripe_account="Choose or connect a new Stripe Account."),"create"!==e.stripe_account||e.email||(i.email=s("If you want us to create a Stripe account for you, you need to provide an email address.")),i}}),Object(P.b)(e=>({isChoosingToAuthorizeStripeAccount:"authorize"===no(e,"membershipsForm"),isChoosingToCreateStripeAccount:"create"===no(e,"membershipsForm"),membershipsConnectedAccounts:io(e)}),{authorizeStripeAccount:function(){return e=>(e({type:"MEMBERSHIPS_CONNECTED_ACCOUNTS_STRIPE_AUTHORIZE_REQUEST"}),Je.a.req.post("/me/stripe_connect/oauth/url").then(t=>Object(to.a)(t.url,()=>e(Xi()).then(t=>e(Object(so.a)("simplePaymentsForm","stripe_account",Math.max(...Object.keys(t)),!1,!1))))))}}))(class extends u.Component{render(){const e=this.props.translate;return m.a.createElement("form",{className:"editor-simple-payments-modal__form"},m.a.createElement("div",{className:"editor-simple-payments-modal__form-fields"},m.a.createElement(Ji.b,{name:"title",label:e("What is this payment for?"),component:de.a,explanation:e("For example: event tickets, charitable donations, training courses, coaching fees, etc.")}),m.a.createElement(Ji.b,{name:"description",label:e("Description"),component:$i.a}),m.a.createElement(Yi.a,{names:["price","currency"],label:e("Price"),component:lo}),this.renderRecurringFields()))}renderRecurringFields(){const e=this.props.translate;return m.a.createElement("div",null,m.a.createElement(eo,null),m.a.createElement(Ji.b,{name:"stripe_account",explanation:e("This is the Stripe account where the funds will end up."),label:e("Stripe account"),component:Zi.a,children:Object.values(this.props.membershipsConnectedAccounts).map(e=>m.a.createElement("option",{value:e.connected_destination_account_id,key:e.connected_destination_account_id},e.payment_partner_account_id)).concat([m.a.createElement("option",{value:"create",key:"create"},e("Create Stripe account for me")),m.a.createElement("option",{value:"authorize",key:"authorize"},e("I already have a Stripe account"))])}),this.props.isChoosingToAuthorizeStripeAccount&&m.a.createElement(q.a,{onClick:this.props.authorizeStripeAccount},e("Authorize Stripe account")),this.props.isChoosingToCreateStripeAccount&&m.a.createElement("div",null,m.a.createElement(Ji.b,{name:"email",label:e("Email"),explanation:e("New Stripe account will be tied to this email address."),component:de.a})),m.a.createElement(Ji.b,{name:"renewal_schedule",explanation:e("After what time should the subscription renew?"),label:e("Renewal Schedule"),component:Zi.a},m.a.createElement("option",{value:"1 month"},e("1 Month")),m.a.createElement("option",{value:"1 year"},e("1 Year"))))}}),uo=s("./client/components/tinymce/plugins/simple-payments/dialog/list.jsx"),mo=s("./client/lib/accept/index.js"),ho=s("./client/blocks/upgrade-nudge/index.jsx"),go=s("./client/lib/analytics/track-component-view/index.jsx"),bo=s("./client/components/banner/index.jsx");const fo=e=>Array.isArray(e)&&0===e.length,yo=e=>(t,s)=>{const n=oo(s()),i=s=>Je.a.req.post("/sites/".concat(e,"/memberships/product"),{title:s.title,description:s.description,connected_destination_account_id:s.stripe_account,interval:s.renewal_schedule,price:s.price,currency:s.currency}).then(s=>{const n=Object(Li.a)(s.product);return t(Ai(e,n)),n});return"create"===n.stripe_account&&n.email?Je.a.req.post("/me/stripe_connect/create",{country:"US",email:n.email}).then(e=>(n.stripe_account=e.result.account.connected_destination_account_id,i(n))):i(n)},Eo=(e,t)=>(s,n)=>{const i=oo(n());return Je.a.req.post("/sites/".concat(e,"/memberships/product/").concat(t),{title:i.title,description:i.description,connected_destination_account_id:i.stripe_account,interval:i.renewal_schedule,price:i.price,currency:i.currency}).then(t=>{const n=Object(Li.a)(t.product);return s(Ai(e,n)),n})},vo=(e,t)=>s=>{const n=Je.a.site(e).post(t);return n.delete().then(()=>n.delete()).then(()=>s(function(e,t){return{siteId:e,productId:t,type:"MEMBERSHIPS_PRODUCT_DELETE"}}(e,t)))};class jo extends u.Component{constructor(e){super(e),S()(this,"handleDialogClose",()=>{this.checkUnsavedForm().then(e=>e&&this.props.onClose())}),S()(this,"handleChangeTabs",e=>{"form"===e?this.showButtonForm(null):this.checkUnsavedForm().then(e=>e&&this.showButtonList())}),S()(this,"showButtonForm",e=>{const t=this.getInitialFormFields(e);this.setState({activeTab:"form",editedPaymentId:e,initialFormValues:t})}),S()(this,"handleSelectedChange",e=>this.setState({selectedPaymentId:e})),S()(this,"showError",e=>this._isMounted&&this.setState({errorMessage:e})),S()(this,"dismissError",()=>this._isMounted&&this.setState({errorMessage:null})),S()(this,"handleInsert",()=>{const e=this.props,t=e.siteId,s=e.dispatch,n=e.translate,i=this.state.activeTab;let o;this.setIsSubmitting(!0),(o="list"===i?Promise.resolve(this.state.selectedPaymentId):s(yo(t)).then(e=>(s(Object(Us.i)("calypso_memberships_button_create",{price:e.price,currency:e.currency,id:e.ID})),e.ID))).then(e=>s((t,s)=>Mi(s(),this.props.siteId,e))).then(e=>{this.props.onInsert({id:e.ID,isMembership:!0}),s(Object(Us.i)("calypso_simple_payments_button_insert",{id:e.ID}))}).catch(()=>this.showError(n("The payment button could not be inserted."))).then(()=>this.setIsSubmitting(!1))}),S()(this,"handleSave",()=>{this.setIsSubmitting(!0);const e=this.props,t=e.siteId,s=e.dispatch,n=e.translate,i=this.state.editedPaymentId;s(Eo(t,i)).then(this.handleFormClose).catch(()=>this.showError(n("The payment button could not be updated."))).then(()=>this.setIsSubmitting(!1))}),S()(this,"handleFormClose",()=>{this.isDirectEdit()?this.props.onClose():this.showButtonList()}),S()(this,"handleTrash",e=>{const t=this.props.translate,s=t("Are you sure you want to delete this item? It will be disabled and removed from all locations where it currently appears.");Object(mo.a)(s,s=>{if(!s)return;this.setIsSubmitting(!0);const n=this.props,i=n.siteId,o=n.dispatch;o(Object(Us.i)("calypso_simple_payments_button_delete",{id:e})),o(vo(i,e)).catch(()=>this.showError(t("The payment button could not be deleted."))).then(()=>this.setIsSubmitting(!1))},t("Delete"),null,{isScary:!0})}),this._isMounted=!1;const t=this.props,s=t.editPaymentId,n=t.paymentButtons;this.state={activeTab:s||fo(n)?"form":"list",editedPaymentId:s,initialFormValues:this.getInitialFormFields(s),selectedPaymentId:null,isSubmitting:!1,errorMessage:null}}componentDidUpdate(e){this.props.showDialog&&!e.showDialog&&(this.props.editPaymentId?this.showButtonForm(this.props.editPaymentId):fo(this.props.paymentButtons)?this.showButtonForm(null):this.showButtonList())}componentDidMount(){this._isMounted=!0}componentWillUnmount(){this._isMounted=!1}getInitialFormFields(e){const t=this.constructor.initialFields,s=this.props,n=s.paymentButtons,i=s.currencyCode,o=s.currentUserEmail;if(Object(y.isNumber)(e)){const s=Object(y.find)(n,t=>t.ID===e);if(s)return Object(y.pick)(s,Object.keys(t))}const a=i||"USD",r=Object(y.get)(n,"0.email",o);return Ce()({},t,{currency:a,email:r})}isDirectEdit(){return Object(y.isNumber)(this.props.editPaymentId)}checkUnsavedForm(){return"form"===this.state.activeTab&&this.props.formIsDirty?new Promise(e=>{const t=this.props.translate;Object(mo.a)(t("Wait! You have unsaved changes. Do you really want to discard them?"),e,t("Discard"),null,{isScary:!0})}):Promise.resolve(!0)}showButtonList(){this.setState({activeTab:"list"})}setIsSubmitting(e){this._isMounted&&this.setState({isSubmitting:e})}getActionButtons(){const e=this.props,t=e.formIsValid,s=e.formIsDirty,n=e.translate,i=this.state,o=i.activeTab,a=i.editedPaymentId,r=i.isSubmitting,c=t&&s;let l,d,p,u;return"form"===o&&Object(y.isNumber)(a)?(l=this.handleFormClose,d=this.handleSave,p=!c,u=n("Done")):(l=this.props.onClose,d=this.handleInsert,p="form"===o&&!c||"list"===o&&null===this.state.selectedPaymentId,u=n("Insert")),[m.a.createElement(q.a,{onClick:l,disabled:r},n("Cancel")),m.a.createElement(q.a,{onClick:d,busy:r,disabled:r||p,primary:!0},r?n("Saving…"):u)]}renderEmptyDialog(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const s=this.props,n=s.onClose,i=s.translate,o=s.showDialog;return m.a.createElement(ke.a,{isVisible:o,onClose:n,buttons:[m.a.createElement(q.a,{onClick:n},i("Close"))],additionalClassNames:"editor-simple-payments-modal"},m.a.createElement(go.a,{eventName:"calypso_simple_payments_dialog_view"}),!t&&m.a.createElement(Bi.a,{activeTab:"list",paymentButtons:[],onChangeTabs:y.noop}),e)}returnTrue(){return!0}render(){const e=this.props,t=e.showDialog,s=e.siteId,n=e.siteSlug,i=e.paymentButtons,o=e.currencyCode,a=e.isJetpackNotSupported,r=e.translate,c=e.planHasSimplePaymentsFeature,l=e.shouldQuerySitePlans,d=this.state,p=d.activeTab,u=d.initialFormValues,h=d.errorMessage,g="list"===p||"form"===p&&!this.isDirectEdit()&&!fo(i);return!l&&a?this.renderEmptyDialog(m.a.createElement(un.a,{className:"upgrade-jetpack",illustration:"/calypso/images/illustrations/illustration-jetpack.svg",title:r("Upgrade Jetpack to use Simple Payments"),illustrationWidth:600,action:m.a.createElement(bo.a,{icon:"star",title:r("Upgrade your Jetpack!"),description:r("Simple Payments requires Jetpack version 5.2 or later."),feature:Rt.xb,plan:Rt.vc,href:"../../plugins/jetpack/"+n})}),!0):l||c?m.a.createElement(ke.a,{isVisible:t,onClose:this.handleDialogClose,buttons:this.getActionButtons(),additionalClassNames:"editor-simple-payments-modal"},m.a.createElement(go.a,{eventName:"calypso_simple_payments_dialog_view"}),m.a.createElement(qi,{siteId:s}),(!o||l)&&m.a.createElement(kt.a,{siteId:s}),g&&m.a.createElement(Bi.a,{activeTab:p,paymentButtons:i,onChangeTabs:this.handleChangeTabs}),h&&m.a.createElement(Fi.b,{status:"is-error",text:h,onDismissClick:this.dismissError}),"form"===p?m.a.createElement(po,{initialValues:u,showError:this.showError}):m.a.createElement(uo.a,{siteId:s,paymentButtons:i,selectedPaymentId:this.state.selectedPaymentId,onSelectedChange:this.handleSelectedChange,onTrashClick:this.handleTrash,onEditClick:this.showButtonForm})):this.renderEmptyDialog(m.a.createElement(un.a,{illustration:"/calypso/images/illustrations/type-e-commerce.svg",illustrationWidth:300,title:r("Want to add a payment button to your site?"),action:m.a.createElement(ho.a,{className:"editor-simple-payments-modal__nudge-nudge",title:r("Upgrade your plan to our Premium or Business plan!"),message:r("Get simple payments, advanced social media tools, your own domain, and more."),feature:Rt.xb,event:"editor_simple_payments_modal_nudge",shouldDisplay:this.returnTrue}),secondaryAction:m.a.createElement("a",{className:"empty-content__action button",href:"https://support.wordpress.com/simple-payments/"},r("Learn more about Simple Payments"))}),!0)}}S()(jo,"propTypes",{showDialog:T.a.bool.isRequired,editPaymentId:T.a.number,onClose:T.a.func.isRequired,onInsert:T.a.func.isRequired,isJetpackNotSupported:T.a.bool}),S()(jo,"initialFields",{title:"",description:"",price:"",currency:"USD",email:"",recurring:!1,stripe_account:"",renewal_schedule:"1 year"});var _o=Object(P.b)((e,t)=>{let s=t.siteId;return s||(s=Object(B.e)(e)),{siteId:s,siteSlug:Object(ie.v)(e,s),paymentButtons:Mi(e,s),currencyCode:Object(Vs.d)(e),shouldQuerySitePlans:null===Object(Nt.g)(e,s),isJetpackNotSupported:Object(ie.J)(e,s)&&!Object(ie.H)(e,s,"5.2"),planHasSimplePaymentsFeature:Object(Nt.i)(e,s,Rt.xb),formIsValid:ao(e),formIsDirty:ro(e),currentUserEmail:Object(Vs.f)(e)}})(Object(h.localize)(jo));const xo=e=>{let t;const s=e.getParam("redux_store");e.on("init",()=>{t=e.getContainer().appendChild(document.createElement("div"))}),e.on("remove",()=>{Object(C.unmountComponentAtNode)(t),t.parentNode.removeChild(t),t=null}),e.addCommand("membershipsButton",n=>{let i=null;if(n){const e=It(n);i=e.id||null}!function n(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"show";Object(qt.b)(Object(u.createElement)(_o,{showDialog:"show"===o,editPaymentId:i,onInsert(t){e.execCommand("mceInsertContent",!1,Ct(t)),n("hide")},onClose(){e.focus(),n("hide")}}),t,s)}()})};function wo(e){e.on("preinit",function(e){const t=e.target;Object.keys(t.schema.elements).forEach(function(e){t.schema.elements[e].attributes.markdown={},t.schema.elements[e].attributesOrder.push("markdown")})})}var So=s("./node_modules/twemoji/2/esm.js");function Co(e){let t=!1;const s=R.a.Env,n=window.navigator.userAgent,i=n.indexOf("Windows")>-1;function o(t){let n,i;t&&So.default.test(t.textContent||t.innerText)&&(s.webkit&&(i=(n=e.selection).getBookmark()),function(e){So.default.parse(e,{base:Object(St.a)("twemoji_cdn_url"),size:"72x72",attributes:()=>({"data-mce-resize":"false","data-mce-placeholder":"1","data-wp-emoji":"1"}),callback:(e,t)=>-1===["a9","ae","2122","2194","2660","2663","2665","2666"].indexOf(e)&&"".concat(t.base,t.size,"/",e,t.ext)})}(t),s.webkit&&n.moveToBookmark(i))}(function(){const e=n.match(/Windows NT 6\.(\d)/);return!!(e&&e[1]>1)})()?e.on("keyup",function(t){231===t.keyCode&&o(e.selection.getNode())}):i||(e.on("keydown keyup",function(e){t="keydown"===e.type}),e.on("input",function(){t||o(e.selection.getNode())})),e.on("setcontent",function(){o(e.selection.getNode())}),e.on("PastePostProcess",function(t){R.a.each(e.dom.$("img.emoji",t.node),function(e){e.alt&&So.default.test(e.alt)&&function(e){e.className="emoji",e.setAttribute("data-mce-resize","false"),e.setAttribute("data-mce-placeholder","1"),e.setAttribute("data-wp-emoji","1")}(e)})}),e.on("postprocess",function(e){e.content&&(e.content=e.content.replace(/<img[^>]+data-wp-emoji="[^>]+>/g,function(e){const t=e.match(/alt="([^"]+)"/);return t&&t[1]?t[1]:e}))}),e.on("resolvename",function(t){"IMG"===t.target.nodeName&&e.dom.getAttrib(t.target,"data-wp-emoji")&&t.preventDefault()})}var Io=s("./client/components/tinymce/i18n.js"),Oo=s("./client/state/selectors/get-current-locale-slug.js"),To=s("./client/state/selectors/is-rtl.js");s("./client/components/tinymce/style.scss");[function(){R.a.PluginManager.add("wpcom",Te)},function(){R.a.PluginManager.add("wpcom/autoresize",Pe)},function(){R.a.PluginManager.add("wpcom/help",Me)},function(){R.a.PluginManager.add("wpcom/charmap",Ue)},function(){R.a.PluginManager.add("wpcom/view",Ft)},function(){R.a.PluginManager.add("wpcom/sourcecode",Vt)},function(){R.a.PluginManager.add("wpeditimage",Ht)},Wt.a,()=>{R.a.PluginManager.add("wpcom/insertmenu",ri)},function(){R.a.PluginManager.add("wpcom/media",ks)},function(){R.a.PluginManager.add("wpcom/advanced",Rs)},function(){R.a.PluginManager.add("wpcom/tabindex",Ms)},()=>{R.a.PluginManager.add("wpcom/trackpaste",Bs)},function(){R.a.PluginManager.add("wpcom/touchscrolltoolbar",zs)},function(){R.a.PluginManager.add("wpcom/editorbuttonanalytics",Ys)},()=>{R.a.PluginManager.add("wpcom/calypsoalert",Qs)},()=>{R.a.PluginManager.add("wpcom/contactform",An)},function(){R.a.PluginManager.add("AtD",si)},function(){R.a.PluginManager.add("wptextpattern",ni)},function(){R.a.PluginManager.add("wpcom/toolbarpin",ii)},()=>{R.a.PluginManager.add("embed",li)},()=>{R.a.PluginManager.add("wpcom/embedreversal",di)},function(){R.a.PluginManager.add("wpcom/markdown",wo)},function(){R.a.PluginManager.add("wpemoji",Co)},()=>{R.a.PluginManager.add("wpcom/simplepayments",qn)}].forEach(e=>e());let Po=1;const ko="/do-not-load/",Do={activate:"onActivate",blur:"onBlur",change:"onChange",click:"onClick",input:"onInput",keyUp:"onKeyUp",deactivate:"onDeactivate",focus:"onFocus",hide:"onHide",init:"onInit",mouseUp:"onMouseUp",redo:"onRedo",remove:"onRemove",reset:"onReset",show:"onShow",submit:"onSubmit",undo:"onUndo",setContent:"onSetContent"},No=["colorpicker","embed","hr","lists","media","paste","tabfocus","textcolor","wptextpattern","wpcom","wpeditimage","wplink","AtD","directionality","wpemoji","wpcom/autoresize","wpcom/media","wpcom/advanced","wpcom/help","wpcom/charmap","wpcom/tabindex","wpcom/touchscrolltoolbar","wpcom/view","wpcom/editorbuttonanalytics","wpcom/calypsoalert","wpcom/tabindex","wpcom/toolbarpin","wpcom/contactform","wpcom/sourcecode","wpcom/embedreversal","wpcom/trackpaste","wpcom/insertmenu","wpcom/markdown","wpcom/simplepayments"];St.a.isEnabled("memberships")&&(R.a.PluginManager.add("wpcom/memberships",xo),No.push("wpcom/memberships")),R.a.PluginManager.add("wpcom/mentions",Ni),No.push("wpcom/mentions");const Ro=[window.app.staticUrls["tinymce/skins/wordpress/wp-content.css"],"//s1.wp.com/wp-includes/css/dashicons.css?v=20150727",window.app.staticUrls["editor.css"],"https://fonts.googleapis.com/css?family=Noto+Serif:400,400i,700,700i&subset=cyrillic,cyrillic-ext,greek,greek-ext,latin-ext,vietnamese"];class Mo extends m.a.Component{constructor(){var e;super(...arguments),e=this,S()(this,"state",{content:"",selection:null}),S()(this,"_editor",null),S()(this,"_id","tinymce-"+Po++),S()(this,"textInput",m.a.createRef()),S()(this,"destroyEditor",()=>{Object(y.forEach)(Do,function(e,t){this.props[e]&&this._editor.off(t,this.props[e])}.bind(this)),R.a.remove(this._editor),this._editor=null,Oe.a.destroy(this.textInput.current)}),S()(this,"doAutosizeUpdate",()=>{Oe.a.update(this.textInput.current)}),S()(this,"bindEditorEvents",e=>{e=e||{},Object(y.forEach)(Do,function(t,s){e[t]!==this.props[t]&&(this.props[t]?this._editor.on(s,this.props[t]):this._editor.off(s,this.props[t]))}.bind(this))}),S()(this,"toggleEditor",function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{autofocus:!0};if(e._editor){if("html"===e.props.mode)return e._editor.hide(),e.doAutosizeUpdate(),void(t.autofocus&&e.focusEditor());e._editor.show(),t.autofocus&&e.focusEditor()}}),S()(this,"focusEditor",()=>{if("html"===this.props.mode){const e=this.textInput.current;this.state.selection?this.selectTextInTextArea(this.state.selection):e.setSelectionRange(0,0),11!==R.a.Env.ie&&e.focus()}else this._editor&&this._editor.focus()}),S()(this,"getContent",e=>{if("html"===this.props.mode)return this.state.content;if(!this._editor)return"";let t=this._editor.getContent(e);return e&&"raw"===e.format||(t=t.replace(/<p>(?:<br ?\/?>|\u00a0|\uFEFF| )*<\/p>/g,"<p>&nbsp;</p>"),t=Object(Y.e)(t)),t}),S()(this,"isDirty",()=>!!this._editor&&this._editor.isDirty()),S()(this,"setTextAreaContent",e=>{this.setState({content:Object(Y.b)(e)},this.doAutosizeUpdate)}),S()(this,"setEditorContent",function(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e._editor){const n=e.props.mode;e._editor.setContent(Object(Y.g)(t),Ce()({},s,{mode:n})),s.initial&&e._editor.undoManager.clear()}e.setTextAreaContent(t)}),S()(this,"setSelection",e=>{this.setState({selection:e})}),S()(this,"selectTextInTextArea",e=>{if(!e)return;const t=this.textInput.current,s=e.start,n=e.end||e.start;t.setSelectionRange(s,n),this.setState({selection:null})}),S()(this,"onTextAreaChange",e=>{const t=e.target.value;this.props.onTextEditorChange&&this.props.onTextEditorChange(t),this.setState({content:t},this.doAutosizeUpdate)}),S()(this,"onToolbarChangeContent",e=>{this.props.onTextEditorChange&&this.props.onTextEditorChange(e),this.setState({content:e},this.doAutosizeUpdate)}),S()(this,"localize",(e,t)=>{let s=Io.a;e&&(s=Object(y.assign)({_dir:"rtl"},s)),R.a.addI18n(t,s),R.a.ScriptLoader.markDone(ko)})}componentDidUpdate(e){this._editor&&(this.bindEditorEvents(e),this.props.mode!==e.mode&&this.toggleEditor())}componentDidMount(){const e=this.props,t=e.isGutenbergClassicBlock,s=e.isVipSite;this.mounted=!0;const n=function(e){this._editor=e,this.mounted?(this.bindEditorEvents(),e.on("SetTextAreaContent",e=>this.setTextAreaContent(e.content)),e.once("PostRender",this.toggleEditor.bind(this,{autofocus:!this.props.isNew}))):this.destroyEditor()}.bind(this),i=this.context.store;let o=!1,a="en",r=void 0;if(i){const e=i.getState();o=Object(To.a)(e),a=Object(Oo.a)(e),r=Object(Ns.b)(e,"colorScheme")}this.localize(o,a);const c=o?"ltr,":"",l=t?" is-gutenberg":"",d=s?",spellchecker":"";R.a.init({selector:"#"+this._id,skin_url:"/calypso/tinymce/skins/lightgray",skin:"lightgray",content_css:Ro,language:a,language_url:ko,directionality:o?"rtl":"ltr",formats:{alignleft:[{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li",styles:{textAlign:"left"}},{selector:"img,table,dl.wp-caption",classes:"alignleft"}],aligncenter:[{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li",styles:{textAlign:"center"}},{selector:"img,table,dl.wp-caption",classes:"aligncenter"}],alignright:[{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li",styles:{textAlign:"right"}},{selector:"img,table,dl.wp-caption",classes:"alignright"}],strikethrough:{inline:"del"}},relative_urls:!1,remove_script_host:!1,convert_urls:!1,branding:!1,browser_spellcheck:!0,fix_list_elements:!0,entities:"38,amp,60,lt,62,gt",entity_encoding:"raw",keep_styles:!1,wpeditimage_html5_captions:!0,redux_store:this.context.store,textarea:this.textInput.current,preview_styles:"font-family font-size font-weight font-style text-decoration text-transform",end_container_on_empty_block:!0,plugins:No.join(),statusbar:!1,resize:!1,menubar:!1,indent:!1,atd_rpc_id:"https://wordpress.com",atd_ignore_enable:!0,autoresize_min_height:t?150:Math.max(document.documentElement.clientHeight-300,300),autoresize_bottom_margin:t||Object(ye.e)()?10:50,toolbar1:"wpcom_insert_menu,formatselect,bold,italic,bullist,numlist,link,blockquote,alignleft,aligncenter,alignright".concat(d,",wp_more,").concat(c,"wpcom_advanced"),toolbar2:"strikethrough,underline,hr,alignjustify,forecolor,pastetext,removeformat,wp_charmap,outdent,indent,undo,redo,wp_help",toolbar3:"",toolbar4:"",tabfocus_elements:"content-html,save-post",tabindex:this.props.tabIndex,body_class:"content post-type-post post-status-draft post-format-standard locale-en-us".concat(l),add_unload_trigger:!1,color_scheme:r,setup:n}),Oe()(this.textInput.current)}componentWillUnmount(){this.mounted=!1,this._editor&&this.destroyEditor()}render(){const e=this.props.mode,t=D()({tinymce:!0,"is-visible":"html"===e}),s=D()("tinymce-container","editor-mode-"+e);return m.a.createElement("div",{className:s},"html"===e&&St.a.isEnabled("post-editor/html-toolbar")&&m.a.createElement(xi,{content:this.textInput.current,onToolbarChangeContent:this.onToolbarChangeContent}),m.a.createElement("textarea",{ref:this.textInput,className:t,id:this._id,onChange:this.onTextAreaChange,tabIndex:this.props.tabIndex,value:this.state.content}))}}S()(Mo,"displayName","TinyMCE"),S()(Mo,"propTypes",{isNew:T.a.bool,mode:T.a.string,tabIndex:T.a.number,onActivate:T.a.func,onBlur:T.a.func,onChange:T.a.func,onClick:T.a.func,onDeactivate:T.a.func,onFocus:T.a.func,onHide:T.a.func,onInit:T.a.func,onInput:T.a.func,onKeyUp:T.a.func,onMouseUp:T.a.func,onRedo:T.a.func,onRemove:T.a.func,onReset:T.a.func,onShow:T.a.func,onSubmit:T.a.func,onSetContent:T.a.func,onUndo:T.a.func,onTextEditorChange:T.a.func,isGutenbergClassicBlock:T.a.bool,isVipSite:T.a.bool}),S()(Mo,"contextTypes",{store:T.a.object}),S()(Mo,"defaultProps",{mode:"tinymce",isNew:!1,isGutenbergClassicBlock:!1});var Lo=s("./client/components/segmented-control/index.jsx"),Ao=s("./client/components/segmented-control/item.jsx");class Uo extends m.a.Component{constructor(){super(...arguments),S()(this,"state",{isPage:this.isPage()}),S()(this,"startNewPage",()=>{const e=Object(j.d)(a.a.current),t=this.state.isPage?"/page/":"/post/";a()(t+e)})}isPage(){return Object(y.startsWith)(a.a.current,"/page/")}getDialogButtons(){const e=this.state.isPage?this.props.translate("New Page"):this.props.translate("New Post");return[m.a.createElement(De.a,{key:"startNewPage",isPrimary:!0,onClick:this.startNewPage},e),m.a.createElement(De.a,{key:"back",isPrimary:!1,onClick:this.props.onClose},this.props.translate("Close"))]}getStrings(e){return e?{dialogTitle:this.props.translate("Invalid Page Address"),dialogContent:this.props.translate("This page cannot be found. Check the web address or start a new page.")}:{dialogTitle:this.props.translate("Invalid Post Address"),dialogContent:this.props.translate("This post cannot be found. Check the web address or start a new post.")}}render(){const e=this.getStrings(this.state.isPage);return m.a.createElement(ke.a,{isVisible:!0,buttons:this.getDialogButtons()},m.a.createElement("h1",null,e.dialogTitle),m.a.createElement("p",null,e.dialogContent))}}S()(Uo,"displayName","EditorTrashedDialog"),S()(Uo,"defaultProps",{onClose:y.noop}),S()(Uo,"propTypes",{onClose:T.a.func});var qo=Object(h.localize)(Uo);class Fo extends u.Component{constructor(){super(...arguments),S()(this,"getStrings",()=>{const e=this.props,t=e.isAutosave,s=e.postType,n=e.translate,i="page"===s;return t?i?{dialogTitle:n("Saved Draft"),dialogContent:n("A more recent revision of this page exists. Restore?")}:{dialogTitle:n("Saved Draft"),dialogContent:n("A more recent revision of this post exists. Restore?")}:i?{dialogTitle:n("Deleted Page"),dialogContent:n("This page has been sent to the trash. Restore it to continue writing.")}:{dialogTitle:n("Deleted Post"),dialogContent:n("This post has been sent to the trash. Restore it to continue writing.")}})}render(){const e=this.props,t=e.onClose,s=e.onRestore,n=e.translate,i=this.getStrings(),o=[m.a.createElement(De.a,{key:"restore",isPrimary:!0,onClick:s},n("Restore")),m.a.createElement(De.a,{key:"back",isPrimary:!1,onClick:t},n("Don't restore"))];return m.a.createElement(ke.a,{isVisible:!0,buttons:o},m.a.createElement("h1",null,i.dialogTitle),m.a.createElement("p",null,i.dialogContent))}}S()(Fo,"propTypes",{translate:T.a.func,onClose:T.a.func,onRestore:T.a.func,isAutosave:T.a.bool,postType:T.a.string}),S()(Fo,"defaultProps",{onClose:y.noop,onRestore:y.noop,isAutosave:!1});var Bo=Object(P.b)(e=>{const t=Object(B.e)(e),s=Object(z.f)(e);return{postType:Object(V.c)(e,t,s,"type")}})(Object(h.localize)(Fo)),zo=s("./client/components/email-verification/email-verification-dialog/index.jsx"),Vo=s("./node_modules/url/url.js"),Ho=s.n(Vo),Wo=s("./client/lib/url/index.js"),Go=s("./client/components/web-preview/index.jsx");s("./client/post-editor/editor-preview/style.scss");class Yo extends m.a.Component{constructor(){super(...arguments),S()(this,"state",{iframeUrl:"about:blank"}),S()(this,"_hasTouch",!1),S()(this,"didStartSaving",(e,t)=>!(!e||!t)&&(t.isSaving&&!e.isSaving)),S()(this,"didFinishSaving",e=>e.isSaving&&!this.props.isSaving),S()(this,"didLoad",e=>e&&e.isLoading&&!this.props.isLoading),S()(this,"didShowSavedPreviewViaTouch",e=>this._hasTouch&&!e.showPreview&&this.props.showPreview&&!this.props.isSaving&&!this.props.isLoading),S()(this,"didShowOrHideFullPreview",e=>Object(St.c)("post-editor/preview-scroll-to-content")&&"about:blank"!==this.state.iframeUrl&&e.showPreview!==this.props.showPreview),S()(this,"getIframePreviewUrl",()=>{const e=Ho.a.parse(this.props.previewUrl,!0);return e.query.preview="true",e.query.iframe="true",e.query.revision=String(this.props.revision),this.props.postId&&Object(St.c)("post-editor/preview-scroll-to-content")&&(this.props.showPreview?e.hash="post-"+this.props.postId:e.hash="__preview-hidden"),delete e.search,Ho.a.format(e)}),S()(this,"cleanExternalUrl",e=>Object(Wo.h)(e,["iframe","frame-nonce"]))}componentDidUpdate(e){this.didStartSaving(e,this.props)&&this.setState({iframeUrl:"about:blank"}),this.props.previewUrl&&(this.didFinishSaving(e)||this.didLoad(e)||this.didShowSavedPreviewViaTouch(e)||this.didShowOrHideFullPreview(e))&&this.setState({iframeUrl:this.getIframePreviewUrl()})}componentWillUnmount(){window.removeEventListener("keydown",this.keyDown)}render(){const e=this.props.isFullScreen,t=D()("editor-preview",{"is-fullscreen":e});return m.a.createElement("div",{className:t},e?m.a.createElement(Go.a,{isContentOnly:!0,showPreview:this.props.showPreview,showEdit:!0,showExternal:!0,showUrl:!0,onClose:this.props.onClose,onEdit:this.props.onEdit,previewUrl:this.state.iframeUrl,editUrl:this.props.editUrl,externalUrl:this.cleanExternalUrl(this.props.externalUrl),loadingMessage:this.props.translate("{{strong}}One moment, please.{{/strong}} We're loading your preview.",{components:{strong:m.a.createElement("strong",null)}})}):m.a.createElement(Go.a,{showPreview:this.props.showPreview,onClose:this.props.onClose,previewUrl:this.state.iframeUrl,externalUrl:this.cleanExternalUrl(this.props.externalUrl)}))}}S()(Yo,"propTypes",{showPreview:T.a.bool,isSaving:T.a.bool,isLoading:T.a.bool,isFullScreen:T.a.bool,previewUrl:T.a.string,editUrl:T.a.string,onClose:T.a.func,postId:T.a.number,revision:T.a.number});var Ko=Object(h.localize)(Yo),$o=s("./client/state/ui/layout-focus/actions.js");const Qo=()=>e=>{e(Object(Ds.b)("editor-sidebar","closed")),e(Object(Us.k)(Object(Us.b)(Object(Us.i)("calypso_editor_sidebar_toggle_close"),Object(Us.g)("Editor","Sidebar Toggle","close"),Object(Us.a)("editor_actions","close-sidebar")),Object($o.b)("content")))};var Jo=s("./client/state/selectors/edited-post-has-content.js"),Zo=s("./client/state/selectors/has-broken-site-user-connection.js"),Xo=s("./client/state/selectors/is-vip-site.js"),ea=s("./node_modules/moment-timezone/index.js"),ta=s.n(ea),sa=s("./client/components/post-schedule/index.jsx"),na=s("./client/components/data/query-posts/index.jsx"),ia=s("./client/lib/site/utils.js");const oa=Object(P.b)((e,t)=>{let s=t.site,n=t.query;return{posts:Object(V.i)(e,Object(y.get)(s,"ID"),n)||[]}})(function(e){let t=e.onDateChange,s=e.onMonthChange,n=e.posts,i=e.selectedDay,o=e.site;return m.a.createElement(sa.a,{displayInputChrono:!1,selectedDay:i,onDateChange:t,onMonthChange:s,posts:n,site:o,timezone:Object(ia.f)(o),gmtOffset:Object(ia.b)(o)})});class aa extends u.PureComponent{constructor(){super(...arguments),S()(this,"state",this.getFirstAndLastDayOfTheMonth(this.props.initialDate)),S()(this,"setCurrentMonth",e=>{this.setState(this.getFirstAndLastDayOfTheMonth(e))})}getFirstAndLastDayOfTheMonth(e){const t=Object(ia.f)(this.props.site),s=t?ta.a.tz(e,t):ta()(e);return{firstDayOfTheMonth:s.clone().startOf("month").startOf("week"),lastDayOfTheMonth:s.clone().endOf("month").endOf("week")}}render(){const e=this.props,t=e.post,s=e.setPostDate,n=e.site,i={status:"publish,future",before:this.state.lastDayOfTheMonth.format(),after:this.state.firstDayOfTheMonth.format(),number:100};return m.a.createElement(u.Fragment,null,!G.v(t)&&m.a.createElement(na.a,{siteId:Object(y.get)(n,"ID"),query:i}),m.a.createElement(oa,{onDateChange:s,onMonthChange:this.setCurrentMonth,query:i,selectedDay:Object(y.get)(t,"date"),site:n}))}}S()(aa,"propTypes",{initialDate:T.a.object.isRequired,post:T.a.object,setPostDate:T.a.func,site:T.a.object});s("./client/post-editor/editor-publish-date/style.scss");class ra extends m.a.Component{constructor(){super(...arguments),S()(this,"state",{isOpen:!1}),S()(this,"handleOutsideClick",e=>{const t="string"==typeof e.target.className?e.target.className.split(/\s/):[],s=Object(y.intersection)(t,["DayPicker-Day","date-picker__day"]).length>0,n=I.a.findDOMNode(this.refs.editorPublishDateWrapper).contains(e.target);s||n||this.setState({isOpen:!1})}),S()(this,"setImmediate",()=>{this.props.setPostDate(!1),this.setState({isOpen:!1})}),S()(this,"toggleOpenState",()=>{this.setState({isOpen:!this.state.isOpen})})}componentWillUnmount(){window.removeEventListener("click",this.handleOutsideClick)}componentDidUpdate(){this.state.isOpen?window.addEventListener("click",this.handleOutsideClick):window.removeEventListener("click",this.handleOutsideClick)}getHeaderDescription(){const e=G.u(this.props.post),t=G.q(this.props.post),s=G.y(this.props.post);return s&&e?this.props.translate("Scheduled"):e?this.props.translate("Schedule"):s?this.props.translate("Published"):t?this.props.translate("Backdate"):this.props.translate("Publish Immediately")}renderCalendarHeader(){const e=G.u(this.props.post),t=G.q(this.props.post);if(!G.y(this.props.post))return e||t?m.a.createElement(q.a,{borderless:!0,className:"editor-publish-date__immediate",onClick:this.setImmediate},this.props.translate("Cancel scheduling")):m.a.createElement("div",{className:"editor-publish-date__choose-header"},this.props.translate("Choose a date to schedule"))}renderHeader(){const e=G.u(this.props.post),t=G.q(this.props.post),s=G.y(this.props.post),n=D()("editor-publish-date__header",{"is-scheduled":e,"is-back-dated":t,"is-published":s}),i=this.props.post&&this.props.post.date?this.props.post.date:null;return m.a.createElement("div",{className:n,onClick:this.toggleOpenState},m.a.createElement(A.a,{className:"editor-publish-date__header-icon",icon:"calendar",size:18}),m.a.createElement("div",{className:"editor-publish-date__header-wrapper"},m.a.createElement("div",{className:"editor-publish-date__header-description"},this.getHeaderDescription()),(e||t||s)&&m.a.createElement("div",{className:"editor-publish-date__header-chrono"},this.props.moment(i).calendar())),m.a.createElement(A.a,{className:"editor-publish-date__header-chevron",icon:"chevron-down",size:18}))}renderSchedule(){const e=this.props.post&&this.props.post.date?this.props.post.date:null,t=G.u(this.props.post),s=D()("editor-publish-date__schedule",{"is-scheduled":t});return m.a.createElement("div",{className:s},this.renderCalendarHeader(),m.a.createElement(aa,{post:this.props.post,site:this.props.site,initialDate:this.props.moment(),setPostDate:this.props.setPostDate,selectedDay:e}))}render(){const e=D()("editor-publish-date",{"is-open":this.state.isOpen});return m.a.createElement("div",{className:e},m.a.createElement("div",{className:"editor-publish-date__wrapper",ref:"editorPublishDateWrapper"},this.renderHeader(),this.state.isOpen&&this.renderSchedule()))}}S()(ra,"propTypes",{post:T.a.object,setPostDate:T.a.func});var ca=Object(P.b)(e=>({site:Object(B.d)(e)}))(Object(h.localize)(ra)),la=s("./client/lib/touch-detect/index.js"),da=s("./client/state/selectors/is-private-site.js");s("./client/post-editor/editor-visibility/style.scss");class pa extends m.a.Component{constructor(){super(...arguments),S()(this,"state",{passwordIsValid:!0}),S()(this,"getVisibility",()=>this.props.password?"password":"private"===this.props.status?"private":"public"),S()(this,"recordStats",e=>{this.getVisibility()!==e&&(this.props.recordEditorStat("visibility-set-"+e),this.props.recordEditorEvent("Changed visibility",e),this.props.recordTracksEvent("calypso_editor_visibility_set",{context:this.props.context,visibility:e}))}),S()(this,"onPrivatePublish",()=>{this.setPostToPrivate(),setTimeout(()=>this.props.onPrivatePublish(!0),0)}),S()(this,"onSetToPrivate",()=>{if("private"===this.props.savedStatus)return void this.setPostToPrivate();let e;e="page"===this.props.type?this.props.translate("Private pages are only visible to administrators and editors of this site. Would you like to privately publish this page now?"):this.props.translate("Private posts are only visible to administrators and editors of this site. Would you like to privately publish this post now?"),Object(mo.a)(e,e=>{e&&this.onPrivatePublish()},this.props.translate("Yes"),this.props.translate("No"))}),S()(this,"onPasswordChange",e=>{const t=this.props,s=t.siteId,n=t.postId;let i=e.target.value.trim();const o=i.length>0;this.setState({passwordIsValid:o}),o||(i=" "),this.props.editPost(s,n,{password:i})}),S()(this,"renderPrivacyDropdown",e=>{const t=this.props.translate("Public",{context:"Editor: Radio label to set post visible to public"}),s=this.props.translate("Site Members",{context:"Editor: Radio label to set post visible to public on a private site so that only site members can see it"}),n=[{label:this.props.isPrivateSite?s:t,icon:m.a.createElement(A.a,{icon:"globe",size:18}),value:"public",onClick:()=>{this.updateVisibility("public")}},{label:this.props.translate("Admins and Editors",{context:"Editor: Radio label to set post to private so that only admins and editors can see it"}),icon:m.a.createElement(A.a,{icon:"user",size:18}),value:"private",onClick:this.onSetToPrivate},{label:this.props.translate("Password Protected",{context:"Editor: Radio label to set post to password protected"}),icon:m.a.createElement(A.a,{icon:"lock",size:18}),value:"password",onClick:()=>{this.updateVisibility("password")}}],i=Object(y.find)(n,["value",e]);return m.a.createElement("div",{className:"editor-visibility__dropdown"},m.a.createElement(vs.a,{className:"editor-fieldset"},m.a.createElement(En.a,{selectedText:i?i.label:this.props.translate("Select an option"),selectedIcon:i.icon},n.map(t=>m.a.createElement(vn.a,{selected:t.value===e,key:t.value,value:t.value,onClick:t.onClick,icon:t.icon},t.label))),"password"===e?this.renderPasswordInput():null))})}componentWillReceiveProps(e){if(this.props.password===e.password)return;const t=this.props.password+"",s=e.password+"",n=""===t&&" "===s,i=s.trim().length>0,o=n||i;this.setState({passwordIsValid:o})}updateVisibility(e){const t=this.props,s=t.siteId,n=t.postId,i={status:"draft"===t.status?"draft":"publish"};switch(e){case"public":i.password="";break;case"password":i.password=this.props.savedPassword||" ",i.sticky=!1,this.setState({passwordIsValid:!0})}this.props.editPost(s,n,i),this.recordStats(e)}setPostToPrivate(){const e=this.props,t=e.siteId,s=e.postId;this.props.editPost(t,s,{status:"private",password:"",sticky:!1}),this.recordStats("private")}renderPasswordInput(){const e=this.props.password?this.props.password.trim():null,t=!this.state.passwordIsValid,s=this.props.translate("Password is empty.",{context:"Editor: Error shown when password is empty."});return m.a.createElement("div",null,m.a.createElement(de.a,{autoFocus:!0,onChange:this.onPasswordChange,onBlur:this.onPasswordChange,value:e,isError:t,placeholder:this.props.translate("Create password",{context:"Editor: Create password for post"})}),t?m.a.createElement(Xs.a,{isError:!0,text:s}):null)}render(){if(!this.props.hasPost)return null;const e=this.getVisibility(),t=D()("editor-visibility",{"is-touch":Object(la.a)()});return m.a.createElement("div",{className:t},this.renderPrivacyDropdown(e))}}S()(pa,"propTypes",{context:T.a.string,onPrivatePublish:T.a.func,isPrivateSite:T.a.bool,hasPost:T.a.bool,type:T.a.string,status:T.a.string,password:T.a.string,savedStatus:T.a.string,savedPassword:T.a.string,siteId:T.a.number,postId:T.a.number});var ua=Object(P.b)(e=>{const t=Object(B.e)(e),s=Object(z.f)(e),n=Object(V.l)(e,t,s),i=Object(V.a)(e,t,s);return{siteId:t,postId:s,hasPost:!!i,type:Object(y.get)(i,"type",null),status:Object(y.get)(i,"status","draft"),password:Object(y.get)(i,"password",null),savedStatus:Object(y.get)(n,"status",null),savedPassword:Object(y.get)(n,"password",null),isPrivateSite:Object(da.a)(e,t)}},{editPost:v.e,recordEditorStat:F.b,recordEditorEvent:F.a,recordTracksEvent:Us.i})(Object(h.localize)(pa));class ma extends u.PureComponent{renderPublishHeader(){const e=this.props.translate;return m.a.createElement("div",{className:"editor-confirmation-sidebar__header"},e('{{strong}}Almost there!{{/strong}} Double-check your settings, then press the "Publish!" button.',{comment:"This string appears as the header for the confirmation sidebar when a user publishes a post.",components:{strong:m.a.createElement("strong",null)}}))}renderScheduleHeader(){const e=this.props.translate;return m.a.createElement("div",{className:"editor-confirmation-sidebar__header"},e('{{strong}}Almost there!{{/strong}} Double-check your settings below, then press the "Schedule!" button.',{comment:"This string appears as the header for the confirmation sidebar when a user schedules the publishing of a post.",components:{strong:m.a.createElement("strong",null)}}))}render(){return G.u(this.props.post)?this.renderScheduleHeader():this.renderPublishHeader()}}S()(ma,"propTypes",{post:T.a.object});var ha=Object(h.localize)(ma);s("./client/post-editor/editor-confirmation-sidebar/style.scss");class ga extends u.Component{constructor(){super(...arguments),S()(this,"state",{doFullRender:!1}),S()(this,"getCloseOverlayHandler",e=>()=>this.props.setStatus({status:"closed",context:e})),S()(this,"closeAndPublish",()=>{this.props.setStatus({status:"closed",context:"publish"}),this.props.onPublish(!0)})}static getDerivedStateFromProps(e,t){return t.doFullRender||"closed"===e.status?null:{doFullRender:!0}}getPublishButtonLabel(e){switch(e){case"update":return this.props.translate("Update");case"schedule":return this.props.translate("Schedule!");case"publish":return this.props.translate("Publish!");case"requestReview":return this.props.translate("Submit for Review")}}renderPublishButton(){if(null===this.props.publishButtonStatus)return null;const e=this.getPublishButtonLabel(this.props.publishButtonStatus),t=this.props.isPasswordProtectedWithInvalidPassword;return m.a.createElement(q.a,{primary:!0,disabled:t,onClick:this.closeAndPublish},e)}getBusyButtonLabel(e){switch(e){case"update":return this.props.translate("Updating…");case"schedule":return this.props.translate("Scheduling…");case"publish":return this.props.translate("Publishing…");case"requestReview":return this.props.translate("Submitting for Review…")}return this.props.translate("Publishing…")}renderPrivacyControl(){return m.a.createElement(ua,{onPrivatePublish:this.props.onPrivatePublish,context:"confirmation-sidebar"})}renderPublishingBusyButton(){if("publishing"!==this.props.status||null===this.props.publishButtonStatus)return null;const e=this.getBusyButtonLabel(this.props.publishButtonStatus);return m.a.createElement(q.a,{disabled:!0,primary:!0,busy:!0,className:"editor-confirmation-sidebar__publishing-button"},e)}renderNoticeDisplayPreferenceCheckbox(){return m.a.createElement("div",{className:"editor-confirmation-sidebar__display-preference"},m.a.createElement(js.a,null,m.a.createElement(yn.a,{onChange:this.props.handlePreferenceChange,defaultChecked:!0,className:"editor-confirmation-sidebar__display-preference-checkbox",id:"confirmation_sidebar_display_preference",name:"confirmation_sidebar_display_preference"}),m.a.createElement("span",null,this.props.translate("Show this every time I publish",{comment:"This string appears in the bottom of a publish confirmation sidebar. There is limited space. Longer strings will wrap."}))))}render(){const e="open"===this.props.status,t="closed"!==this.props.status;return this.state.doFullRender?m.a.createElement("div",{className:D()("editor-confirmation-sidebar",{"is-active":t})},this.renderPublishingBusyButton(),m.a.createElement("div",{key:"sidebar",className:D()("editor-confirmation-sidebar__sidebar",{"is-active":e})},m.a.createElement("div",{className:"editor-confirmation-sidebar__ground-control"},m.a.createElement("div",{className:"editor-confirmation-sidebar__close"},m.a.createElement(q.a,{borderless:!0,onClick:this.getCloseOverlayHandler("dismiss_x"),title:this.props.translate("Close sidebar"),"aria-label":this.props.translate("Close sidebar")},m.a.createElement(A.a,{icon:"cross"}))),m.a.createElement("div",{className:"editor-confirmation-sidebar__action"},this.renderPublishButton())),m.a.createElement("div",{className:"editor-confirmation-sidebar__content-wrap"},m.a.createElement(ha,{post:this.props.post}),m.a.createElement(ca,{post:this.props.post,setPostDate:this.props.setPostDate}),m.a.createElement("div",{className:"editor-confirmation-sidebar__privacy-control"},this.renderPrivacyControl())),this.renderNoticeDisplayPreferenceCheckbox())):m.a.createElement("div",{className:"editor-confirmation-sidebar"},m.a.createElement("div",{key:"sidebar",className:"editor-confirmation-sidebar__sidebar"}))}}S()(ga,"propTypes",{handlePreferenceChange:T.a.func,onPrivatePublish:T.a.func,onPublish:T.a.func,post:T.a.object,isPasswordProtectedWithInvalidPassword:T.a.bool,setPostDate:T.a.func,setStatus:T.a.func,status:T.a.string});var ba=Object(P.b)(e=>{const t=Object(B.e)(e),s=Object(z.f)(e);return{siteId:t,postId:s,post:Object(V.a)(e,t,s),isPasswordProtectedWithInvalidPassword:Object(V.p)(e,t,s)&&!Object(V.q)(e,t,s),publishButtonStatus:Object(z.h)(e)}},{editPost:v.e})(Object(h.localize)(ga)),fa=s("./client/components/data/document-head/index.jsx");function ya(e){let t,s=e.translate,n=e.siteId,i=e.type,o=e.typeObject,a=e.newPost;return t="post"===i?s(a?"New Post":"Edit Post",{textOnly:!0}):"page"===i?s(a?"New Page":"Edit Page",{textOnly:!0}):a?o?o.labels.new_item:s("New",{textOnly:!0}):o?o.labels.edit_item:s("Edit",{context:"verb",textOnly:!0}),m.a.createElement("div",null,n&&"page"!==i&&"post"!==i&&m.a.createElement(K.a,{siteId:n}),m.a.createElement(fa.a,{title:t}))}ya.propTypes={translate:T.a.func,siteId:T.a.number,type:T.a.string,typeObject:T.a.object,newPost:T.a.bool};var Ea=Object(P.b)(e=>{const t=Object(B.e)(e),s=Object(z.f)(e),n=Object(V.c)(e,t,s,"type");return{siteId:t,type:n,typeObject:Object($.a)(e,t,n),newPost:Object(z.m)(e)}})(Object(h.localize)(ya));s("./client/post-editor/editor-post-type-unsupported/style.scss");const va=["jetpack-portfolio","jetpack-testimonial"];function ja(e){let t=e.translate,s=e.types,n=e.type,i=e.typeObject,o=e.writePostPath,a=e.siteSlug;if(!s||!n||i)return null;const r=[m.a.createElement(q.a,{href:"/posts/".concat(a)},t("Back to My Sites"))];let c;if(Object(y.includes)(va,n)){switch(n){case"jetpack-portfolio":c=t("Portfolios are not enabled. Open your site settings to activate them.");break;case"jetpack-testimonial":c=t("Testimonials are not enabled. Open your site settings to activate them.")}r.push(m.a.createElement(q.a,{href:"/settings/writing/".concat(a),primary:!0},t("Site Settings")))}else c=t("To use this post type, please check that your theme and site support it."),r.push(m.a.createElement(q.a,{href:o,primary:!0},t("Write a Blog Post")));return m.a.createElement(ke.a,{isVisible:!0,buttons:r,className:"editor-post-type-unsupported"},m.a.createElement("h1",null,t("This post type is not supported")),m.a.createElement("p",null,c),m.a.createElement("p",null,t("For more information, visit our {{supportLink}}support page on custom content types{{/supportLink}}.",{components:{supportLink:m.a.createElement("a",{href:"https://support.wordpress.com/custom-post-types/"})}})))}ja.propTypes={translate:T.a.func,types:T.a.object,type:T.a.string,typeObject:T.a.object,writePostPath:T.a.string,siteSlug:T.a.string};var _a=Object(P.b)((e,t)=>{let s=t.type;const n=Object(B.e)(e),i=s||Object(V.c)(e,n,Object(z.f)(e),"type");return{type:i,types:Object($.b)(e,n),typeObject:Object($.a)(e,n,i),writePostPath:Object(z.d)(e,n),siteSlug:Object(ie.v)(e,n)}})(Object(h.localize)(ja)),xa=s("./client/state/selectors/can-current-user.js");s("./client/post-editor/editor-forbidden/style.scss");function wa(e){let t=e.translate,s=e.userCanEdit,n=e.siteSlug;if(!1!==s)return null;const i=[m.a.createElement(q.a,{key:"back",href:"/posts/".concat(n),primary:!0},t("Back to My Sites"))];return m.a.createElement(ke.a,{isVisible:!0,buttons:i,className:"editor-forbidden"},m.a.createElement("h1",null,t("You can't edit this post type")),m.a.createElement("p",null,t("If you think you should have access to this post type, request that your site administrator grant you access.")))}wa.propTypes={translate:T.a.func,userCanEdit:T.a.bool,siteSlug:T.a.string};var Sa=Object(P.b)(e=>{const t=Object(B.e)(e),s=Object(V.c)(e,t,Object(z.f)(e),"type"),n=Object($.a)(e,t,s),i=Object(y.get)(n,["capabilities","edit_posts"],null);return{userCanEdit:Object(xa.b)(e,t,i),siteSlug:Object(ie.v)(e,t)}})(Object(h.localize)(wa)),Ca=s("./client/components/global-notices/container.jsx");s("./client/post-editor/editor-notice/style.scss");class Ia extends u.Component{constructor(){super(...arguments),S()(this,"handleViewPostClick",()=>{this.props.recordTracksEvent("calypso_editor_notice_view_post_click")}),S()(this,"handleAddPagePromptClick",()=>{this.props.recordTracksEvent("calypso_editor_notice_add_page_prompt_click")})}componentWillReceiveProps(e){Object(ye.e)()&&(!this.props.message&&e.message||!this.props.error&&e.error)&&this.props.setLayoutFocus("content")}getErrorMessage(){const e=this.props,t=e.translate,s=e.error;if(s)switch(s.message){case"NO_CONTENT":return t("You haven't written anything yet!")}}getText(e){const t=this.props,s=t.translate,n=t.type,i=t.typeObject,o=t.site,a=t.postUrl,r=t.postDate,c=(0,t.moment)(r).format("lll"),l=Object(y.get)(i,"labels.singular_name",n);switch(e){case"publishFailure":return"post"===n?s("Publishing of post failed."):"page"===n?s("Publishing of page failed."):s("Publishing of %(typeLabel)s failed.",{args:{typeLabel:l}});case"saveFailure":return s("Saving of draft failed.");case"trashFailure":return"page"===n?s("Trashing of page failed!"):"post"===n?s("Trashing of post failed!"):s("Trashing of %(typeLabel)s failed.",{args:{typeLabel:l}});case"published":return o?"page"===n?s("Page published on {{pageLink/}}! {{a}}Add another page{{/a}}",{components:{pageLink:m.a.createElement("a",{href:a,onClick:this.handleViewPostClick},o.title),a:m.a.createElement("a",{href:"/page/".concat(o.slug),onClick:this.handleAddPagePromptClick})},comment:"Editor: Message displayed when a page is published, with a link to the page."}):"post"===n?s("Post published on {{postLink/}}! {{a}}Add another post{{/a}}",{components:{postLink:m.a.createElement("a",{href:a,onClick:this.handleViewPostClick},o.title),a:m.a.createElement("a",{href:"/post/".concat(o.slug),onClick:this.handleAddPagePromptClick})},comment:"Editor: Message displayed when a post is published, with a link to the post."}):s("%(typeLabel)s published on {{postLink/}}!",{args:{typeLabel:l},components:{postLink:m.a.createElement("a",{href:a,onClick:this.handleViewPostClick},o.title)},comment:"Editor: Message displayed when a post or post of a custom type is published, with a link to the post."}):"page"===n?s("Page published!"):"post"===n?s("Post published!"):s("%(typeLabel)s published!",{args:{typeLabel:l}});case"scheduled":return"post"===n?s("Post scheduled for %(formattedPostDate)s!",{args:{formattedPostDate:c},comment:"Editor: Message displayed when a post is scheduled, with the scheduled date and time."}):"page"===n?s("Page scheduled for %(formattedPostDate)s!",{args:{formattedPostDate:c},comment:"Editor: Message displayed when a page is scheduled, with the scheduled date and time."}):s("%(typeLabel)s scheduled for %(formattedPostDate)s!",{args:{typeLabel:l,formattedPostDate:c},comment:"Editor: Message displayed when a post of a custom type is scheduled, with the scheduled date and time."});case"publishedPrivately":return s("{{strong}}Published privately.{{/strong}} Only admins and editors can view.",{components:{strong:m.a.createElement("strong",null)},comment:"Editor: Message displayed when a post is published privately."});case"view":return i.labels.view_item;case"preview":return s("View Preview");case"updated":return"page"===n?s("Page updated! {{pageLink}}Visit page{{/pageLink}}.",{components:{pageLink:m.a.createElement("a",{href:a,onClick:this.handleViewPostClick})},comment:"Editor: Message displayed when a page is updated, with a link to the updated page."}):"post"===n?s("Post updated! {{postLink}}Visit post{{/postLink}}.",{components:{postLink:m.a.createElement("a",{href:a,onClick:this.handleViewPostClick})},comment:"Editor: Message displayed when a post is updated, with a link to the updated post."}):s("%(typeLabel)s updated! {{postLink}}Visit %(typeLabel)s{{/postLink}}.",{args:{typeLabel:l},components:{postLink:m.a.createElement("a",{href:a,onClick:this.handleViewPostClick})},comment:"Editor: Message displayed when a post of a custom type is updated, with a link to the updated post."})}}render(){const e=this.props,t=e.siteId,s=e.message,n=e.status,i=e.onDismissClick,o=this.getErrorMessage()||this.getText(s);return m.a.createElement(Ca.a,{className:"editor-notice is-global"},t&&m.a.createElement(K.a,{siteId:t}),o&&m.a.createElement(Fi.b,x()({status:n,text:o,onDismissClick:i},{showDismiss:!0})))}}S()(Ia,"propTypes",{translate:T.a.func,moment:T.a.func,siteId:T.a.number,site:T.a.object,type:T.a.string,typeObject:T.a.object,message:T.a.string,status:T.a.string,onDismissClick:T.a.func,error:T.a.object,postUrl:T.a.string,postDate:T.a.string});var Oa=Object(P.b)(e=>{const t=Object(B.e)(e),s=Object(V.a)(e,t,Object(z.f)(e));return s?{siteId:t,site:Object(B.d)(e),type:s.type,typeObject:Object($.a)(e,t,s.type),postUrl:s.URL||null,postDate:s.date||null}:{}},{setLayoutFocus:$o.b,recordTracksEvent:Us.i})(Object(h.localize)(Ia)),Ta=s("./client/components/notice/notice-action.jsx"),Pa=s("./client/state/selectors/is-gutenberg-enabled.js");function ka(){return{type:"GUTENBERG_OPT_IN_DIALOG_IS_SHOWING",isShowing:!0}}s("./client/post-editor/editor-gutenberg-opt-in-notice/style.scss");class Da extends u.Component{constructor(e){super(e),S()(this,"dismissNotice",()=>this.props.dismissNotice("gutenberg_nudge_notice_dismissed",!0)),this.state={hasOpenedSidebar:!1}}static getDerivedStateFromProps(e,t){return!t.hasOpenedSidebar&&e.sidebarOpen?{hasOpenedSidebar:!0}:null}render(){if(!this.props.optInEnabled||this.props.noticeDismissed||this.state.hasOpenedSidebar||Object(ye.e)())return null;const e=this.props,t=e.translate,s=e.showDialog;return m.a.createElement(Fi.b,{className:"editor-gutenberg-opt-in-notice",status:"is-info",onDismissClick:this.dismissNotice,text:t("Try the new block editor and level up your layout.")},m.a.createElement(Ta.a,{onClick:s},t("Learn More")))}}S()(Da,"propTypes",{translate:T.a.func,showDialog:T.a.func,optInEnabled:T.a.bool,noticeDismissed:T.a.bool,sidebarOpen:T.a.bool,dismissNotice:T.a.func});const Na={showDialog:ka,dismissNotice:Ds.b};var Ra=Object(P.b)(e=>({optInEnabled:Object(St.c)("gutenberg/opt-in")&&Object(Pa.a)(e,Object(B.e)(e)),noticeDismissed:Object(Ns.b)(e,"gutenberg_nudge_notice_dismissed"),sidebarOpen:"open"===Object(Ns.b)(e,"editor-sidebar")}),Na)(Object(h.localize)(Da));s("./node_modules/diff/dist/diff.js");function Ma(e){if(e&&"string"==typeof e){const t=(e=(e=(e=(e=(e=(e=e.replace(/\.\.\./g," ")).replace(/<.[^<>]*?>/g," ")).replace(/&nbsp;|&#160;/gi," ")).replace(/(\w+)(&#?[a-z0-9]+;)+(\w+)/i,"$1$3")).replace(/&.+?;/g," ")).replace(/[0-9.(),;:!?%#$\x27\x22_+=\\\/\-]*/g,"")).match(/[\w\u2019\x27\-\u00C0-\u1FFF]+/g);if(t)return t.length}return 0}s("./client/post-editor/editor-word-count/style.scss");class La extends u.Component{getSelectedTextCount(){const e=Ma(this.props.selectedText);return e?this.props.translate("%(selectedText)s word selected {{span}}%(separator)s{{/span}}","%(selectedText)s words selected {{span}}%(separator)s{{/span}}",{count:e,args:{selectedText:e,separator:"/ "},components:{span:m.a.createElement("span",{className:"editor-word-count__separator"})}}):null}render(){switch(this.props.localeSlug){case"ja":case"th":case"zh-cn":case"zh-hk":case"zh-sg":case"zh-tw":case"ko":return null}const e=Ma(this.props.rawContent);return m.a.createElement("div",{className:"editor-word-count"},m.a.createElement("span",{className:"editor-word-count__is-selected-text"},m.a.createElement("strong",null,this.getSelectedTextCount())),this.props.translate("%d word","%d words",{count:e,args:[e]}))}}S()(La,"propTypes",{selectedText:T.a.string,rawContent:T.a.string,localeSlug:T.a.string});var Aa=Object(P.b)(e=>({localeSlug:Object(Vs.h)(e)||"en",rawContent:Object(z.i)(e)}))(Object(h.localize)(La)),Ua=s("./client/components/data/query-preferences/index.jsx"),qa=s("./client/state/ui/layout-focus/selectors.js"),Fa=s("./client/lib/protect-form/index.tsx"),Ba=s("./client/components/accordion/index.jsx"),za=s("./client/components/accordion/section.jsx"),Va=s("./client/post-editor/editor-drawer/label.jsx"),Ha=s("./client/blocks/term-tree-selector/index.jsx"),Wa=s("./client/blocks/term-form-dialog/index.jsx"),Ga=s("./client/state/post-types/taxonomies/selectors.js"),Ya=s("./client/state/terms/selectors.js");s("./client/post-editor/editor-term-selector/add-term.scss");class Ka extends u.Component{constructor(e){super(e),S()(this,"openDialog",e=>{e.preventDefault(),this.setState({showDialog:!0})}),S()(this,"closeDialog",()=>{this.setState({showDialog:!1})}),this.state={showDialog:!1}}render(){const e=this.props,t=e.labels,s=e.onSuccess,n=e.type,i=e.terms,o=e.taxonomy,a=i?i.length:0,r=D()("editor-term-selector__add-term",{"is-compact":a<8});return m.a.createElement("div",{className:r},m.a.createElement(q.a,{borderless:!0,compact:!0,onClick:this.openDialog},m.a.createElement(A.a,{icon:"folder"})," ",t.add_new_item),m.a.createElement(Wa.a,{showDialog:this.state.showDialog,onClose:this.closeDialog,postType:n,taxonomy:o,onSuccess:s}))}}S()(Ka,"propTypes",{labels:T.a.object,onSuccess:T.a.func,taxonomy:T.a.string,terms:T.a.array,type:T.a.string}),S()(Ka,"defaultProps",{onSuccess:y.noop});var $a=Object(P.b)((e,t)=>{let s=t.taxonomy;const n=Object(B.e)(e),i=Object(z.f)(e),o=Object(V.c)(e,n,i,"type"),a=Object(Ga.b)(e,n,o,s),r=Object(y.get)(a,"labels",{});return{terms:Object(Ya.c)(e,n,s),labels:r,type:o}})(Ka);class Qa extends u.Component{constructor(e){super(e),S()(this,"onAddTerm",e=>{const t=this.props,s=t.postId,n=t.taxonomyName,i=t.siteId;this.props.addTermForPost(i,n,e,s)}),this.boundOnTermsChange=this.onTermsChange.bind(this)}onTermsChange(e){const t=this.props,s=t.postTerms,n=t.taxonomyName,i=t.siteId,o=t.postId,a=Object(y.cloneDeep)(s)||{},r=Object(y.toArray)(a[n]),c=Object(y.findIndex)(r,{ID:e.ID});-1!==c?r.splice(c,1):r.push(e),this.props.editPost(i,o,{terms:{[n]:r}})}getSelectedTermIds(){const e=this.props,t=e.postTerms,s=e.taxonomyName,n=t?t[s]:[];return Object(y.map)(n,"ID")}render(){const e=this.props,t=e.taxonomyName,s=e.canEditTerms,n=e.compact;return m.a.createElement("div",null,m.a.createElement(Ha.a,{analyticsPrefix:"Editor",onChange:this.boundOnTermsChange,selected:this.getSelectedTermIds(),taxonomy:t,multiple:!0,compact:n}),s&&m.a.createElement($a,{taxonomy:t,onSuccess:this.onAddTerm}))}}S()(Qa,"propTypes",{siteId:T.a.number,postId:T.a.number,postTerms:T.a.object,taxonomyName:T.a.string,canEditTerms:T.a.bool,compact:T.a.bool});var Ja=Object(P.b)(e=>{const t=Object(B.e)(e),s=Object(z.f)(e);return{postTerms:Object(V.c)(e,t,s,"terms"),canEditTerms:Object(xa.b)(e,t,"manage_categories"),siteId:t,postId:s}},{editPost:v.e,addTermForPost:v.a})(Qa),Za=s("./client/components/data/query-terms/index.jsx");const Xa=As()("calypso:post-editor:editor-terms"),er={number:1e3,order_by:"count",order:"DESC"},tr=20;class sr extends m.a.Component{componentWillMount(){this.boundOnTermsChange=this.onTermsChange.bind(this)}onTermsChange(e){let t,s;Xa("onTermsChange",e,this),e.length>this.getPostTerms().length?(t="term_added",s="Added Term"):(t="term_removed",s="Removed Term"),this.props.recordEditorStat(t),this.props.recordEditorEvent("Changed Terms",s);const n=this.props,i=n.siteId,o=n.postId,a=n.taxonomyName;this.props.editPost(i,o,{terms:{[a]:e}})}getPostTerms(){const e=this.props,t=e.postTerms,s=e.taxonomyName;return t&&t[s]?Array.isArray(t[s])?t[s]:Object.keys(t[s]):[]}render(){const e=Object(y.map)(this.props.terms,"name");return m.a.createElement("div",null,m.a.createElement(Za.a,{siteId:this.props.siteId,taxonomy:this.props.taxonomyName,query:er}),m.a.createElement(jn.a,{value:this.getPostTerms(),displayTransform:Y.b,suggestions:e,onChange:this.boundOnTermsChange,maxSuggestions:tr}))}}sr.propTypes={siteId:T.a.number,postId:T.a.number,postTerms:T.a.object,taxonomyName:T.a.string,taxonomyLabel:T.a.string,terms:T.a.arrayOf(T.a.object),editPost:T.a.func};var nr=Object(P.b)((e,t)=>{const s=Object(B.e)(e),n=Object(z.f)(e),i=Object(V.c)(e,s,n,"type"),o=Object(Ga.b)(e,s,i,t.taxonomyName);return{siteId:s,postId:n,taxonomyLabel:o&&o.label,terms:Object(Ya.c)(e,s,t.taxonomyName),postTerms:Object(V.c)(e,s,n,"terms")}},{editPost:v.e,recordEditorStat:F.b,recordEditorEvent:F.a})(sr);s("./client/post-editor/editor-categories-tags/style.scss");class ir extends u.Component{renderJetpackNotice(){const e=this.props,t=e.translate,s=e.siteSlug;return m.a.createElement(Fi.b,{status:"is-warning",showDismiss:!1,text:t("You must update Jetpack to use this feature."),className:"editor-categories-tags__upgrade-notice"},m.a.createElement(Ta.a,{href:Object(j.b)("/plugins/jetpack",s)},t("Update Now")))}renderCategories(){const e=this.props,t=e.translate,s=e.postType,n=e.isTermsSupported;if("page"!==s)return m.a.createElement(za.a,null,m.a.createElement(Va.a,{helpText:t("Use categories to group your posts by topic."),labelText:t("Categories")}),n?m.a.createElement(Ja,{compact:!0,taxonomyName:"category"}):this.renderJetpackNotice())}renderTags(){const e=this.props,t=e.isTermsSupported,s=e.postType,n=e.translate,i=n("page"===s?"Use tags to associate more specific keywords with your pages.":"Use tags to associate more specific keywords with your posts.");return m.a.createElement(za.a,null,m.a.createElement(Va.a,{helpText:i,labelText:n("Tags")},t?m.a.createElement(nr,{taxonomyName:"post_tag"}):this.renderJetpackNotice()))}getCategoriesSubtitle(){const e=this.props,t=e.translate,s=e.postTerms,n=e.defaultCategory,i=Object(y.toArray)(Object(y.get)(s,"category"));if(i.length>1)return t("%d category","%d categories",{args:[i.length],count:i.length});let o;return(o=i.length>0?i[0]:n)?Object(y.unescape)(o.name):void 0}getTagsSubtitle(){const e=this.props,t=e.translate,s=e.postTerms,n=Object(y.toArray)(Object(y.get)(s,"post_tag")),i=n.length;switch(i){case 0:return null;case 1:case 2:return n.map(e=>"#"+Object(y.unescape)(e.name||e)).join(", ");default:return t("%d tag","%d tags",{args:[i],count:i})}}getSubtitle(){const e=[],t=this.props,s=t.postType;if(!t.siteId)return null;if("post"===s){const t=this.getCategoriesSubtitle();t&&e.push(t)}const n=this.getTagsSubtitle();return n&&e.push(n),e.join(", ")}getTitle(){const e=this.props,t=e.translate;let s;return s=t("page"===e.postType?"Tags":"Categories & Tags")}render(){const e=D()("editor-drawer__accordion","editor-categories-tags__accordion",this.props.className);return m.a.createElement(Ba.a,{title:this.getTitle(),subtitle:this.getSubtitle(),className:e,e2eTitle:"categories-tags"},this.renderCategories(),this.renderTags())}}S()(ir,"propTypes",{translate:T.a.func,postTerms:T.a.object,postType:T.a.string,defaultCategory:T.a.object,isTermsSupported:T.a.bool,siteSlug:T.a.string});var or=Object(P.b)(e=>{const t=Object(B.e)(e),s=Object(z.f)(e),n=Object(ie.r)(e,t,"default_category"),i=!1!==Object(ie.H)(e,t,"4.1.0");return{defaultCategory:Object(Ya.b)(e,t,"category",n),postTerms:Object(V.c)(e,t,s,"terms"),postType:Object(V.c)(e,t,s,"type"),siteSlug:Object(ie.v)(e,t),siteId:t,postId:s,isTermsSupported:i}})(Object(h.localize)(ir));s("./client/post-editor/editor-more-options/slug.scss");class ar extends u.PureComponent{getPopoverLabel(){const e=this.props,t=e.translate;return t("page"===e.postType?"The slug is the part of a web address that identifies a specific page within a site. It's often based on the page title.":"The slug is the part of a web address that identifies a specific post within a site. It's often based on the post title.")}render(){const e=this.props,t=e.postType,s=e.translate;return m.a.createElement(za.a,{className:"editor-more-options__slug"},m.a.createElement(Va.a,{labelText:s("Slug"),helpText:this.getPopoverLabel()},m.a.createElement(ue,{instanceName:t+"-sidebar",className:"editor-more-options__slug-field"})))}}S()(ar,"propTypes",{postType:T.a.string,translate:T.a.func});var rr=Object(P.b)(e=>{const t=Object(B.e)(e);return{postType:Object(V.c)(e,t,Object(z.f)(e),"type")}})(Object(h.localize)(ar)),cr=s("./client/lib/products-values/index.js"),lr=s("./client/components/data/query-jetpack-plugins/index.jsx"),dr=s("./client/state/plugins/installed/selectors.js"),pr=s("./client/components/data/query-taxonomies/index.jsx");function ur(e){let t=e.translate,s=e.siteId,n=e.postType,i=e.isSupported,o=e.taxonomies,a=e.terms;return i?m.a.createElement("div",{className:"editor-drawer__taxonomies"},s&&n&&m.a.createElement(pr.a,{siteId:s,postType:n}),Object(y.reduce)(o,(e,s)=>{const i=s.name,o=s.label,r=s.hierarchical;if(function(e,t){return!!Object(y.includes)(["post_format","mentions","xposts"],t)||"post"===e&&Object(y.includes)(["category","post_tag"],t)}(n,i))return e;const c=Object(y.get)(a,i),l=Object(y.size)(c);let d;return d=l>2?t("%d selected","%d selected",{count:l,args:[l]}):Object(y.map)(c,e=>Object(Y.b)(e.name||e)).join(", "),e.concat(m.a.createElement(Ba.a,{key:i,title:o,subtitle:d,e2eTitle:"taxonomies"},r?m.a.createElement(Ja,{compact:!0,taxonomyName:i}):m.a.createElement(nr,{taxonomyName:i})))},[])):null}ur.propTypes={translate:T.a.func,siteId:T.a.number,postType:T.a.string,isSupported:T.a.bool,terms:T.a.oneOfType([T.a.object,T.a.array]),taxonomies:T.a.array};var mr=Object(P.b)(e=>{const t=Object(B.e)(e),s=Object(z.f)(e),n=Object(V.c)(e,t,s,"type");return{siteId:t,postType:n,isSupported:!1!==Object(ie.H)(e,t,"4.1.0"),terms:Object(V.c)(e,t,s,"terms"),taxonomies:Object(Ga.a)(e,t,n)}})(Object(h.localize)(ur)),hr=s("./client/components/forms/form-legend/index.jsx"),gr=s("./client/components/forms/form-toggle/compact.jsx");s("./client/post-editor/editor-page-parent/style.scss");class br extends u.Component{constructor(){super(...arguments),S()(this,"state",{isTopLevel:!this.props.parentId}),S()(this,"updatePageParent",e=>{const t=this.props,s=t.siteId,n=t.postId,i=Object(y.get)(e,"ID");if(!i)return this.setState(e=>{return{isTopLevel:!e.isTopLevel}},()=>{this.state.isTopLevel&&this.props.editPost(s,n,{parent:0})});this.setState({isTopLevel:!1}),this.props.editPost(s,n,{parent:i})})}componentWillReceiveProps(e){this.props.parentId!==e.parentId&&this.setState({isTopLevel:!e.parentId})}render(){const e=this.props,t=e.parentId,s=e.translate,n=e.postId,i=e.siteId,o=e.postType,a=e.labels,r=this.state.isTopLevel;return m.a.createElement(za.a,{className:"editor-page-parent"},m.a.createElement(js.a,null,m.a.createElement("span",{className:"editor-page-parent__label-text"},a.parent||s("Parent Page"))),m.a.createElement(js.a,{className:"editor-page-parent__top-level"},m.a.createElement(gr.a,{checked:r,onChange:this.updatePageParent,"aria-label":s("Toggle to set as top level")}),m.a.createElement("span",{className:"editor-page-parent__top-level-label"},s("Top level",{context:"Editor: Page being edited is top level i.e. has no parent"})),r&&m.a.createElement("span",{className:"editor-page-parent__top-level-description"},s("Disable to select a parent page"))),!r&&m.a.createElement("div",{className:"editor-page-parent__parent-tree-selector"},m.a.createElement(hr.a,null,s("Choose a parent page")),m.a.createElement(mi.a,{type:o,siteId:i,onChange:this.updatePageParent,selected:t,excludeTree:n,emptyMessage:a.not_found||s("You have no other pages yet.")})))}}S()(br,"propTypes",{siteId:T.a.number,postId:T.a.number,parentId:T.a.number,postType:T.a.string,translate:T.a.func,labels:T.a.object});var fr=Object(P.b)(e=>{const t=Object(B.e)(e),s=Object(z.f)(e),n=Object(V.c)(e,t,s,"type"),i=Object(V.c)(e,t,s,"parent");return{siteId:t,postId:s,postType:n,parentId:Object(y.get)(i,"ID",i)||0,labels:Object(y.get)(Object($.a)(e,t,n),"labels",{})}},{editPost:v.e})(Object(h.localize)(br));function yr(e,t){return!!e.pageTemplates.requesting[t]}class Er extends u.Component{componentWillMount(){this.request(this.props)}componentWillReceiveProps(e){const t=this.props,s=t.siteId,n=t.themeSlug,i=e.siteId,o=e.themeSlug;(s!==i||n&&o&&n!==o)&&this.request(e)}request(e){e.isRequesting||e.requestPageTemplates(e.siteId)}render(){return null}}Er.propTypes={siteId:T.a.number.isRequired,isRequesting:T.a.bool,requestPageTemplates:T.a.func};var vr=Object(P.b)((e,t)=>{let s=t.siteId;return{isRequesting:yr(e,s),themeSlug:Object(ie.r)(e,s,"theme_slug")}},{requestPageTemplates:function(e){return t=>(t({type:"PAGE_TEMPLATES_REQUEST",siteId:e}),Je.a.site(e).pageTemplates().then(s=>{let n=s.templates;t(function(e,t){return{type:"PAGE_TEMPLATES_RECEIVE",siteId:e,templates:t}}(e,n)),t({type:"PAGE_TEMPLATES_REQUEST_SUCCESS",siteId:e})}).catch(s=>{t({type:"PAGE_TEMPLATES_REQUEST_FAILURE",siteId:e,error:s})}))}})(Er),jr=s("./client/post-editor/editor-theme-help/index.jsx");s("./client/post-editor/editor-page-templates/style.scss");class _r extends u.Component{constructor(){super(...arguments),this.selectTemplate=this.selectTemplate.bind(this)}selectTemplate(e){const t=this.props,s=t.siteId,n=t.postId;this.props.editPost(s,n,{page_template:e})}getSelectedTemplateText(){const e=this.props,t=e.templates,s=e.template,n=e.translate;let i;return s&&(i=Object(y.find)(t,{file:s})),i?i.label:n("Default Template")}getTemplates(){const e=this.props,t=e.translate,s=e.templates;return[{label:t("Default Template"),file:""}].concat(s||[])}render(){const e=this.props,t=e.postType,s=e.template,n=e.siteId,i=e.translate,o=e.postId,a=e.pageForPostsId;if("page"!==t||o===a)return null;const r=this.getTemplates();return m.a.createElement("div",null,n&&m.a.createElement(vr,{siteId:n}),Object(y.size)(r)>1&&m.a.createElement(za.a,null,m.a.createElement(Va.a,{labelText:i("Page Template")},m.a.createElement(jr.a,{className:"editor-page-templates__help-link"}),m.a.createElement(En.a,{selectedText:this.getSelectedTemplateText()},Object(y.map)(r,e=>{let t=e.file,n=e.label;return m.a.createElement(vn.a,{key:t,selected:t===s,onClick:()=>this.selectTemplate(t)},n)})))))}}S()(_r,"propTypes",{siteId:T.a.number,postId:T.a.number,postType:T.a.string,template:T.a.string,templates:T.a.array,editPost:T.a.func,pageForPostsId:T.a.number});var xr=Object(P.b)(e=>{const t=Object(B.e)(e),s=Object(z.f)(e);return{siteId:t,postId:s,postType:Object(V.c)(e,t,s,"type"),template:Object(V.c)(e,t,s,"page_template"),templates:function(e,t){return e.pageTemplates.items[t]||null}(e,t),pageForPostsId:Object(ie.r)(e,t,"page_for_posts")}},{editPost:v.e})(Object(h.localize)(_r));s("./client/post-editor/editor-page-order/style.scss");class wr extends u.Component{constructor(){super(...arguments),this.editMenuOrder=this.editMenuOrder.bind(this),this.statTracked=!1}editMenuOrder(e){const t=this.props,s=t.menuOrder,n=t.siteId,i=t.postId,o=parseInt(e.target.value,10)||0;o!==s&&(this.statTracked||(this.statTracked=!0,this.props.recordEditorStat("advanced_menu_order_changed"),this.props.recordEditorEvent("Changed page menu order")),this.props.editPost(n,i,{menu_order:o}))}render(){const e=this.props,t=e.translate,s=e.menuOrder;return m.a.createElement(za.a,{className:"editor-page-order"},m.a.createElement("label",null,m.a.createElement("span",{className:"editor-page-order__label-text"},t("Order",{context:"Editor: Field label for menu order."})),m.a.createElement(de.a,{type:"number",value:s,pattern:"[0-9]*",onChange:this.editMenuOrder,onBlur:this.editMenuOrder,className:"editor-page-order__input"})))}}S()(wr,"propTypes",{siteId:T.a.number,postId:T.a.number,menuOrder:T.a.number}),S()(wr,"defaultProps",{menuOrder:0});var Sr=Object(P.b)(e=>{const t=Object(B.e)(e),s=Object(z.f)(e);return{siteId:t,postId:s,menuOrder:Object(V.c)(e,t,s,"menu_order")}},{editPost:v.e,recordEditorStat:F.b,recordEditorEvent:F.a})(Object(h.localize)(wr));var Cr=Object(P.b)(e=>{const t=Object(B.e)(e),s=Object(z.f)(e),n=Object(V.c)(e,t,s,"type");return{postType:n,hierarchical:"page"===n||Object(y.get)(Object($.a)(e,t,n),"hierarchical")}})(Object(h.localize)(function(e){let t,s=e.translate,n=e.postType,i=e.hierarchical;return t=s("page"===n?"Page Attributes":"Attributes"),m.a.createElement(Ba.a,{title:t,e2eTitle:"page-options"},i&&m.a.createElement(fr,null),m.a.createElement(xr,null),m.a.createElement(Sr,null))})),Ir=s("./client/components/forms/form-section-heading/index.jsx");s("./client/post-editor/editor-more-options/copy-post.scss");class Or extends u.Component{constructor(){super(...arguments),S()(this,"state",{selectedPostId:null,showDialog:!1}),S()(this,"isPost",()=>"post"===this.props.type),S()(this,"openDialog",e=>{e.preventDefault(),this.setState({showDialog:!0})}),S()(this,"closeDialog",()=>{this.setState({selectedPostId:null,showDialog:!1})}),S()(this,"setPostToCopy",e=>{this.setState({selectedPostId:e.ID})}),S()(this,"goToNewDraft",()=>{const e=this.props,t=e.siteSlug,s=e.type,n=this.state.selectedPostId;""!==n&&(a.a.redirect("/".concat(s,"/").concat(t,"?jetpack-copy=").concat(n)),this.closeDialog())})}render(){const e=this.props,t=e.siteId,s=e.translate,n=e.type,i=this.state,o=i.selectedPostId,a=i.showDialog,r=[{action:"cancel",label:s("Cancel")},{action:"copy",label:s("Overwrite"),isPrimary:!0,disabled:!o,onClick:this.goToNewDraft}];return m.a.createElement(za.a,{className:"editor-more-options__copy-post"},m.a.createElement(Va.a,{labelText:this.isPost()?s("Copy Post"):s("Copy Page"),helpText:this.isPost()?s("Pick a post and we'll copy the title, content, tags and categories."):s("Pick a page and we'll copy the title and content.")},m.a.createElement(q.a,{borderless:!0,compact:!0,onClick:this.openDialog},m.a.createElement(A.a,{icon:"clipboard"}),this.isPost()?s("Select a post to copy"):s("Select a page to copy"))),m.a.createElement(ke.a,{isVisible:a,buttons:r,onClose:this.closeDialog,additionalClassNames:"editor-more-options__copy-post-select-dialog"},m.a.createElement(Ir.a,null,this.isPost()?s("Select a post to copy"):s("Select a page to copy")),m.a.createElement("p",null,this.isPost()?s("Pick a post and we'll copy the title, content, tags and categories."):s("Pick a page and we'll copy the title and content.")),t&&m.a.createElement(mi.a,{emptyMessage:this.isPost()?s("No posts found"):s("No pages found"),onChange:this.setPostToCopy,order:"DESC",orderBy:"date",selected:o,siteId:t,status:"draft,future,pending,private,publish",type:n})))}}S()(Or,"propTypes",{siteId:T.a.number,siteSlug:T.a.string,translate:T.a.func,type:T.a.oneOf(["page","post"]).isRequired});var Tr=Object(P.b)(e=>{const t=Object(z.f)(e),s=Object(B.e)(e),n=Object(V.c)(e,s,t,"type");return{siteId:s,siteSlug:Object(ie.v)(e,s),type:n}})(Object(h.localize)(Or)),Pr=s("./client/components/info-popover/index.jsx");s("./client/post-editor/edit-post-status/style.scss");class kr extends u.Component{constructor(){super(...arguments),S()(this,"toggleStickyStatus",()=>{let e,t;this.props.post.sticky?(e="advanced_sticky_disabled",t="Off"):(e="advanced_sticky_enabled",t="On"),this.props.recordEditorStat(e),this.props.recordEditorEvent("Changed Sticky Setting",t),this.props.editPost(this.props.siteId,this.props.postId,{sticky:!this.props.post.sticky})}),S()(this,"togglePendingStatus",()=>{const e="pending"===this.props.post.status;this.props.recordEditorStat("status_changed"),this.props.recordEditorEvent("Changed Pending Status",e?"Marked Draft":"Marked Pending"),this.props.editPost(this.props.siteId,this.props.postId,{status:e?"draft":"pending"})}),S()(this,"revertToDraft",()=>{this.props.onSave("draft")})}render(){const e=this.props,t=e.translate,s=e.canUserPublishPosts,n=e.post,i=e.currentPost,o=G.w(n),a=G.x(n),r="password"===G.o(n),c=G.y(i),l=G.z(i),d=n&&"post"===n.type&&!a&&!r,p=n&&!c&&!l&&s,u=c||l||o&&!s;return m.a.createElement("div",{className:"edit-post-status"},this.renderPostScheduling(),this.renderPostVisibility(),d&&m.a.createElement("label",{className:"edit-post-status__sticky"},m.a.createElement("span",{className:"edit-post-status__label-text"},t("Stick to the top of the blog"),m.a.createElement(Pr.a,{position:"top right",gaEventCategory:"Editor",popoverName:"Sticky Post"},t("Sticky posts will appear at the top of your posts page."))),m.a.createElement(gr.a,{checked:n.sticky,onChange:this.toggleStickyStatus,"aria-label":t("Stick post to the front page")})),p&&m.a.createElement("label",{className:"edit-post-status__pending-review"},m.a.createElement("span",{className:"edit-post-status__label-text"},t("Pending review"),m.a.createElement(Pr.a,{position:"top right"},t("Flag this post to be reviewed for approval."))),m.a.createElement(gr.a,{checked:o,onChange:this.togglePendingStatus,"aria-label":t("Request review for post")})),u&&m.a.createElement(q.a,{className:"edit-post-status__revert-to-draft",onClick:this.revertToDraft,compact:!0},m.a.createElement(A.a,{icon:"undo",size:18})," ",t("Revert to draft")))}renderPostScheduling(){return m.a.createElement(ca,{post:this.props.post,setPostDate:this.props.setPostDate})}renderPostVisibility(){if("open"!==this.props.confirmationSidebarStatus)return m.a.createElement(ua,{onPrivatePublish:this.props.onPrivatePublish,context:"post-settings"})}}S()(kr,"propTypes",{moment:T.a.func,setPostDate:T.a.func,onSave:T.a.func,post:T.a.object,currentPost:T.a.object,translate:T.a.func,onPrivatePublish:T.a.func,confirmationSidebarStatus:T.a.string});var Dr=Object(P.b)(e=>{const t=Object(B.e)(e),s=Object(z.f)(e);return{siteId:t,postId:s,post:Object(V.a)(e,t,s),currentPost:Object(V.l)(e,t,s),canUserPublishPosts:Object(xa.b)(e,t,"publish_posts")}},{editPost:v.e,recordEditorStat:F.b,recordEditorEvent:F.a})(Object(h.localize)(kr));var Nr=Object(P.b)(e=>{const t=Object(B.e)(e),s=Object(z.f)(e);return{siteId:t,postId:s,excerpt:Object(V.c)(e,t,s,"excerpt")}},{editPost:v.e,recordEditorStat:F.b,recordEditorEvent:F.a})(Object(h.localize)(class extends m.a.Component{constructor(){super(...arguments),S()(this,"recordExcerptChangeStats",()=>{this.props.recordEditorStat("excerpt_changed"),this.props.recordEditorEvent("Changed Excerpt")}),S()(this,"onExcerptChange",e=>{const t=e.target.value;this.props.editPost(this.props.siteId,this.props.postId,{excerpt:t})})}render(){const e=this.props,t=e.excerpt,s=(0,e.translate)("Write an excerpt…");return m.a.createElement(le.a,{onNewValue:this.recordExcerptChangeStats},m.a.createElement($i.a,{id:"excerpt",name:"excerpt",onChange:this.onExcerptChange,value:t,placeholder:s,"aria-label":s}))}})),Rr=s("./client/lib/seo/index.js");s("./client/post-editor/editor-drawer/style.scss");const Mr=Object(y.overSome)(cr.j,cr.x,cr.G,cr.w),Lr={post:{thumbnail:!0,excerpt:!0,"post-formats":!0,"geo-location":!0,tags:!0,comments:!0},page:{thumbnail:!0,"page-attributes":!0,"geo-location":!0,excerpt:!0,comments:!0}};var Ar=function(e){s.e(166).then(s.bind(null,"./client/post-editor/editor-post-formats/accordion.jsx")).then(function(t){e(t.default)})},Ur=function(e){s.e(377).then(s.bind(null,"./client/post-editor/editor-sharing/accordion.jsx")).then(function(t){e(t.default)})},qr=function(e){s.e(164).then(s.bind(null,"./client/post-editor/editor-drawer/featured-image.jsx")).then(function(t){e(t.default)})},Fr=function(e){s.e(165).then(s.bind(null,"./client/post-editor/editor-location/index.jsx")).then(function(t){e(t.default)})},Br=function(e){s.e(163).then(s.bind(null,"./client/post-editor/editor-discussion/index.jsx")).then(function(t){e(t.default)})},zr=function(e){s.e(106).then(s.bind(null,"./client/post-editor/editor-seo-accordion/index.jsx")).then(function(t){e(t.default)})};class Vr extends u.Component{currentPostTypeSupports(e){const t=this.props,s=t.typeObject,n=t.type;return s&&s.supports?!!s.supports[e]:!Lr.hasOwnProperty(n)||!!Lr[n][e]}renderCategories(){const e=this.props.type,t=!St.a.isEnabled("manage/custom-post-types")&&this.currentPostTypeSupports("tags");if("post"===e||t)return m.a.createElement(or,null)}renderTaxonomies(){const e=this.props.canJetpackUseTaxonomies;if(St.a.isEnabled("manage/custom-post-types")&&!1!==e)return m.a.createElement(mr,null)}renderPostFormats(){if(this.currentPostTypeSupports("post-formats"))return m.a.createElement(L.a,{require:Ar})}renderSharing(){return m.a.createElement(L.a,{require:Ur})}renderFeaturedImage(){if(this.currentPostTypeSupports("thumbnail"))return m.a.createElement(L.a,{require:qr})}renderExcerpt(){const e=this.props.translate;if(this.currentPostTypeSupports("excerpt"))return m.a.createElement(za.a,null,m.a.createElement(Va.a,{labelText:e("Excerpt"),helpText:e("An excerpt is a short summary you can add to your posts. Some themes show excerpts alongside post titles on your site's homepage and archive pages.")},m.a.createElement(Nr,null)))}renderLocation(){const e=this.props.translate;if(this.props.site&&(!this.props.isJetpack||this.props.jetpackVersionSupportsLocation)&&this.currentPostTypeSupports("geo-location"))return m.a.createElement(za.a,null,m.a.createElement(Va.a,{labelText:e("Location")}),m.a.createElement(L.a,{require:Fr}))}renderDiscussion(){if(this.currentPostTypeSupports("comments"))return m.a.createElement(za.a,null,m.a.createElement(L.a,{require:Br}))}renderSeo(){const e=this.props,t=e.hasConflictingSeoPlugins,s=e.isSeoToolsModuleActive,n=e.isJetpack,i=e.jetpackVersionSupportsSeo,o=e.isRequestingPlugins,a=e.site;if(a&&(!n||!o&&s&&i&&!t)&&Mr(a.plan))return m.a.createElement(L.a,{require:zr})}renderCopyPost(){const e=this.props.type;if("post"===e||"page"===e)return m.a.createElement(Tr,null)}renderMoreOptions(){const e=this.props,t=e.isPermalinkEditable,s=e.translate;if(this.currentPostTypeSupports("excerpt")||this.currentPostTypeSupports("geo-location")||this.currentPostTypeSupports("comments")||t)return m.a.createElement(Ba.a,{title:s("More Options"),className:"editor-drawer__more-options",e2eTitle:"more-options"},t&&m.a.createElement(rr,null),this.renderExcerpt(),this.renderLocation(),this.renderDiscussion(),this.renderCopyPost())}renderPageOptions(){if(this.currentPostTypeSupports("page-attributes"))return m.a.createElement(Cr,null)}renderStatus(){const e=this.props.translate;return m.a.createElement(Ba.a,{title:e("Status"),e2eTitle:"status"},m.a.createElement(Dr,{onSave:this.props.onSave,onPrivatePublish:this.props.onPrivatePublish,setPostDate:this.props.setPostDate,confirmationSidebarStatus:this.props.confirmationSidebarStatus}))}render(){const e=this.props.site;return m.a.createElement("div",{className:"editor-drawer"},e&&m.a.createElement(K.a,{siteId:e.ID}),e&&m.a.createElement(se.a,{siteId:e.ID}),e&&m.a.createElement(lr.a,{siteIds:[e.ID]}),this.renderStatus(),this.renderCategories(),this.renderTaxonomies(),this.renderFeaturedImage(),this.renderPageOptions(),this.renderSharing(),this.renderPostFormats(),this.renderSeo(),this.renderMoreOptions())}}S()(Vr,"propTypes",{site:T.a.object,canJetpackUseTaxonomies:T.a.bool,typeObject:T.a.object,type:T.a.string,setPostDate:T.a.func,onSave:T.a.func,confirmationSidebarStatus:T.a.string}),Vr.displayName="EditorDrawer";var Hr=Object(y.flow)(h.localize,Object(P.b)(e=>{const t=Object(B.e)(e),s=Object(V.c)(e,t,Object(z.f)(e),"type"),n=Object(dr.b)(e,[t],"active");return{hasConflictingSeoPlugins:!!Object(Rr.a)(n),isPermalinkEditable:Ee(e,t),canJetpackUseTaxonomies:Object(ie.H)(e,t,"4.1"),isJetpack:Object(ie.J)(e,t),isSeoToolsModuleActive:Object(ie.I)(e,t,"seo-tools"),jetpackVersionSupportsSeo:Object(ie.H)(e,t,"4.4-beta1"),jetpackVersionSupportsLocation:Object(ie.H)(e,t,"6.3-beta"),isRequestingPlugins:Object(dr.g)(e,t),type:s,typeObject:Object($.a)(e,t,s)}}))(Vr);s("./client/post-editor/editor-post-type/style.scss");function Wr(e){let t,s=e.translate,n=e.siteId,i=e.typeSlug,o=e.type,a=e.isSettings;"page"===i?t=a?s("Page Settings"):s("Page",{context:"noun"}):"post"===i?t=a?s("Post Settings"):s("Post",{context:"noun"}):o?(t=a?s("%s: Settings",{args:o.labels.singular_name,comment:"type refers to a post type's singular noun"}):o.labels.singular_name,t=Object(Y.b)(t)):t=s("Loading…");const r=D()("editor-post-type",{"is-loading":!t});return m.a.createElement("span",{className:r},n&&"page"!==i&&"post"!==i&&m.a.createElement(K.a,{siteId:n}),t)}Wr.propTypes={translate:T.a.func,siteId:T.a.number,typeSlug:T.a.string,type:T.a.object,isSettings:T.a.bool};var Gr=Object(P.b)(e=>{const t={},s=Object(B.e)(e);if(!s)return t;t.siteId=s;const n=Object(V.a)(e,s,Object(z.f)(e));return n?Object.assign(t,{typeSlug:n.type,type:Object($.a)(e,s,n.type)}):t})(Object(h.localize)(Wr));const Yr=e=>{let t=e.closeSidebar,s=e.translate;return m.a.createElement("div",{className:"editor-sidebar__header"},m.a.createElement(Gr,{isSettings:!0}),m.a.createElement(q.a,{compact:!0,borderless:!0,className:"editor-sidebar__back",onClick:t,title:s("Close sidebar")},m.a.createElement(A.a,{icon:"cross"})))};Yr.propTypes={translate:T.a.func.isRequired,closeSidebar:T.a.func};var Kr=Object(y.flow)(h.localize,Object(P.b)(null,{closeSidebar:Qo}))(Yr),$r=s("./client/layout/sidebar/footer.jsx");s("./client/post-editor/editor-delete-post/style.scss");class Qr extends m.a.Component{constructor(){super(...arguments),S()(this,"state",{isTrashing:!1}),S()(this,"sendToTrash",()=>{const e=this.props,t=e.siteId,s=e.postId;e.canDelete&&(this.props.onTrashingPost&&this.props.onTrashingPost(),this.setState({isTrashing:!0}),this.props.trashPost(t,s))}),S()(this,"onSendToTrash",()=>{const e=this.props,t=e.translate,s=e.postType;if(this.state.isTrashing)return;let n;n=t("page"===s?"Are you sure you want to trash this page?":"Are you sure you want to trash this post?"),Object(mo.a)(n,e=>{e&&this.sendToTrash()},t("Move to trash"),t("Back"))})}render(){const e=this.props,t=e.canDelete,s=e.postId,n=e.postStatus,i=e.translate;if(!t||!s||"trash"===n)return null;const o=D()("editor-delete-post__button",{"is-trashing":this.state.isTrashing}),a=this.state.isTrashing?i("Trashing…"):i("Move to trash");return m.a.createElement("div",{className:"editor-delete-post"},m.a.createElement(q.a,{borderless:!0,className:o,onClick:this.onSendToTrash,"aria-label":a},m.a.createElement(A.a,{icon:"trash",size:18}),a))}}S()(Qr,"displayName","EditorDeletePost"),S()(Qr,"propTypes",{siteId:T.a.number,postId:T.a.number,postType:T.a.string,postStatus:T.a.string,canDelete:T.a.bool,onTrashingPost:T.a.func});var Jr=Object(P.b)(e=>{const t=Object(B.e)(e),s=Object(z.f)(e),n=Object(V.a)(e,t,s),i=Object(Vs.g)(e),o=!Object(y.isNull)(i)&&Object(y.get)(n,["author","ID"],null)===i;return{siteId:t,postId:s,postType:Object(y.get)(n,"type",null),postStatus:Object(y.get)(n,"status",null),canDelete:Object(xa.b)(e,t,o?"delete_posts":"delete_others_posts")}},{trashPost:v.n})(Object(h.localize)(Qr));var Zr=s("./client/state/selected-editor/actions.js"),Xr=s("./client/state/selectors/get-gutenberg-editor-url.js");s("./client/post-editor/editor-gutenberg-opt-in-dialog/style.scss");class ec extends u.Component{constructor(){super(...arguments),S()(this,"onCloseDialog",()=>{this.props.hideDialog()}),S()(this,"optInToGutenberg",()=>{const e=this.props,t=e.gutenbergUrl,s=e.hideDialog,n=e.optIn,i=e.siteId;s(),n(i,t)})}render(){const e=this.props,t=e.translate,s=e.isDialogVisible,n=e.useClassic,i=[m.a.createElement(q.a,{key:"gutenberg",onClick:this.optInToGutenberg,primary:!0},t("Try the block editor")),{action:"cancel",label:t("Use the current editor"),onClick:n}];return m.a.createElement(ke.a,{additionalClassNames:"editor-gutenberg-opt-in-dialog",isVisible:s,buttons:i,onClose:this.onCloseDialog},m.a.createElement("div",{className:"editor-gutenberg-opt-in-dialog__illustration"}),m.a.createElement("header",null,m.a.createElement("button",{onClick:this.onCloseDialog,className:"editor-gutenberg-opt-in-dialog__close"},m.a.createElement(A.a,{icon:"cross"}))),m.a.createElement("h1",null,t("Check out the new building blocks of the web")),m.a.createElement("p",{className:"editor-gutenberg-opt-in-dialog__subhead"},t("The new WordPress block editor lets you pick from a growing collection of blocks to build your ideal layout.")))}}S()(ec,"propTypes",{translate:T.a.func,gutenbergUrl:T.a.string,isDialogVisible:T.a.bool,hideDialog:T.a.func,optIn:T.a.func,useClassic:T.a.func,siteId:T.a.number});var tc=Object(P.b)(e=>{const t=function(e){return Object(y.get)(e,"ui.gutenbergOptInDialog.isShowing",!1)}(e),s=Object(B.e)(e),n=Object(z.f)(e),i=Object(V.c)(e,s,n,"type");return{gutenbergUrl:Object(Xr.a)(e,s,n,i),isDialogVisible:t,siteId:s}},e=>({optIn:(t,s)=>{e(Object(Us.k)(Object(Us.b)(Object(Us.g)("Gutenberg Opt-In",'Clicked "Try the new editor" in the editor opt-in sidebar.',"Opt-In",!0),Object(Us.i)("calypso_gutenberg_opt_in",{opt_in:!0}),Object(Us.a)("gutenberg-opt-in","Calypso Dialog Opt In")),Object(Zr.b)(t,"gutenberg",s)))},useClassic:()=>{e(Object(Us.k)(Object(Us.b)(Object(Us.g)("Gutenberg Opt-Out",'Clicked "Use the classic editor" in the editor opt-in sidebar.',"Opt-In",!1),Object(Us.i)("calypso_gutenberg_use_classic_editor"),Object(Us.a)("selected-editor","calypso-gutenberg-use-classic-editor")),{type:"GUTENBERG_OPT_IN_DIALOG_IS_SHOWING",isShowing:!1}))},hideDialog:()=>e({type:"GUTENBERG_OPT_IN_DIALOG_IS_SHOWING",isShowing:!1})}))(Object(h.localize)(ec));s("./client/post-editor/editor-gutenberg-opt-in-sidebar/style.scss");class sc extends u.PureComponent{constructor(){super(...arguments),S()(this,"handleKeyPress",e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),this.props.showDialog())})}render(){const e=this.props,t=e.showDialog,s=e.translate;return e.optInEnabled?m.a.createElement("div",{tabIndex:"0",role:"button",className:"editor-gutenberg-opt-in-sidebar",onClick:t,onKeyPress:this.handleKeyPress},m.a.createElement("img",{src:"/calypso/images/illustrations/gutenberg-mini.svg",alt:""}),m.a.createElement("p",null,s("Try the new block editor and level up your layout.")),m.a.createElement(q.a,{tabIndex:"-1"},s("Learn more"))):null}}S()(sc,"propTypes",{translate:T.a.func,showDialog:T.a.func,optInEnabled:T.a.bool});const nc={showDialog:ka};var ic=Object(P.b)(e=>({optInEnabled:Object(St.c)("gutenberg/opt-in")&&Object(Pa.a)(e,Object(B.e)(e))}),nc)(Object(h.localize)(sc));s("./client/post-editor/editor-sidebar/style.scss");class oc extends u.Component{render(){const e=this.props,t=e.onTrashingPost,s=e.onPublish,n=e.onSave,i=e.site,o=e.setPostDate,a=e.confirmationSidebarStatus;return m.a.createElement("div",{className:"editor-sidebar"},m.a.createElement(Kr,null),m.a.createElement(Hr,{site:i,setPostDate:o,onPrivatePublish:s,onSave:n,confirmationSidebarStatus:a}),m.a.createElement(ic,null),m.a.createElement(tc,null),m.a.createElement($r.a,null,m.a.createElement(Jr,{onTrashingPost:t})))}}S()(oc,"propTypes",{onSave:T.a.func,onPublish:T.a.func,onTrashingPost:T.a.func,site:T.a.object,setPostDate:T.a.func,confirmationSidebarStatus:T.a.string});var ac=oc,rc=s("./client/blocks/site/index.jsx"),cc=s("./node_modules/moment/moment.js"),lc=s.n(cc);const dc={update:"Clicked Update Post Button",schedule:"Clicked Schedule Post Button",requestReview:"Clicked Request-Review Post Button",publish:"Clicked Publish Post Button"},pc={update:"Clicked Update Page Button",schedule:"Clicked Schedule Page Button",requestReview:"Clicked Request-Review Page Button",publish:"Clicked Publish Page Button"};class uc extends u.Component{constructor(){super(...arguments),S()(this,"onClick",()=>(this.trackClick(),G.y(this.props.currentPost)&&!G.r(this.props.currentPost)?this.props.onSave():this.props.canUserPublishPosts?this.props.onPublish():this.props.onSave("pending")))}trackClick(){const e=G.v(this.props.currentPost)?pc:dc;this.props.recordEditorEvent(e[this.props.publishButtonStatus]),this.props.recordEditorEvent("Clicked Primary Button")}getButtonLabel(){const e=this.props.translate;switch(this.props.publishButtonStatus){case"update":return e("Update");case"schedule":return this.props.isConfirmationSidebarEnabled?e("Schedule…",{comment:"Button label on the editor sidebar - a confirmation step will follow"}):e("Schedule");case"publish":return this.props.isConfirmationSidebarEnabled?this.props.isPublishing?e("Publishing…",{comment:"Button label on the editor sidebar while publishing is in progress"}):e("Publish…",{comment:"Button label on the editor sidebar - a confirmation step will follow"}):e("Publish");case"requestReview":return e("Submit for Review");default:return e("Loading…")}}isBusy(){return this.props.isPublishing||G.y(this.props.currentPost)&&this.props.isSaving}isEnabled(){return!this.props.isPublishing&&!this.props.isSaveBlocked&&this.props.hasContent&&!this.props.needsVerification&&!this.props.isPasswordProtectedWithInvalidPassword}render(){return m.a.createElement(q.a,{className:"editor-publish-button",primary:!0,busy:this.isBusy(),onClick:this.onClick,disabled:!this.isEnabled(),tabIndex:this.props.tabIndex,"data-tip-target":"editor-publish-button"},this.getButtonLabel())}}S()(uc,"propTypes",{currentPost:T.a.object,onSave:T.a.func,onPublish:T.a.func,tabIndex:T.a.number,isSaving:T.a.bool,isPublishing:T.a.bool,isSaveBlocked:T.a.bool,hasContent:T.a.bool,needsVerification:T.a.bool,isPasswordProtectedWithInvalidPassword:T.a.bool,isConfirmationSidebarEnabled:T.a.bool,recordEditorEvent:T.a.func.isRequired}),S()(uc,"defaultProps",{recordEditorEvent:y.noop});var mc=Object(P.b)(e=>{const t=Object(B.e)(e),s=Object(z.f)(e);return{currentPost:Object(V.l)(e,t,s),publishButtonStatus:Object(z.h)(e),canUserPublishPosts:Object(xa.b)(e,t,"publish_posts"),isPasswordProtectedWithInvalidPassword:Object(V.p)(e,t,s)&&!Object(V.q)(e,t,s)}},{recordEditorEvent:F.a})(Object(h.localize)(uc)),hc=s("./client/state/posts/revisions/actions.js");const gc=e=>{let t=e.translate,s=e.selectHistory;return m.a.createElement("div",{className:"editor-ground-control__history"},m.a.createElement("button",{className:"editor-ground-control__history-button button is-link",onClick:s},t("History")))};gc.propTypes={translate:T.a.func};var bc=Object(P.b)(null,{selectHistory:()=>Object(Us.k)(Object(Us.i)("calypso_editor_history_button_click"),Object(hc.b)())})(Object(h.localize)(gc));const fc=e=>{let t=e.isSaving,s=e.isSaveBlocked,n=e.isDirty,i=e.hasContent,o=e.post,a=e.translate,r=e.onSave,c=Vi()(e,["isSaving","isSaveBlocked","isDirty","hasContent","post","translate","onSave"]);const l=(e=>{let t=e.isSaving,s=void 0!==t&&t,n=e.isSaveBlocked,i=void 0!==n&&n,o=e.isDirty,a=void 0!==o&&o,r=e.hasContent,c=void 0!==r&&r,l=e.post,d=void 0===l?null:l;return!s&&!i&&a&&c&&!!d&&!Object(G.y)(d)})({isSaving:t,isSaveBlocked:s,isDirty:n,hasContent:i,post:o}),d=t||o&&o.ID&&!Object(G.y)(o),p=l||d,u=o&&!Object(y.isEmpty)(o.revisions);return p||u?m.a.createElement("div",{className:"editor-ground-control__quick-save"},u&&m.a.createElement(bc,null),p&&m.a.createElement("div",{className:"editor-ground-control__status"},l&&m.a.createElement("button",{className:"editor-ground-control__save button is-link",onClick:()=>{r();const e=Object(G.v)(o)?"Clicked Save Page Button":"Clicked Save Post Button";c.recordEditorEvent(e),c.recordEditorStat("save_draft_clicked")},tabIndex:3},a("Save")),!l&&d&&m.a.createElement("span",{className:"editor-ground-control__save-status","data-e2e-status":t?"Saving…":"Saved"},a(t?"Saving…":"Saved")))):null};fc.propTypes={isSaving:T.a.bool,isSaveBlocked:T.a.bool,isDirty:T.a.bool,hasContent:T.a.bool,post:T.a.object,onSave:T.a.func.isRequired,translate:T.a.func,recordEditorEvent:T.a.func,recordEditorStat:T.a.func},fc.defaultProps={hasContent:!1,isDirty:!1,isSaveBlocked:!1,isSaving:!1,post:null,recordEditorEvent:y.noop,recordEditorStat:y.noop};var yc=Object(P.b)(e=>{const t=Object(B.e)(e),s=Object(z.f)(e);return{post:Object(V.a)(e,t,s)}},{recordEditorEvent:F.a,recordEditorStat:F.b})(Object(h.localize)(fc)),Ec=s("./client/layout/masterbar/drafts.jsx"),vc=s("./client/state/selectors/is-unlaunched-site.js"),jc=s("./client/state/ui/action-log/selectors.js"),_c=s("./client/state/ui/guided-tours/actions.js");s("./client/post-editor/editor-ground-control/style.scss");class xc extends m.a.Component{constructor(){super(...arguments),S()(this,"onPreviewButtonClick",e=>{this.isPreviewEnabled()&&this.props.onPreview(e)}),S()(this,"onCloseButtonClick",()=>{this.props.recordCloseButtonClick(),this.props.pauseEditorTour(),a.a.show(this.getCloseButtonPath())})}getPreviewLabel(){return this.props.translate("Preview")}getVerificationNoticeLabel(){const e=this.props,t=e.translate;switch(e.publishButtonStatus){case"update":return t("To update, check your email and confirm your address.");case"schedule":return t("To schedule, check your email and confirm your address.");case"publish":return t("To publish, check your email and confirm your address.");case"requestReview":return t("To submit for review, check your email and confirm your address.");default:return null}}isPreviewEnabled(){return this.props.hasContent&&!(this.props.isNew&&!this.props.isDirty)&&!this.props.isSaveBlocked}renderGroundControlActionButtons(){if("open"!==this.props.confirmationSidebarStatus)return m.a.createElement("div",{className:"editor-ground-control__action-buttons"},m.a.createElement(q.a,{borderless:!0,className:"editor-ground-control__toggle-sidebar",onClick:this.props.toggleSidebar},m.a.createElement(A.a,{icon:"cog"})),m.a.createElement(q.a,{className:"editor-ground-control__preview-button",disabled:!this.isPreviewEnabled(),onClick:this.onPreviewButtonClick},m.a.createElement("span",{className:"editor-ground-control__button-label"},this.getPreviewLabel())),m.a.createElement("div",{className:"editor-ground-control__publish-button"},m.a.createElement(mc,{onSave:this.props.onSave,onPublish:this.props.onPublish,isConfirmationSidebarEnabled:this.props.isConfirmationSidebarEnabled,isSaving:this.props.isSaving,isPublishing:this.props.isPublishing,isSaveBlocked:this.props.isSaveBlocked,hasContent:this.props.hasContent,needsVerification:this.props.userNeedsVerification})))}getCloseButtonPath(){const e=/^(\/block-editor)?\/(post|page|(edit\/[^\/]+))(\/|$)/i,t=Object(y.findLast)(this.props.routeHistory,t=>{let s=t.path;return"/block-editor"!==s&&!s.match(e)});return t?t.path:this.props.allPostsUrl}render(){const e=this.props,t=e.isSaving,s=e.isSaveBlocked,n=e.isDirty,i=e.hasContent,o=e.onSave,a=e.translate,r=e.userNeedsVerification;return m.a.createElement(Zs.a,{className:"editor-ground-control"},m.a.createElement(q.a,{borderless:!0,className:"editor-ground-control__back",href:"",onClick:this.onCloseButtonClick,"aria-label":a("Close")},a("Close")),m.a.createElement(rc.a,{compact:!0,site:this.props.site,onSelect:this.props.recordSiteButtonClick,indicator:!1}),m.a.createElement(Ec.a,null),r&&m.a.createElement("button",{className:"editor-ground-control__email-verification-notice",onClick:this.props.onMoreInfoAboutEmailVerify},m.a.createElement(A.a,{icon:"info",className:"editor-ground-control__email-verification-notice-icon"}),this.getVerificationNoticeLabel()," ",m.a.createElement("span",{className:"editor-ground-control__email-verification-notice-more"},a("Learn More"))),m.a.createElement(yc,{isSaving:t,isSaveBlocked:s,isDirty:n,hasContent:i,onSave:o}),this.renderGroundControlActionButtons())}}S()(xc,"propTypes",{hasContent:T.a.bool,isConfirmationSidebarEnabled:T.a.bool,confirmationSidebarStatus:T.a.string,isDirty:T.a.bool,isSaveBlocked:T.a.bool,isPublishing:T.a.bool,isSaving:T.a.bool,isSidebarOpened:T.a.bool,moment:T.a.func,onPreview:T.a.func,onPublish:T.a.func,onSave:T.a.func,onSaveDraft:T.a.func,onMoreInfoAboutEmailVerify:T.a.func,setPostDate:T.a.func,site:T.a.object,toggleSidebar:T.a.func,translate:T.a.func}),S()(xc,"defaultProps",{hasContent:!1,isConfirmationSidebarEnabled:!0,isDirty:!1,isSaveBlocked:!1,isPublishing:!1,isSaving:!1,moment:lc.a,onPublish:y.noop,onSaveDraft:y.noop,site:{},translate:y.identity,setPostDate:y.noop});const wc={recordSiteButtonClick:()=>Object(Us.i)("calypso_editor_site_button_click"),recordCloseButtonClick:()=>Object(Us.i)("calypso_editor_close_button_click"),pauseEditorTour:()=>Object(_c.b)()};var Sc=Object(P.b)((e,t)=>{const s=Object(y.get)(t,"site.ID",null);return{publishButtonStatus:Object(z.h)(e),routeHistory:Object(jc.d)(e),userNeedsVerification:!Object(Vs.m)(e)&&!Object(Xo.a)(e,s)&&!Object(vc.a)(e,s)}},wc)(Object(h.localize)(xc)),Cc=s("./client/post-editor/editor-revisions/dialog.jsx"),Ic=s("./client/lib/analytics/page-view-tracker/index.jsx");s("./client/post-editor/editor-gutenberg-blocks-warning-dialog/style.scss");class Oc extends u.Component{constructor(){super(...arguments),S()(this,"state",{isDialogVisible:!1,forceClassic:!1}),S()(this,"useClassicEditor",()=>{this.props.useClassic(),this.setState({forceClassic:!0})}),S()(this,"switchToGutenberg",()=>{const e=this.props;(0,e.switchToGutenberg)(e.siteId,e.gutenbergUrl)}),S()(this,"showDocumentHistory",e=>{e.preventDefault(),this.props.openPostRevisionsDialog(),this.useClassicEditor()})}shouldComponentUpdate(e,t){return this.state.isDialogVisible!==t.isDialogVisible}static getDerivedStateFromProps(e,t){const s=e.postContent;return{isDialogVisible:!t.forceClassic&&(e=>!!e&&-1!==e.indexOf("\x3c!-- wp:"))(s)}}render(){const e=this.props,t=e.translate;if(!e.optInEnabled)return null;const s=this.state.isDialogVisible,n=[{action:"gutenberg",label:t("Switch to the new editor"),onClick:this.switchToGutenberg,isPrimary:!0},{action:"cancel",label:t("Use the classic editor"),onClick:this.useClassicEditor}];return m.a.createElement(ke.a,{additionalClassNames:"editor-gutenberg-blocks-warning-dialog",isVisible:s,buttons:n,onClose:this.useClassicEditor},m.a.createElement("h1",null,t("This post uses blocks from the new editor")),m.a.createElement("p",null,t("You can continue to edit this post in the Classic Editor, but you may lose some data and formatting. You can also check the {{a}}document history{{/a}} and restore a version of the page from earlier.",{components:{a:m.a.createElement("a",{href:"#",onClick:this.showDocumentHistory})}})))}}S()(Oc,"propTypes",{translate:T.a.func,postContent:T.a.string,siteId:T.a.number,gutenbergUrl:T.a.string,switchToGutenberg:T.a.func,openPostRevisionsDialog:T.a.func,optInEnabled:T.a.bool,useClassic:T.a.func}),S()(Oc,"defaultProps",{translate:y.identity,postContent:null,siteId:null,gutenbergUrl:null,switchToGutenberg:y.noop,openPostRevisionsDialog:y.noop,optInEnabled:!1,useClassic:y.noop});var Tc=Object(P.b)(e=>{const t=Object(z.i)(e),s=Object(B.e)(e),n=Object(z.f)(e),i=Object(V.c)(e,s,n,"type");return{postContent:t,siteId:s,gutenbergUrl:Object(Xr.a)(e,s,n,i),optInEnabled:Object(St.c)("gutenberg/opt-in")&&Object(Pa.a)(e,s)}},e=>({switchToGutenberg:(t,s)=>{e(Object(Us.k)(Object(Us.b)(Object(Us.g)("Gutenberg Opt-In",'Clicked "Switch to the new editor" in the blocks warning dialog.',"Opt-In",!0),Object(Us.i)("calypso_gutenberg_opt_in",{opt_in:!0}),Object(Us.a)("gutenberg-opt-in","Calypso Dialog Opt In")),Object(Zr.b)(t,"gutenberg",s)))},useClassic:()=>{e(Object(Us.k)(Object(Us.b)(Object(Us.g)("Gutenberg Opt-Out",'Clicked "Use the classic editor" in the blocks warning dialog.',"Opt-In",!1),Object(Us.i)("calypso_gutenberg_use_classic_editor"),Object(Us.a)("selected-editor","calypso-gutenberg-use-classic-editor"))))},openPostRevisionsDialog:()=>e(Object(hc.b)())}))(Object(h.localize)(Oc));s("./client/post-editor/style.scss");class Pc extends m.a.Component{constructor(){var e;super(...arguments),e=this,S()(this,"state",this.getDefaultState()),S()(this,"_previewWindow",null),S()(this,"storeEditor",e=>{this.editor=e}),S()(this,"hideNotice",()=>{this.setState({notice:null})}),S()(this,"setConfirmationSidebar",e=>{let t=e.status,s=e.context,n=void 0===s?null:s;const i=["closed","open","publishing"].indexOf(t)>-1?t:"closed",o="open"===this.props.editorSidebarPreference?"sidebar":"content";switch(this.setState({confirmationSidebar:i}),i){case"closed":this.props.setLayoutFocus(o),this.props.recordTracksEvent("calypso_editor_confirmation_sidebar_close",{context:n});break;case"open":this.props.setLayoutFocus("editor-confirmation-sidebar"),this.props.recordTracksEvent("calypso_editor_confirmation_sidebar_open")}}),S()(this,"copySelectedText",()=>{const e=R.a.activeEditor.selection.getContent()||null;this.state.selectedText!==e&&this.setState({selectedText:e||null})}),S()(this,"handleConfirmationSidebarPreferenceChange",e=>{this.setState({confirmationSidebarPreference:e.target.checked})}),S()(this,"toggleSidebar",()=>{"sidebar"===this.props.layoutFocus?this.props.closeEditorSidebar():this.props.openEditorSidebar()}),S()(this,"loadRevision",e=>{this.restoreRevision({content:e.post_content,excerpt:e.post_excerpt,title:e.post_title}),Object(ye.f)("<660px")&&this.props.setLayoutFocus("content")}),S()(this,"restoreTrashed",()=>{this.onSave("draft")}),S()(this,"restoreAutosave",()=>{this.setState({showAutosaveDialog:!1}),this.restoreRevision(Object(y.get)(this.props.post,"meta.data.autosave"))}),S()(this,"restoreRevision",e=>{this.props.editPost(this.props.siteId,this.props.postId,{excerpt:e.excerpt,title:e.title,content:e.content}),this.editor&&this.editor.setEditorContent(e.content,{initial:!0})}),S()(this,"closeAutosaveDialog",()=>{this.setState({showAutosaveDialog:!1})}),S()(this,"closeVerifyEmailDialog",()=>{this.setState({showVerifyEmailDialog:!1})}),S()(this,"onEditedPostChange",e=>{e.loadingError||(e.isNew&&!this.props.isNew||e.isLoading?this.setState(this.getDefaultState(),()=>this.editor&&this.editor.setEditorContent("")):this.editor&&this.props.isLoading&&!e.isLoading&&this.editor.setEditorContent(e.post.content,{initial:!0}))}),S()(this,"isSaveBlocked",()=>this.props.isSaveBlocked||!this.state.isEditorInitialized),S()(this,"onEditorInitialized",()=>{this.setState({isEditorInitialized:!0})}),S()(this,"onEditorTitleChange",()=>{"open"===this.state.confirmationSidebar&&this.setConfirmationSidebar({status:"closed",context:"content_edit"}),this.debouncedAutosave()}),S()(this,"onEditorContentChange",()=>{this.debouncedSaveRawContent(),this.debouncedAutosave()}),S()(this,"onEditorTextContentChange",()=>{"open"===this.state.confirmationSidebar&&this.setConfirmationSidebar({status:"closed",context:"content_edit"}),this.debouncedSaveRawContent(),this.debouncedAutosave()}),S()(this,"onEditorKeyUp",()=>{"open"===this.state.confirmationSidebar&&this.setConfirmationSidebar({status:"closed",context:"content_edit"}),this.debouncedCopySelectedText(),this.debouncedSaveRawContent()}),S()(this,"onEditorFocus",()=>{I.a.findDOMNode(this.editor).click()}),S()(this,"saveRawContent",()=>{this.props.editorEditRawContent(this.editor.getContent({format:"raw"})),this.debouncedSaveRawContent.cancel()}),S()(this,"autosave",async()=>{if(this.throttledAutosave.cancel(),this.debouncedAutosave.cancel(),!0===this.state.isSaving||this.isSaveBlocked())return;this.syncEditorContent();const e=G.y(this.props.savedPost)||G.y(this.props.post);e||this.setState({isSaving:!0});try{const t=await this.props.autosave();e||this.onSaveDraftSuccess(t)}catch(t){e||this.onSaveDraftFailure(t)}}),S()(this,"onClose",()=>{a.a.back(this.getAllPostsUrl())}),S()(this,"getAllPostsUrl",e=>{const t=this.props,s=t.type,n=t.selectedSite;let i;switch(s){case"page":i="/pages";break;case"post":i="/posts";break;default:i="/types/".concat(s)}return"post"!==s||!n||n.jetpack||n.single_user_site||(i+="/my"),"trashed"===e&&(i+="/trashed"),n&&(i=Object(j.b)(i,n.slug)),i}),S()(this,"onMoreInfoAboutEmailVerify",()=>{this.setState({showVerifyEmailDialog:!0})}),S()(this,"onTrashingPost",()=>{const e=this.props.type;this.props.recordEditorStat(e+"_trashed"),this.props.recordEditorEvent("page"===e?"Clicked Trash Page Button":"Clicked Trash Post Button"),this.props.markSaved(),a()(this.getAllPostsUrl("trashed"))}),S()(this,"onSave",e=>{!G.y(this.props.savedPost)&&G.y(this.props.post,e)||(this.setState({isSaving:!0}),e&&this.props.editPost(this.props.siteId,this.props.postId,{status:e}),this.syncEditorContent(),this.props.saveEdited().then(this.onSaveDraftSuccess,this.onSaveDraftFailure))}),S()(this,"onPreview",async e=>{if(this.recordPreviewButtonClick(),this.props.isSitePreviewable&&!e.metaKey&&!e.ctrlKey)return this.iframePreview();this._previewWindow&&!this._previewWindow.closed||(this._previewWindow=window.open("about:blank","WordPress.com Post Preview")),this.props.isDirty&&await this.autosave();const t=this.props.previewUrl;this._previewWindow?(this._previewWindow.location=t,this._previewWindow.focus()):this._previewWindow=window.open(t,"WordPress.com Post Preview")}),S()(this,"iframePreview",async()=>{this.props.isDirty&&this.autosave(),this.setState({showPreview:!0})}),S()(this,"onPreviewClose",()=>{this.state.isPostPublishPreview?a.a.back(this.getAllPostsUrl()):this.setState({showPreview:!1,isPostPublishPreview:!1})}),S()(this,"onPreviewEdit",()=>("open"===this.props.editorSidebarPreference&&this.props.setNextLayoutFocus("sidebar"),this.hideNotice(),this.setState({showPreview:!1,isPostPublishPreview:!1}),!1)),S()(this,"onSaveDraftFailure",e=>{this.onSaveFailure(e,"saveFailure")}),S()(this,"onSaveDraftSuccess",e=>{this.onSaveSuccess(e,"save")}),S()(this,"onPublish",function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(e.props.isConfirmationSidebarEnabled){if(!1===t)return void e.setConfirmationSidebar({status:"open"});"open"===e.state.confirmationSidebar&&e.setConfirmationSidebar({status:"publishing"})}e.setState({isSaving:!0,isPublishing:!0});const s=e.getPublishStatus();e.props.editPost(e.props.siteId,e.props.postId,{status:s}),e.syncEditorContent(),e.props.saveEdited().then(e.onPublishSuccess,e.onPublishFailure)}),S()(this,"onPublishFailure",e=>{this.props.isConfirmationSidebarEnabled&&this.setConfirmationSidebar({status:"closed",context:"publish_failure"}),this.onSaveFailure(e,"publishFailure")}),S()(this,"onPublishSuccess",e=>{this.state.confirmationSidebarPreference||this.props.saveConfirmationSidebarPreference(this.props.siteId,!1),this.props.isConfirmationSidebarEnabled&&this.setConfirmationSidebar({status:"closed",context:"publish_success"}),this.onSaveSuccess(e,"publish")}),S()(this,"onSaveFailure",(e,t)=>{this.setState({isSaving:!1,isPublishing:!1,notice:{status:"is-error",error:e,message:t}})}),S()(this,"setPostDate",e=>{const t=this.props,s=t.siteId,n=t.postId,i=!!e&&e.format();this.props.editPost(s,n,{date:i}),this.props.recordTracksEvent("calypso_editor_publish_date_change",{context:"open"===this.state.confirmationSidebar?"confirmation-sidebar":"post-settings"})}),S()(this,"onSaveSuccess",(e,t)=>{let s=null;if(e){const n=e.receivedPost;"save"===t?G.y(n)&&(s="updated"):"publish"===t&&(s=G.x(n)?"publishedPrivately":G.u(n)?"scheduled":"published")}const n={isSaving:!1,isPublishing:!1};if(s?(n.notice={status:"is-success",message:s},window.scrollTo(0,0),this.props.isSitePreviewable&&"published"===s&&(this.setState({isPostPublishPreview:!0}),this.iframePreview())):n.notice=null,this.setState(n),e&&e.idAssigned){const t=G.e(e.receivedPost,this.props.selectedSite);a.a.replace(t,null,!1,!1)}e||this.props.pauseGuidedTour()}),S()(this,"getContainingTagInfo",(e,t)=>{const s=e.lastIndexOf("<",t);if(s>e.lastIndexOf(">",t)){const t=e.substr(s),n=t.match(/<\s*(\/)?(\w+)/);if(!n)return null;const i=n[2];return{ltPos:s,gtPos:s+t.indexOf(">")+1,tagType:i,isClosingTag:!!n[1]}}return null}),S()(this,"getCursorMarkerSpan",e=>{return'<span\n\t\t\t\tdata-mce-type="bookmark"\n\t\t\t\tid="mce_SELREST_'.concat(e||"start",'"\n\t\t\t\tdata-mce-style="overflow:hidden;line-height:0"\n\t\t\t\tstyle="overflow:hidden;line-height:0"\n\t\t\t>&#65279;</span>')}),S()(this,"addHTMLBookmarkInTextAreaContent",()=>{const e=this.editor._editor.getElement();let t=e.selectionStart,s=e.selectionEnd;const n=this.getContainingTagInfo(e.value,t);n&&(t=n.ltPos);const i=this.getContainingTagInfo(e.value,s);i&&(s=i.gtPos);let o=null;if("range"===(t!==s?"range":"single")){const n=this.getCursorMarkerSpan("end");o=[e.value.slice(t,s),n].join("")}e.value=[e.value.slice(0,t),this.getCursorMarkerSpan("start"),o,e.value.slice(s)].join(""),this.editor.onTextAreaChange({target:{value:e.value}})}),S()(this,"focusHTMLBookmarkInVisualEditor",e=>{const t=e.target.getDoc().getElementById("mce_SELREST_start"),s=e.target.getDoc().getElementById("mce_SELREST_end");if(t){if(e.target.focus(),s){const n=document.createRange();n.setStart(t,0),n.setEnd(s,0),e.target.selection.setRng(n),s.parentNode.removeChild(s)}else e.target.selection.select(t);t.parentNode.removeChild(t),e.target.off("SetContent",this.focusHTMLBookmarkInVisualEditor)}}),S()(this,"findBookmarkedPosition",e=>{const t=e.getWin().getSelection();if(t.rangeCount<=0)return;const s="SELRES_"+Object(M.v4)(),n=document.createElement("span");n.className="mce_SELRES_start",n.style.display="inline-block",n.style.width=0,n.style.overflow="hidden",n.style.lineHeight="0px",n.innerHTML=s;const i=document.createElement("span");i.className="mce_SELRES_end",i.style.display="inline-block",i.style.width=0,i.style.overflow="hidden",i.style.lineHeight="0px",i.innerHTML=s;const o=t.getRangeAt(0),a=o.startContainer,r=o.startOffset,c=o.cloneRange();c.collapse(!1),c.insertNode(i),c.setStart(a,r),c.collapse(!0),c.insertNode(n),o.setStartAfter(n),o.setEndBefore(i),t.removeAllRanges(),t.addRange(o);const l=Object(Y.e)(e.getContent()),d=new RegExp('<span[^>]*\\s*class="mce_SELRES_start"[^>]+>\\s*'+s+"[^<]*<\\/span>"),p=new RegExp('<span[^>]*\\s*class="mce_SELRES_end"[^>]+>\\s*'+s+"[^<]*<\\/span>"),u=l.match(d),m=l.match(p);return u?{start:u.index,end:m?m.index-u[0].length:null}:null}),S()(this,"switchEditorMode",e=>{const t=this.editor.getContent();if("html"===e){const e=this.findBookmarkedPosition(this.editor._editor);this.editor.setEditorContent(t),this.state.selectedText&&this.copySelectedText(),this.editor.setSelection(e)}else"tinymce"===e&&(this.addHTMLBookmarkInTextAreaContent(),this.editor._editor.on("SetContent",this.focusHTMLBookmarkInVisualEditor));this.props.setEditorModePreference(e),this.setState({mode:e},()=>{this.syncEditorContent({resetRawContent:!0,content:t})})})}getDefaultState(){return{mode:this.props.editorModePreference||"tinymce",confirmationSidebar:"closed",confirmationSidebarPreference:!0,isSaving:!1,isPublishing:!1,notice:null,selectedText:null,showVerifyEmailDialog:!1,showAutosaveDialog:!0,isTitleFocused:!1,showPreview:!1,isPostPublishPreview:!1}}UNSAFE_componentWillMount(){this.debouncedSaveRawContent=Object(y.debounce)(this.saveRawContent,200),this.throttledAutosave=Object(y.throttle)(this.autosave,2e4),this.debouncedAutosave=Object(y.debounce)(this.throttledAutosave,3e3),this.switchEditorVisualMode=this.switchEditorMode.bind(this,"tinymce"),this.switchEditorHtmlMode=this.switchEditorMode.bind(this,"html"),this.debouncedCopySelectedText=Object(y.debounce)(this.copySelectedText,200),this.useDefaultSidebarFocus(),ss.default.mc.bumpStat("calypso_default_sidebar_mode",this.props.editorSidebarPreference),this.setState({isEditorInitialized:!1})}UNSAFE_componentWillUpdate(e,t){t.isSaving&&!this.state.isSaving&&(this.debouncedAutosave.cancel(),this.throttledAutosave.cancel()),e.isDirty?this.props.markChanged():this.props.markSaved()}componentDidMount(){this.props.post&&this.props.post.content&&this.editor.setEditorContent(this.props.post.content,{initial:!0}),this.props.editorModePreference&&ss.default.mc.bumpStat("calypso_default_editor_mode",this.props.editorModePreference)}componentWillUnmount(){this.debouncedAutosave.cancel(),this.throttledAutosave.cancel(),this.debouncedSaveRawContent.cancel(),this.debouncedCopySelectedText.cancel(),this._previewWindow=null,clearTimeout(this._switchEditorTimeout)}UNSAFE_componentWillReceiveProps(e){const t=this.props,s=t.siteId,n=t.postId;e.siteId===s&&e.postId===n||this.useDefaultSidebarFocus(e),this.onEditedPostChange(e)}useDefaultSidebarFocus(e){const t=e||this.props;Object(ye.f)(">660px")&&("open"===t.editorSidebarPreference||t.hasBrokenPublicizeConnection)&&this.props.setLayoutFocus("sidebar")}render(){const e=this.props.selectedSite,t=this.state.mode,s=this.props.loadingError,n="trash"===Object(y.get)(this.props.post,"status"),i=Object(y.get)(this.props.post,"meta.data.autosave"),o=D()("post-editor",{"is-loading":!this.state.isEditorInitialized});return m.a.createElement("div",{className:o},m.a.createElement(Ic.a,{path:this.props.analyticsPath,title:this.props.analyticsTitle}),m.a.createElement(Ua.a,null),m.a.createElement(Ra,null),m.a.createElement(ba,{handlePreferenceChange:this.handleConfirmationSidebarPreferenceChange,onPrivatePublish:this.onPublish,onPublish:this.onPublish,setPostDate:this.setPostDate,setStatus:this.setConfirmationSidebar,status:this.state.confirmationSidebar}),m.a.createElement(Ea,null),m.a.createElement(_a,null),m.a.createElement(Sa,null),m.a.createElement(Cc.a,{loadRevision:this.loadRevision}),m.a.createElement(Tc,null),m.a.createElement("div",{className:"post-editor__inner"},m.a.createElement(Sc,{setPostDate:this.setPostDate,hasContent:this.props.hasContent,isConfirmationSidebarEnabled:this.props.isConfirmationSidebarEnabled,confirmationSidebarStatus:this.state.confirmationSidebar,isDirty:this.props.isDirty,isSaveBlocked:this.isSaveBlocked(),isPublishing:this.state.isPublishing,isSaving:this.state.isSaving,onPreview:this.onPreview,onPublish:this.onPublish,onSave:this.onSave,onSaveDraft:this.props.onSaveDraft,site:e,toggleSidebar:this.toggleSidebar,onMoreInfoAboutEmailVerify:this.onMoreInfoAboutEmailVerify,allPostsUrl:this.getAllPostsUrl(),isSidebarOpened:"sidebar"===this.props.layoutFocus}),m.a.createElement("div",{className:"post-editor__content"},m.a.createElement("div",{className:"post-editor__content-editor"},m.a.createElement(re,null),m.a.createElement("div",{className:"post-editor__site"},m.a.createElement(rc.a,{compact:!0,site:e,indicator:!1,homeLink:!0,externalLink:!0}),this.props.isDirty?m.a.createElement(yc,{isSaving:this.state.isSaving,isSaveBlocked:this.isSaveBlocked(),isDirty:this.props.isDirty,hasContent:this.props.hasContent,onSave:this.onSave}):m.a.createElement(ee,null)),m.a.createElement("div",{className:"post-editor__inner-content"},m.a.createElement(ce.a,{maxWidth:1462,hasDropZone:!0}),m.a.createElement("div",{className:"post-editor__header"},m.a.createElement(_e,{onChange:this.onEditorTitleChange}),m.a.createElement(we,null),m.a.createElement(Lo.a,{className:"post-editor__switch-mode",compact:!0},m.a.createElement(Ao.a,{selected:"tinymce"===t,onClick:this.switchEditorVisualMode,title:this.props.translate("Edit with a visual editor")},this.props.translate("Visual",{context:"Editor writing mode"})),m.a.createElement(Ao.a,{selected:"html"===t,onClick:this.switchEditorHtmlMode,title:this.props.translate("Edit the raw HTML code")},"HTML"))),m.a.createElement("hr",{className:"post-editor__header-divider"}),m.a.createElement(Mo,{ref:this.storeEditor,mode:t,isNew:this.props.isNew,isVipSite:this.props.isVipSite,onSetContent:this.debouncedSaveRawContent,onInit:this.onEditorInitialized,onChange:this.onEditorContentChange,onKeyUp:this.onEditorKeyUp,onFocus:this.onEditorFocus,onMouseUp:this.copySelectedText,onBlur:this.copySelectedText,onTextEditorChange:this.onEditorTextContentChange}),m.a.createElement(Aa,{selectedText:this.state.selectedText})))),m.a.createElement(ac,{onPublish:this.onPublish,onTrashingPost:this.onTrashingPost,site:e,setPostDate:this.setPostDate,onSave:this.onSave,confirmationSidebarStatus:this.state.confirmationSidebar}),this.props.isSitePreviewable?m.a.createElement(Ko,{showPreview:this.state.showPreview,onClose:this.onPreviewClose,onEdit:this.onPreviewEdit,isSaving:this.state.isSaving||this.props.isAutosaving,isLoading:this.props.isLoading,isFullScreen:this.state.isPostPublishPreview,previewUrl:this.props.previewUrl,postId:this.props.postId,externalUrl:this.getExternalUrl(),revision:Object(y.get)(this.props.post,"revisions.length",0)}):null,m.a.createElement(Oa,x()({},this.state.notice,{onDismissClick:this.hideNotice}))),n?m.a.createElement(Bo,{onClose:this.onClose,onRestore:this.restoreTrashed}):null,this.state.showVerifyEmailDialog?m.a.createElement(zo.a,{onClose:this.closeVerifyEmailDialog}):null,s&&m.a.createElement(qo,{onClose:this.onClose}),i&&this.state.showAutosaveDialog?m.a.createElement(Bo,{onRestore:this.restoreAutosave,onClose:this.closeAutosaveDialog,isAutosave:!0}):null)}syncEditorContent(e){const t=Object(y.get)(e,"resetRawContent",!1),s=Object(y.get)(e,"content",this.editor.getContent());t&&this.props.editorResetRawContent(),this.saveRawContent(),s!==Object(y.get)(this.props.post,"content",null)&&this.props.editPost(this.props.siteId,this.props.postId,{content:s})}getExternalUrl(){const e=this.props.post;return e?e.URL:this.props.previewUrl}recordPreviewButtonClick(){const e="page"===this.props.type;this.props.recordTracksEvent(e?"calypso_editor_page_preview_button_click":"calypso_editor_post_preview_button_click"),this.props.recordGoogleEvent("Editor",e?"Clicked Preview Page Button":"Clicked Preview Post Button",e?"Editor Preview Page Button Clicked":"Editor Preview Post Button Clicked",e?"editorPageButtonClicked":"editorPostButtonClicked")}getPublishStatus(){return G.x(this.props.post)?"private":G.u(this.props.post)?"future":"publish"}}S()(Pc,"propTypes",{siteId:T.a.number,preferences:T.a.object,setEditorModePreference:T.a.func,setLayoutFocus:T.a.func.isRequired,setNextLayoutFocus:T.a.func.isRequired,editorModePreference:T.a.string,editorSidebarPreference:T.a.string,markChanged:T.a.func.isRequired,markSaved:T.a.func.isRequired,translate:T.a.func.isRequired,hasBrokenPublicizeConnection:T.a.bool,editPost:T.a.func,type:T.a.string,analyticsPath:T.a.string,analyticsTitle:T.a.string});var kc=Object(y.flow)(h.localize,Fa.c,Object(P.b)(e=>{const t=Object(B.e)(e),s=Object(z.f)(e),n=Object(Vs.g)(e);return{siteId:t,postId:s,savedPost:Object(V.l)(e,t,s),post:Object(V.a)(e,t,s),type:Object(V.c)(e,t,s,"type"),selectedSite:Object(B.d)(e),editorModePreference:Object(Ns.b)(e,"editor-mode"),editorSidebarPreference:Object(Ns.b)(e,"editor-sidebar")||"open",isNew:Object(z.m)(e),isDirty:Object(V.o)(e,t,s),hasContent:Object(Jo.a)(e,t,s),layoutFocus:Object(qa.a)(e),hasBrokenPublicizeConnection:Object(Zo.a)(e,t,n),isSitePreviewable:Object(ie.R)(e,t),isVipSite:Object(Xo.a)(e,t),isConfirmationSidebarEnabled:Object(z.j)(e,t),isSaveBlocked:Object(z.n)(e),previewUrl:Object(z.g)(e),isAutosaving:Object(z.k)(e),isLoading:Object(z.l)(e),loadingError:Object(z.c)(e)}},{autosave:v.b,saveEdited:v.j,editPost:v.e,setEditorModePreference:Object(y.partial)(Ds.b,"editor-mode"),setLayoutFocus:$o.b,setNextLayoutFocus:$o.c,saveConfirmationSidebarPreference:Ss.k,recordTracksEvent:Us.i,recordGoogleEvent:Us.g,recordEditorStat:F.b,recordEditorEvent:F.a,closeEditorSidebar:Qo,openEditorSidebar:()=>e=>{e(Object(Ds.b)("editor-sidebar","open")),e(Object(Us.k)(Object(Us.b)(Object(Us.i)("calypso_editor_sidebar_toggle_open"),Object(Us.g)("Editor","Sidebar Toggle","open"),Object(Us.a)("editor_actions","open-sidebar")),Object($o.b)("sidebar")))},editorEditRawContent:Ss.c,editorResetRawContent:Ss.g,pauseGuidedTour:_c.b}))(Pc),Dc=s("./client/state/selectors/get-selected-editor.js");function Nc(e){return e.params.post&&"new"!==e.params.post?parseInt(e.params.post,10):null}function Rc(e){return Object(y.startsWith)(e.path,"/post")?"post":Object(y.startsWith)(e.path,"/page")?"page":e.params.type}async function Mc(e,t){const s=e.store.getState();Object(Dc.a)(s,Object(B.e)(s))||await function(e){return new Promise(t=>{const s=e.store.subscribe(()=>{const n=e.store.getState(),i=Object(B.e)(n);i&&Object(Dc.a)(n,i)&&(s(),t())});e.store.dispatch(Object(Zr.a)(Object(B.e)(e.store.getState())))})}(e);const n=e.store.getState(),i=Object(B.e)(n),o=Object(y.get)(e.query,"set-editor"),a=Object(Dc.a)(n,i);if(-1!==["classic","gutenberg"].indexOf(o)&&o!==a&&e.store.dispatch(Object(Zr.b)(i,o)),"classic"===o)return t();if(!Object(Pa.a)(n,i))return t();if("gutenberg"!==Object(Dc.a)(n,i))return t();const r=Rc(e),c=Nc(e),l=Object(Xr.a)(n,i,c,r);return window.location.replace(Object(j.a)(e.query,l))}var Lc=function(e,t){const s=Rc(e),n=Nc(e),i=e.query["jetpack-copy"];function o(t){if(!function(e){const t=Rc(e),s=Nc(e),n=e.store.getState(),i=Object(B.e)(n);if(null===s){let s=Object(z.d)(n,i,t);if(s!==e.pathname)return e.querystring&&(s+="?".concat(e.querystring)),a.a.redirect(s),!0}return!1}(e))if(i)e.store.dispatch(Object(v.m)(t,i));else if(n){const i=e.path;e.store.dispatch(Object(v.l)(t,n)).then(n=>{i===a.a.current&&n&&n.type&&n.type!==s&&a.a.redirect(Object(G.e)(n,Object(ie.k)(e.store.getState(),t)))})}else{const n={type:s};if(e.query.url){const t=function(e){const t=e.text,s=e.url,n=e.title,i=e.image,o=e.embed,a=[];return i&&a.push(p.a.renderToStaticMarkup(m.a.createElement("p",null,m.a.createElement("a",{href:s},m.a.createElement("img",{alt:"",src:i}))))),Object(f.isWebUri)(o)&&a.push(p.a.renderToStaticMarkup(m.a.createElement("p",null,o))),t&&a.push(p.a.renderToStaticMarkup(m.a.createElement("blockquote",null,t))),a.push(p.a.renderToStaticMarkup(m.a.createElement("p",null,g.a.translate("via {{anchor/}}",{components:{anchor:m.a.createElement("a",{href:s},n)}})))),a.join("\n\n")}(e.query);Object.assign(n,{format:"quote",title:e.query.title,content:t})}e.store.dispatch(Object(Ss.m)(t,n))}}let r;function c(){const t=Object(B.e)(e.store.getState());return!!t&&(r&&r(),o(t),!0)}Object(E.b)(),c()||(r=e.store.subscribe(c));const d=((e,t,s)=>{const n="post"===e,i="page"===e,o=s||!t,a=!!t;return n&&o?["/post/:site","Post > New"]:n&&a?["/post/:site/:post_id","Post > Edit"]:i&&o?["/page/:site","Page > New"]:i&&a?["/page/:site/:post_id","Page > Edit"]:o?["/edit/".concat(e,"/:site"),"Custom Post Type > New"]:a?["/edit/".concat(e,"/:site/:post_id"),"Custom Post Type > Edit"]:void 0})(s,n,i),u=l()(d,2),h=u[0],b=u[1];!function(e,t){e.primary=m.a.createElement(kc,t)}(e,{analyticsPath:h,analyticsTitle:b}),t()},Ac=function(e,t){const s=Nc(e),n=Object(B.e)(e.store.getState());n&&e.store.dispatch(Object(Ss.o)(n,s)),t()},Uc=function(e,t){if(!e.query.url)return t();const s=Object(Vs.b)(e.store.getState()).primarySiteSlug;if(!s)return t();const n=[Object(j.b)(e.pathname,s),Object(b.stringify)(e.query)].join("?");return a.a.redirect(n),!1},qc=(e,t)=>{Object(y.has)(window,"location.replace")||t(),Mc(e,t)},Fc=s("./client/controller/index.web.js");t.default=function(){a()("/post",Uc,r.d,r.e,Fc.c,Fc.f),a()("/post/new",()=>a.a.redirect("/post")),a()("/post/:site?/:post?",r.d,qc,Lc,Fc.c,Fc.f),a.a.exit("/post/:site?/:post?",Ac),a()("/page",r.d,r.e,Fc.c,Fc.f),a()("/page/new",()=>a.a.redirect("/page")),a()("/page/:site?/:post?",r.d,qc,Lc,Fc.c,Fc.f),a.a.exit("/page/:site?/:post?",Ac),St.a.isEnabled("manage/custom-post-types")&&(a()("/edit/:type",r.d,r.e,Fc.c,Fc.f),a()("/edit/:type/new",e=>a.a.redirect("/edit/".concat(e.params.type))),a()("/edit/:type/:site?/:post?",r.d,qc,Lc,Fc.c,Fc.f),a.a.exit("/edit/:type/:site?/:post?",Ac))}},"./client/post-editor/media-modal/dialog.jsx":function(e,t,s){"use strict";var n=s("./node_modules/@babel/runtime/helpers/extends.js"),i=s.n(n),o=s("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),a=s.n(o),r=s("./node_modules/react/index.js"),c=s.n(r),l=s("./node_modules/classnames/index.js"),d=s.n(l),p=s("./client/components/dialog/index.jsx");s("./client/post-editor/media-modal/dialog.scss");t.a=(e=>{let t=e.additionalClassNames,s=a()(e,["additionalClassNames"]);return c.a.createElement(p.a,i()({additionalClassNames:d()("editor-media-modal",t)},s))})},"./client/post-editor/media-modal/dialog.scss":function(e,t,s){},"./client/post-editor/media-modal/gallery/style.scss":function(e,t,s){},"./client/post-editor/media-modal/index.jsx":function(e,t,s){"use strict";s.r(t);var n=s("./node_modules/@babel/runtime/helpers/extends.js"),i=s.n(n),o=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),a=s.n(o),r=s("./node_modules/react/index.js"),c=s.n(r),l=s("./node_modules/prop-types/index.js"),d=s.n(l),p=s("./packages/i18n-calypso/dist/esm/index.js"),u=s("./node_modules/react-redux/es/index.js"),m=s("./node_modules/lodash/lodash.js"),h=s("./client/my-sites/media-library/index.jsx"),g=s("./client/lib/analytics/index.js"),b=s("./client/state/posts/stats.js"),f=s("./client/components/header-cake/index.jsx"),y=s("./client/lib/media/store.js"),E=s("./client/post-editor/media-modal/content.jsx"),v=s("./client/my-sites/media-library/drop-zone.jsx"),j=s("./client/lib/media/library-selected-store.js"),_=s("./client/lib/media/actions.js"),x=s("./client/lib/media/utils.js");class w extends c.a.Component{constructor(){super(...arguments),a()(this,"filterDroppedImagesSelected",()=>{const e=this.props.site;if(!e)return;const t=j.a.getAll(e.ID),s=Object(x.d)(t,"image");Object(m.isEqual)(t,s)||(_.a.setLibrarySelectedItems(e.ID,s),this.props.onInvalidItemAdded())})}render(){return c.a.createElement(v.a,{site:this.props.site,onAddMedia:this.filterDroppedImagesSelected,fullScreen:!1})}}a()(w,"displayName","EditorMediaModalGalleryDropZone"),a()(w,"propTypes",{site:d.a.object,onInvalidItemAdded:d.a.func}),a()(w,"defaultProps",{onInvalidItemAdded:()=>{}});var S=s("./client/post-editor/media-modal/fieldset.jsx"),C=s("./client/components/select-dropdown/index.jsx"),I=s("./client/components/select-dropdown/item.jsx"),O=s("./client/components/forms/form-checkbox/index.jsx"),T=s("./client/lib/media/constants.js"),P=s("./client/lib/site/utils.js");class k extends c.a.Component{constructor(){super(...arguments),a()(this,"getTypeOptions",()=>{const e=this.props.site,t={individual:this.props.translate("Individual Images"),default:this.props.translate("Thumbnail Grid")};return!e||e.jetpack&&!Object(P.e)(e,"tiled-gallery")||Object(m.assign)(t,{rectangular:this.props.translate("Tiled Mosaic"),square:this.props.translate("Square Tiles"),circle:this.props.translate("Circles"),columns:this.props.translate("Tiled Columns")}),!e||e.jetpack&&!Object(P.e)(e,"shortcodes")||Object(m.assign)(t,{slideshow:this.props.translate("Slideshow")}),t}),a()(this,"getLinkOptions",()=>"individual"===this.props.settings.type?{}:{"":this.props.translate("Attachment Page"),file:this.props.translate("Media File"),none:this.props.translate("None")}),a()(this,"getSizeOptions",()=>Object(m.includes)(T.c,this.props.settings.type)?{thumbnail:this.props.translate("Thumbnail"),medium:this.props.translate("Medium"),large:this.props.translate("Large"),full:this.props.translate("Full Size")}:{}),a()(this,"getColumnOptions",()=>{const e=Math.min(this.props.numberOfItems,9);return Object(m.fromPairs)(Object(m.times)(e,e=>[e+1,(e+1).toString()]))}),a()(this,"updateRandomOrder",e=>{this.props.onUpdateSetting("orderBy",e.target.checked?"rand":null)}),a()(this,"renderDropdown",(e,t,s)=>{const n=this.props,i=n.settings,o=n.onUpdateSetting;if(Object.keys(t).length)return c.a.createElement(S.a,{legend:e,className:"for-setting-"+s},c.a.createElement(C.a,{selectedText:t[i[s]]},Object.keys(t).map(e=>{const n=t[e];return c.a.createElement(I.a,{key:"value-"+e,selected:e===i[s],onClick:()=>o(s,isFinite(parseInt(e))?+e:e)},n)})))}),a()(this,"renderColumnsOption",()=>{if(Object(m.includes)(T.a,this.props.settings.type))return this.renderDropdown(this.props.translate("Columns"),this.getColumnOptions(),"columns")}),a()(this,"renderRandomOption",()=>{const e=this.props.settings;if("individual"!==e.type)return c.a.createElement(S.a,{legend:this.props.translate("Random Order")},c.a.createElement(O.a,{onChange:this.updateRandomOrder,checked:"rand"===e.orderBy}))})}render(){const e=this.getTypeOptions(),t=this.getLinkOptions(),s=this.getSizeOptions();return c.a.createElement("div",{className:"editor-media-modal-gallery__fields"},this.renderDropdown(this.props.translate("Layout"),e,"type"),this.renderColumnsOption(),this.renderRandomOption(),this.renderDropdown(this.props.translate("Link To"),t,"link"),this.renderDropdown(this.props.translate("Size"),s,"size"))}}a()(k,"propTypes",{site:d.a.object,settings:d.a.object,onUpdateSetting:d.a.func,numberOfItems:d.a.number}),a()(k,"defaultProps",{settings:Object.freeze({}),onUpdateSetting:m.noop,numberOfItems:0});var D=Object(p.localize)(k),N=s("./client/components/notice/index.jsx"),R=s("./client/components/segmented-control/index.jsx"),M=s("./client/components/segmented-control/item.jsx"),L=s("./client/components/ellipsis-menu/index.jsx"),A=s("./client/components/popover/menu-item.jsx"),U=s("./client/components/forms/sortable-list/index.jsx"),q=s("./client/my-sites/media-library/list-item.jsx"),F=s("./client/components/forms/form-text-input/index.jsx");class B extends c.a.Component{constructor(){super(...arguments),a()(this,"state",{caption:null}),a()(this,"getValue",()=>null!==this.state.caption?this.state.caption:this.props.item?this.props.item.caption:void 0),a()(this,"setCaption",e=>{this.setState({caption:e.target.value})}),a()(this,"saveCaption",()=>{const e=this.props,t=e.siteId,s=e.item;if(!t||!s)return;const n=this.getValue();s&&n===s.caption||_.a.update(t,Object.assign({},s,{caption:n}))})}render(){return c.a.createElement(F.a,{value:this.getValue(),placeholder:this.props.translate("Caption this image…"),onChange:this.setCaption,onBlur:this.saveCaption,onMouseDown:e=>e.stopPropagation(),className:"editor-media-modal-gallery__caption"})}}a()(B,"displayName","EditorMediaModalGalleryCaption"),a()(B,"propTypes",{siteId:d.a.number,item:d.a.object});var z=Object(p.localize)(B),V=s("./client/components/gridicon/index.jsx"),H=s("./client/components/screen-reader-text/index.js");class W extends r.PureComponent{constructor(){super(...arguments),a()(this,"remove",()=>{const e=this.props,t=e.siteId,s=e.itemId;if(!t||!s)return;const n=j.a.getAll(t),i=Object(m.reject)(n,e=>e.ID===s);_.a.setLibrarySelectedItems(t,i)})}render(){const e=this.props.translate;return c.a.createElement("button",{onClick:this.remove,onMouseDown:e=>e.stopPropagation(),className:"editor-media-modal-gallery__remove"},c.a.createElement(H.a,null,e("Remove")),c.a.createElement(V.a,{icon:"cross"}))}}a()(W,"propTypes",{siteId:d.a.number,itemId:d.a.number}),W.displayName="RemoveButton";var G=Object(p.localize)(W),Y=s("./client/state/selectors/can-current-user.js");class K extends r.Component{constructor(){super(...arguments),a()(this,"renderCaption",()=>{const e=this.props,t=e.site,s=e.item;if(e.canUserUploadFiles)return c.a.createElement(z,{siteId:t.ID,item:s})})}render(){const e=this.props,t=e.site,s=e.item,n=e.showRemoveButton;return c.a.createElement("div",{className:"editor-media-modal-gallery__edit-item"},c.a.createElement(q.a,{media:s,scale:1,photon:!1}),this.renderCaption(),n&&c.a.createElement(G,{siteId:t.ID,itemId:s.ID}))}}a()(K,"propTypes",{site:d.a.object,item:d.a.object,showRemoveButton:d.a.bool}),a()(K,"defaultProps",{showRemoveButton:!0});var $=Object(u.b)((e,t)=>{let s=t.site,n=void 0===s?{}:s;return{canUserUploadFiles:Object(Y.b)(e,n.ID,"upload_files")}})(K);class Q extends c.a.Component{constructor(){super(...arguments),a()(this,"onOrderChanged",e=>{const t=[];this.props.settings.items.forEach((s,n)=>{t[e[n]]=s}),this.props.onUpdateSetting({items:t,orderBy:null})})}render(){const e=this.props,t=e.onUpdateSetting,s=e.site,n=e.settings,i=e.translate;if(!s||!n.items)return null;const o={[i("Reverse order")]:Object(m.reverse)([...n.items]),[i("Order alphabetically")]:Object(m.sortBy)(n.items,"title"),[i("Order chronologically")]:Object(m.sortBy)(n.items,"date")};return c.a.createElement("div",null,c.a.createElement(L.a,{popoverClassName:"gallery__order-popover",position:"bottom right"},Object(m.map)(o,(e,s)=>{return c.a.createElement(A.a,{key:s,onClick:()=>t({items:e})},s)})),c.a.createElement(U.a,{onChange:this.onOrderChanged},n.items.map(e=>c.a.createElement($,{key:e.ID,site:s,item:e,showRemoveButton:n.items.length>1}))))}}a()(Q,"propTypes",{site:d.a.object,settings:d.a.object,onUpdateSetting:d.a.func}),a()(Q,"defaultProps",{settings:Object.freeze({}),onUpdateSetting:m.noop});var J=Object(p.localize)(Q),Z=s("./node_modules/create-react-class/index.js"),X=s.n(Z),ee=s("./node_modules/classnames/index.js"),te=s.n(ee),se=s("./client/components/gallery-shortcode/index.jsx"),ne=X()({displayName:"EditorMediaModalGalleryPreviewShortcode",propTypes:{siteId:d.a.number,settings:d.a.object},getInitialState(){return{isLoading:!0,shortcode:Object(x.e)(this.props.settings)}},componentWillReceiveProps(e){const t=Object(x.e)(e.settings);this.state.shortcode!==t&&this.setState({isLoading:!0,shortcode:t})},setLoaded(){this.isMounted()&&this.setState({isLoading:!1})},render(){const e=this.props,t=e.siteId,s=e.settings,n=this.state,i=n.isLoading,o=n.shortcode,a=te()("editor-media-modal-gallery__preview-shortcode",{"is-loading":i||Object(m.some)(s.items,"transient")});return c.a.createElement("div",{className:a},c.a.createElement(se.a,{siteId:t,onLoad:this.setLoaded},o))}}),ie=s("./client/post-editor/media-modal/markup.js"),oe=s("./client/state/ui/selectors.js");class ae extends c.a.Component{render(){const e=this.props.items.map(e=>{const t=ie.a.caption(this.props.site,e);return null===t?c.a.createElement("div",{key:e.ID,dangerouslySetInnerHTML:{__html:ie.a.get(this.props.site,e)}}):c.a.cloneElement(t,{key:e.ID})});return c.a.createElement("div",{className:"editor-media-modal-gallery__preview-individual"},c.a.createElement("div",{className:"editor-media-modal-gallery__preview-individual-content"},e))}}a()(ae,"propTypes",{items:d.a.arrayOf(d.a.object),site:d.a.object});var re=Object(u.b)(e=>({site:Object(oe.d)(e)}))(ae);class ce extends r.Component{constructor(){super(...arguments),a()(this,"state",{isEditing:!1})}renderPreviewModeToggle(){const e=this.props.translate;return c.a.createElement(R.a,{className:"editor-media-modal-gallery__preview-toggle",compact:!0},c.a.createElement(M.a,{selected:!this.state.isEditing,onClick:()=>this.setState({isEditing:!1})},e("Preview")),c.a.createElement(M.a,{selected:this.state.isEditing,onClick:()=>this.setState({isEditing:!0})},e("Edit")))}renderPreview(){const e=this.props,t=e.site,s=e.settings,n=e.onUpdateSetting;if(t&&s.items)return this.state.isEditing?c.a.createElement(J,{site:t,settings:s,onUpdateSetting:n}):"individual"===s.type?c.a.createElement(re,{items:s.items}):c.a.createElement(ne,{siteId:t.ID,settings:s})}render(){const e=this.props.translate;return c.a.createElement("div",{className:"editor-media-modal-gallery__preview"},this.props.invalidItemDropped&&c.a.createElement(N.b,{status:"is-warning",onDismissClick:this.props.onDismissInvalidItemDropped,isCompact:!0},e("Galleries can only include images. All other uploads will be added to your media library.")),c.a.createElement("div",{className:"editor-media-modal-gallery__preview-wrapper"},this.renderPreview()),this.renderPreviewModeToggle())}}a()(ce,"propTypes",{site:d.a.object,settings:d.a.object,onUpdateSetting:d.a.func,invalidItemDropped:d.a.bool,onDismissInvalidItemDropped:d.a.func}),a()(ce,"defaultProps",{settings:Object.freeze({}),onUpdateSetting:m.noop,invalidItemDropped:!1,onDismissInvalidItemDropped:m.noop}),ce.displayName="EditorMediaModalGalleryPreview";var le=Object(p.localize)(ce),de=s("./client/state/ui/media-modal/constants.js"),pe=s("./client/state/ui/editor/actions.js");s("./client/post-editor/media-modal/gallery/style.scss");class ue extends c.a.Component{constructor(){super(...arguments),a()(this,"state",{invalidItemDropped:!1}),a()(this,"reconcileSettingsItems",(e,t)=>{const s=e.items.filter(e=>Object(m.some)(t,{ID:e.ID})).concat(t.filter(t=>!Object(m.some)(e.items,{ID:t.ID}))).map(e=>y.a.get(this.props.site.ID,e.ID));Object(m.isEqual)(s,e.items)||this.updateSetting("items",s)}),a()(this,"maybeUpdateColumnsSetting",()=>{this.props.items.length<this.props.settings.columns&&this.updateSetting("columns",this.props.items.length)}),a()(this,"setDefaultSettings",()=>{const e=this.props,t=e.site,s=e.settings,n=e.items,i=e.onUpdateSettings;if(s)return;const o=Object(m.assign)({},T.b,{items:n});!t||t.jetpack&&!Object(P.e)(t,"tiled-gallery")||(o.type="rectangular"),i(o)}),a()(this,"updateSetting",(e,t)=>{"string"==typeof e&&(e={[e]:t});let s=Object(m.assign)({},this.props.settings,e);s=Object(m.omitBy)(s,e=>null===e),this.props.onUpdateSettings(s)})}componentWillMount(){this.props.settings?(this.maybeUpdateColumnsSetting(),this.reconcileSettingsItems(this.props.settings,this.props.items)):this.setDefaultSettings()}componentDidUpdate(e){this.props.settings&&(this.maybeUpdateColumnsSetting(),Object(m.isEqual)(e.items,this.props.items)||this.reconcileSettingsItems(this.props.settings,this.props.items))}render(){const e=this.props,t=e.site,s=e.items,n=e.settings;return c.a.createElement("div",{className:"editor-media-modal-gallery"},c.a.createElement(w,{site:t,onInvalidItemAdded:()=>this.setState({invalidItemDropped:!0})}),c.a.createElement(f.a,{onClick:this.props.onReturnToList,backText:this.props.translate("Media Library")}),c.a.createElement(E.a,{className:"editor-media-modal-gallery__content"},c.a.createElement(le,{site:t,items:s,settings:n,onUpdateSetting:this.updateSetting,invalidItemDropped:this.state.invalidItemDropped,onDismissInvalidItemDropped:()=>this.setState({invalidItemDropped:!1})}),c.a.createElement("div",{className:"editor-media-modal-gallery__sidebar"},c.a.createElement(D,{site:t,settings:n,onUpdateSetting:this.updateSetting,numberOfItems:s.length}))))}}a()(ue,"propTypes",{site:d.a.object,items:d.a.array,settings:d.a.object,onUpdateSettings:d.a.func,onReturnToList:d.a.func}),a()(ue,"defaultProps",{onUpdateSettings:m.noop});var me=Object(u.b)(null,{onReturnToList:Object(m.partial)(pe.l,de.a.LIST)})(Object(p.localize)(ue)),he=s("./client/components/close-on-escape/index.jsx"),ge=s("./client/lib/accept/index.js"),be=s("./client/state/ui/media-modal/selectors.js"),fe=s("./client/state/sites/selectors.js"),ye=s("./client/state/ui/editor/selectors.js"),Ee=s("./client/state/ui/media-modal/actions.js"),ve=s("./client/state/media/actions.js"),je=s("./client/blocks/image-editor/index.jsx"),_e=s("./client/blocks/video-editor/index.jsx"),xe=s("./client/post-editor/media-modal/dialog.jsx"),we=s("./client/post-editor/media-modal/detail/index.jsx"),Se=s("./client/state/analytics/actions.js");s("./client/post-editor/media-modal/index.scss");function Ce(e,t,s){return!s(t)||Object(m.some)(t,t=>x.k(t)&&("image"!==x.g(t)||!x.o(t)||e===de.a.GALLERY))}s.d(t,"EditorMediaModal",function(){return Ie});class Ie extends r.Component{constructor(e){super(e),a()(this,"confirmSelection",()=>{const e=this.props,t=e.view,s=e.mediaLibrarySelectedItems;if(!Ce(t,s,this.props.isParentReady))if(s.length&&""!==this.state.source){const e=s.map(e=>Object.assign({},e,{ID:Object(m.uniqueId)("media-"),transient:!0}));1===e.length&&"image"===x.g(e[0])?(this.copyExternal(e,this.state.source),this.props.onClose({type:"media",items:e})):this.copyExternalAfterLoadingWordPressLibrary(e,this.state.source)}else{const e=s.length?{type:de.a.GALLERY===t?"gallery":"media",items:s,settings:this.state.gallerySettings}:void 0;this.props.onClose(e)}}),a()(this,"setDetailSelectedIndex",e=>{this.setState({detailSelectedIndex:e})}),a()(this,"confirmDeleteMedia",e=>{const t=this.props,s=t.site,n=t.mediaLibrarySelectedItems;if(!s||!e)return;let i=n;de.a.DETAIL===this.props.view&&(i=i[this.getDetailSelectedIndex()],this.setNextAvailableDetailView()),_.a.delete(s.ID,i),g.default.mc.bumpStat("editor_media_actions","delete_media"),this.props.deleteMedia(s.ID,Object(m.map)(i,"ID"))}),a()(this,"deleteMedia",()=>{const e=this.props,t=e.view,s=e.mediaLibrarySelectedItems,n=e.translate;let i;const o=n("Are you sure you want to delete this item? Deleted media will no longer appear anywhere on your website, including all posts, pages, and widgets. This cannot be undone.","Are you sure you want to delete these items? Deleted media will no longer appear anywhere on your website, including all posts, pages, and widgets. This cannot be undone.",{count:i=de.a.DETAIL===t?1:s.length});Object(ge.a)(o,this.confirmDeleteMedia,n("Delete"),null,{isScary:!0})}),a()(this,"onAddMedia",()=>{this.props.recordEditorStat("media_explorer_upload"),this.props.recordEditorEvent("Upload Media")}),a()(this,"onAddAndEditImage",()=>{_.a.setLibrarySelectedItems(this.props.site.ID,[]),this.props.setView(de.a.IMAGE_EDITOR)}),a()(this,"restoreOriginalMedia",(e,t)=>{e&&t&&(_.a.update(e,{ID:t.ID,media_url:t.guid},!0),this.props.onRestoreMediaHook())}),a()(this,"onImageEditorDone",(e,t,s)=>{if(e)return void this.onImageEditorCancel(s);const n=s.fileName,i=s.site,o=s.ID,a=s.resetAllImageEditorState,r=s.width,c=s.height,l=x.h(n),d=Object.assign({ID:o,media:{fileName:n,fileContents:t,mimeType:l}},r&&{width:r},c&&{height:c});_.a.update(i.ID,d,!0),a(),this.props.setView(de.a.DETAIL),this.props.onImageEditorDoneHook()}),a()(this,"handleUpdatePoster",e=>{let t=e.ID,s=e.posterUrl;const n=this.props.site,i=(s||"").split("?")[0];n&&_.a.edit(n.ID,{ID:t,thumbnails:{fmt_hd:i,fmt_dvd:i,fmt_std:i}}),this.props.setView(de.a.DETAIL)}),a()(this,"handleCancel",()=>{this.props.mediaLibrarySelectedItems[this.getDetailSelectedIndex()]?this.props.setView(de.a.DETAIL):this.props.setView(de.a.LIST)}),a()(this,"onImageEditorCancel",e=>{const t=e.resetAllImageEditorState;this.handleCancel(),t()}),a()(this,"onFilterChange",e=>{e!==this.state.filter&&g.default.mc.bumpStat("editor_media_actions","filter_"+(e||"all")),this.setState({filter:e})}),a()(this,"onScaleChange",()=>{this.statsTracking.scale||(g.default.mc.bumpStat("editor_media_actions","scale"),this.statsTracking.scale=!0)}),a()(this,"onSearch",e=>{this.setState({search:e||void 0}),this.statsTracking.search||(g.default.mc.bumpStat("editor_media_actions","search"),this.statsTracking.search=!0)}),a()(this,"onSourceChange",e=>{_.a.sourceChanged(this.props.site.ID),this.setState({source:e,search:void 0})}),a()(this,"onClose",()=>{this.props.onClose()}),a()(this,"editItem",e=>{const t=this.props,s=t.site,n=t.mediaLibrarySelectedItems,i=t.single;if(!s)return;let o=n;o.some(t=>t.ID===e.ID)||(o=i?[e]:o.concat(e),_.a.setLibrarySelectedItems(s.ID,o)),this.setDetailSelectedIndex(Object(m.findIndex)(o,{ID:e.ID})),g.default.mc.bumpStat("editor_media_actions","edit_button_contextual"),g.default.ga.recordEvent("Media","Clicked Contextual Edit Button"),this.props.setView(de.a.DETAIL)}),a()(this,"updateSettings",e=>{this.setState({gallerySettings:e})}),this.state=this.getDefaultState(e)}componentWillReceiveProps(e){e.site&&this.props.visible&&!e.visible&&_.a.setLibrarySelectedItems(e.site.ID,[]),this.props.visible!==e.visible&&(e.visible?(this.setState(this.getDefaultState(e)),e.source&&this.state.source!==e.source&&e.site&&_.a.sourceChanged(e.site.ID)):this.props.resetView())}componentDidMount(){this.statsTracking={}}componentWillMount(){const e=this.props,t=e.view,s=e.mediaLibrarySelectedItems,n=e.site,i=e.single;Object(m.isEmpty)(s)||t!==de.a.LIST&&!i||_.a.setLibrarySelectedItems(n.ID,[])}componentWillUnmount(){this.props.resetView(),_.a.setLibrarySelectedItems(this.props.site.ID,[])}getDefaultState(e){return{filter:"",detailSelectedIndex:0,source:e.source?e.source:"",gallerySettings:e.initialGallerySettings}}copyExternalAfterLoadingWordPressLibrary(e,t){const s=this.props.site;_.a.sourceChanged(s.ID),this.setState({source:"",search:void 0},()=>{_.a.setQuery(s.ID,{}),_.a.addExternal(s,e,t)})}copyExternal(e,t){const s=this.props.site,n=!!this.state.search;n&&this.setState({search:""}),_.a.addExternal(s,e,t),n&&_.a.setQuery(s.ID,{})}setNextAvailableDetailView(){1===this.props.mediaLibrarySelectedItems.length?this.props.setView(de.a.LIST):this.getDetailSelectedIndex()===this.props.mediaLibrarySelectedItems.length-1&&this.setDetailSelectedIndex(Math.max(this.getDetailSelectedIndex()-1,0))}getDetailSelectedIndex(){const e=this.props.mediaLibrarySelectedItems,t=this.state.detailSelectedIndex;return t>=e.length?0:t}getFirstEnabledFilter(){if(this.props.enabledFilters)return Object(m.head)(this.props.enabledFilters)}getModalButtons(){if(Object(m.includes)([de.a.IMAGE_EDITOR,de.a.VIDEO_EDITOR],this.props.view))return;const e=this.props.mediaLibrarySelectedItems,t=this.props.galleryViewEnabled,s=Ce(this.props.view,e,this.props.isParentReady),n=[{action:"cancel",label:this.props.translate("Cancel")}],i=()=>{let t=this.props.translate("Insert");return(e.length>1||1===e.length&&"image"!==x.g(e[0]))&&(t=this.props.translate("Copy to media library")),t};return""!==this.state.source?n.push({action:"confirm",label:this.props.labels.confirm||i(),isPrimary:!0,disabled:s||0===e.length,onClick:this.confirmSelection}):de.a.GALLERY!==this.props.view&&e.length>1&&t&&!Object(m.some)(e,e=>"image"!==x.g(e))?n.push({action:"confirm",label:this.props.translate("Continue"),isPrimary:!0,disabled:s||!this.props.site,onClick:Object(m.partial)(this.props.setView,de.a.GALLERY)}):n.push({action:"confirm",label:this.props.labels.confirm||this.props.translate("Insert"),isPrimary:!0,disabled:s||0===e.length,onClick:this.confirmSelection}),n}shouldClose(){return!Object(m.includes)([de.a.IMAGE_EDITOR,de.a.VIDEO_EDITOR],this.props.view)}renderContent(){let e;switch(this.props.view){case de.a.DETAIL:e=c.a.createElement(we.b,{site:this.props.site,items:this.props.mediaLibrarySelectedItems,selectedIndex:this.getDetailSelectedIndex(),onRestoreItem:this.restoreOriginalMedia,onSelectedIndexChange:this.setDetailSelectedIndex});break;case de.a.GALLERY:e=c.a.createElement(me,{site:this.props.site,items:this.props.mediaLibrarySelectedItems,settings:this.state.gallerySettings,onUpdateSettings:this.updateSettings});break;case de.a.IMAGE_EDITOR:{const t=this.props,s=t.site,n=t.imageEditorProps,o=t.mediaLibrarySelectedItems,a=this.getDetailSelectedIndex(),r=Object(m.get)(o,a,null);e=c.a.createElement(je.a,i()({siteId:Object(m.get)(s,"ID"),media:r,onDone:this.onImageEditorDone,onCancel:this.onImageEditorCancel},n));break}case de.a.VIDEO_EDITOR:{const t=this.props.mediaLibrarySelectedItems,s=this.getDetailSelectedIndex(),n=Object(m.get)(t,s,null);e=c.a.createElement(_e.a,{media:n,onCancel:this.handleCancel,onUpdatePoster:this.handleUpdatePoster});break}default:e=c.a.createElement(h.a,{site:this.props.site,filter:this.state.filter||this.props.defaultFilter||this.getFirstEnabledFilter(),enabledFilters:this.props.enabledFilters,search:this.state.search,source:this.state.source,onAddMedia:this.onAddMedia,onAddAndEditImage:this.onAddAndEditImage,onFilterChange:this.onFilterChange,onScaleChange:this.onScaleChange,onSourceChange:this.onSourceChange,onSearch:this.onSearch,onEditItem:this.editItem,fullScreenDropZone:!1,single:this.props.single,onDeleteItem:this.deleteMedia,onViewDetails:this.props.onViewDetails,mediaLibrarySelectedItems:this.props.mediaLibrarySelectedItems,postId:this.props.postId,disableLargeImageSources:this.props.disableLargeImageSources,disabledDataSources:this.props.disabledDataSources,scrollable:!0})}return e}render(){return c.a.createElement(xe.a,{isVisible:this.props.visible,buttons:this.getModalButtons(),onClose:this.onClose,isBackdropVisible:this.props.isBackdropVisible,shouldCloseOnOverlayClick:this.shouldClose(),shouldCloseOnEsc:!1},c.a.createElement(he.a,{onEscape:this.onClose}),this.renderContent())}}a()(Ie,"propTypes",{visible:d.a.bool,mediaLibrarySelectedItems:d.a.arrayOf(d.a.object),onClose:d.a.func,isBackdropVisible:d.a.bool,isParentReady:d.a.func,site:d.a.object,siteId:d.a.number,labels:d.a.object,single:d.a.bool,defaultFilter:d.a.string,enabledFilters:d.a.arrayOf(d.a.string),view:d.a.oneOf(Object(m.values)(de.a)),galleryViewEnabled:d.a.bool,setView:d.a.func,resetView:d.a.func,postId:d.a.number,disableLargeImageSources:d.a.bool,disabledDataSources:d.a.arrayOf(d.a.string),onImageEditorDoneHook:d.a.func,onRestoreMediaHook:d.a.func}),a()(Ie,"defaultProps",{visible:!1,mediaLibrarySelectedItems:Object.freeze([]),onClose:m.noop,isBackdropVisible:!0,isParentReady:()=>!0,labels:Object.freeze({}),setView:m.noop,resetView:m.noop,translate:m.identity,view:de.a.LIST,galleryViewEnabled:!0,imageEditorProps:{},deleteMedia:()=>{},disableLargeImageSources:!1,disabledDataSources:[],onImageEditorDoneHook:m.noop,onRestoreMediaHook:m.noop});t.default=Object(u.b)((e,t)=>{let s=t.site,n=t.siteId;return{view:Object(be.a)(e),site:s||Object(fe.k)(e,n),postId:Object(ye.f)(e)}},{setView:pe.l,resetView:Ee.a,deleteMedia:ve.a,onViewDetails:Object(m.flow)(Object(Se.k)(Object(Se.a)("editor_media_actions","edit_button_dialog")),Object(Se.k)(Object(Se.g)("Media","Clicked Dialog Edit Button")),Object(m.partial)(pe.l,de.a.DETAIL)),recordEditorEvent:b.a,recordEditorStat:b.b})(Object(p.localize)(Ie))},"./client/post-editor/media-modal/index.scss":function(e,t,s){},"./client/post-editor/media-modal/markup.js":function(e,t,s){"use strict";var n=s("./node_modules/lodash/lodash.js"),i=s("./node_modules/react-dom/server.browser.js"),o=s.n(i),a=s("./node_modules/react/index.js"),r=s.n(a),c=s("./node_modules/classnames/index.js"),l=s.n(c),d=s("./client/lib/shortcode/index.js"),p=s("./client/lib/media/utils.js"),u=s("./client/lib/media-serialization/index.js");const m={get:function(e,t,s){if(!t||t.hasOwnProperty("status"))return"";const n=p.g(t);return n&&"function"==typeof m.mimeTypes[n]?m.mimeTypes[n](e,t,s):m.link(t)},link:function(e){const t=r.a.createElement("a",{href:e.URL,title:e.title},e.title);return o.a.renderToStaticMarkup(t)},
/**
   * Given a media object or markup string and a site, returns a caption React element.
   *
   * Adapted from WordPress.
   *
   * @copyright 2015 by the WordPress contributors.
   * @license See CREDITS.md.
   * @see https://github.com/WordPress/WordPress/blob/4.3/wp-includes/js/tinymce/plugins/wpeditimage/plugin.js#L97-L157
   *
   * @param  {Object} site           A site object
   * @param  {(Object|String)} media A media object or markup string
   * @return {String}                A caption React element, or null if not
   *                                 a captioned item.
   */
caption:function(e,t){let s,n,i;"string"!=typeof t&&(t=m.get(e,t));const o=Object(d.b)(t);if(!o||!o.content)return null;const a=o.content.match(/((?:<a [^>]+>)?<img [^>]+>(?:<\/a>)?)([\s\S]*)/i);return a&&(s=a[1].trim(),n=a[2].trim()),(i=o.attrs.named.width)||(i=Object(u.a)(s).width),r.a.createElement("dl",{className:l()("wp-caption",o.attrs.named.align,o.attrs.named.classes),style:{width:parseInt(i,10)}},r.a.createElement("dt",{className:"wp-caption-dt",dangerouslySetInnerHTML:{__html:s}}),r.a.createElement("dd",{className:"wp-caption-dd"},n))},mimeTypes:{image:function(e,t,s){let i,a,c;if("full"===(s=Object(n.assign)({size:"full",align:"none",forceResize:!1},s)).size)i=t.width,a=t.height;else{const n=p.i(s.size,e),o=Math.min(n.width/t.width||1/0,n.height/t.height||1/0);i=Math.round(t.width*o),a=Math.round(t.height*o)}c=s.forceResize||e&&!e.jetpack&&i&&i!==t.width?{maxWidth:i}:{size:s.size};const u=r.a.createElement("img",{src:p.s(t,c),alt:t.alt||t.title,width:isFinite(i)?i:null,height:isFinite(a)?a:null,className:l()("align"+s.align,"size-"+s.size,"wp-image-"+t.ID),"data-istransient":t.transient?"istransient":null});let m=o.a.renderToStaticMarkup(u);return t.caption&&i&&(m=Object(d.c)({tag:"caption",attrs:{id:"attachment_"+t.ID,width:i},content:[m,t.caption].join(" ")})),m},audio:function(e,t){return Object(d.c)({tag:"audio",attrs:{src:t.URL}})},video:function(e,t){return p.p(t)?Object(d.c)({tag:"wpvideo",attrs:[t.videopress_guid],type:"single"}):Object(d.c)({tag:"video",attrs:{src:t.URL,height:t.height,width:t.width}})}}};t.a=m},"./client/post-editor/style.scss":function(e,t,s){},"./client/state/data-layer/wpcom/sites/memberships/index.js":function(e,t,s){"use strict";s.d(t,"a",function(){return r});var n=s("./node_modules/lodash/lodash.js"),i=s("./client/state/data-layer/wpcom-http/actions.js"),o=s("./client/state/data-layer/wpcom-http/utils.js"),a=s("./client/state/data-layer/handler-registry.js");const r=e=>({ID:e.id||e.connected_account_product_id,currency:e.currency,description:e.description,email:"",featuredImageId:null,formatted_price:e.price,multiple:!1,price:e.price,title:e.title,recurring:!0,stripe_account:e.connected_destination_account_id,renewal_schedule:e.interval}),c=Object(o.a)({fetch:e=>Object(i.a)({method:"GET",path:"/sites/".concat(e.siteId,"/memberships/products")},e),fromApi:function(e){return e.products.map(r)},onSuccess:(e,t)=>{return{type:"MEMBERSHIPS_PRODUCTS_RECEIVE",siteId:e.siteId,products:t}},onError:n.noop}),l=Object(o.a)({fetch:e=>Object(i.a)({method:"GET",path:"/sites/".concat(e.siteId,"/memberships/earnings"),apiNamespace:"wpcom/v2"},e),onSuccess:(e,t)=>{return{type:"MEMBERSHIPS_EARNINGS_RECEIVE",siteId:e.siteId,earnings:t}},onError:n.noop}),d=Object(o.a)({fetch:e=>Object(i.a)({method:"GET",path:"/sites/".concat(e.siteId,"/memberships/subscribers?offset=").concat(e.offset),apiNamespace:"wpcom/v2"},e),onSuccess:(e,t)=>{return{type:"MEMBERSHIPS_SUBSCRIBERS_RECEIVE",siteId:e.siteId,subscribers:t}},onError:n.noop}),p=Object(o.a)({fetch:e=>Object(i.a)({method:"GET",path:"/sites/".concat(e.siteId,"/memberships/status"),apiNamespace:"wpcom/v2"},e),onSuccess:(e,t)=>{return{type:"MEMBERSHIPS_SETTINGS_RECEIVE",siteId:e.siteId,data:t}},onError:n.noop});Object(a.b)("state/data-layer/wpcom/sites/memberships/index.js",{MEMBERSHIPS_PRODUCTS_LIST:[c],MEMBERSHIPS_EARNINGS_GET:[l],MEMBERSHIPS_SUBSCRIBERS_LIST:[d],MEMBERSHIPS_SETTINGS:[p]})},"./client/state/data-layer/wpcom/sites/simple-payments/index.js":function(e,t,s){"use strict";s.d(t,"a",function(){return v}),s.d(t,"b",function(){return j});var n=s("./node_modules/@babel/runtime/helpers/slicedToArray.js"),i=s.n(n),o=s("./node_modules/@babel/runtime/helpers/objectSpread.js"),a=s.n(o),r=s("./node_modules/lodash/lodash.js"),c=s("./packages/format-currency/dist/esm/index.js"),l=s.n(c),d=s("./client/lib/formatting/index.js"),p=s("./client/state/data-layer/wpcom-http/utils.js"),u=s("./client/state/posts/utils.js"),m=s("./client/state/data-layer/wpcom-http/actions.js"),h=s("./client/lib/simple-payments/utils.js"),g=s("./client/state/simple-payments/product-list/schema.js"),b=s("./client/lib/simple-payments/constants.js"),f=s("./client/lib/make-json-schema-parser/index.js"),y=s("./client/state/simple-payments/product-list/actions.js"),E=s("./client/state/data-layer/handler-registry.js");function v(e){if(!Object(h.b)(e))throw new f.b("Custom post is not a valid simple payment product",e);const t=function(e){const t={};return e.forEach(e=>{let s=e.key,n=e.value;const i=g.b[s];i&&("boolean"===g.c[i].type&&(n=!!Number(n)),t[i]=n)}),t}(e.metadata);return a()({ID:e.ID,description:Object(d.b)(e.content),title:Object(d.b)(e.title),featuredImageId:Object(u.g)(e)},t)}function j(e){const t=Object(r.toPairs)(e).filter(e=>{let t=i()(e,1)[0];return g.c[t]});e.formatted_price||t.push(["formatted_price",l()(e.price,e.currency)]);const s=t.map(e=>{let t=i()(e,2),s=t[0],n=t[1];const o=g.c[s];return"boolean"===o.type&&(n=n?1:0),{key:o.metaKey,value:n}});return{type:b.c,metadata:s,title:e.title,content:e.description,featured_image:e.featuredImageId||""}}const _=(e,t)=>{let s=e.siteId;return Object(y.c)(s,t)},x=Object(p.a)({fetch:e=>Object(m.a)({method:"GET",path:"/sites/".concat(e.siteId,"/posts/").concat(e.productId)},e),fromApi:v,onSuccess:_,onError:r.noop}),w=Object(p.a)({fetch:e=>Object(m.a)({method:"GET",path:"/sites/".concat(e.siteId,"/posts"),query:{type:b.c,status:"publish",number:b.b}},e),fromApi:function(e){return Object(r.get)(e,"posts",[]).map(e=>{try{return v(e)}catch(e){return null}}).filter(Boolean)},onSuccess:(e,t)=>{let s=e.siteId;return Object(y.b)(s,t)},onError:r.noop}),S=Object(p.a)({fetch:e=>Object(m.a)({method:"POST",path:"/sites/".concat(e.siteId,"/posts/new"),body:j(e.product)},e),fromApi:v,onSuccess:_,onError:r.noop}),C=Object(p.a)({fetch:e=>Object(m.a)({method:"POST",path:"/sites/".concat(e.siteId,"/posts/").concat(e.productId),body:j(e.product)},e),fromApi:v,onSuccess:_,onError:r.noop}),I=Object(p.a)({fetch:e=>Object(m.a)({method:"POST",path:"/sites/".concat(e.siteId,"/posts/").concat(e.productId,"/delete")},e),onSuccess:(e,t)=>{let s=e.siteId;return Object(y.a)(s,t.ID)},onError:r.noop});Object(E.b)("state/data-layer/wpcom/sites/simple-payments/index.js",{SIMPLE_PAYMENTS_PRODUCT_GET:[x],SIMPLE_PAYMENTS_PRODUCTS_LIST:[w],SIMPLE_PAYMENTS_PRODUCTS_LIST_ADD:[S],SIMPLE_PAYMENTS_PRODUCTS_LIST_EDIT:[C],SIMPLE_PAYMENTS_PRODUCTS_LIST_DELETE:[I]})},"./client/state/media/actions.js":function(e,t,s){"use strict";var n=s("./node_modules/lodash/lodash.js"),i=s("./node_modules/debug/src/browser.js"),o=s.n(i),a=s("./client/state/data-layer/wpcom-http/utils.js"),r=s("./client/state/data-layer/wpcom-http/actions.js"),c=s("./client/state/data-layer/handler-registry.js");const l=o()("calypso:middleware-media");function d(e,t,s,i){return{type:"MEDIA_RECEIVE",siteId:e,media:Object(n.castArray)(t),found:s,query:i}}function p(e,t){return{type:"MEDIA_REQUEST",siteId:e,query:t}}function u(e,t){return{type:"MEDIA_REQUESTING",siteId:e,query:t}}function m(e,t){return{type:"MEDIA_REQUEST_FAILURE",siteId:e,query:t}}function h(e,t){return{type:"MEDIA_REQUEST_SUCCESS",siteId:e,query:t}}function g(e,t){return{type:"MEDIA_ITEM_REQUEST",siteId:e,mediaId:t}}function b(e,t){return{type:"MEDIA_ITEM_REQUESTING",siteId:e,mediaId:t}}function f(e,t){return{type:"MEDIA_ITEM_REQUEST_FAILURE",siteId:e,mediaId:t}}function y(e,t){return{type:"MEDIA_ITEM_REQUEST_SUCCESS",siteId:e,mediaId:t}}function E(e,t){return{type:"MEDIA_DELETE",mediaIds:Object(n.castArray)(t),siteId:e}}Object(c.b)("state/data-layer/wpcom/sites/media/index.js",{MEDIA_REQUEST:[Object(a.a)({fetch:function(e){return l("Request media for site %d using query %o",e.siteId,e.query),[u(e.siteId,e.query),Object(r.a)({method:"GET",path:"/sites/".concat(e.siteId,"/media"),apiVersion:"1.1"},e)]},onSuccess:(e,t)=>{let s=e.siteId,n=e.query;return[d(s,t.media,t.found,n),h(s,n)]},onError:e=>{return m(e.siteId,e.query)}})],MEDIA_ITEM_REQUEST:[Object(a.a)({fetch:function(e){const t=e.mediaId,s=e.query,n=e.siteId;return l("Request media item %d for site %d",t,n),[b(n,s),Object(r.a)({apiVersion:"1.2",method:"GET",path:"/sites/".concat(n,"/media/").concat(t),query:s},e)]},onSuccess:(e,t)=>{let s=e.mediaId,n=e.siteId;return[d(n,t),y(n,s)]},onError:e=>{let t=e.mediaId;return f(e.siteId,t)}})]}),s.d(t,"d",function(){return d}),s.d(t,"e",function(){return p}),s.d(t,"g",function(){return u}),s.d(t,"c",function(){return m}),s.d(t,"j",function(){return h}),s.d(t,"f",function(){return g}),s.d(t,"h",function(){return b}),s.d(t,"b",function(){return f}),s.d(t,"i",function(){return y}),s.d(t,"a",function(){return E})},"./client/state/post-types/taxonomies/selectors.js":function(e,t,s){"use strict";s.d(t,"c",function(){return i}),s.d(t,"a",function(){return o}),s.d(t,"b",function(){return a});var n=s("./node_modules/lodash/lodash.js");function i(e,t,s){return Object(n.get)(e.postTypes.taxonomies.requesting,[t,s],!1)}function o(e,t,s){return Object(n.get)(e.postTypes.taxonomies.items,[t,s],null)}function a(e,t,s,i){const a=o(e,t,s);return Object(n.find)(a,{name:i})||null}},"./client/state/posts/revisions/actions.js":function(e,t,s){"use strict";var n=s("./node_modules/@babel/runtime/helpers/objectSpread.js"),i=s.n(n),o=s("./node_modules/lodash/lodash.js"),a=s("./client/state/data-layer/wpcom-http/utils.js"),r=s("./client/state/data-layer/wpcom-http/actions.js"),c=s("./client/state/data-layer/handler-registry.js");const l=Object(a.a)({fetch:e=>{const t=e.siteId,s=e.postId,n=e.postType,i=e.comparisons;return Object(r.a)({apiVersion:"1.1",path:"/sites/".concat(t,"/").concat(n,"/").concat(s,"/diffs"),method:"GET",query:{comparisons:i}},e)},onSuccess:(e,t)=>{let s=e.siteId,n=e.postId;return p(i()({siteId:s,postId:n},t))},onError:o.noop});Object(c.b)("state/data-layer/wpcom/posts/revisions/index.js",{POST_REVISIONS_REQUEST:[l]}),s.d(t,"d",function(){return d}),s.d(t,"c",function(){return p}),s.d(t,"e",function(){return u}),s.d(t,"a",function(){return m}),s.d(t,"b",function(){return h}),s.d(t,"f",function(){return g}),s.d(t,"g",function(){return b});const d=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"posts";return{type:"POST_REVISIONS_REQUEST",comparisons:arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],postId:t,postType:s,siteId:e}},p=e=>{return{type:"POST_REVISIONS_RECEIVE",diffs:e.diffs,postId:e.postId,revisions:e.revisions,siteId:e.siteId}},u=e=>({type:"POST_REVISIONS_SELECT",revisionId:e}),m=()=>({type:"POST_REVISIONS_DIALOG_CLOSE"}),h=()=>({type:"POST_REVISIONS_DIALOG_OPEN"}),g=()=>({type:"POST_REVISIONS_DIFF_SPLIT_VIEW"}),b=()=>({type:"POST_REVISIONS_DIFF_UNIFY_VIEW"})},"./client/state/selectors/get-current-route-parameterized.js":function(e,t,s){"use strict";s.d(t,"a",function(){return o});var n=s("./client/state/selectors/get-current-route.js"),i=s("./client/state/sites/selectors.js");function o(e,t){const s=Object(n.a)(e),o=Object(i.v)(e,t);return null===s||null===o?null:s.replace(o,":site").replace(t,":siteid")}},"./client/state/selectors/get-simple-payments.js":function(e,t,s){"use strict";var n=s("./node_modules/lodash/lodash.js"),i=s("./client/lib/create-selector/index.js");t.a=Object(i.a)(function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!t)return null;const i=Object(n.get)(e,"simplePayments.productList.items.".concat(t),null);if(!i)return null;if(!s)return Object(n.orderBy)(i,"ID","desc");const o=Object(n.find)(i,e=>e.ID===s);return o||null},e=>e.simplePayments.productList.items)},"./client/state/selectors/get-site-setting.js":function(e,t,s){"use strict";s.d(t,"a",function(){return o});var n=s("./node_modules/lodash/lodash.js"),i=s("./client/state/site-settings/selectors.js");function o(e,t,s){return Object(n.get)(Object(i.a)(e,t),[s],null)}},"./client/state/selectors/has-broken-site-user-connection.js":function(e,t,s){"use strict";s.d(t,"a",function(){return o});var n=s("./node_modules/lodash/lodash.js"),i=s("./client/state/sharing/publicize/selectors.js");function o(e,t,s){return Object(n.some)(Object(i.c)(e,t,s),{status:"broken"})}},"./client/state/selectors/is-drop-zone-visible.js":function(e,t,s){"use strict";s.d(t,"a",function(){return i});var n=s("./node_modules/lodash/lodash.js");function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return Object(n.get)(e,["ui","dropZone","isVisible",t],!1)}},"./client/state/selectors/is-unlaunched-site.js":function(e,t,s){"use strict";s.d(t,"a",function(){return i});var n=s("./client/state/selectors/get-raw-site.js");function i(e,t){const s=Object(n.a)(e,t);return s&&s.launch_status&&"unlaunched"===s.launch_status}},"./client/state/simple-payments/product-list/actions.js":function(e,t,s){"use strict";s.d(t,"e",function(){return n}),s.d(t,"d",function(){return i}),s.d(t,"b",function(){return o}),s.d(t,"c",function(){return a}),s.d(t,"a",function(){return r});s("./client/state/data-layer/wpcom/sites/simple-payments/index.js");const n=e=>({siteId:e,type:"SIMPLE_PAYMENTS_PRODUCTS_LIST"}),i=(e,t)=>({siteId:e,productId:t,type:"SIMPLE_PAYMENTS_PRODUCT_GET"});function o(e,t){return{type:"SIMPLE_PAYMENTS_PRODUCTS_LIST_RECEIVE",siteId:e,products:t}}function a(e,t){return{siteId:e,type:"SIMPLE_PAYMENTS_PRODUCTS_LIST_RECEIVE_UPDATE",product:t}}function r(e,t){return{siteId:e,productId:t,type:"SIMPLE_PAYMENTS_PRODUCTS_LIST_RECEIVE_DELETE"}}},"./client/state/site-settings/actions.js":function(e,t,s){"use strict";var n=s("./node_modules/@babel/runtime/helpers/objectSpread.js"),i=s.n(n),o=s("./client/lib/wp/browser.js"),a=s("./node_modules/lodash/lodash.js");function r(e){return Object.keys(e).reduce((t,s)=>{switch(s){case"default_category":t[s]=parseInt(e[s]);break;case"sharing_show":Object(a.isPlainObject)(e[s])?t[s]=Object(a.values)(e[s]):t[s]=e[s];break;default:t[s]=e[s]}return t},{})}function c(e,t){return{type:"SITE_SETTINGS_UPDATE",siteId:e,settings:t}}function l(e){return t=>(t({type:"SITE_SETTINGS_REQUEST",siteId:e}),o.a.undocumented().settings(e).then(s=>{let n=s.name,o=s.description,a=s.settings;const c=i()({},r(a),{blogname:n,blogdescription:o});t(function(e,t){return{type:"SITE_SETTINGS_RECEIVE",siteId:e,settings:t}}(e,c)),t({type:"SITE_SETTINGS_REQUEST_SUCCESS",siteId:e})}).catch(s=>{t({type:"SITE_SETTINGS_REQUEST_FAILURE",siteId:e,error:s})}))}function d(e,t){return s=>(s({type:"SITE_SETTINGS_SAVE",siteId:e}),o.a.undocumented().settings(e,"post",t).then(t=>(s(c(e,r(t.updated))),s({type:"SITE_SETTINGS_SAVE_SUCCESS",siteId:e}),t)).catch(t=>(s({type:"SITE_SETTINGS_SAVE_FAILURE",siteId:e,error:t}),t)))}s.d(t,"c",function(){return c}),s.d(t,"a",function(){return l}),s.d(t,"b",function(){return d})},"./client/state/sites/plans/actions.js":function(e,t,s){"use strict";var n=s("./node_modules/debug/src/browser.js"),i=s.n(n),o=s("./node_modules/lodash/lodash.js"),a=s("./packages/i18n-calypso/dist/esm/index.js"),r=s.n(a),c=s("./client/state/sites/plans/assembler.js"),l=s("./client/lib/wp/browser.js"),d=s("./client/state/data-layer/wpcom-http/utils.js"),p=s("./client/state/notices/actions.js"),u=s("./client/state/data-layer/wpcom-http/actions.js"),m=s("./client/state/data-layer/handler-registry.js");const h=e=>({duration:8e3,id:"sites-plan-transfer-notice-".concat(e)});Object(m.b)("state/data-layer/wpcom/sites/plan-transfer/index.js",{SITE_PLAN_OWNERSHIP_TRANSFER:[Object(d.a)({fetch:e=>Object(u.a)({apiVersion:"1",method:"POST",path:"/sites/"+e.siteId+"/plan-transfer",query:{new_user_id:e.newOwnerUserId}},e),onSuccess:e=>{let t=e.siteId;return[Object(p.f)(Object(a.translate)("Plan purchaser has been changed successfully."),h(t)),y(t)]},onError:(e,t)=>{let s=e.siteId,n=t.message;return Object(p.b)(n,h(s))}})]}),s.d(t,"a",function(){return b}),s.d(t,"b",function(){return f}),s.d(t,"c",function(){return y}),s.d(t,"d",function(){return E});const g=i()("calypso:site-plans:actions");function b(e){return{type:"SITE_PLANS_REMOVE",siteId:e}}function f(e){return t=>(t({type:"SITE_PLANS_FETCH",siteId:e}),new Promise(s=>{l.a.undocumented().getSitePlans(e,(n,i)=>{if(n){g("Fetching site plans failed: ",n);const s=n.message||r.a.translate("There was a problem fetching site plans. Please try again later or contact support.");t({type:"SITE_PLANS_FETCH_FAILED",siteId:e,error:s})}else t(function(e,t){return{type:"SITE_PLANS_FETCH_COMPLETED",siteId:e,plans:Object(o.map)(t,c.a)}}(e,i));s()})}))}function y(e){return t=>{t(b(e)),t(f(e))}}const E=(e,t)=>({type:"SITE_PLAN_OWNERSHIP_TRANSFER",newOwnerUserId:t,siteId:e})},"./client/state/terms/actions.js":function(e,t,s){"use strict";s.d(t,"a",function(){return u}),s.d(t,"d",function(){return m}),s.d(t,"b",function(){return h}),s.d(t,"c",function(){return y});var n=s("./node_modules/@babel/runtime/helpers/objectSpread.js"),i=s.n(n),o=s("./node_modules/lodash/lodash.js"),a=s("./client/lib/wp/browser.js"),r=s("./client/state/posts/actions.js"),c=s("./client/state/site-settings/actions.js"),l=s("./client/state/posts/selectors.js"),d=s("./client/state/site-settings/selectors.js"),p=s("./client/state/terms/selectors.js");function u(e,t,s){return n=>{const r=Object(o.uniqueId)("temporary");return n(g(e,t,i()({},s,{ID:r}))),a.a.site(e).taxonomy(t).term().add(s).then(s=>(n(g(e,t,s)),s),()=>Promise.resolve()).then(s=>(n(f(e,t,r)),s))}}function m(e,t,s,n,u){return(m,h)=>a.a.site(e).taxonomy(t).term(n).update(u).then(n=>{const a=h(),u=Object(o.filter)(Object(p.c)(a,e,t),{parent:s}).map(e=>i()({},e,{parent:n.ID}));m(f(e,t,s)),m(b(e,t,u.concat([n]))),Object(l.n)(a,e,t,s).forEach(i=>{const a=Object(o.filter)(i.terms[t],e=>e.ID!==s);a.push(n),m(Object(r.e)(e,i.ID,{terms:{[t]:a}}))});const g=Object(d.a)(a,e);return"category"===t&&Object(o.get)(g,["default_category"])===s&&n.ID!==s&&m(Object(c.c)(e,{default_category:n.ID})),n})}function h(e,t,s,n){return(c,u)=>a.a.site(e).taxonomy(t).term(n).delete().then(()=>{const n=u(),a=Object(p.b)(n,e,t,s),m=Object(o.get)(a,"post_count",0),h=Object(o.filter)(Object(p.c)(n,e,t),e=>e.parent===s).map(e=>i()({},e,{parent:a.parent}));if(h.length&&c(b(e,t,h)),Object(l.n)(n,e,t,s).forEach(n=>{const i=Object(o.filter)(n.terms[t],e=>e.ID!==s);c(Object(r.e)(e,n.ID,{terms:{[t]:i}}))}),"category"===t&&m>0){const s=Object(d.a)(n,e),a=Object(p.b)(n,e,t,Object(o.get)(s,["default_category"]));a&&c(g(e,t,i()({},a,{post_count:a.post_count+m})))}c(f(e,t,s))})}function g(e,t,s){return b(e,t,[s])}function b(e,t,s,n,i){return{type:"TERMS_RECEIVE",siteId:e,taxonomy:t,terms:s,query:n,found:i}}function f(e,t,s){return{type:"TERM_REMOVE",siteId:e,taxonomy:t,termId:s}}function y(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n=>(n({type:"TERMS_REQUEST",siteId:e,taxonomy:t,query:s}),a.a.site(e).taxonomy(t).termsList(s).then(i=>{n({type:"TERMS_REQUEST_SUCCESS",siteId:e,taxonomy:t,query:s}),n(b(e,t,i.terms,s,i.found))}).catch(i=>{n({type:"TERMS_REQUEST_FAILURE",siteId:e,taxonomy:t,query:s,error:i})}))}},"./client/state/terms/selectors.js":function(e,t,s){"use strict";s.d(t,"f",function(){return c}),s.d(t,"g",function(){return l}),s.d(t,"d",function(){return d}),s.d(t,"e",function(){return p}),s.d(t,"c",function(){return u}),s.d(t,"b",function(){return m}),s.d(t,"a",function(){return h});var n=s("./node_modules/@babel/runtime/helpers/objectSpread.js"),i=s.n(n),o=s("./node_modules/lodash/lodash.js"),a=s("./client/lib/create-selector/index.js"),r=s("./client/state/terms/utils.js");function c(e,t,s,n){const i=Object(r.a)(n);return!!Object(o.get)(e.terms.queryRequests,[t,s,i])}function l(e,t,s,n){const a=p(e,t,s,n);return null!==a&&Object(o.range)(1,a+1).some(o=>{const a=i()({},n,{page:o});return c(e,t,s,a)})}Object(a.a)((e,t,s,n)=>{const i=Object(o.get)(e.terms.queries,[t,s]);return i?i.getItems(n):null},(e,t,s)=>Object(o.get)(e.terms.queries,[t,s]),(e,t,s,n)=>{return[t,s,Object(r.a)(n)].join()});const d=Object(a.a)((e,t,s,n)=>{const i=Object(o.get)(e.terms.queries,[t,s]);return i?i.getItemsIgnoringPage(n):null},(e,t,s)=>Object(o.get)(e.terms.queries,[t,s]),(e,t,s,n)=>{return[t,s,Object(r.b)(n)].join()});function p(e,t,s,n){const i=Object(o.get)(e.terms.queries,[t,s]);if(!i)return null;const a=i.getNumberOfPages(n);return null===a?null:Math.max(a,1)}function u(e,t,s){const n=Object(o.get)(e.terms.queries,[t,s]);return n?n.getItems():null}function m(e,t,s,n){const i=Object(o.get)(e.terms.queries,[t,s]);if(!i)return null;const a=i.getItem(n);return a||null}function h(e,t,s,n){const i=Object(o.get)(e.terms.queries,[t,s]);return i?i.getFound(n):null}},"./client/state/ui/editor/image-editor/actions.js":function(e,t,s){"use strict";function n(){return{type:"IMAGE_EDITOR_STATE_RESET",additionalData:arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}}}function i(){return{type:"IMAGE_EDITOR_STATE_RESET_ALL",additionalData:arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}}}function o(){return{type:"IMAGE_EDITOR_ROTATE_COUNTERCLOCKWISE"}}function a(){return{type:"IMAGE_EDITOR_FLIP"}}function r(e){return{type:"IMAGE_EDITOR_SET_ASPECT_RATIO",ratio:e}}function c(e){return{type:"IMAGE_EDITOR_SET_DEFAULT_ASPECT_RATIO",ratio:e}}function l(e,t,s,n){return{type:"IMAGE_EDITOR_SET_FILE_INFO",src:e,fileName:t,mimeType:s,title:n}}function d(e,t,s,n){return{type:"IMAGE_EDITOR_SET_CROP_BOUNDS",topBound:e,leftBound:t,bottomBound:s,rightBound:n}}function p(e,t,s,n){return{type:"IMAGE_EDITOR_COMPUTED_CROP",topRatio:e,leftRatio:t,widthRatio:s,heightRatio:n}}function u(e,t,s,n){return{type:"IMAGE_EDITOR_CROP",topRatio:e,leftRatio:t,widthRatio:s,heightRatio:n}}function m(e,t){return{type:"IMAGE_EDITOR_IMAGE_HAS_LOADED",width:e,height:t}}s.d(t,"f",function(){return n}),s.d(t,"e",function(){return i}),s.d(t,"d",function(){return o}),s.d(t,"c",function(){return a}),s.d(t,"g",function(){return r}),s.d(t,"i",function(){return c}),s.d(t,"j",function(){return l}),s.d(t,"h",function(){return d}),s.d(t,"a",function(){return p}),s.d(t,"b",function(){return u}),s.d(t,"k",function(){return m})},"./client/state/ui/editor/image-editor/selectors.js":function(e,t,s){"use strict";function n(e){return e.ui.editor.imageEditor.transform}function i(e){return e.ui.editor.imageEditor.fileInfo}function o(e){return e.ui.editor.imageEditor.hasChanges}function a(e){return!e.ui.editor.imageEditor.imageIsLoading}function r(e){return e.ui.editor.imageEditor.cropBounds}function c(e){return e.ui.editor.imageEditor.crop}function l(e){return e.ui.editor.imageEditor.aspectRatio}s.d(t,"e",function(){return n}),s.d(t,"d",function(){return i}),s.d(t,"f",function(){return o}),s.d(t,"g",function(){return a}),s.d(t,"c",function(){return r}),s.d(t,"b",function(){return c}),s.d(t,"a",function(){return l})},"./client/state/ui/editor/save-blockers/actions.js":function(e,t,s){"use strict";s.d(t,"a",function(){return n}),s.d(t,"b",function(){return i});const n=e=>({type:"EDITOR_SAVE_BLOCK",key:e}),i=e=>({type:"EDITOR_SAVE_UNBLOCK",key:e})},"./client/state/users/suggestions/selectors.js":function(e,t,s){"use strict";s.d(t,"b",function(){return i}),s.d(t,"a",function(){return o});var n=s("./node_modules/lodash/lodash.js");function i(e,t){return Object(n.get)(e.users.suggestions.requesting,[t],!1)}function o(e,t){return Object(n.get)(e.users.suggestions.items,[t],[])}}}]);