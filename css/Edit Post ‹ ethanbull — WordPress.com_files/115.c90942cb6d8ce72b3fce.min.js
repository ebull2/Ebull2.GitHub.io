(window.webpackJsonp=window.webpackJsonp||[]).push([[115],{"./client/components/infinite-list/index.jsx":function(t,e,s){"use strict";var i=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),o=s.n(i),r=s("./node_modules/debug/src/browser.js"),n=s.n(r),l=s("./node_modules/lodash/lodash.js"),h=s("./node_modules/page/page.js"),d=s.n(h),a=s("./node_modules/prop-types/index.js"),c=s.n(a),p=s("./node_modules/react/index.js"),m=s.n(p),g=s("./node_modules/react-dom/index.js"),u=s.n(g),x=s("./client/lib/detect-history-navigation/index.js");const H=n()("calypso:infinite-list:scroll-store"),f={leading:!1},R=new Map,I=new Map;var w={getPositions(t){const e=R.get(t);return H("getting positions:",t,e),e},storePositions:Object(l.throttle)(function(t,e){H("storing positions:",t,e),R.set(t,e)},1e3,f),getScrollTop(t){const e=I.get(t);return H("getting scrollTop:",t,e),e},storeScrollTop:Object(l.throttle)(function(t,e){H("storing scrollTop:",t,e),I.set(t,e)},1e3,f)};const b=n()("calypso:infinite-list:helper");var P=class{constructor(t){this.boundsForRef=t,this.itemHeights={},this.contextHeight=null,this.topHideLevelHard=null,this.topHideLevelSoft=null,this.bottomHideLevelHard=null,this.bottomHideLevelSoft=null,this.bottomHideLevelUltraSoft=null,this.props=null,this.scrollPosition=null,this.containerTop=null,this.topPlaceholderHeight=null,this.bottomPlaceholderHeight=null,this.containerBottom=null,this.stateUpdated=null,this.firstRenderedIndex=null,this.lastRenderedIndex=null}storedItemHeight(t){let e=this.props.guessedItemHeight;return t in this.itemHeights&&(e=this.itemHeights[t]),e}forEachInRow(t,e,s){if("function"!=typeof e)return;s&&(e=e.bind(s));const i=t-t%this.props.itemsPerRow,o=Math.min(i+this.props.itemsPerRow,this.props.items.length)-1;for(let t=i;t<=o;t++)e(this.props.items[t],t)}storeRowItemHeights(t,e){this.forEachInRow(e,function(e){const s=this.props.getItemRef(e),i=this.boundsForRef(s);let o;o=i?"bottom"===t?this.containerBottom-this.bottomPlaceholderHeight-i.top:i.bottom-(this.containerTop+this.topPlaceholderHeight):this.props.guessedItemHeight,this.itemHeights[s]=o},this)}deleteRowItemHeights(t){this.forEachInRow(t,t=>{const e=this.props.getItemRef(t);delete this.itemHeights[e]},this)}getRowHeight(t){let e=0;return this.forEachInRow(t,t=>{const s=this.props.getItemRef(t),i=this.storedItemHeight(s);e=Math.max(e,i)},this),e}updateContextHeight(t){this.contextHeight!==t&&(this.contextHeight=t,this.topHideLevelHard=Math.min(-1*t,-5*this.props.guessedItemHeight),this.topHideLevelSoft=Math.min(-2*t,-10*this.props.guessedItemHeight),this.bottomHideLevelHard=t+Math.max(t,5*this.props.guessedItemHeight),this.bottomHideLevelSoft=t+Math.max(2*t,10*this.props.guessedItemHeight),this.bottomHideLevelUltraSoft=t+Math.max(3*t,15*this.props.guessedItemHeight))}initialLastRenderedIndex(){return Math.min(this.props.items.length-1,Math.floor(this.bottomHideLevelSoft/this.props.guessedItemHeight)-1)}updatePlaceholderDimensions(){const t=this.boundsForRef("topPlaceholder"),e=this.boundsForRef("bottomPlaceholder");this.topPlaceholderHeight=t.height,this.containerTop=t.top,this.bottomPlaceholderHeight=e.height,this.containerBottom=e.bottom}scrollChecks(t){this.reset(t),this.adjustLastRenderedIndex(),this.shouldHideItemsAbove()?this.hideItemsAbove():this.shouldShowItemsAbove()&&this.showItemsAbove(),this.shouldHideItemsBelow()?this.hideItemsBelow():this.shouldShowItemsBelow()&&this.showItemsBelow(),this.shouldLoadNextPage()&&this.loadNextPage()}reset(t){this.stateUpdated=!1,this.firstRenderedIndex=t.firstRenderedIndex,this.lastRenderedIndex=t.lastRenderedIndex}adjustLastRenderedIndex(){const t=this.initialLastRenderedIndex(),e=this.lastRenderedIndex||0,s=this.firstRenderedIndex||0,i=this.props.items.length;let o=e;0===i&&(o=-1),e>=i&&(o=Math.min(s+t,i-1)),-1===o&&i>0&&0===s&&(o=t),o!==this.lastRenderedIndex&&(this.stateUpdated=!0,this.lastRenderedIndex=o)}shouldHideItemsAbove(){return this.containerTop+this.topPlaceholderHeight<this.topHideLevelSoft}hideItemsAbove(){let t,e;for(;this.firstRenderedIndex<this.props.items.length;){if(this.storeRowItemHeights("top",this.firstRenderedIndex),t=this.getRowHeight(this.firstRenderedIndex),(e=this.containerTop+this.topPlaceholderHeight+t)>this.topHideLevelHard){this.deleteRowItemHeights(this.firstRenderedIndex);break}this.topPlaceholderHeight+=t,this.firstRenderedIndex+=this.props.itemsPerRow,this.stateUpdated=!0,b("hiding top item",t,this.topPlaceholderHeight)}}shouldShowItemsAbove(){return this.containerTop+this.topPlaceholderHeight>this.topHideLevelHard}showItemsAbove(){let t,e;for(;this.firstRenderedIndex>0&&(t=this.getRowHeight(this.firstRenderedIndex-this.props.itemsPerRow),!((e=this.containerTop+this.topPlaceholderHeight-t)<this.topHideLevelSoft));)this.deleteRowItemHeights(this.firstRenderedIndex-this.props.itemsPerRow),this.firstRenderedIndex-=this.props.itemsPerRow,this.firstRenderedIndex=Math.max(0,this.firstRenderedIndex),this.firstRenderedIndex<=0?this.topPlaceholderHeight=0:this.topPlaceholderHeight=Math.max(0,this.topPlaceholderHeight-t),this.stateUpdated=!0,b("showing top item",t,this.topPlaceholderHeight)}shouldHideItemsBelow(){return this.containerBottom-this.bottomPlaceholderHeight>this.bottomHideLevelUltraSoft}hideItemsBelow(){let t,e;for(;this.lastRenderedIndex>=0;){if(this.storeRowItemHeights("bottom",this.lastRenderedIndex),e=this.getRowHeight(this.lastRenderedIndex),(t=this.containerBottom-this.bottomPlaceholderHeight-e)<this.bottomHideLevelHard){this.deleteRowItemHeights(this.lastRenderedIndex);break}this.bottomPlaceholderHeight+=e,this.lastRenderedIndex-=this.props.itemsPerRow,this.stateUpdated=!0,b("hiding bottom item",e,this.bottomPlaceholderHeight)}}shouldShowItemsBelow(){return this.containerBottom-this.bottomPlaceholderHeight<this.bottomHideLevelHard}showItemsBelow(){let t,e,s;for(;this.lastRenderedIndex<this.props.items.length-1&&(t=this.getRowHeight(this.lastRenderedIndex+this.props.itemsPerRow),!((e=(s=this.containerBottom-this.bottomPlaceholderHeight)+t)>this.bottomHideLevelSoft&&s>this.bottomHideLevelHard));)this.deleteRowItemHeights(this.lastRenderedIndex+this.props.itemsPerRow),this.bottomPlaceholderHeight-t<0?(this.containerBottom+=t-this.bottomPlaceholderHeight,this.bottomPlaceholderHeight=0):this.bottomPlaceholderHeight-=t,this.lastRenderedIndex+=this.props.itemsPerRow,this.lastRenderedIndex=Math.min(this.lastRenderedIndex,this.props.items.length-1),this.lastRenderedIndex>=this.props.items.length-1&&(this.bottomPlaceholderHeight=0),this.stateUpdated=!0,b("showing bottom item",t,this.bottomPlaceholderHeight)}shouldLoadNextPage(){return!this.props.fetchingNextPage&&!this.props.lastPage&&0===this.bottomPlaceholderHeight&&this.containerBottom<this.bottomHideLevelHard}loadNextPage(){if(this.queuedFetchNextPage)return;let t=this.triggeredByScroll;b("fetching next page",this.containerBottom,this.bottomPlaceholderHeight),this.scrollPosition>this.contextHeight&&(t=!0),this.queuedFetchNextPage=Promise.resolve().then(()=>{if(this.queuedFetchNextPage=null,this.props.fetchingNextPage||this.props.lastPage)return!1;this.props.fetchNextPage({triggeredByScroll:t})})}},S=s("./client/lib/scroll-to/index.js"),T=s("./client/lib/react-smart-set-state/index.js");s("./client/components/infinite-list/style.scss");s.d(e,"a",function(){return y});const v=n()("calypso:infinite-list");class y extends m.a.Component{constructor(){super(...arguments),o()(this,"lastScrollTop",-1),o()(this,"scrollRAFHandle",!1),o()(this,"scrollHelper",null),o()(this,"isScrolling",!1),o()(this,"_isMounted",!1),o()(this,"smartSetState",T.a),o()(this,"onScroll",()=>{this.isScrolling||this.scrollRAFHandle||this.getCurrentScrollTop()===this.lastScrollTop||(this.scrollRAFHandle=window.requestAnimationFrame(this.scrollChecks))}),o()(this,"scrollChecks",()=>{this._isMounted&&this.getCurrentScrollTop()!==this.lastScrollTop?this.updateScroll({triggeredByScroll:!0}):this.scrollRAFHandle=null}),o()(this,"boundsForRef",t=>t in this.refs?u.a.findDOMNode(this.refs[t]).getBoundingClientRect():null),o()(this,"_resetScroll",t=>{const e=this.state.scrollTop;this._contextLoaded()&&(v("history setting scroll position:",t),this._setContainerY(e),this._scrollContainer.removeEventListener("scroll",this._resetScroll),v("override scroll position from HTML5 history popstate:",e))})}componentWillMount(){const t=d.a.current;let e,s;x.a.loadedViaHistory()&&(e=w.getPositions(t),s=w.getScrollTop(t)),e&&s&&(v("overriding scrollTop:",s),e.scrollTop=s),this.scrollHelper=new P(this.boundsForRef),this.scrollHelper.props=this.props,this._contextLoaded()&&(this._scrollContainer=this.props.context||window,this.scrollHelper.updateContextHeight(this.getCurrentContextHeight())),this.isScrolling=!1,e?v("infinite-list positions loaded from store"):(v("infinite-list positions reset for new list"),e={firstRenderedIndex:0,topPlaceholderHeight:0,lastRenderedIndex:this.scrollHelper.initialLastRenderedIndex(),bottomPlaceholderHeight:0,scrollTop:0}),v("infinite list mounting",e),this.setState(e)}componentDidMount(){this._isMounted=!0,this._contextLoaded()&&this._setContainerY(this.state.scrollTop),x.a.loadedViaHistory()&&this._overrideHistoryScroll(),v("setting scrollTop:",this.state.scrollTop),this.updateScroll({triggeredByScroll:!1}),this._contextLoaded()&&this._scrollContainer.addEventListener("scroll",this.onScroll)}componentWillReceiveProps(t){this.scrollHelper.props=t,this.isScrolling||(this.cancelAnimationFrame(),this.updateScroll({triggeredByScroll:!1})),t.context!==this.props.context&&this._contextLoaded()&&this._scrollContainer.removeEventListener("scroll",this._resetScroll)}componentDidUpdate(t){this._contextLoaded()&&(this.props.context!==t.context&&(this._scrollContainer&&this._scrollContainer.removeEventListener("scroll",this.onScroll),this._scrollContainer=this.props.context||window,this._scrollContainer.addEventListener("scroll",this.onScroll),x.a.loadedViaHistory()&&this._overrideHistoryScroll()),this.isScrolling||(this.cancelAnimationFrame(),this.updateScroll({triggeredByScroll:!1})))}reset(){this.cancelAnimationFrame(),this.scrollHelper=new P(this.boundsForRef),this.scrollHelper.props=this.props,this._contextLoaded()&&(this._scrollContainer=this.props.context||window,this.scrollHelper.updateContextHeight(this.getCurrentContextHeight())),this.isScrolling=!1,this.setState({firstRenderedIndex:0,topPlaceholderHeight:0,lastRenderedIndex:this.scrollHelper.initialLastRenderedIndex(),bottomPlaceholderHeight:0,scrollTop:0})}componentWillUnmount(){this._scrollContainer.removeEventListener("scroll",this.onScroll),this._scrollContainer.removeEventListener("scroll",this._resetScroll),this.cancelAnimationFrame(),this._isMounted=!1}cancelAnimationFrame(){this.scrollRAFHandle&&(window.cancelAnimationFrame(this.scrollRAFHandle),this.scrollRAFHandle=null),this.lastScrollTop=-1}getCurrentContextHeight(){return(this.props.context||window.document.documentElement).clientHeight}getCurrentScrollTop(){return this.props.context?(v("getting scrollTop from context"),this.props.context.scrollTop):window.pageYOffset}scrollToTop(){this.cancelAnimationFrame(),this.isScrolling=!0,this.props.context&&this.props.context!==window?(this.props.context.scrollTop=0,this.updateScroll({triggeredByScroll:!1}),this.isScrolling=!1):Object(S.a)({x:0,y:0,duration:250,onComplete:()=>{this._isMounted&&this.updateScroll({triggeredByScroll:!1}),this.isScrolling=!1}})}updateScroll(t){const e=d.a.current;let s;this._contextLoaded()&&(this.lastScrollTop=this.getCurrentScrollTop(),w.storeScrollTop(e,this.lastScrollTop),this.scrollHelper.updateContextHeight(this.getCurrentContextHeight()),this.scrollHelper.scrollPosition=this.lastScrollTop,this.scrollHelper.triggeredByScroll=t.triggeredByScroll,this.scrollHelper.updatePlaceholderDimensions(),this.scrollHelper.scrollChecks(this.state),this.scrollHelper.stateUpdated&&(s={firstRenderedIndex:this.scrollHelper.firstRenderedIndex,topPlaceholderHeight:this.scrollHelper.topPlaceholderHeight,lastRenderedIndex:this.scrollHelper.lastRenderedIndex,bottomPlaceholderHeight:this.scrollHelper.bottomPlaceholderHeight,scrollTop:this.lastScrollTop},this.lastScrollTop=-1,v("new scroll positions",s,this.state),this.smartSetState(s),w.storePositions(e,s)),this.scrollRAFHandle=window.requestAnimationFrame(this.scrollChecks))}getVisibleItemIndexes(t){const e=u.a.findDOMNode(this),s=[],i=this.state.firstRenderedIndex,o=this.state.lastRenderedIndex,r=t&&t.offsetTop?t.offsetTop:0;let n,l,h,d,a=t&&t.offsetBottom?t.offsetBottom:0;if(a=a||0,o>-1)for(h=e.children,d=1;d<h.length-1;d++)l=e.children[d].getBoundingClientRect(),n=window.innerHeight||document.documentElement.clientHeight,(l.top<0&&Math.abs(l.top)<l.height-r||l.top>0&&l.top<n-a)&&s.push({index:i+d-1,bounds:l});return s}render(){const t=Object(l.omit)(this.props,Object.keys(this.constructor.propTypes));let e,s=this.state.lastRenderedIndex,i=[];for((-1===s||s>this.props.items.length-1)&&(v("resetting lastRenderedIndex, currently at %s, %d items",s,this.props.items.length),s=Math.min(this.state.firstRenderedIndex+this.scrollHelper.initialLastRenderedIndex(),this.props.items.length-1),v("reset lastRenderedIndex to %s",s)),v("rendering %d to %d",this.state.firstRenderedIndex,s),e=this.state.firstRenderedIndex;e<=s;e++)i.push(this.props.renderItem(this.props.items[e],e));return this.props.fetchingNextPage&&(i=i.concat(this.props.renderLoadingPlaceholders())),m.a.createElement("div",t,m.a.createElement("div",{ref:"topPlaceholder",className:"infinite-list__spacer",style:{height:this.state.topPlaceholderHeight}}),i,this.props.renderTrailingItems(),m.a.createElement("div",{ref:"bottomPlaceholder",className:"infinite-list__spacer",style:{height:this.state.bottomPlaceholderHeight}}))}_setContainerY(t){this.props.context&&this.props.context!==window?this.props.context.scrollTop=t:window.scrollTo(0,t)}_overrideHistoryScroll(){this._contextLoaded()&&this._scrollContainer.addEventListener("scroll",this._resetScroll)}_contextLoaded(){return this.props.context||!1===this.props.context||!("context"in this.props)}}o()(y,"propTypes",{items:c.a.array.isRequired,fetchingNextPage:c.a.bool.isRequired,lastPage:c.a.bool.isRequired,guessedItemHeight:c.a.number.isRequired,itemsPerRow:c.a.number,fetchNextPage:c.a.func.isRequired,getItemRef:c.a.func.isRequired,renderItem:c.a.func.isRequired,renderLoadingPlaceholders:c.a.func.isRequired,renderTrailingItems:c.a.func,context:c.a.oneOfType([c.a.object,c.a.bool])}),o()(y,"defaultProps",{itemsPerRow:1,renderTrailingItems:l.noop})},"./client/components/infinite-list/style.scss":function(t,e,s){},"./client/lib/scroll-to/index.js":function(t,e,s){"use strict";s.d(e,"a",function(){return d});var i=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),o=s.n(i);const r=new Map;function n(t){return t=t&&void 0!==t.scrollTop?t:window,function(e,s){t===window?t.scrollTo(e,s):(t.scrollTop=s,t.scrollLeft=e)}}class l{constructor(t){o()(this,"finish",()=>{this.updater(this.end.x,this.end.y),this.onComplete&&this.onComplete(),r.delete(this.container)}),o()(this,"step",t=>{if(this.nextFrame=null,!this.startTime)return this.startTime=t,void this.animate();if(t-this.startTime>=this.duration)return void this.finish();const e=(t-this.startTime)/this.duration,s=this.easing(e),i=Math.round(this.start.x+(this.end.x-this.start.x)*s),o=Math.round(this.start.y+(this.end.y-this.start.y)*s);i===this.x&&o===this.y||(this.x=i,this.y=o,this.updater(i,o)),this.animate()}),this.x=t.x,this.y=t.y,this.startTime=null,this.duration=t.duration,this.start=t.start,this.end=t.end,this.onStart=t.onStart,this.onComplete=t.onComplete,this.updater=t.updater,this.easing=t.easing,this.container=t.container}animate(){this.nextFrame=requestAnimationFrame(this.step)}cancel(){this.nextFrame&&(cancelAnimationFrame(this.nextFrame),this.nextFrame=null),this.finishTimeout&&(clearTimeout(this.finishTimeout),this.finishTimeout=null)}jumpTo(t,e){this.cancel(),this.end={x:t,y:e},this.updater(t,e),this.finishTimeout=setTimeout(this.finish,this.duration)}}function h(t){const e=t-1;return Math.sqrt(1-e*e)}function d(t){const e=t.container||window;if(r.has(e)){return void r.get(e).jumpTo(t.x,t.y)}const s=function(t){return t&&void 0!==t.scrollTop?{x:t.scrollLeft,y:t.scrollTop}:{x:window.pageXOffset||document.documentElement.scrollLeft,y:window.pageYOffset||document.documentElement.scrollTop}}(e),i=new l({start:s,end:{x:t.x,y:t.y},container:e,easing:t.easing||h,duration:t.duration||500,updater:n(e),x:s.x,y:s.y,onStart:t.onStart,onComplete:t.onComplete});return r.set(e,i),i.animate(),t.onStart&&t.onStart(),i}},"./client/state/selectors/get-blocked-sites.js":function(t,e,s){"use strict";var i=s("./node_modules/lodash/lodash.js"),o=s("./client/lib/create-selector/index.js");e.a=Object(o.a)(t=>Object(i.map)(Object.keys(Object(i.pickBy)(t.reader.siteBlocks.items)),Number),t=>[t.reader.siteBlocks.items])}}]);