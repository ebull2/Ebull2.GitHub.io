(window.webpackJsonp=window.webpackJsonp||[]).push([[156],{"./client/components/data/query-rewind-state/index.jsx":function(e,t,a){"use strict";var s=a("./node_modules/react/index.js"),i=a("./node_modules/react-redux/es/index.js");const n={requestState:a("./client/state/rewind/actions.js").a};t.a=Object(i.b)(null,n)(class extends s.Component{componentDidMount(){this.request()}componentDidUpdate(e){e.siteId!==this.props.siteId&&this.request()}request(){const e=this.props,t=e.requestState,a=e.siteId;a&&t(a)}render(){return null}})},"./client/components/sidebar-navigation/index.jsx":function(e,t,a){"use strict";var s=a("./node_modules/prop-types/index.js"),i=a.n(s),n=a("./node_modules/react/index.js"),r=a.n(n),c=a("./node_modules/react-redux/es/index.js"),o=a("./client/components/gridicon/index.jsx"),l=a("./client/state/document-head/selectors.js"),d=a("./client/state/ui/layout-focus/actions.js"),u=a("./client/components/translatable/proptype.js");class p extends r.a.Component{constructor(e){super(e),this.toggleSidebar=this.toggleSidebar.bind(this)}toggleSidebar(e){e.preventDefault(),this.props.setLayoutFocus("sidebar")}render(){return r.a.createElement("header",{className:"current-section"},r.a.createElement("a",{onClick:this.toggleSidebar,className:this.props.linkClassName},r.a.createElement(o.a,{icon:"chevron-left"}),this.props.children,r.a.createElement("div",null,r.a.createElement("p",{className:"current-section__"+this.props.sectionName+"-title"},this.props.sectionTitle),r.a.createElement("h1",{className:"current-section__section-title"},this.props.title))))}}p.propTypes={title:u.a,linkClassName:i.a.string,sectionTitle:u.a,sectionName:i.a.string.isRequired,setLayoutFocus:i.a.func.isRequired},t.a=Object(c.b)(e=>({title:Object(l.c)(e)}),{setLayoutFocus:d.b})(p)},"./client/lib/analytics/page-view-tracker/index.jsx":function(e,t,a){"use strict";var s=a("./node_modules/@babel/runtime/helpers/defineProperty.js"),i=a.n(s),n=a("./node_modules/debug/src/browser.js"),r=a.n(n),c=a("./node_modules/prop-types/index.js"),o=a.n(c),l=a("./node_modules/react/index.js"),d=a.n(l),u=a("./node_modules/lodash/lodash.js"),p=a("./node_modules/react-redux/es/index.js"),m=a("./client/lib/route/index.js"),h=a("./client/state/analytics/actions.js"),g=a("./client/state/utils.js"),y=a("./client/state/ui/selectors.js"),b=a("./client/state/sites/selectors.js");const v=r()("calypso:analytics:PageViewTracker");class f extends d.a.Component{constructor(){super(...arguments),i()(this,"state",{timer:null}),i()(this,"queuePageView",()=>{const e=this.props,t=e.delay,a=void 0===t?0:t,s=e.path,i=e.recorder,n=void 0===i?u.noop:i,r=e.hasSelectedSiteLoaded,c=e.title,o=e.properties;if(v('Queuing Page View: "'.concat(c,'" at "').concat(s,'" with ').concat(a,"ms delay")),r&&!this.state.timer)return a?void this.setState({timer:setTimeout(()=>n(s,c),a)}):n(s,c,"default",o)})}componentDidMount(){v("Component has mounted."),this.queuePageView()}componentWillUnmount(){v("Component has unmounted."),clearTimeout(this.state.timer)}componentDidUpdate(e){e.path===this.props.path&&e.selectedSiteId===this.props.selectedSiteId||this.queuePageView()}render(){return null}}i()(f,"displayName","PageViewTracker"),i()(f,"propTypes",{delay:o.a.number,path:o.a.string.isRequired,recorder:o.a.func,hasSelectedSiteLoaded:o.a.bool,selectedSiteId:o.a.number,title:o.a.string.isRequired,properties:o.a.object});const _={recorder:Object(g.f)(h.h,[h.c])};t.a=Object(p.b)(e=>{const t=Object(y.e)(e),a=Object(b.v)(e,t),s="undefined"==typeof window?"":Object(m.d)(Object(u.get)(window,"location.pathname",""));return{hasSelectedSiteLoaded:!s||Object(u.isNumber)(s)&&s===t||s===a,selectedSiteId:t}},_)(f)},"./client/my-sites/activity/activity-log-banner/intro-banner.scss":function(e,t,a){},"./client/my-sites/activity/activity-log-banner/style.scss":function(e,t,a){},"./client/my-sites/activity/activity-log-banner/success-banner.scss":function(e,t,a){},"./client/my-sites/activity/activity-log-banner/upgrade-banner.scss":function(e,t,a){},"./client/my-sites/activity/activity-log-example/style.scss":function(e,t,a){},"./client/my-sites/activity/activity-log-switch/style.scss":function(e,t,a){},"./client/my-sites/activity/activity-log-tasklist/style.scss":function(e,t,a){},"./client/my-sites/activity/activity-log/rewind-alerts.scss":function(e,t,a){},"./client/my-sites/activity/activity-log/style.scss":function(e,t,a){},"./client/my-sites/activity/activity-log/threat-alert.scss":function(e,t,a){},"./client/my-sites/activity/controller.jsx":function(e,t,a){"use strict";var s=a("./node_modules/@babel/runtime/helpers/objectSpread.js"),i=a.n(s),n=a("./node_modules/react/index.js"),r=a.n(n),c=a("./packages/i18n-calypso/dist/esm/index.js"),o=a.n(c),l=a("./node_modules/page/page.js"),d=a.n(l),u=a("./node_modules/lodash/lodash.js"),p=a("./client/state/ui/selectors.js"),m=a("./client/state/selectors/get-activity-log-filter.js"),h=a("./node_modules/@babel/runtime/helpers/defineProperty.js"),g=a.n(h),y=a("./node_modules/prop-types/index.js"),b=a.n(y),v=a("./client/config/index.js"),f=a("./node_modules/react-redux/es/index.js"),_=a("./client/components/card/index.jsx"),j=a("./client/components/screen-reader-text/index.js"),k=a("./client/components/gridicon/index.jsx");a("./client/my-sites/activity/activity-log-banner/style.scss");class w extends n.Component{getIcon(){const e=this.props.icon;if(void 0!==e)return e;switch(this.props.status){case"error":case"warning":return"notice-outline";case"info":return"info-outline";case"success":return"star"}return null}render(){const e=this.props,t=e.isDismissable,a=e.onDismissClick,s=e.children,i=e.title,n=e.translate,c=e.status,o=this.getIcon();return r.a.createElement(_.a,{className:"activity-log-banner",highlight:c},o&&r.a.createElement("div",{className:"activity-log-banner__icon"},r.a.createElement(k.a,{icon:o,size:24})),r.a.createElement("div",{className:"activity-log-banner__content"},i&&r.a.createElement("h2",{className:"activity-log-banner__title"},i),s&&r.a.createElement("div",{className:"activity-log-banner__body"},s)),t&&r.a.createElement("button",{className:"activity-log-banner__dismiss",onClick:a,type:"button"},r.a.createElement(j.a,null,n("Dismiss")),r.a.createElement(k.a,{icon:"cross",size:24})))}}g()(w,"propTypes",{icon:b.a.string,isDismissable:b.a.bool.isRequired,onDismissClick:b.a.func,status:b.a.oneOf(["error","info","success","warning"]),title:b.a.node.isRequired,translate:b.a.func.isRequired}),g()(w,"defaultProps",{isDismissable:!1,onDismissClick:u.noop,status:null,title:""});var E=Object(c.localize)(w),O=a("./client/my-sites/activity/activity-log-item/index.jsx"),x=a("./client/components/feature-example/index.jsx"),I=a("./client/components/formatted-header/index.jsx"),S=a("./client/components/banner/index.jsx"),D=a("./client/state/sites/selectors.js"),N=a("./client/lib/plans/constants.js");a("./client/my-sites/activity/activity-log-banner/upgrade-banner.scss");var T=Object(f.b)((e,t)=>{let a=t.siteId;return{isJetpack:Object(D.J)(e,a),siteId:a}})(Object(c.localize)(class extends n.Component{render(){const e=this.props,t=e.translate,a=e.isJetpack;return r.a.createElement("div",{className:"activity-log-banner__upgrade"},a?r.a.createElement(S.a,{callToAction:t("Learn more"),event:"activity_log_upgrade_click_jetpack",feature:N.ib,plan:N.pc,title:t("Unlock more activities now"),description:t("With your free plan, you can monitor the 20 most recent events on your site. Upgrade to a paid plan to unlock powerful features:"),list:[t("Access full activity for the past 30 days"),t("Filter events by type and date range")]}):r.a.createElement(S.a,{callToAction:t("Learn more"),event:"activity_log_upgrade_click_wpcom",feature:N.Z,plan:N.tc,title:t("Unlock more activities now"),description:t("With your free plan, you can monitor the 20 most recent events on your site. Upgrade to a paid plan to unlock powerful features:"),list:[t("Access full activity for the past 30 days"),t("Filter events by type and date range")]}))}})),C=a("./client/state/preferences/selectors.js");a("./client/my-sites/activity/activity-log-example/style.scss");var R=Object(f.b)((e,t)=>{return{siteId:t.siteId,isIntroDismissed:Object(C.b)(e,"dismissible-card-activity-introduction-banner")}})(Object(c.localize)(class extends n.Component{render(){const e=this.props,t=e.isIntroDismissed,a=e.siteId,s=e.siteIsOnFreePlan,i=e.translate,n=[{activityTs:new Date("2018-06-28T18:38:00.000Z").getTime(),activityDescription:[i("My journey through Asia")],activityIcon:"posts",activityStatus:"success",activityTitle:i("Post published"),actorName:"Maria",actorRole:"administrator"},{activityTs:new Date("2018-06-28T15:10:00.000Z").getTime(),activityDescription:[i("Lovely summer photos")],activityIcon:"comment",activityStatus:"warning",activityTitle:i("Comment waiting approval"),actorName:"Filippa"},{activityTs:new Date("2018-06-28T00:20:00.000Z").getTime(),activityDescription:[i("My journey through Asia")],activityIcon:"posts",activityTitle:i("Post draft modified"),actorName:"Vincent",actorRole:"administrator"}].map(e=>Object.assign({activityMeta:{},activityStatus:null,actorRole:"",actorType:"Person"},e));return r.a.createElement("div",{className:"activity-log-example"},t&&r.a.createElement(I.a,{headerText:i("Welcome to Activity"),subHeaderText:i("All of your site activity will appear here.")}),r.a.createElement(x.a,{role:"presentation"},n.map(e=>r.a.createElement(O.a,{key:e.activityTs,activity:e,disableRestore:!0,disableBackup:!0,hideRestore:!0,siteId:a}))),s&&!t&&r.a.createElement(T,{siteId:a}))}})),q=a("./node_modules/classnames/index.js"),P=a.n(q),A=a("./client/lib/site/timezone.js"),U=a("./client/my-sites/activity/activity-log-item/activity-description.jsx"),Y=a("./client/my-sites/activity/activity-log-item/activity-icon.jsx"),M=a("./client/components/foldable-card/index.jsx"),B=a("./client/state/selectors/get-site-gmt-offset.js"),F=a("./client/state/selectors/get-site-timezone-value.js"),W=a("./client/components/button/index.jsx"),L=a("./client/state/activity-log/utils.js"),V=a("./client/lib/url/index.js"),z=a("./client/my-sites/activity/activity-log-item/activity-actor.jsx"),H=a("./client/my-sites/activity/activity-log-item/activity-media.jsx"),J=a("./client/lib/analytics/index.js"),G=a("./client/lib/viewport/react.js"),Q=a("./client/components/localized-moment/index.js");const Z=10;var K=Object(u.flowRight)(Object(f.b)((e,t)=>{let a=t.siteId;return{gmtOffset:Object(B.a)(e,a),timezone:Object(F.a)(e,a),siteSlug:Object(D.v)(e,a),filter:Object(m.b)(e,a)}}),G.b,Q.b,c.localize)(class extends n.Component{constructor(){super(...arguments),g()(this,"trackClick",e=>{const t=this.props.activity,a=t.activityGroup;J.default.tracks.recordEvent("calypso_activitylog_item_click",{activity:t.activityName,section:a,intent:e,is_aggregate:!0,stream_count:t.streamCount})}),g()(this,"trackAggregateExpandToggle",()=>{this.trackClick("toggle")}),g()(this,"trackAggregateViewAll",()=>{this.trackClick("view_all")})}getViewAllUrl(){const e=this.props,t=e.activity,a=t.firstPublishedDate,s=t.lastPublishedDate,i=e.filter,n=e.timezone,r=Object.assign({},Object(u.omit)(i,["dateRange","on"]),{before:Object(A.a)(a,{timezone:n}).add(1,"second").format(),after:Object(A.a)(s,{timezone:n}).subtract(1,"second").format(),aggregate:!1,backButton:!0}),c=Object(L.b)(r);return Object(V.a)(c,window.location.pathname+window.location.hash)}renderHeader(){const e=this.props,t=e.activity,a=e.isBreakpointActive,s=t.actorAvatarUrl,i=t.actorName,n=t.actorRole,c=t.actorType,o=t.multipleActors,l=t.activityMedia;let d;return d=o?r.a.createElement(z.a,{actorType:"Multiple"}):r.a.createElement(z.a,{actorAvatarUrl:s,actorName:i,actorRole:n,actorType:c}),r.a.createElement("div",{className:"activity-log-item__card-header"},d,l&&a&&r.a.createElement(H.a,{className:P()({"activity-log-item__activity-media":!0,"is-desktop":!0,"has-gridicon":!l.available}),icon:!l.available&&l.gridicon,name:l.available&&l.name,thumbnail:l.available&&l.thumbnail_url,fullImage:!1}),r.a.createElement("div",{className:"activity-log-item__description"},r.a.createElement("div",{className:"activity-log-item__description-content"},r.a.createElement(U.a,{activity:t}))),l&&!a&&r.a.createElement(H.a,{className:"activity-log-item__activity-media is-mobile",icon:!1,name:l.available&&l.name,thumbnail:!1,fullImage:l.available&&l.medium_url}))}render(){const e=this.props,t=e.activity,a=e.disableBackup,s=e.disableRestore,i=e.gmtOffset,c=e.moment,o=e.rewindState,l=e.siteId,d=e.timezone,u=e.translate,p=t.activityIcon,m=t.activityStatus,h=t.activityTs,g=t.streamCount,y=Object(A.a)(c(h),{timezone:d,gmtOffset:i}),b=P()("activity-log-item","is-aggregated");return r.a.createElement("div",{className:b},r.a.createElement("div",{className:"activity-log-item__type"},r.a.createElement("div",{className:"activity-log-item__time",title:y.format("LTS")},y.format("LT")),r.a.createElement(Y.a,{activityIcon:p,activityStatus:m})),r.a.createElement(M.a,{className:"activity-log-item__card",header:this.renderHeader(),onClick:this.trackAggregateExpandToggle},t.streams.map(e=>r.a.createElement(n.Fragment,{key:e.activityId},r.a.createElement(O.a,{key:e.activityId,activity:e,disableRestore:s,disableBackup:a,hideRestore:"active"!==o,siteId:l}))),g>Z&&r.a.createElement("div",{className:"activity-log-item__footer"},r.a.createElement("p",null,u("Showing %(number)d of %(total)d activities",{args:{number:Z,total:g}})),r.a.createElement(W.a,{href:this.getViewAllUrl(),compact:!0,borderless:!0,onClick:this.trackAggregateViewAll},u("View All")))))}}),X=a("./client/state/selectors/get-rewind-state.js");a("./client/my-sites/activity/activity-log-switch/style.scss");class $ extends n.Component{getMainButton(){const e=this.props,t=e.siteId,a=e.siteSlug,s=e.translate,i=e.canAutoconfigure;switch(this.props.failureReason){case"vp_can_transfer":return r.a.createElement(W.a,{primary:!0,href:"/start/rewind-switch/?siteId=".concat(t,"&siteSlug=").concat(a)},s("Switch now"));case"missing_plan":return r.a.createElement(W.a,{primary:!0,href:"/plans/".concat(a)},s("Upgrade now"));case"awaitingCredentials":default:return r.a.createElement(W.a,{primary:!0,href:i?"/start/rewind-auto-config/?blogid=".concat(t,"&siteSlug=").concat(a):"/start/rewind-setup/?siteId=".concat(t,"&siteSlug=").concat(a)},s("Continue setup"))}}render(){if("vp_active_on_site"===this.props.failureReason)return!1;if("uninitialized"===this.props.rewindState)return r.a.createElement(_.a,{className:"activity-log-switch activity-log-switch__placeholder"},r.a.createElement("div",{className:"activity-log-switch__header"},r.a.createElement("div",{className:"activity-log-switch__header-header"})),r.a.createElement("div",{className:"activity-log-switch__img-placeholder"}),r.a.createElement("p",{className:"activity-log-switch__header-text"}));const e=this.props,t=e.translate,a=e.redirect,s=e.siteUrl;return r.a.createElement(_.a,{className:"activity-log-switch"},r.a.createElement("div",{className:"activity-log-switch__header"},r.a.createElement("h2",{className:"activity-log-switch__header-header"},t("Welcome to Jetpack's new backups and security")),r.a.createElement("img",{src:"/calypso/images/illustrations/security.svg",alt:""}),r.a.createElement("p",{className:"activity-log-switch__header-text"},t("Backing up and securing your site should be a breeze. Our new seamless system makes it possible to see all your site's activity from one convenient dashboard.")),this.getMainButton(),r.a.createElement("div",null,r.a.createElement("a",{className:"activity-log-switch__no-thanks",href:"".concat(s).concat(a)},t("No thanks")))),r.a.createElement("h3",{className:"activity-log-switch__features-header"},t("What else can it do?")),r.a.createElement(_.a,{className:"activity-log-switch__feature"},r.a.createElement("h4",{className:"activity-log-switch__feature-heading"},t("Rewind to any event")),r.a.createElement("div",{className:"activity-log-switch__feature-content"},r.a.createElement("p",null,t("As soon as you switch over, we will start tracking every change made to your site and allow you to rewind to any past event. If you lose a file, get hacked, or just liked your site better before some changes, you can rewind with a click of a button."))),r.a.createElement("img",{className:"activity-log-switch__img is-backup",src:"/calypso/images/illustrations/backup.svg",alt:""})),r.a.createElement(_.a,{className:"activity-log-switch__feature"},r.a.createElement("h4",{className:"activity-log-switch__feature-heading"},t("Stay on top of your site's security")),r.a.createElement("div",{className:"activity-log-switch__feature-content"},r.a.createElement("p",null,t("When something happens to your website you want to know it immediately. And you will—we'll send you instant alerts based on our 24/7 monitoring of advanced threats."))),r.a.createElement("img",{className:"activity-log-switch__img is-security-issue",src:"/calypso/images/illustrations/security-issue.svg",alt:""})),r.a.createElement(_.a,{className:"activity-log-switch__feature"},r.a.createElement("h4",{className:"activity-log-switch__feature-heading"},t("Log all events on your site")),r.a.createElement("div",{className:"activity-log-switch__feature-content"},r.a.createElement("p",null,t("Access a new, streamlined history of events on your site—from published posts to user-role changes. If you ever need to figure out what happened when, now you can get the answer in seconds."))),r.a.createElement("img",{className:"activity-log-switch__img is-stats",src:"/calypso/images/illustrations/stats.svg",alt:""})))}}g()($,"propTypes",{siteId:b.a.number.isRequired,redirect:b.a.string.isRequired,siteSlug:b.a.string.isRequired,rewindState:b.a.string.isRequired,failureReason:b.a.string.isRequired,translate:b.a.func.isRequired});var ee=Object(f.b)((e,t)=>{let a=t.siteId;const s=Object(X.a)(e,a);return{siteSlug:Object(p.f)(e,a),siteUrl:Object(D.y)(e,a),rewindState:s.state,failureReason:s.reason||"",canAutoconfigure:s.canAutoconfigure}})(Object(c.localize)($)),te=a("./client/components/popover/menu-item.jsx"),ae=a("./client/components/split-button/index.jsx");class se extends n.Component{constructor(){super(...arguments),g()(this,"handleEnqueue",()=>this.props.enqueue(this.props.toUpdate)),g()(this,"handleDismiss",()=>this.props.dismiss(this.props.toUpdate)),g()(this,"handleNameClick",()=>this.props.goToPage(this.props.slug,this.props.type))}render(){const e=this.props,t=e.translate,a=e.name,s=e.version,i=e.type,n=e.disable,c=e.linked,o=e.slug,l=e.siteSlug;let d=t("Plugin update available");"theme"===i?d=t("Theme update available"):"core"===i&&(d=t("Core update available"));const u="plugin"===i?"/plugins/".concat(o,"/").concat(l):"/theme/".concat(o,"/").concat(l);return r.a.createElement(_.a,{className:"activity-log-tasklist__task",compact:!0},r.a.createElement(Y.a,{activityIcon:"plugin"===i||"theme"===i?"".concat(i,"s"):"my-sites",activityStatus:"warning"}),r.a.createElement("span",{className:"activity-log-tasklist__update-item"},r.a.createElement("div",{className:"activity-log-tasklist__update-text"},c?r.a.createElement("a",{href:u,onClick:this.handleNameClick},a):r.a.createElement("span",{className:"activity-log-tasklist__unlinked"},a),r.a.createElement("span",{className:"activity-log-tasklist__update-bullet"},"•"),r.a.createElement("span",{className:"activity-log-tasklist__update-version"},s)),r.a.createElement("div",{className:"activity-log-tasklist__update-type"},d)),r.a.createElement("span",{className:"activity-log-tasklist__update-action"},r.a.createElement(ae.a,{compact:!0,label:t("Update"),onClick:this.handleEnqueue,disabled:n},r.a.createElement(te.a,{icon:"trash",onClick:this.handleDismiss},t("Dismiss")))))}}g()(se,"propTypes",{toUpdate:b.a.object.isRequired,disable:b.a.bool,name:b.a.string,slug:b.a.string,version:b.a.string,type:b.a.string,linked:b.a.bool,goToPage:b.a.func,enqueueTheme:b.a.func,dismissTheme:b.a.func,enqueue:b.a.func,dismiss:b.a.func,translate:b.a.func.isRequired});var ie=Object(c.localize)(se),ne=a("./node_modules/@babel/runtime/helpers/extends.js"),re=a.n(ne),ce=a("./client/state/plugins/installed/selectors.js"),oe=a("./client/state/data-getters/index.js");const le=[];var de=a("./client/lib/analytics/track-component-view/index.jsx"),ue=a("./client/state/plugins/installed/actions.js"),pe=a("./client/state/data-layer/http-data.js"),me=a("./client/state/data-layer/wpcom-http/actions.js"),he=a("./client/state/notices/actions.js"),ge=a("./client/state/analytics/actions.js"),ye=a("./client/state/ui/actions.js");a("./client/my-sites/activity/activity-log-tasklist/style.scss");const be=e=>e.some(e=>"inProgress"===Object(u.get)(e,"updateStatus.status")),ve=(e,t)=>!!Object(u.find)(t,{slug:e}),fe=3;class _e extends n.Component{constructor(){var e;super(...arguments),e=this,g()(this,"state",{dismissed:[],queued:[],expandedView:!1}),g()(this,"dismiss",e=>{const t=this.props,a=t.pluginWithUpdate,s=t.themeWithUpdate,i=t.coreWithUpdate,n=t.trackDismiss,r=t.trackDismissAll;let c;"string"==typeof e.slug?(c=[e.slug],n(e)):(c=Object(u.union)(a.map(e=>e.slug),s.map(e=>e.slug),i.map(e=>e.slug)),r()),this.setState({dismissed:Object(u.union)(this.state.dismissed,c)})}),g()(this,"goManagePlugins",()=>this.props.goManagePlugins(this.props.siteSlug)),g()(this,"goToPage",(e,t)=>this.props.goToPage(e,t,this.props.siteSlug)),g()(this,"continueQueue",()=>{const e=Object(u.union)(this.props.coreWithUpdate,this.props.pluginWithUpdate,this.props.themeWithUpdate);0<this.state.queued.length&&!be(e)&&this.updateItem(this.state.queued[0])}),g()(this,"enqueue",function(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";t.from=a,e.setState({queued:Object(u.union)(e.state.queued,[t])},e.continueQueue)}),g()(this,"dequeue",()=>this.setState({queued:this.state.queued.slice(1)},this.continueQueue)),g()(this,"updateAll",()=>{this.props.trackUpdateAll(),this.setState({queued:Object(u.union)(this.state.queued,this.props.coreWithUpdate,this.props.pluginWithUpdate,this.props.themeWithUpdate)},this.continueQueue)}),g()(this,"showAllUpdates",e=>{Object(ge.i)("calypso_activitylog_tasklist_expand_view"),this.setState({expandedView:!0}),e.preventDefault()}),g()(this,"updateItem",e=>{const t=this.props,a=t.showInfoNotice,s=t.siteName,i=t.updateSingle,n=t.translate;(0,t.trackUpdate)(e),i(e),a(n("Updating %(item)s on %(siteName)s.",{args:{item:e.name,siteName:s}}),{id:"alitemupdate-".concat(e.slug),showDismiss:!1})})}componentDidMount(){const e="/activity-log/".concat(this.props.siteSlug);d.a.exit(e,(e,t)=>{if(!this.state.queued.length||window.confirm(this.props.translate("Navigating away will cancel remaining updates")))return t();setTimeout(()=>d.a.replace("/activity-log/".concat(this.props.siteSlug),null,!1,!1),0)})}componentDidUpdate(e){const t=Object(u.union)(this.props.coreWithUpdate,this.props.pluginWithUpdate,this.props.themeWithUpdate);if(Object(u.isEmpty)(t))return;const a=this.props,s=a.showErrorNotice,i=a.showSuccessNotice,n=a.siteName,r=a.translate;Object(u.each)(t,t=>{const a=t.slug,c=t.updateStatus,o=t.type,l=t.name,d=Object(u.find)(e["".concat(o,"WithUpdate")],{slug:a});if(!1===Object(u.get)(d,["updateStatus"],!1))return;if(Object(u.get)(d,["updateStatus","status"],!1)===Object(u.get)(c,"status",!1)||be([t]))return;const p={args:{item:l,siteName:n}};switch(c.status){case"error":s(r("An error occurred while updating %(item)s on %(siteName)s.",p),{id:"alitemupdate-".concat(a),button:r("Try again"),onClick:()=>this.enqueue(t,"_from_error")}),this.dequeue();break;case"completed":i(r("Successfully updated %(item)s on %(siteName)s.",p),{id:"alitemupdate-".concat(a),duration:3e3}),this.dismiss(t),this.dequeue()}})}showAllItemsToUpdate(e){return e.map(e=>r.a.createElement(ie,{key:e.slug,toUpdate:e,name:e.name,slug:e.slug,version:e.version,type:e.type,linked:"core"!==e.type,goToPage:this.goToPage,siteSlug:this.props.siteSlug,enqueue:this.enqueue,dismiss:this.dismiss,disable:ve(e.slug,this.state.queued)}))}showFooterToExpandAll(e){const t=this.props.translate,a=e-fe;return r.a.createElement("div",{className:"activity-log-tasklist__footer"},r.a.createElement("span",null,t("One more update available"," %(updates)s more updates available",{count:a,args:{updates:a}})),r.a.createElement("a",{onClick:this.showAllUpdates,href:"?expandedView"},t("Show All")))}render(){const e=Object(u.union)(this.props.coreWithUpdate,this.props.pluginWithUpdate,this.props.themeWithUpdate).filter(e=>!Object(u.includes)(this.state.dismissed,e.slug));if(Object(u.isEmpty)(e))return null;const t=this.props.translate,a=e.length,s=this.state.queued,i=this.state.expandedView||a<=fe;return r.a.createElement(_.a,{className:"activity-log-tasklist",highlight:"warning"},r.a.createElement(de.a,{eventName:"calypso_activitylog_tasklist_update_impression"}),r.a.createElement("div",{className:"activity-log-tasklist__heading"},1<a?t("You have %(updates)s update available","You have %(updates)s updates available",{count:a,args:{updates:a}}):t("You have one update available"),1<a&&r.a.createElement(ae.a,{compact:!0,primary:!0,label:t("Update all"),onClick:this.updateAll,disabled:0<s.length},r.a.createElement(te.a,{onClick:this.goManagePlugins,className:"activity-log-tasklist__menu-item",icon:"cog"},r.a.createElement("span",null,t("Manage plugins"))),r.a.createElement(te.a,{onClick:this.dismiss,className:"activity-log-tasklist__menu-item",icon:"trash"},r.a.createElement("span",null,t("Dismiss all"))))),i&&this.showAllItemsToUpdate(e),!i&&this.showAllItemsToUpdate(e.slice(0,fe)),!i&&this.showFooterToExpandAll(a))}}g()(_e,"propTypes",{siteId:b.a.number,siteSlug:b.a.string,plugins:b.a.arrayOf(b.a.object),themes:b.a.arrayOf(b.a.object),core:b.a.arrayOf(b.a.object),siteName:b.a.string.isRequired,trackUpdateAll:b.a.func.isRequired,goToPage:b.a.func.isRequired,updateSingle:b.a.func.isRequired,trackUpdate:b.a.func.isRequired,trackDismissAll:b.a.func.isRequired,trackDismiss:b.a.func.isRequired,coreWithUpdate:b.a.arrayOf(b.a.object).isRequired,pluginWithUpdate:b.a.arrayOf(b.a.object).isRequired,goManagePlugins:b.a.func.isRequired,themeWithUpdate:b.a.arrayOf(b.a.object).isRequired,translate:b.a.func.isRequired,showErrorNotice:b.a.func.isRequired,showInfoNotice:b.a.func.isRequired,showSuccessNotice:b.a.func.isRequired});const je=(e,t)=>"pending"===e?{status:"inProgress"}:"failure"===e?{status:"error"}:"success"===e&&(t?{status:"completed"}:{status:"error"}),ke=(e,t)=>{const a=Object(pe.c)("theme-update-".concat(e,"-").concat(t)),s=null===Object(u.get)(a,"data.themes.0.update");return je(a.state,s)},we=(e,t)=>{const a=Object(pe.c)("core-update-".concat(e)),s=t===Object(u.get)(a,"data.version.0");return je(a.state,s)},Ee=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return e.map(e=>i()({},e,{updateStatus:"plugin"===e.type?Object(ce.d)(a,t,e.id):ke(t,e.slug)}))};var Oe=(e=>{class t extends n.Component{constructor(){super(...arguments),g()(this,"state",{plugins:le,siteId:this.props.siteId})}static getDerivedStateFromProps(e,t){return{plugins:e.siteId===t.siteId?Object(u.unionBy)(e.plugins,t.plugins,"slug"):le,siteId:e.siteId}}render(){return r.a.createElement(e,re()({},this.props,{siteId:this.props.siteId,plugins:this.state.plugins,themes:this.props.themes,core:this.props.core}))}}return g()(t,"propTypes",{siteId:b.a.number,plugins:b.a.arrayOf(b.a.object),themes:b.a.arrayOf(b.a.object),core:b.a.arrayOf(b.a.object)}),Object(f.b)((e,t)=>{let a=t.siteId;const s=Object(oe.d)(a);let i=null;return Object(D.M)(e,a)||(i=Object(ce.c)(e,[a])),{plugins:i,themes:Object(u.get)(s,"data.updates.themes",le),core:Object(u.get)(s,"data.updates.core",le)}})(t)})(Object(f.b)((e,t)=>{let a=t.siteId,s=t.plugins,n=t.themes,r=t.core;const c=Object(D.k)(e,a);return{siteId:a,siteSlug:c.slug,siteName:c.name,pluginWithUpdate:Ee(s,a,e),themeWithUpdate:Ee(n,a),coreWithUpdate:Object(u.isEmpty)(r)?[]:[i()({},r[0],{updateStatus:we(a,r[0].version)})]}},(e,t)=>{let a=t.siteId;return{updateSingle:t=>"core"===t.type?(e=>Object(pe.f)("core-update-".concat(e),Object(me.a)({method:"POST",path:"/sites/".concat(e,"/core/update")}),{fromApi:()=>e=>[[e.version,!0]],freshness:-1/0}))(a):"plugin"===t.type?e(Object(ue.d)(a,t)):((e,t)=>Object(pe.f)("theme-update-".concat(e,"-").concat(t),Object(me.a)({method:"POST",path:"/sites/".concat(e,"/themes"),body:{action:"update",themes:t}}),{fromApi:()=>e=>e.themes.map(e=>[e.id,!0]),freshness:-1/0}))(a,t.slug),showErrorNotice:(t,a)=>e(Object(he.b)(t,a)),showInfoNotice:(t,a)=>e(Object(he.c)(t,a)),showSuccessNotice:(t,a)=>e(Object(he.f)(t,a)),trackUpdate:t=>{let a=t.type,s=t.slug,i=t.from;return e(Object(ge.i)("calypso_activitylog_tasklist_update_".concat(a).concat(i),{slug:s}))},trackUpdateAll:()=>e(Object(ge.i)("calypso_activitylog_tasklist_update_all")),trackDismissAll:()=>e(Object(ge.i)("calypso_activitylog_tasklist_dismiss_all")),trackDismiss:t=>{let a=t.type,s=t.slug;return e(Object(ge.i)("calypso_activitylog_tasklist_dismiss_".concat(a),{slug:s}))},goManagePlugins:t=>e(Object(ge.k)(Object(ge.i)("calypso_activitylog_tasklist_manage_plugins"),Object(ye.b)("/plugins/manage/".concat(t)))),goToPage:(t,a,s)=>e("plugin"===a?Object(ge.k)(Object(ge.i)("calypso_activitylog_tasklist_manage_single_plugin"),Object(ye.b)("/plugins/".concat(t,"/").concat(s))):Object(ge.k)(Object(ge.i)("calypso_activitylog_tasklist_manage_single_theme"),Object(ye.b)("/theme/".concat(t,"/").concat(s))))}})(Object(c.localize)(_e))),xe=a("./client/components/data/document-head/index.jsx"),Ie=a("./client/components/empty-content/index.jsx"),Se=a("./client/components/happychat/button.jsx"),De=a("./client/state/activity-log/actions.js");class Ne extends n.PureComponent{constructor(){super(...arguments),g()(this,"handleClickRestart",()=>{const e=this.props,t=e.siteId,a=e.downloadId,s=e.requestedRestoreId,i=e.rewindRestore,n=e.createBackup;return a?n(t,a):s?i(t,s):void 0}),g()(this,"handleDismiss",()=>Object(u.isUndefined)(this.props.downloadId)?this.props.closeDialog("restore"):this.props.closeDialog("backup"))}render(){const e=this.props,t=e.errorCode,a=e.failureReason,s=e.timestamp,i=e.translate,n=e.downloadId,c=e.trackHappyChatBackup,o=e.trackHappyChatRestore,l=Object(u.isUndefined)(n)?{title:i("Problem rewinding your site"),details:i("We came across a problem while trying to rewind your site.")}:{title:i("Problem preparing your file"),details:i("There was a problem preparing your backup for downloading.")};return r.a.createElement(E,{isDismissable:!0,onDismissClick:this.handleDismiss,status:"error",title:l.title},r.a.createElement(de.a,{eventName:"calypso_activitylog_errorbanner_impression",eventProperties:Object(u.isUndefined)(n)?{error_code:t,failure_reason:a,restore_to:s}:{error_code:"backup",failure_reason:"backup failed",download_id:n}}),r.a.createElement("p",null,l.details),r.a.createElement(W.a,{primary:!0,onClick:this.handleClickRestart},i("Try again")),r.a.createElement(Se.a,{className:"activity-log-banner__happychat-button",onClick:Object(u.isUndefined)(n)?o:c},r.a.createElement(k.a,{icon:"chat"}),r.a.createElement("span",null,i("Get help"))))}}g()(Ne,"propTypes",{errorCode:b.a.string.isRequired,failureReason:b.a.string.isRequired,closeDialog:b.a.func.isRequired,siteId:b.a.number.isRequired,timestamp:b.a.string,downloadId:b.a.number,requestedRestoreId:b.a.string,createBackup:b.a.func,rewindRestore:b.a.func,dismissRewindRestoreProgress:b.a.func.isRequired,translate:b.a.func.isRequired}),g()(Ne,"defaultProps",{errorCode:"",failureReason:"",downloadId:void 0,requestedRestoreId:void 0});var Te=Object(f.b)(null,{dismissRewindRestoreProgress:De.c,trackHappyChatBackup:()=>Object(ge.i)("calypso_activitylog_error_banner_backup"),trackHappyChatRestore:()=>Object(ge.i)("calypso_activitylog_error_banner_restore")})(Object(c.localize)(Ne)),Ce=a("./client/components/back-button/index.jsx"),Re=a("./node_modules/react-day-picker/DayPicker.js"),qe=a("./client/components/date-range/index.js");const Pe="YYYY-MM-DD HH:mm:ss";var Ae=Object(u.flowRight)(Object(f.b)(null,e=>({selectDateRange:(t,a,s)=>{if(!a&&!s)return e(Object(ge.k)(Object(ge.i)("calypso_activitylog_filterbar_reset_range"),Object(De.s)(t,{after:a,before:s,on:null,page:1})));if(s){const i=new Date(s),n=new Date(a),r=Date.now(),c=(i-n)/864e5,o=Math.floor((r-n)/864e5);return e(Object(ge.k)(Object(ge.i)("calypso_activitylog_filterbar_select_range",{duration:c,distance:o}),Object(De.s)(t,{after:a,before:s,on:null,page:1})))}const i=new Date(a),n=Date.now(),r=Math.floor((n-i)/864e5);return e(Object(ge.k)(Object(ge.i)("calypso_activitylog_filterbar_select_range",{duration:1,distance:r}),Object(De.s)(t,{on:a,after:null,before:null,page:1})))}})),c.localize,Q.b)(class extends n.Component{constructor(e){super(e),g()(this,"state",{fromDate:null,toDate:null,enteredToDate:null}),g()(this,"handleClose",()=>{const e=this.props,t=e.moment,a=e.siteId,s=e.filter,i=e.onClose,n=e.selectDateRange,r=this.getFromDate(s),c=this.getToDate(s);this.setState({toDate:null,fromDate:null,enteredToDate:null});const o=r&&t(r).format(Pe),l=c&&t(c).endOf("day").format(Pe);if(o&&l&&o!==l)return n(a,o,l),void i();o&&n(a,o,null),i()}),g()(this,"handleDateRangeCommit",(e,t)=>{const a=this.props,s=a.moment,i=a.selectDateRange,n=e?s(e).format(Pe):null,r=t?s(t).endOf("day").format(Pe):null;i(this.props.siteId,n,r)}),g()(this,"isSelectingFirstDay",(e,t,a)=>{const s=e&&Re.DateUtils.isDayBefore(a,e);return!e||s||e&&t}),g()(this,"isSelectingDayInPast",e=>{const t=new Date;return e.getTime()<=t.getTime()}),g()(this,"handleDayClick",e=>{const t=this.props.filter,a=e.toDate(),s=this.getFromDate(t),i=this.getToDate(t);s&&i&&a>=i?this.setState({enteredToDate:a,toDate:a}):this.isSelectingFirstDay(s,i,a)?this.setState({fromDate:a,enteredToDate:null}):this.setState({enteredToDate:a,toDate:a})}),g()(this,"handleDayMouseEnter",e=>{const t=this.props.filter,a=this.getFromDate(t),s=this.getToDate(t);!this.isSelectingFirstDay(a,s,e)&&this.isSelectingDayInPast(e)&&this.setState({enteredToDate:e}),this.isSelectingDayInPast(e)||s||this.setState({enteredToDate:a})}),g()(this,"handleResetSelection",()=>{const e=this.props,t=e.siteId,a=e.selectDateRange;this.setState({enteredToDate:null,fromDate:null,toDate:null}),a(t,null,null)}),g()(this,"getFormattedFromDate",(e,t)=>e?t?e.format("YYYY-MM-DD")===t.format("YYYY-MM-DD")?"":e.format("YYYY-MM")===t.format("YYYY-MM")?"":e.format("YYYY")===t.format("YYYY")?e.format("MMM D"):e.format("ll"):e.format("LL"):null),g()(this,"getFormattedToDate",(e,t)=>t?e.format("YYYY-MM-DD")===t.format("YYYY-MM-DD")?t.format("ll"):e.format("YYYY-MM")===t.format("YYYY-MM")?"".concat(e.format("MMM D")," – ").concat(t.format("D, YYYY")):t.format("ll"):null),g()(this,"getFormattedDate",(e,t)=>{const a=this.props,s=a.moment,i=a.translate,n=e?s(e):null,r=t?s(t):null,c=this.getFormattedFromDate(n,r),o=this.getFormattedToDate(n,r);return c&&!o?c:!Object(u.isEmpty)(c)&&o?"".concat(c," – ").concat(o):o?"".concat(o):i("Date Range")}),g()(this,"getFromDate",()=>{const e=this.props,t=e.moment,a=e.filter,s=this.state.fromDate;return s||(a&&a.after?t(a.after).toDate():a&&a.on?t(a.on).toDate():null)}),g()(this,"getToDate",()=>{const e=this.props,t=e.moment,a=e.filter,s=this.state.toDate;return s||(a&&a.before?t(a.before).toDate():null)}),g()(this,"getEnteredToDate",()=>{const e=this.props.filter;return this.state.enteredToDate?this.state.enteredToDate:this.getToDate(e)}),g()(this,"handleButtonClick",()=>{const e=this.props,t=e.isVisible,a=e.onButtonClick;t&&this.handleClose(),a()}),this.dateRangeButton=r.a.createRef()}render(){const e=this.props.isVisible,t=this.getFromDate(),a=this.getToDate(),s=new Date,i=P()("filterbar__selection",{"is-selected":t,"is-active":e&&!t});return r.a.createElement(qe.a,{selectedStartDate:t,selectedEndDate:a,lastSelectableDate:s,onDateCommit:this.handleDateRangeCommit,renderTrigger:e=>r.a.createElement(n.Fragment,null,r.a.createElement(W.a,{className:i,compact:!0,borderless:!0,onClick:e.onTriggerClick,ref:e.buttonRef},this.getFormattedDate(t,a)),(t||a)&&r.a.createElement(W.a,{className:"filterbar__selection-close",compact:!0,borderless:!0,onClick:this.handleResetSelection},r.a.createElement(k.a,{icon:"cross-small"})))})}}),Ue=a("./client/components/forms/form-checkbox/index.jsx"),Ye=a("./client/components/forms/form-label/index.jsx"),Me=a("./client/components/popover/index.jsx"),Be=a("./node_modules/react-dom/index.js"),Fe=a.n(Be);class We extends n.Component{constructor(e){super(e),g()(this,"getMobileWrapper",()=>document.querySelector(".filterbar__mobile-wrap")),g()(this,"hasMobileWrapper",()=>!!this.mobileWrapper||(this.mobileWrapper=this.getMobileWrapper(),!!this.mobileWrapper)),this.mobileWrapper=this.getMobileWrapper()}render(){return this.props.isVisible&&this.hasMobileWrapper()?Fe.a.createPortal(this.props.children,this.mobileWrapper):null}}var Le=a("./client/lib/viewport/index.js");var Ve=Object(f.b)((e,t)=>{let a=t.siteId,s=t.filter;const i=a&&Object(oe.a)(a,s),n=s&&s.group;return{activityTypes:a&&i.data||[],selectedState:n}},e=>({selectActionType:(t,a,s)=>{if(0===a.length)return e(Object(ge.k)(Object(ge.i)("calypso_activitylog_filterbar_reset_type"),Object(De.s)(t,{group:null,page:1})));const i={num_groups_selected:a.length};return s.forEach(e=>i["group_"+e.key]=a.includes(e.key)),i.num_total_activities_selected=s.reduce((e,t)=>a.includes(t.key)?e+t.count:e,0),e(Object(ge.k)(Object(ge.i)("calypso_activitylog_filterbar_select_type",i),Object(De.s)(t,{group:a,page:1})))}}))(Object(c.localize)(class extends n.Component{constructor(e){super(e),g()(this,"state",{userHasSelected:!1,selectedCheckboxes:[]}),g()(this,"resetActivityTypeSelector",e=>{const t=this.props;(0,t.selectActionType)(t.siteId,[],t.activityTypes),e.preventDefault()}),g()(this,"handleToggleAllActionTypeSelector",()=>{const e=this.props.activityTypes;this.getSelectedCheckboxes().length?this.setState({userHasSelected:!0,selectedCheckboxes:[]}):this.setState({userHasSelected:!0,selectedCheckboxes:e.map(e=>e.key)})}),g()(this,"handleSelectClick",e=>{const t=e.target.getAttribute("id");this.getSelectedCheckboxes().includes(t)?this.setState({userHasSelected:!0,selectedCheckboxes:Object(u.without)(this.getSelectedCheckboxes(),t)}):this.setState({userHasSelected:!0,selectedCheckboxes:Object(u.concat)(this.getSelectedCheckboxes(),t)})}),g()(this,"getSelectedCheckboxes",()=>{const e=this.props.selectedState;return this.state.userHasSelected?this.state.selectedCheckboxes:e&&e.length?e:[]}),g()(this,"activityKeyToName",e=>{const t=this.props.activityTypes,a=Object(u.find)(t,["key",e]);return a&&a.name||e}),g()(this,"handleClose",()=>{const e=this.props,t=e.siteId,a=e.onClose,s=e.selectActionType,i=e.activityTypes;s(t,this.getSelectedCheckboxes(),i),this.setState({userHasSelected:!1,selectedCheckboxes:[]}),a()}),g()(this,"humanReadable",e=>e>=1e3?this.props.translate("%(number_over_thousand)d K+",{args:{number_over_thousand:Math.floor(e/1e3*10)/10}}):e),g()(this,"renderCheckbox",e=>r.a.createElement(Ye.a,{key:e.key},r.a.createElement(Ue.a,{id:e.key,checked:this.isSelected(e.key),name:e.key,onChange:this.handleSelectClick}),e.name+" ("+this.humanReadable(e.count)+")")),g()(this,"renderCheckboxSelection",()=>{const e=this.props,t=e.translate,a=e.activityTypes,s=this.getSelectedCheckboxes();return r.a.createElement("div",{className:"filterbar__activity-types-selection-wrap"},a&&!!a.length&&r.a.createElement("div",null,r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:"filterbar__activity-types-selection-granular"},a.map(this.renderCheckbox))),r.a.createElement("div",{className:"filterbar__activity-types-selection-info"},r.a.createElement("div",{className:"filterbar__date-range-info"},0===s.length&&r.a.createElement(W.a,{borderless:!0,compact:!0,onClick:this.handleToggleAllActionTypeSelector},t("{{icon/}} select all",{components:{icon:r.a.createElement(k.a,{icon:"checkmark"})}})),0!==s.length&&r.a.createElement(W.a,{borderless:!0,compact:!0,onClick:this.handleToggleAllActionTypeSelector},t("{{icon/}} clear",{components:{icon:r.a.createElement(k.a,{icon:"cross-small"})}}))),r.a.createElement(W.a,{className:"filterbar__activity-types-apply",primary:!0,compact:!0,disabled:!this.state.userHasSelected,onClick:this.handleClose},t("Apply")))),!a&&[1,2,3].map(this.renderPlaceholder),a&&!a.length&&r.a.createElement("p",null,t("No activities recorded in the selected date range.")))}),g()(this,"renderPlaceholder",e=>r.a.createElement("div",{className:"filterbar__activity-types-selection-placeholder",key:"placeholder"+e})),g()(this,"isSelected",e=>this.getSelectedCheckboxes().includes(e)),g()(this,"handleButtonClick",()=>{const e=this.props,t=e.isVisible,a=e.onButtonClick;t&&this.handleClose(),a()}),this.activityTypeButton=r.a.createRef()}render(){const e=this.props,t=e.translate,a=e.isVisible,s=this.getSelectedCheckboxes(),i=!Object(u.isEmpty)(s),c=P()("filterbar__selection",{"is-selected":i,"is-active":a&&!i});return r.a.createElement(n.Fragment,null,r.a.createElement(W.a,{className:c,compact:!0,borderless:!0,onClick:this.handleButtonClick,ref:this.activityTypeButton},t("Activity Type"),i&&r.a.createElement("span",null,": "),i&&s.map(this.activityKeyToName).join(", ")),i&&r.a.createElement(W.a,{className:"filterbar__selection-close",compact:!0,borderless:!0,onClick:this.resetActivityTypeSelector},r.a.createElement(k.a,{icon:"cross-small"})),Object(Le.f)(">660px")&&r.a.createElement(Me.a,{id:"filterbar__activity-types",isVisible:a,onClose:this.handleClose,position:"bottom",relativePosition:{left:-80},context:this.activityTypeButton.current},this.renderCheckboxSelection()),!Object(Le.f)(">660px")&&r.a.createElement(We,{isVisible:a},r.a.createElement(_.a,null,this.renderCheckboxSelection())))}})),ze=a("./client/state/selectors/get-previous-route.js");a("./client/my-sites/activity/filterbar/style.scss");var He=Object(f.b)(e=>({previousRoute:Object(ze.a)(e)}),e=>({resetFilters:t=>e(Object(ge.k)(Object(ge.i)("calypso_activitylog_filterbar_reset"),Object(De.s)(t,{group:null,after:null,before:null,on:null,page:1})))}))(Object(c.localize)(class extends n.Component{constructor(){super(...arguments),g()(this,"state",{showActivityTypes:!1,showActivityDates:!1}),g()(this,"goBack",()=>{const e=this.props.previousRoute;e?d.a.back(e):d.a.back("activity-log")}),g()(this,"toggleDateRangeSelector",()=>{this.setState({showActivityDates:!this.state.showActivityDates,showActivityTypes:!1}),this.scrollIntoView()}),g()(this,"closeDateRangeSelector",()=>{this.setState({showActivityDates:!1})}),g()(this,"toggleActivityTypesSelector",()=>{this.setState({showActivityTypes:!this.state.showActivityTypes,showActivityDates:!1}),this.scrollIntoView()}),g()(this,"closeActivityTypes",()=>{this.setState({showActivityTypes:!1})}),g()(this,"handleRemoveFilters",()=>{const e=this.props,t=e.siteId;(0,e.resetFilters)(t)}),g()(this,"renderCloseButton",()=>{const e=this.props.filter;if(e&&(e.group||e.before||e.after))return r.a.createElement(W.a,{onClick:this.handleRemoveFilters,borderless:!0,className:"filterbar__icon-reset"},r.a.createElement(k.a,{icon:"cross"}))}),g()(this,"scrollIntoView",()=>{if(Object(Le.f)(">660px"))return!0;const e=document.getElementById("filterbar");e&&(e.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),window.scrollBy(0,-50))}),g()(this,"isEmptyFilter",e=>!e||!(e.group||e.on||e.before||e.after)&&1===e.page)}render(){const e=this.props,t=e.translate,a=e.siteId,s=e.filter,i=e.isLoading,n=e.isVisible;return a&&i&&this.isEmptyFilter(s)?r.a.createElement("div",{className:"filterbar is-loading"}):n?s.backButton?r.a.createElement("div",{className:"filterbar",id:"filterbar"},r.a.createElement("div",{className:"filterbar__wrap card"},r.a.createElement(Ce.a,{onClick:this.goBack}))):r.a.createElement("div",{className:"filterbar",id:"filterbar"},r.a.createElement("div",{className:"filterbar__wrap card"},r.a.createElement("span",{className:"filterbar__label"},t("Filter by:")),r.a.createElement(Ae,{isVisible:this.state.showActivityDates,onButtonClick:this.toggleDateRangeSelector,onClose:this.closeDateRangeSelector,filter:s,siteId:a}),r.a.createElement(Ve,{filter:s,siteId:a,isVisible:this.state.showActivityTypes,onButtonClick:this.toggleActivityTypesSelector,onClose:this.closeActivityTypes}),this.renderCloseButton()),r.a.createElement("div",{className:"filterbar__mobile-wrap"})):null}})),Je=a("./client/components/card-heading/index.jsx"),Ge=a("./client/blocks/dismissible-card/index.jsx"),Qe=a("./client/components/external-link/index.jsx"),Ze=a("./client/state/sites/plans/selectors.js"),Ke=a("./client/lib/plans/index.js");a("./client/my-sites/activity/activity-log-banner/intro-banner.scss");var Xe=Object(f.b)((e,t)=>{let a=t.siteId;return{siteId:a,siteIsJetpack:Object(D.J)(e,a),siteIsOnFreePlan:Object(Ke.p)(Object(u.get)(Object(Ze.a)(e,a),"productSlug")),siteSlug:Object(D.v)(e,a)}},{recordTracksEvent:ge.i})(Object(c.localize)(class extends n.Component{constructor(){super(...arguments),g()(this,"recordLearnMore",()=>this.props.recordTracksEvent("calypso_activitylog_intro_banner_learn_more")),g()(this,"recordUpgrade",()=>this.props.recordTracksEvent("calypso_activitylog_intro_banner_upgrade")),g()(this,"recordDismiss",()=>this.props.recordTracksEvent("calypso_activitylog_intro_banner_dismiss"))}renderCardContent(){const e=this.props,t=e.siteIsJetpack,a=e.siteIsOnFreePlan,s=e.siteSlug,i=e.translate,c=t?N.pc:N.tc,o=t?N.ib:N.Z;return r.a.createElement(n.Fragment,null,r.a.createElement("p",null,i("Activity tracks the events that occur on your site so that you don’t have to.")),r.a.createElement("p",null,i(a?"With your free plan, you can monitor the 20 most recent events. A paid plan unlocks more powerful features. You can access all site activity for the last 30 days and filter events by type and date range to quickly find the information you need. ":"Explore the list below or filter events by type and date range to quickly find the information you need. "),r.a.createElement(Qe.a,{href:"https://en.blog.wordpress.com/2018/10/30/introducing-activity/",icon:!0,onClick:this.recordLearnMore,target:"_blank"},i("Learn more"))),a&&r.a.createElement(W.a,{className:"activity-log-banner__intro-button",href:"/plans/".concat(s,"?feature=").concat(o,"&plan=").concat(c),onClick:this.recordUpgrade},i("Upgrade now")))}render(){const e=this.props.translate;return r.a.createElement(Ge.a,{preferenceName:"activity-introduction-banner",className:"activity-log-banner__intro",onClick:this.recordDismiss},r.a.createElement("img",{className:"activity-log-banner__intro-image",src:"/calypso/images/illustrations/jetpack-site-activity.svg",alt:e("Activity")}),r.a.createElement("div",{className:"activity-log-banner__intro-description"},r.a.createElement(Je.a,{tagName:"h1",size:24},e("Welcome to your site’s activity")),this.renderCardContent()))}})),$e=a("./client/components/jetpack-colophon/index.jsx"),et=a("./client/components/main/index.jsx"),tt=a("./client/lib/analytics/page-view-tracker/index.jsx"),at=a("./client/components/pagination/index.jsx"),st=a("./client/components/progress-bar/index.jsx"),it=a("./client/lib/interval/index.js");class nt extends n.Component{constructor(){super(...arguments),g()(this,"query",()=>{const e=this.props,t=e.restoreId,a=e.siteId;a&&t&&this.props.getRewindRestoreProgress(a,t)})}render(){return r.a.createElement(it.e,{onTick:this.query,period:it.c})}}g()(nt,"propTypes",{restoreId:b.a.number,siteId:b.a.number.isRequired});var rt=Object(f.b)(null,{getRewindRestoreProgress:De.e})(nt);class ct extends n.Component{constructor(){super(...arguments),g()(this,"query",()=>{const e=this.props,t=e.downloadId,a=e.siteId;a&&t&&this.props.getRewindBackupProgress(a)})}componentWillMount(){if(!this.props.downloadId){const e=this.props.siteId;e&&this.props.getRewindBackupProgress(e)}}render(){return r.a.createElement(it.e,{onTick:this.query,period:it.c})}}g()(ct,"propTypes",{downloadId:b.a.number,siteId:b.a.number.isRequired});var ot=Object(f.b)(null,{getRewindBackupProgress:De.d})(ct);const lt=e=>e<9467028e5?1e3*e:e;function dt(e){let t=e.applySiteOffset,a=e.percent,s=e.status,i=e.siteId,n=e.timestamp,o=e.restoreId,l=e.downloadId,d=e.action,u=e.context;const p=Object(c.useTranslate)();let m="",h="",g="";const y=t(Object(Q.a)()(lt(n))).format("LLLL");switch(d){case"restore":"alternate"===u?(m=p("Currently cloning your site"),h=p("We're cloning your site to %(dateTime)s. You'll be notified once it's complete.",{args:{dateTime:y}}),g=p("queued"===s?"The cloning process will start in a moment.":"Away we go! Your site is being cloned.")):(m=p("Currently rewinding your site"),h=p("We're rewinding your site back to %(dateTime)s. You'll be notified once it's complete.",{args:{dateTime:y}}),g=p("queued"===s?"Your rewind will start in a moment.":"Away we go! Your site is being rewound."));break;case"backup":m=p("Currently creating a downloadable backup of your site"),h=p("We're creating a downloadable backup of your site at %(dateTime)s. You'll be notified once it's complete.",{args:{dateTime:y}}),g=p(0<a?"Away we go! Your download is being created.":"The creation of your backup will start in a moment.")}return r.a.createElement(E,{status:"info",title:m},r.a.createElement("div",null,"restore"===d&&r.a.createElement(rt,{restoreId:o,siteId:i}),"backup"===d&&r.a.createElement(ot,{downloadId:l,siteId:i}),r.a.createElement("p",null,h),r.a.createElement("em",null,g)),("running"===s||0<=a&&a<=100)&&r.a.createElement(st.a,{isPulsing:!0,value:a||0}))}dt.propTypes={applySiteOffset:b.a.func.isRequired,percent:b.a.number,siteId:b.a.number,status:b.a.oneOf(["queued","running","fail"]),timestamp:b.a.string,action:b.a.oneOf(["restore","backup"])};var ut=dt,pt=a("./node_modules/debug/src/browser.js"),mt=a.n(pt),ht=a("./client/components/diff-viewer/index.jsx"),gt=a("./client/components/marked-lines/index.jsx"),yt=a("./client/components/time-since/index.jsx");a("./client/my-sites/activity/activity-log/threat-alert.scss");const bt=mt()("calypso:activity-log"),vt=e=>e.hasOwnProperty("diff")?"core":e.hasOwnProperty("context")?"file":e.hasOwnProperty("extension")?e.extension.type:"none",ft=(e,t)=>{const a=t.extension,s=t.filename,i=e=>e.replace(/.*\//,"");switch(vt(t)){case"core":return e("The file {{filename/}} has been modified from its original.",{components:{filename:r.a.createElement("code",{className:"activity-log__threat-alert-filename"},i(s))}});case"file":return e("The file {{filename/}} contains a malicious code pattern.",{components:{filename:r.a.createElement("code",{className:"activity-log__threat-alert-filename"},i(s))}});case"plugin":return e("The plugin {{pluginSlug/}} (version {{version/}}) has a publicly known vulnerability.",{components:{pluginSlug:r.a.createElement("span",{className:"activity-log__threat-alert-slug"},a.slug),version:r.a.createElement("span",{className:"activity-log__threat-alert-version"},a.version)}});case"theme":return e("The theme {{themeSlug/}} (version {{version/}}) has a publicly known vulnerability.",{components:{themeSlug:r.a.createElement("span",{className:"activity-log__threat-alert-slug"},a.slug),version:r.a.createElement("span",{className:"activity-log__threat-alert-version"},a.version)}});case"none":default:return e("Threat found")}},_t=(e,t)=>{switch(vt(t)){case"core":return e("Vulnerability found in WordPress");case"file":return e("Threat found ({{signature/}})",{components:{signature:r.a.createElement("span",{className:"activity-log__threat-alert-signature"},t.signature)}});case"plugin":return e("Vulnerability found in plugin");case"theme":return e("Vulnerability found in theme");case"none":default:return e("Miscellaneous vulnerability")}};var jt=Object(c.localize)(class extends n.Component{render(){const e=this.props,t=e.threat,a=e.translate;return r.a.createElement(n.Fragment,null,r.a.createElement(M.a,{className:"activity-log__threat-alert",highlight:"error",compact:!0,clickableHeader:!0,actionButton:r.a.createElement("span",null),header:r.a.createElement(n.Fragment,null,r.a.createElement(Y.a,{activityIcon:"notice-outline",activityStatus:"error"}),r.a.createElement("div",{className:"activity-log__threat-alert-header"},r.a.createElement("div",{className:"activity-log__threat-header-top"},r.a.createElement("span",{className:"activity-log__threat-alert-title"},ft(a,t),r.a.createElement(yt.a,{className:"activity-log__threat-alert-time-since",date:t.firstDetected,dateFormat:"ll"})),r.a.createElement(ae.a,{compact:!0,primary:!0,label:a("Fix threat"),onClick:()=>bt("main button clicked"),disabled:!1},r.a.createElement(te.a,{onClick:()=>bt("documentation clicked"),className:"activity-log__threat-menu-item",icon:"help"},r.a.createElement("span",null,a("Documentation"))),r.a.createElement(te.a,{onClick:()=>bt("get help clicked"),className:"activity-log__threat-menu-item",icon:"chat"},r.a.createElement("span",null,a("Get help"))),r.a.createElement(te.a,{onClick:()=>bt("ignore threat clicked"),className:"activity-log__threat-menu-item",icon:"trash"},r.a.createElement("span",null,a("Ignore threat"))))),r.a.createElement("span",{className:"activity-log__threat-alert-type"},_t(a,t))))},r.a.createElement(n.Fragment,null,r.a.createElement("p",{className:"activity-log__threat-alert-description"},t.description),t.filename?r.a.createElement(n.Fragment,null,r.a.createElement("p",null,a("Threat {{threatSignature/}} found in file:",{comment:'filename follows in separate line; e.g. "PHP.Injection.5 in: `post.php`"',components:{threatSignature:r.a.createElement("span",{className:"activity-log__threat-alert-signature"},t.signature)}})),r.a.createElement("pre",{className:"activity-log__threat-alert-filename"},t.filename)):r.a.createElement("p",{className:"activity-log__threat-alert-signature"},t.signature),t.context&&r.a.createElement(gt.a,{context:t.context}),t.diff&&r.a.createElement(ht.a,{diff:t.diff}))))}});a("./client/my-sites/activity/activity-log/rewind-alerts.scss");var kt=Object(f.b)((e,t)=>{let a=t.siteId;return{alerts:Object(oe.d)(a).data}})(function(e){let t=e.alerts;const a=Object(c.useTranslate)();return t&&t.threats&&0!==t.threats.length?r.a.createElement(_.a,{className:"activity-log__threats",highlight:"error"},r.a.createElement("div",{className:"activity-log__threats-heading"},a("These items require your immediate attention")),t.threats.map(e=>r.a.createElement(jt,{key:e.id,threat:e}))):null}),wt=a("./client/components/data/query-rewind-state/index.jsx"),Et=a("./client/components/data/query-site-settings/index.js"),Ot=a("./client/components/data/query-jetpack-plugins/index.jsx"),xt=a("./client/my-sites/sidebar-navigation/sidebar-navigation.jsx"),It=a("./client/state/selectors/get-site-url.js");a("./client/my-sites/activity/activity-log-banner/success-banner.scss");const St=e=>e<9467028e5?1e3*e:e;class Dt extends n.PureComponent{constructor(){super(...arguments),g()(this,"handleDismiss",()=>this.props.backupUrl?this.props.dismissBackupProgress(this.props.siteId,this.props.downloadId):this.props.dismissRestoreProgress(this.props.siteId,this.props.restoreId)),g()(this,"trackDownload",()=>this.props.recordTracksEvent("calypso_activitylog_backup_download",{download_count:this.props.downloadCount}))}render(){const e=this.props,t=e.applySiteOffset,a=e.moment,s=e.siteUrl,i=e.timestamp,n=e.translate,c=e.backupUrl,o=e.context,l=e.trackHappyChatBackup,d=e.trackHappyChatRestore,u=t(a(St(i))).format("LLLL"),p=c?{title:n("Your backup is now available for download"),icon:"cloud-download",track:r.a.createElement(de.a,{eventName:"calypso_activitylog_backup_successbanner_impression"}),taskFinished:n("We successfully created a backup of your site as of %(date)s!",{args:{date:u}}),actionButton:r.a.createElement(W.a,{href:c,onClick:this.trackDownload,primary:!0},n("Download")),trackHappyChat:l}:{title:n("alternate"===o?"Your site has been successfully cloned":"Your site has been successfully rewound"),icon:"history",track:r.a.createElement(de.a,{eventName:"calypso_activitylog_restore_successbanner_impression",eventProperties:{restore_to:i}}),taskFinished:n("alternate"===o?"We successfully cloned your site to the state as of %(date)s!":"We successfully rewound your site back to %(date)s!",{args:{date:u}}),actionButton:r.a.createElement(W.a,{href:s,primary:!0},n("View site")),trackHappyChat:d};return r.a.createElement(E,{isDismissable:!0,onDismissClick:this.handleDismiss,status:"success",title:p.title,icon:p.icon},p.track,r.a.createElement("p",null,p.taskFinished),p.actionButton,!c&&r.a.createElement(W.a,{className:"activity-log-banner__success-gotit",onClick:this.handleDismiss},n("Thanks, got it!")),r.a.createElement(Se.a,{className:"activity-log-banner__happychat-button",onClick:p.trackHappyChat},r.a.createElement(k.a,{icon:"chat"}),r.a.createElement("span",null,n("Get help"))))}}g()(Dt,"propTypes",{applySiteOffset:b.a.func.isRequired,siteId:b.a.number.isRequired,siteUrl:b.a.string.isRequired,timestamp:b.a.string,backupUrl:b.a.string,downloadCount:b.a.number,downloadId:b.a.number,context:b.a.string,dismissRestoreProgress:b.a.func.isRequired,dismissBackupProgress:b.a.func.isRequired,recordTracksEvent:b.a.func.isRequired,moment:b.a.func.isRequired,translate:b.a.func.isRequired});var Nt=Object(u.flowRight)(Object(f.b)((e,t)=>{let a=t.siteId;return{siteUrl:Object(It.a)(e,a)}},{dismissRestoreProgress:De.c,dismissBackupProgress:De.b,recordTracksEvent:ge.i,trackHappyChatBackup:()=>Object(ge.i)("calypso_activitylog_success_banner_backup"),trackHappyChatRestore:()=>Object(ge.i)("calypso_activitylog_success_banner_restore")}),c.localize,Q.b)(Dt);var Tt=Object(f.b)((e,t)=>{let a=t.siteId;const s=Object(X.a)(e,a),i=s.reason,n=s.state;return{adminUrl:Object(D.l)(e,a),reason:i,rewindState:n,slug:Object(p.f)(e),siteId:a}})(Object(c.localize)(e=>{let t=e.adminUrl,a=e.reason,s=e.rewindState,i=e.slug,n=e.translate,c=e.siteId;if("unavailable"!==s)return null;switch(a){case"no_connected_jetpack":return r.a.createElement(S.a,{icon:"history",href:t,title:n("The site is not connected."),description:n("We can't back up or rewind your site until it has been reconnected.")});case"vp_can_transfer":return r.a.createElement(S.a,{icon:"history",href:"/start/rewind-switch/?siteId=".concat(c,"&siteSlug=").concat(i),title:n("Try our new backup service"),description:n("Get real-time backups with one-click restores to any event in time.")});default:return null}})),Ct=a("./client/state/selectors/can-current-user.js");function Rt(e,t){return Object(u.get)(e,["activityLog","backupProgress",t],null)}var qt=a("./client/state/selectors/get-requested-backup.js"),Pt=a("./client/state/selectors/get-requested-rewind.js");function At(e,t){return Object(u.get)(e,["activityLog","restoreProgress",t],null)}var Ut=a("./client/state/selectors/is-vip-site.js"),Yt=a("./client/state/activity-log/reducer.js");a("./client/my-sites/activity/activity-log/style.scss");const Mt=20;class Bt extends n.Component{constructor(){super(...arguments),g()(this,"findExistingRewind",e=>{let t=e.siteId,a=e.rewindState;a.rewind&&a.rewind.restoreId&&this.props.getRewindRestoreProgress(t,a.rewind.restoreId)}),g()(this,"handleCloseDialog",e=>{const t=this.props.siteId;switch(e){case"restore":this.props.rewindRequestDismiss(t);break;case"backup":this.props.dismissBackup(t)}}),g()(this,"applySiteOffset",e=>{const t=this.props,a=t.timezone,s=t.gmtOffset;return Object(A.a)(e,{timezone:a,gmtOffset:s})}),g()(this,"changePage",e=>{J.default.tracks.recordEvent("calypso_activitylog_change_page",{page:e}),this.props.selectPage(this.props.siteId,e),window.scrollTo(0,0)})}componentDidMount(){window.scrollTo(0,0),this.findExistingRewind(this.props)}componentDidUpdate(e){!e.rewindState.rewind&&this.props.rewindState.rewind&&this.findExistingRewind(this.props)}renderActionProgress(){const e=this.props,t=e.siteId,a=e.restoreProgress,s=e.backupProgress;if(!a&&!s)return null;const i=[];return a&&i.push("finished"===a.status?this.getEndBanner(t,a):this.getProgressBanner(t,a,"restore")),s&&(0<=s.progress?i.push(this.getProgressBanner(t,s,"backup")):!Object(u.isEmpty)(s.url)&&Date.now()<Date.parse(s.validUntil)?i.push(this.getEndBanner(t,s)):Object(u.isEmpty)(s.backupError)||i.push(this.getEndBanner(t,s))),i}getProgressBanner(e,t,a){const s=t.percent,i=t.progress,n=t.restoreId,c=t.downloadId,o=t.status,l=t.timestamp,d=t.rewindId,u=t.context;return r.a.createElement(ut,{key:"progress-".concat(n||c),applySiteOffset:this.applySiteOffset,percent:s||i,restoreId:n,downloadId:c,siteId:e,status:o,timestamp:l||d,action:a,context:u})}getEndBanner(e,t){const a=t.errorCode,s=t.backupError,i=t.failureReason,n=t.siteTitle,c=t.timestamp,o=t.url,l=t.downloadCount,d=t.restoreId,u=t.downloadId,p=t.rewindId,m=t.context,h=this.props.requestedRestoreId||p;return r.a.createElement("div",{key:"end-banner-".concat(d||u)},a||s?r.a.createElement(Te,{key:"error-".concat(d||u),errorCode:a||s,downloadId:u,requestedRestoreId:h,failureReason:i,createBackup:this.props.createBackup,rewindRestore:this.props.rewindRestore,closeDialog:this.handleCloseDialog,siteId:e,siteTitle:n,timestamp:c,context:m}):r.a.createElement(Nt,{key:"success-".concat(d||u),applySiteOffset:this.applySiteOffset,siteId:e,timestamp:p,downloadId:u,restoreId:d,backupUrl:o,downloadCount:l,context:m}))}renderErrorMessage(){const e=this.props,t=e.rewindState,a=e.translate;return t.rewind&&"failed"===t.rewind.status?r.a.createElement(E,{status:"error",icon:null},a("Something happened and we were unable to restore your site."),r.a.createElement("br",null),a("Please try again or contact support.")):null}renderNoLogsContent(){const e=this.props,t=e.filter,a=e.logLoadingState,s=e.siteId,i=e.translate,c=e.siteIsOnFreePlan,o=e.slug,l=Object(u.isEqual)(Yt.b,t);return"success"===a?l?r.a.createElement(R,{siteId:s,siteIsOnFreePlan:c}):r.a.createElement(n.Fragment,null,r.a.createElement(Ie.a,{title:i("No matching events found."),line:i("Try adjusting your date range or activity type filters"),action:i("Remove all filters"),actionURL:"/activity-log/"+o})):r.a.createElement("section",{className:"activity-log__wrapper"},r.a.createElement("div",{className:"activity-log__time-period is-loading"},r.a.createElement("span",null)),[1,2,3].map(e=>r.a.createElement("div",{key:e,className:"activity-log-item is-loading"},r.a.createElement("div",{className:"activity-log-item__type"},r.a.createElement("div",{className:"activity-log-item__activity-icon"})),r.a.createElement("div",{className:"card foldable-card activity-log-item__card"}))))}getActivityLog(){const e=this.props,t=e.enableRewind,a=e.filter.page,s=e.logs,i=e.moment,c=e.rewindState,o=e.siteId,l=e.siteIsOnFreePlan,d=e.slug,p=e.translate,m=e.isJetpack,h=e.isIntroDismissed,g=!t||Object(u.includes)(["queued","running"],Object(u.get)(this.props,["restoreProgress","status"]))||"active"!==c.state,y=0<=Object(u.get)(this.props,["backupProgress","progress"],-1/0),b=Math.max(1,Math.min(a,Math.ceil(s.length/Mt))),f=s.slice((b-1)*Mt,b*Mt),_=(()=>{const e=this.applySiteOffset(i());let t=null;return a=>{let s=a.rewindId;const n=this.applySiteOffset(i(1e3*s));return null!==t&&n.isSame(t,"day")?null:(t=n,r.a.createElement("h2",{className:"activity-log__time-period",key:"time-period-".concat(n)},n.isSame(e,"day")?n.format(p("LL[ — Today]",{context:"moment format string"})):n.format("LL")))}})();return r.a.createElement("div",null,o&&"active"===c.state&&r.a.createElement(ot,{siteId:o}),r.a.createElement(Et.a,{siteId:o}),r.a.createElement(xt.a,null),v.a.isEnabled("rewind-alerts")&&o&&m&&r.a.createElement(kt,{siteId:o}),o&&"unavailable"===c.state&&r.a.createElement(Tt,{siteId:o}),"awaitingCredentials"===c.state&&!l&&r.a.createElement(S.a,{icon:"history",href:c.canAutoconfigure?"/start/rewind-auto-config/?blogid=".concat(o,"&siteSlug=").concat(d):"/start/rewind-setup/?siteId=".concat(o,"&siteSlug=").concat(d),title:p("Add site credentials"),description:p("Backups and security scans require access to your site to work properly.")}),"provisioning"===c.state&&r.a.createElement(S.a,{icon:"history",disableHref:!0,title:p("Your backup is underway"),description:p("We're currently backing up your site for the first time, and we'll let you know when we're finished. After this initial backup, we'll save future changes in real time.")}),r.a.createElement(Xe,{siteId:o}),l&&h&&r.a.createElement(T,{siteId:o}),o&&m&&r.a.createElement(Oe,{siteId:o}),this.renderErrorMessage(),this.renderActionProgress(),this.renderFilterbar(),Object(u.isEmpty)(s)?this.renderNoLogsContent():r.a.createElement("div",null,r.a.createElement(at.a,{compact:Object(Le.e)(),className:"activity-log__pagination",key:"activity-list-pagination-top",nextLabel:p("Older"),page:b,pageClick:this.changePage,perPage:Mt,prevLabel:p("Newer"),total:s.length}),r.a.createElement("section",{className:"activity-log__wrapper"},l&&r.a.createElement("div",{className:"activity-log__fader"}),f.map(e=>e.isAggregate?r.a.createElement(n.Fragment,{key:e.activityId},_(e),r.a.createElement(K,{key:e.activityId,activity:e,disableRestore:g,disableBackup:y,hideRestore:"active"!==c.state,siteId:o,rewindState:c.state})):r.a.createElement(n.Fragment,{key:e.activityId},_(e),r.a.createElement(O.a,{key:e.activityId,activity:e,disableRestore:g,disableBackup:y,hideRestore:"active"!==c.state,siteId:o})))),l&&!h&&r.a.createElement(T,{siteId:o}),r.a.createElement(at.a,{compact:Object(Le.e)(),className:"activity-log__pagination is-bottom-pagination",key:"activity-list-pagination-bottom",nextLabel:p("Older"),page:b,pageClick:this.changePage,perPage:Mt,prevLabel:p("Newer"),total:s.length})))}renderFilterbar(){const e=this.props,t=e.siteId,a=e.filter,s=e.logs,i=e.siteIsOnFreePlan,n=e.logLoadingState,c=Object(u.isEqual)(Yt.b,a);return i?null:r.a.createElement(He,{siteId:t,filter:a,isLoading:"success"!==n,isVisible:!(Object(u.isEmpty)(s)&&c)})}render(){const e=this.props,t=e.canViewActivityLog,a=e.translate;if(!1===t)return r.a.createElement(et.a,null,r.a.createElement(xt.a,null),r.a.createElement(Ie.a,{title:a("You are not authorized to view this page"),illustration:"/calypso/images/illustrations/illustration-404.svg"}));const s=this.props,i=s.siteId,n=s.context,c=s.rewindState,o=Object(u.get)(n,"query.rewind-redirect",""),l=Object(u.includes)(["uninitialized","awaitingCredentials"],c.state)||"vp_can_transfer"===c.reason;return r.a.createElement(et.a,{wideLayout:!0},r.a.createElement(tt.a,{path:"/activity-log/:site",title:"Activity"}),r.a.createElement(xe.a,{title:a("Activity")}),i&&r.a.createElement(wt.a,{siteId:i}),i&&r.a.createElement(Ot.a,{siteIds:[i]}),""!==o&&l?i&&r.a.createElement(ee,{siteId:i,redirect:o}):this.getActivityLog(),r.a.createElement($e.a,null))}}g()(Bt,"propTypes",{restoreProgress:b.a.shape({errorCode:b.a.string.isRequired,failureReason:b.a.string.isRequired,message:b.a.string.isRequired,percent:b.a.number.isRequired,restoreId:b.a.number,status:b.a.oneOf(["finished","queued","running"]).isRequired,rewindId:b.a.string.isRequired}),backupProgress:b.a.object,changePeriod:b.a.func,requestedRestore:b.a.shape({rewindId:b.a.string.isRequired,activityTs:b.a.number.isRequired}),requestedRestoreId:b.a.string,rewindRequestDismiss:b.a.func.isRequired,rewindRestore:b.a.func.isRequired,createBackup:b.a.func.isRequired,siteId:b.a.number,siteTitle:b.a.string,slug:b.a.string,moment:b.a.func.isRequired,translate:b.a.func.isRequired});const Ft=[];var Wt=Object(f.b)(e=>{const t=Object(p.e)(e),a=Object(B.a)(e,t),s=Object(F.a)(e,t),i=Object(Pt.a)(e,t),n=Object(qt.a)(e,t),r=Object(X.a)(e,t),c=r.rewind&&r.rewind.status,o=Object(m.a)(e,t),l=t&&Object(oe.b)(t,o),d=Object(Ke.p)(Object(u.get)(Object(Ze.a)(e,t),"productSlug"))&&!Object(Ut.a)(e,t),h=Object(D.J)(e,t);return{canViewActivityLog:Object(Ct.b)(e,t,"manage_options"),gmtOffset:a,enableRewind:"active"===r.state&&!("queued"===c||"running"===c),filter:o,isJetpack:h,logs:t&&l.data||Ft,logLoadingState:l&&l.state,requestedRestore:Object(u.find)(l,{activityId:i}),requestedRestoreId:i,requestedBackup:Object(u.find)(l,{activityId:n}),requestedBackupId:n,restoreProgress:At(e,t),backupProgress:Rt(e,t),rewindState:r,siteId:t,siteTitle:Object(D.x)(e,t),slug:Object(D.v)(e,t),timezone:s,siteIsOnFreePlan:d,isIntroDismissed:Object(C.b)(e,"dismissible-card-activity-introduction-banner")}},{changePeriod:e=>{let t=e.date,a=e.direction;return Object(ge.i)("calypso_activitylog_monthpicker_change",{date:t.utc().toISOString(),direction:a})},createBackup:(e,t)=>Object(ge.k)(Object(ge.i)("calypso_activitylog_backup_confirm",{action_id:t}),Object(De.h)(e,t)),dismissBackup:e=>Object(ge.k)(Object(ge.i)("calypso_activitylog_backup_cancel"),Object(De.i)(e)),getRewindRestoreProgress:De.e,rewindRequestDismiss:e=>Object(ge.k)(Object(ge.i)("calypso_activitylog_restore_cancel"),Object(De.o)(e)),rewindRestore:(e,t)=>Object(ge.k)(Object(ge.i)("calypso_activitylog_restore_confirm",{action_id:t}),Object(De.q)(e,t)),selectPage:(e,t)=>Object(De.s)(e,{page:t})})(Object(c.localize)(Object(Q.b)(Bt))),Lt=a("./client/reader/stats.js");function Vt(e,t){const a=e.store.getState(),s=Object(p.e)(a),n=o.a.moment(e.query.startDate,"YYYY-MM-DD").isValid()?e.query.startDate:void 0,c=s&&Object(m.a)(a,s),l=Object(L.c)(e.query);Object(u.isEqual)(c,l)||e.store.dispatch(i()({},Object(De.r)(s,l),{meta:{skipUrlUpdate:!0}})),Object(Lt.recordTrack)("calypso_activitylog_view",function(e){const t={};return["attachment","comment","core","feedback","jetpack","menu","module","monitor","pingback","plan","plugin","post","protect","rewind","setting","theme","user","widget"].forEach(a=>{t["filter_group_"+a]=!!(e.group&&e.group.indexOf(a)>=0)}),i()({},t,{filter_date_on:!!e.on||!!e.before||!!e.after,page:e.page?parseInt(e.page):1})}(l)),e.primary=r.a.createElement(Wt,{siteId:s,context:e,startDate:n}),t()}function zt(e){const t=e.store.getState(),a=Object(p.e)(t);a?d.a.redirect("/activity-log/"+a):d.a.redirect("/activity-log/")}a.d(t,"a",function(){return Vt}),a.d(t,"b",function(){return zt})},"./client/my-sites/activity/filterbar/style.scss":function(e,t,a){},"./client/my-sites/sidebar-navigation/sidebar-navigation.jsx":function(e,t,a){"use strict";var s=a("./node_modules/react/index.js"),i=a.n(s),n=a("./node_modules/react-redux/es/index.js"),r=a("./packages/i18n-calypso/dist/esm/index.js"),c=a("./client/components/sidebar-navigation/index.jsx"),o=a("./client/blocks/site-icon/index.jsx"),l=a("./client/state/ui/selectors.js");t.a=Object(n.b)(e=>({site:Object(l.d)(e)}))(Object(r.localize)(e=>{let t=e.site,a=(0,e.translate)("All Sites"),s="all-sites";return t&&(a=t.title,s=null),i.a.createElement(c.a,{linkClassName:s,sectionName:"site",sectionTitle:a},t&&i.a.createElement(o.a,{site:t}))}))},"./client/state/selectors/get-site-url.js":function(e,t,a){"use strict";a.d(t,"a",function(){return n});var s=a("./node_modules/lodash/lodash.js"),i=a("./client/state/selectors/get-raw-site.js");function n(e,t){return Object(s.get)(Object(i.a)(e,t),"URL",null)}}}]);