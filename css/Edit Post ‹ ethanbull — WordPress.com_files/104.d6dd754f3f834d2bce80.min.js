(window.webpackJsonp=window.webpackJsonp||[]).push([[104],{"./client/components/formatted-header/index.jsx":function(e,t,s){"use strict";var n=s("./node_modules/prop-types/index.js"),a=s.n(n),r=s("./node_modules/react/index.js"),i=s.n(r),o=s("./node_modules/classnames/index.js"),d=s.n(o),c=s("./client/lib/formatting/index.js");s("./client/components/formatted-header/style.scss");function p(e){let t=e.id,s=e.headerText,n=e.subHeaderText;const a=d()("formatted-header",{"is-without-subhead":!n});return i.a.createElement("header",{id:t,className:a},i.a.createElement("h1",{className:"formatted-header__title"},Object(c.d)(s,2)),n&&i.a.createElement("p",{className:"formatted-header__subtitle"},Object(c.d)(n,2)))}p.propTypes={headerText:a.a.node,subHeaderText:a.a.node},t.a=p},"./client/components/formatted-header/style.scss":function(e,t,s){},"./client/state/activity-log/actions.js":function(e,t,s){"use strict";var n=s("./node_modules/@babel/runtime/helpers/objectSpread.js"),a=s.n(n),r=s("./packages/i18n-calypso/dist/esm/index.js"),i=s("./node_modules/lodash/lodash.js"),o=s("./client/state/data-layer/wpcom-http/utils.js"),d=s("./client/state/data-layer/wpcom-http/actions.js"),c=s("./client/state/notices/actions.js"),p=s("./client/state/data-layer/wpcom/sites/rewind/api-transformer.js"),u=s("./client/state/data-layer/handler-registry.js");Object(u.b)("state/data-layer/wpcom/activity-log/activate/index.js",{REWIND_ACTIVATE_REQUEST:[Object(o.a)({fetch:e=>Object(d.a)(a()({method:"POST",path:"/activity-log/".concat(e.siteId,"/rewind/activate"),apiVersion:"1"},e.isVpMigrate?{body:{rewindOptIn:!0}}:{}),e),onSuccess:(e,t)=>{const s=S(e.siteId);return void 0===Object(i.get)(t,"rewind_state",void 0)?s:[s,{type:"REWIND_STATE_UPDATE",siteId:e.siteId,data:Object(p.a)(t.rewind_state)}]},onError:(e,t)=>{let s=e.siteId,n=t.message;return[Object(c.b)(Object(r.translate)("Problem activating rewind: %(message)s",{args:{message:n}})),h(s)]}})]});Object(u.b)("state/data-layer/wpcom/activity-log/deactivate/index.js",{REWIND_DEACTIVATE_REQUEST:[Object(o.a)({fetch:e=>Object(d.a)({method:"POST",path:"/activity-log/".concat(e.siteId,"/rewind/deactivate"),apiVersion:"1"},e),onSuccess:e=>{return T(e.siteId)},onError:(e,t)=>{let s=e.siteId,n=t.message;return[Object(c.b)(Object(r.translate)("Problem deactivating rewind: %(message)s",{args:{message:n}})),D(s)]}})]});Object(u.b)("state/data-layer/wpcom/activity-log/rewind/downloads/index.js",{REWIND_BACKUP:[Object(o.a)({fetch:e=>Object(d.a)({method:"POST",apiNamespace:"wpcom/v2",path:"/sites/".concat(e.siteId,"/rewind/downloads"),body:{rewindId:e.rewindId,types:e.args}},e),onSuccess:(e,t)=>{let s=e.siteId;return[G(s),q(s,t.downloadId,t)]},onError:(e,t)=>{return M(e.siteId,Object(i.pick)(t,["error","status","message"]))},fromApi:e=>{if(!e.hasOwnProperty("downloadId"))throw new Error("Missing downloadId field in response");return e}})]});const l=new Map;Object(u.b)("state/data-layer/wpcom/activity-log/rewind/restore-status/index.js",{REWIND_RESTORE_PROGRESS_REQUEST:[Object(o.a)({fetch:e=>{const t=e.restoreId,s=e.siteId,n="".concat(s,"-").concat(t),a=l.get(n)||-1/0,r=Date.now();if(!(r-a<1500))return l.set(n,r),Object(d.a)({apiVersion:"1",method:"GET",path:"/activity-log/".concat(s,"/rewind/").concat(t,"/restore-status")},e)},onSuccess:(e,t)=>{let s=e.siteId,n=e.restoreId;return C(s,e.timestamp,n,t)},onError:()=>Object(c.b)(Object(r.translate)("Hmm, we can't update the status of your restore. Please refresh this page."),{id:"AL_REW_RESTORESTATUS_ERR"}),fromApi:e=>{let t=e.restore_status,s=(t=void 0===t?{}:t).error_code,n=void 0===s?"":s,a=t.failure_reason,r=void 0===a?"":a,i=t.message,o=void 0===i?"":i,d=t.percent,c=void 0===d?0:d,p=t.status,u=void 0===p?"":p,l=t.rewind_id,m=void 0===l?"":l,y=t.context;return{errorCode:n,failureReason:r,message:o,percent:+c,status:u,rewindId:m,context:void 0===y?"":y}}})]});var m=s("./client/config/index.js"),y=s("./client/state/analytics/actions.js"),_=s("./client/state/rewind/actions.js"),I=s("./client/lib/make-json-schema-parser/index.js");const w=e=>{const t=parseInt(e.restore_id,10);if(Number.isNaN(t))throw new I.a("missing numeric restore id - found `${ data.restore_id }`");return t},E=(e,t)=>Object(d.a)({apiVersion:"1",method:"POST",path:"/activity-log/".concat(e.siteId,"/rewind/to/").concat(e.timestamp),body:Object.assign(t,{calypso_env:Object(m.a)("env_id")})},e),b=(e,t)=>{let s=e.siteId;return[W(s,t),Object(_.a)(s)]},f=(e,t)=>{let s=e.siteId,n=e.timestamp;return t.hasOwnProperty("schemaErrors")?Object(y.k)(Object(y.i)("calypso_rewind_to_missing_restore_id",{site_id:s,timestamp:n}),Object(c.b)(Object(r.translate)("Oops, something went wrong. We've been notified and are working on resolving this issue."))):Object(y.k)(Object(y.i)("calypso_rewind_to_unknown_error",t),Object(c.b)(Object(r.translate)("Oops, something went wrong. Please try again soon or contact support for help.")))};Object(u.b)("state/data-layer/wpcom/activity-log/rewind/to/index.js",{REWIND_RESTORE:[Object(o.a)({fetch:e=>E(e,{types:e.args}),onSuccess:b,onError:f,fromApi:w})],REWIND_CLONE:[Object(o.a)({fetch:e=>E(e,e.payload),onSuccess:b,onError:f,fromApi:w})]});var j=s("./node_modules/@babel/runtime/helpers/slicedToArray.js"),O=s.n(j);const g=new Map;Object(u.b)("state/data-layer/wpcom/sites/rewind/downloads",{REWIND_BACKUP_PROGRESS_REQUEST:[Object(o.a)({fetch:e=>{const t=e.downloadId,s=e.siteId,n="".concat(s,"-").concat(t),a=g.get(n)||-1/0,r=Date.now();if(!(r-a<1500))return g.set(n,r),Object(d.a)({method:"GET",apiNamespace:"wpcom/v2",path:"/sites/".concat(e.siteId,"/rewind/downloads")},e)},onSuccess:(e,t)=>{let s=e.siteId;const n=O()(t,1)[0];if(Object(i.isEmpty)(n))return;const a=(e=>({backupPoint:e.backupPoint,downloadId:+e.downloadId,progress:+e.progress,rewindId:e.rewindId,startedAt:e.startedAt,downloadCount:+e.downloadCount,validUntil:e.validUntil,url:e.url,error:e.error}))(n);return Object(i.get)(a,["error"],!1)?M(s,a.downloadId,a):q(s,a.downloadId,a)},onError:()=>Object(c.b)(Object(r.translate)("Hmm, we can't update the status of your backup. Please refresh this page."))})],REWIND_BACKUP_DISMISS_PROGRESS:[Object(o.a)({fetch:e=>Object(d.a)({method:"POST",apiNamespace:"wpcom/v2",path:"/sites/".concat(e.siteId,"/rewind/downloads/").concat(e.downloadId),body:{dismissed:!0}},e),onSuccess:(e,t)=>t.dismissed?null:Object(c.b)(Object(r.translate)("Dismissing backup failed. Please reload and try again.")),onError:()=>Object(c.b)(Object(r.translate)("Dismissing backup failed. Please reload and try again.")),fromApi:e=>({downloadId:+e.download_id,dismissed:e.is_dismissed})})]});function R(e,t){return{type:"REWIND_ACTIVATE_REQUEST",siteId:e,isVpMigrate:t}}function S(e){return{type:"REWIND_ACTIVATE_SUCCESS",siteId:e}}function h(e){return{type:"REWIND_ACTIVATE_FAILURE",siteId:e}}function T(e){return{type:"REWIND_DEACTIVATE_SUCCESS",siteId:e}}function D(e){return{type:"REWIND_DEACTIVATE_FAILURE",siteId:e}}function v(e,t){return{type:"REWIND_RESTORE_REQUEST",siteId:e,activityId:t}}function A(e){return{type:"REWIND_RESTORE_DISMISS",siteId:e}}function P(e,t,s){return{type:"REWIND_RESTORE",siteId:e,timestamp:t,args:s}}function N(e,t,s){return{type:"REWIND_CLONE",siteId:e,timestamp:t,payload:s}}function U(e,t){return{type:"REWIND_RESTORE_DISMISS_PROGRESS",siteId:e,restoreId:t}}function W(e,t){return{type:"REWIND_RESTORE_PROGRESS_REQUEST",siteId:e,restoreId:t}}function C(e,t,s,n){return a()({type:"REWIND_RESTORE_UPDATE_PROGRESS"},n,{restoreId:s,siteId:e,timestamp:t})}function k(e,t){return{type:"REWIND_BACKUP_REQUEST",siteId:e,rewindId:t}}function x(e){return{type:"REWIND_BACKUP_DISMISS",siteId:e}}function V(e,t,s){return{type:"REWIND_BACKUP",siteId:e,rewindId:t,args:s}}function G(e){return{type:"REWIND_BACKUP_PROGRESS_REQUEST",siteId:e}}function q(e,t,s){return a()({type:"REWIND_BACKUP_UPDATE_PROGRESS"},s,{downloadId:t,siteId:e})}function M(e,t,s){return a()({type:"REWIND_BACKUP_UPDATE_ERROR",siteId:e,downloadId:t},s)}function Q(e,t){return{type:"REWIND_BACKUP_DISMISS_PROGRESS",siteId:e,downloadId:t}}Object(u.b)("state/data-layer/wpcom/sites/rewind/restores",{REWIND_RESTORE_DISMISS_PROGRESS:[Object(o.a)({fetch:e=>Object(d.a)({method:"POST",apiNamespace:"wpcom/v2",path:"/sites/".concat(e.siteId,"/rewind/restores/").concat(e.restoreId),body:{dismissed:!0}},e),onSuccess:(e,t)=>t.dismissed?null:Object(c.b)(Object(r.translate)("Dismissing restore failed. Please reload and try again.")),onError:()=>null,fromApi:e=>({restoreId:parseInt(e.restore_id),dismissed:e.is_dismissed})})]}),s.d(t,"a",function(){return R}),s.d(t,"g",function(){return S}),s.d(t,"f",function(){return h}),s.d(t,"m",function(){return T}),s.d(t,"l",function(){return D}),s.d(t,"p",function(){return v}),s.d(t,"o",function(){return A}),s.d(t,"q",function(){return P}),s.d(t,"k",function(){return N}),s.d(t,"c",function(){return U}),s.d(t,"e",function(){return W}),s.d(t,"u",function(){return C}),s.d(t,"n",function(){return k}),s.d(t,"i",function(){return x}),s.d(t,"h",function(){return V}),s.d(t,"d",function(){return G}),s.d(t,"t",function(){return q}),s.d(t,"j",function(){return M}),s.d(t,"b",function(){return Q}),s.d(t,"r",function(){return B}),s.d(t,"s",function(){return K});const B=(e,t)=>({type:"ACTIVITY_LOG_FILTER_SET",siteId:e,filter:t}),K=(e,t)=>({type:"ACTIVITY_LOG_FILTER_UPDATE",siteId:e,filter:t})},"./client/state/data-layer/wpcom/sites/rewind/api-transformer.js":function(e,t,s){"use strict";s.d(t,"a",function(){return p});var n=s("./node_modules/lodash/lodash.js"),a=s("./client/state/data-layer/wpcom-http/actions.js"),r=s("./client/state/rewind/actions.js");const i=e=>Object.assign({type:e.type,role:e.role},e.host&&{host:e.host},e.path&&{path:e.path},e.port&&{port:e.port},e.user&&{user:e.user}),o=e=>Object.assign({downloadId:e.downloadId,rewindId:e.rewindId,backupPoint:new Date(1e3*e.backupPoint),startedAt:new Date(1e3*e.startedAt)},e.downloadCount&&{downloadCount:e.downloadCount},e.validUntil&&{validUntil:new Date(1e3*e.validUntil)}),d=e=>Object(a.a)({apiVersion:e.apiVersion,method:e.method,path:e.path,onSuccess:Object(r.a)(e.site_id),onFailure:Object(r.a)(e.site_id)}),c=e=>Object.assign({restoreId:e.restore_id,rewindId:e.rewind_id,startedAt:new Date(e.started_at),status:e.status},e.progress&&{progress:e.progress},e.reason&&{reason:e.reason},e.links&&e.links.dismiss&&{dismiss:d(e.links.dismiss)});function p(e){return Object.assign({state:Object(n.camelCase)(e.state),lastUpdated:new Date("string"==typeof e.last_updated?Date.parse(e.last_updated):1e3*e.last_updated)},e.can_autoconfigure&&{canAutoconfigure:!!e.can_autoconfigure},e.credentials&&{credentials:e.credentials.map(i)},e.downloads&&{downloads:e.downloads.map(o)},e.reason&&{reason:e.reason},e.rewind&&{rewind:c(e.rewind)})}},"./client/state/rewind/actions.js":function(e,t,s){"use strict";var n=s("./client/lib/make-json-schema-parser/index.js"),a=s("./client/state/data-layer/handler-registry.js"),r=s("./client/state/data-layer/wpcom-http/utils.js"),i=s("./client/state/data-layer/wpcom-http/actions.js"),o=s("./client/state/analytics/actions.js");const d={type:"object",properties:{still_valid:{type:"boolean"},type:{type:"string",enum:["auto","ftp","managed","ssh"]},host:{type:"string"},path:{type:"string"},port:{type:"integer"},role:{type:"string"}},required:["role","still_valid","type"]},c={allOf:[p("unavailable",{type:"object",properties:{state:{type:"string",pattern:"^unavailable$"},reason:{type:"string"},last_updated:{oneOf:[{type:"integer"},{type:"string",format:"date-time"}]}},required:["state","last_updated"]}),p("inactive",{type:"object",properties:{state:{type:"string",pattern:"^inactive$"},credentials:{type:"array",items:d},last_updated:{oneOf:[{type:"integer"},{type:"string",format:"date-time"}]}},required:["state","last_updated"]}),p("awaiting_credentials",{type:"object",properties:{state:{type:"string",pattern:"^awaiting_credentials$"},last_updated:{oneOf:[{type:"integer"},{type:"string",format:"date-time"}]}},required:["state","last_updated"]}),p("provisioning",{type:"object",properties:{state:{type:"string",pattern:"^provisioning$"},credentials:{type:"array",items:d},last_updated:{oneOf:[{type:"integer"},{type:"string",format:"date-time"}]}},required:["state","last_updated"]}),p("active",{type:"object",properties:{state:{type:"string",pattern:"^active$"},credentials:{type:"array",items:d},downloads:{type:"array",items:{type:"object",properties:{downloadId:{type:"integer"},rewindId:{type:"string"},backupPoint:{type:"integer"},startedAt:{type:"integer"},downloadCount:{type:"integer"},validUntil:{type:"integer"}},required:["downloadId","rewindId","backupPoint","startedAt"]}},rewind:{type:"object",properties:{links:{type:"object"},restore_id:{type:"integer"},rewind_id:{type:"string"},status:{type:"string",enum:["failed","finished","queued","running"]},started_at:{type:"string"},progress:{type:"integer"},reason:{type:"string"}},required:["restore_id","rewind_id","status"]},last_updated:{oneOf:[{type:"integer"},{type:"string",format:"date-time"}]}},required:["state","last_updated"]})]};function p(e,t){return{oneOf:[{not:{type:"object",properties:{state:{type:"string",pattern:"^".concat(e,"$")}},required:["state"]}},t]}}var u=s("./client/state/data-layer/wpcom/sites/rewind/api-transformer.js");const l=e=>e&&e.constructor&&e.constructor.name||typeof e;Object(a.b)("state/data-layer/wpcom/sites/rewind",{REWIND_STATE_REQUEST:[Object(r.a)({fetch:e=>Object(i.a)({apiNamespace:"wpcom/v2",method:"GET",path:"/sites/".concat(e.siteId,"/rewind"),query:{force:"wpcom"}},e),onSuccess:(e,t)=>{let s=e.siteId;const n={type:"REWIND_STATE_UPDATE",siteId:s,data:t};if(!t.rewind||"queued"!==t.rewind.status&&"running"!==t.rewind.status)return n;return[n,e=>setTimeout(()=>e(m(s)),3e3)]},onError:(e,t)=>{let s=e.siteId;const n=t.hasOwnProperty("status")?parseInt(t.status,10):null;return t.hasOwnProperty("code")&&t.hasOwnProperty("message")&&n&&n>=400?Object(o.k)(Object(o.i)("calypso_rewind_state_bad_response",{code:t.code,message:t.message,status:t.status}),{type:"REWIND_STATE_UPDATE",siteId:s,data:{state:"unavailable",reason:"unknown",lastUpdated:new Date}}):Object(o.k)(Object(o.i)("calypso_rewind_state_parse_error",{type:l(t),error:JSON.stringify(t)}),{type:"REWIND_STATE_UPDATE",siteId:s,data:{state:"unknown",lastUpdated:new Date}})},fromApi:Object(n.c)(c,u.a)})]}),s.d(t,"a",function(){return m});const m=e=>({type:"REWIND_STATE_REQUEST",siteId:e,meta:{dataLayer:{trackRequest:!0}}})}}]);