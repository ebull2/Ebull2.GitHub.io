(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{"./client/blocks/image-editor/index.jsx":function(e,t,o){"use strict";var s=o("./node_modules/@babel/runtime/helpers/objectSpread.js"),i=o.n(s),n=o("./node_modules/@babel/runtime/helpers/defineProperty.js"),a=o.n(n),r=o("./node_modules/prop-types/index.js"),d=o.n(r),p=o("./node_modules/react/index.js"),l=o.n(p),c=o("./node_modules/react-redux/es/index.js"),h=o("./node_modules/redux/es/redux.js"),m=o("./node_modules/lodash/lodash.js"),u=o("./node_modules/path-browserify/index.js"),g=o.n(u),b=o("./packages/i18n-calypso/dist/esm/index.js"),f=o("./node_modules/classnames/index.js"),v=o.n(f),E=o("./client/components/close-on-escape/index.jsx"),w=o("./client/components/notice/index.jsx"),C=o("./node_modules/react-dom/index.js"),x=o.n(C),D=o("./node_modules/@babel/runtime/helpers/extends.js"),R=o.n(D);class j extends p.Component{constructor(e){super(e),this.state={x:this.props.x,y:this.props.y},this.onTouchStartHandler=this.onTouchStartHandler.bind(this),this.onMouseDownHandler=this.onMouseDownHandler.bind(this),this.draggingHandler=this.draggingHandler.bind(this),this.draggingEndedHandler=this.draggingEndedHandler.bind(this),this.update=this.update.bind(this)}componentWillReceiveProps(e){this.state.x===e.x&&this.state.y===e.y||this.setState({x:e.x,y:e.y})}componentWillUnmount(){this.removeListeners()}draggingStartedHandler(e){this.dragging=!0;let t=e;this.isTouchEvent(e)&&(t=e.touches[0]),this.relativePos={x:t.pageX-this.state.x,y:t.pageY-this.state.y},cancelAnimationFrame(this.frameRequestId),this.frameRequestId=requestAnimationFrame(this.update)}isTouchEvent(e){return(!e.pageX||!e.pageY)&&e.targetTouches&&e.targetTouches.length}draggingHandler(e){let t=e;this.isTouchEvent(e)&&(t=e.touches[0]);const o=t.pageX-this.relativePos.x,s=t.pageY-this.relativePos.y;this.mousePos={x:o,y:s}}draggingEndedHandler(){this.dragging=!1,this.mousePos=null,cancelAnimationFrame(this.frameRequestId),this.removeListeners(),this.props.onStop()}onTouchStartHandler(e){e.preventDefault(),document.addEventListener("touchmove",this.draggingHandler),document.addEventListener("touchend",this.draggingEndedHandler),this.draggingStartedHandler(e)}onMouseDownHandler(e){e.preventDefault(),document.addEventListener("mousemove",this.draggingHandler),document.addEventListener("mouseup",this.draggingEndedHandler),this.draggingStartedHandler(e)}update(){if(!this.mousePos)return void(this.frameRequestId=requestAnimationFrame(this.update));const e=this.props.bounds;let t=this.mousePos,o=t.x,s=t.y;e&&(o=Math.max(e.left,Math.min(e.right-this.props.width,o)),s=Math.max(e.top,Math.min(e.bottom-this.props.height,s))),this.dragging&&(this.frameRequestId=requestAnimationFrame(this.update)),this.props.onDrag(o,s),this.props.controlled||this.setState({x:o,y:s})}removeListeners(){document.removeEventListener("mousemove",this.draggingHandler),document.removeEventListener("mouseup",this.draggingEndedHandler),document.removeEventListener("touchmove",this.draggingHandler),document.removeEventListener("touchend",this.draggingEndedHandler)}render(){const e=Object(m.omit)(this.props,Object.keys(this.constructor.propTypes)),t={transform:"translate("+this.state.x+"px, "+this.state.y+"px)"};return(this.props.width||this.props.height)&&(t.width=this.props.width+"px",t.height=this.props.height+"px"),l.a.createElement("div",R()({},e,{style:t,onMouseDown:this.onMouseDownHandler,onTouchStart:this.onTouchStartHandler}))}}a()(j,"propTypes",{onDrag:d.a.func,onStop:d.a.func,width:d.a.number,height:d.a.number,x:d.a.number,y:d.a.number,controlled:d.a.bool,bounds:d.a.shape({top:d.a.number,left:d.a.number,bottom:d.a.number,right:d.a.number})}),a()(j,"defaultProps",{onDrag:m.noop,onStop:m.noop,width:0,height:0,x:0,y:0,controlled:!1,bounds:null});var y=o("./client/state/ui/editor/image-editor/selectors.js"),O=o("./client/state/ui/editor/image-editor/constants.js"),_=o("./client/state/ui/editor/image-editor/actions.js"),S=o("./client/state/ui/editor/image-editor/reducer.js");function I(e){return Object(m.get)(e,"ui.editor.imageEditor.originalAspectRatio",null)}class N extends p.Component{constructor(e){super(e),this.state=this.getDefaultState(e),this.onTopLeftDrag=this.onTopLeftDrag.bind(this),this.onTopRightDrag=this.onTopRightDrag.bind(this),this.onBottomLeftDrag=this.onBottomLeftDrag.bind(this),this.onBottomRightDrag=this.onBottomRightDrag.bind(this),this.applyCrop=this.applyCrop.bind(this),this.onBorderDrag=this.onBorderDrag.bind(this)}getDefaultState(e){return{top:e.bounds.topBound,left:e.bounds.leftBound,bottom:e.bounds.bottomBound,right:e.bounds.rightBound}}componentWillMount(){this.updateCrop(this.getDefaultState(this.props),this.props,this.applyComputedCrop)}componentWillReceiveProps(e){const t=this.props,o=t.bounds,s=t.aspectRatio,i=t.crop;if(!Object(m.isEqual)(o,e.bounds)){const t=e.bounds.rightBound-e.bounds.leftBound,o=e.bounds.bottomBound-e.bounds.topBound,s=e.bounds.topBound+e.crop.topRatio*o,i=e.bounds.leftBound+e.crop.leftRatio*t,n={top:s,left:i,bottom:s+e.crop.heightRatio*o,right:i+e.crop.widthRatio*t};this.setState(n),this.updateCrop(n)}s!==e.aspectRatio&&this.updateCrop(this.getDefaultState(e),e,this.applyCrop),e.imageEditorHasChanges||!Object(m.isEqual)(e.crop,S.b)||Object(m.isEqual)(i,e.crop)||this.updateCrop(this.getDefaultState(e),e,this.applyComputedCrop)}updateCrop(e,t,o){const s=(t=t||this.props).aspectRatio;if(s===O.a.FREE)return void this.setState(e,o);const i=t.degrees%180!=0,n=Object.assign({},this.state,e),a=n.right-n.left,r=n.bottom-n.top;let d,p,l=a,c=r;switch(s){case O.a.ORIGINAL:if(!this.props.originalAspectRatio)return void this.setState(e,o);const t=this.props.originalAspectRatio,n=t.width,a=t.height;d=i?a:n,p=i?n:a;break;case O.a.ASPECT_1X1:d=1,p=1;break;case O.a.ASPECT_16X9:d=i?9:16,p=i?16:9;break;case O.a.ASPECT_4X3:d=i?3:4,p=i?4:3;break;case O.a.ASPECT_3X2:d=i?2:3,p=i?3:2}const h=Math.min(a/d,r/p);l=d*h,c=p*h,e.hasOwnProperty("top")?e.top=n.bottom-c:e.hasOwnProperty("bottom")&&(e.bottom=n.top+c),e.hasOwnProperty("left")?e.left=n.right-l:e.hasOwnProperty("right")&&(e.right=n.left+l),this.setState(e,o)}onTopLeftDrag(e,t){const o=this.state,s=o.right,i=o.bottom,n=this.props.minCropSize;let a=t,r=e;s-r<=n.width&&(r=s-n.width),i-a<=n.height&&(a=i-n.height),this.updateCrop({top:a,left:r})}onTopRightDrag(e,t){const o=this.state,s=o.left,i=o.bottom,n=this.props.minCropSize;let a=t,r=e;r-s<=n.width&&(r=s+n.width),i-a<=n.height&&(a=i-n.height),this.updateCrop({top:a,right:r})}onBottomRightDrag(e,t){const o=this.state,s=o.left,i=o.top,n=this.props.minCropSize;let a=t,r=e;r-s<=n.width&&(r=s+n.width),a-i<=n.height&&(a=i+n.height),this.updateCrop({bottom:a,right:r})}onBottomLeftDrag(e,t){const o=this.state,s=o.right,i=o.top,n=this.props.minCropSize;let a=t,r=e;s-r<=n.width&&(r=s-n.width),a-i<=n.height&&(a=i+n.height),this.updateCrop({bottom:a,left:r})}onBorderDrag(e,t){const o=this.state,s=o.top,i=o.left,n=o.right-i,a=o.bottom-s;this.setState({top:t,left:e,bottom:t+a,right:e+n})}getCropBounds(){const e=this.state,t=e.top,o=e.left,s=e.right,i=e.bottom,n=this.props.bounds,a=n.topBound,r=n.leftBound,d=t-a,p=o-r,l=s-o,c=i-t,h=n.rightBound-r;let m=n.bottomBound-a;const u=this.props.degrees%180!=0;if(this.props.originalAspectRatio){const e=this.props.originalAspectRatio,t=e.width,o=e.height;m=h*((u?t:o)/(u?o:t))}return[d/m,p/h,l/h,c/m]}applyCrop(){this.props.imageEditorCrop(...this.getCropBounds())}applyComputedCrop(){this.props.imageEditorComputedCrop(...this.getCropBounds())}render(){const e=this.state,t=e.top,o=e.left,s=e.right,i=e.bottom,n=s-o,a=i-t,r="image-editor__crop-handle",d=this.props.bounds,p=d.topBound,c=d.leftBound,h=d.rightBound,m=d.bottomBound;return l.a.createElement("div",null,l.a.createElement("div",{className:"image-editor__crop-background",style:{top:p+"px",left:o+"px",width:n+"px",height:Math.max(0,t-p)+"px"}}),l.a.createElement("div",{className:"image-editor__crop-background",style:{top:p+"px",left:c+"px",width:Math.max(0,o-c)+"px",height:Math.max(0,m-p)+"px"}}),l.a.createElement("div",{className:"image-editor__crop-background",style:{top:i+"px",left:o+"px",width:n+"px",height:Math.max(0,m-i)+"px"}}),l.a.createElement("div",{className:"image-editor__crop-background",style:{top:p+"px",left:s+"px",width:Math.max(0,h-s)+"px",height:Math.max(0,m-p)+"px"}}),l.a.createElement(j,{ref:"border",onDrag:this.onBorderDrag,onStop:this.applyCrop,x:o,y:t,width:n,height:a,bounds:{top:p,left:c,bottom:m,right:h},className:"image-editor__crop"}),l.a.createElement(j,{onDrag:this.onTopLeftDrag,onStop:this.applyCrop,x:o,y:t,controlled:!0,bounds:{bottom:i,right:s,top:p,left:c},ref:"topLeft",className:v()(r,r+"-nwse")}),l.a.createElement(j,{onDrag:this.onTopRightDrag,onStop:this.applyCrop,y:t,x:s,controlled:!0,bounds:{bottom:i,left:o,top:p,right:h},ref:"topRight",className:v()(r,r+"-nesw")}),l.a.createElement(j,{onDrag:this.onBottomRightDrag,onStop:this.applyCrop,y:i,x:s,controlled:!0,bounds:{top:t,left:o,bottom:m,right:h},ref:"bottomRight",className:v()(r,r+"-nwse")}),l.a.createElement(j,{onDrag:this.onBottomLeftDrag,onStop:this.applyCrop,y:i,x:o,controlled:!0,bounds:{top:t,right:s,bottom:m,left:c},ref:"bottomLeft",className:v()(r,r+"-nesw")}))}}a()(N,"propTypes",{degrees:d.a.number,bounds:d.a.shape({topBound:d.a.number,leftBound:d.a.number,bottomBound:d.a.number,rightBound:d.a.number}),crop:d.a.shape({topRatio:d.a.number,leftRatio:d.a.number,widthRatio:d.a.number,heightRatio:d.a.number}),aspectRatio:d.a.string,imageEditorCrop:d.a.func,imageEditorComputedCrop:d.a.func,minCropSize:d.a.shape({width:d.a.number,height:d.a.number}),imageEditorHasChanges:d.a.bool}),a()(N,"defaultProps",{degrees:0,bounds:{topBound:0,leftBound:0,bottomBound:100,rightBound:100},imageEditorCrop:m.noop,imageEditorComputedCrop:m.noop,minCropSize:{width:50,height:50},imageEditorHasChanges:!1});var T=Object(c.b)(e=>{return{bounds:Object(y.c)(e),crop:Object(y.b)(e),aspectRatio:Object(y.a)(e),degrees:Object(y.e)(e).degrees,originalAspectRatio:I(e),imageEditorHasChanges:Object(y.f)(e)}},{imageEditorCrop:_.b,imageEditorComputedCrop:_.a})(N),A=o("./client/lib/media/utils.js");function P(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:O.c.WIDTH,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:O.c.HEIGHT;const s=I(e);if(s){const e=s.width,i=s.height;if(Object(m.isInteger)(e)&&Object(m.isInteger)(i)&&e>t&&i>o)return!0}return!1}class L extends p.Component{constructor(e){super(e),a()(this,"frameRateInterval",1e3/30),a()(this,"requestAnimationFrameId",null),a()(this,"lastTimestamp",null),a()(this,"onWindowResize",()=>{this.requestAnimationFrameId=window.requestAnimationFrame(this.updateCanvasPosition)}),this.onLoadComplete=this.onLoadComplete.bind(this),this.updateCanvasPosition=this.updateCanvasPosition.bind(this),this.isVisible=!1}componentDidMount(){this.isVisible=!0}componentWillReceiveProps(e){this.props.src!==e.src&&this.getImage(e.src)}isBlobSrc(e){return Object(m.startsWith)(e,"blob")}getImage(e){const t=this.props,o=t.onLoadError,s=t.mimeType,i=new XMLHttpRequest;this.isBlobSrc(e)||(e+="?"),i.open("GET",e,!0),i.responseType="arraybuffer",i.onload=(()=>{if(!this.isVisible)return;const e=window.URL.createObjectURL(new Blob([i.response],{type:s}));this.initImage(e)}),i.onerror=(e=>o(e)),i.send()}initImage(e){this.image=new Image,this.image.src=e,this.image.onload=this.onLoadComplete,this.image.onerror=this.onLoadComplete}onLoadComplete(e){"load"===e.type&&this.isVisible&&(this.drawImage(),this.updateCanvasPosition(),"undefined"!=typeof window&&(this.lastTimestamp=window.performance.now(),window.addEventListener("resize",this.onWindowResize)),this.props.setImageEditorImageHasLoaded(this.image.width,this.image.height))}componentWillUnmount(){"undefined"!=typeof window&&this.onWindowResize&&(window.removeEventListener("resize",this.onWindowResize),window.cancelAnimationFrame(this.requestAnimationFrameId)),this.isVisible=!1}componentDidUpdate(){this.drawImage(),this.updateCanvasPosition()}toBlob(e){const t=this.props.crop,o=t.leftRatio,s=t.topRatio,i=t.widthRatio,n=t.heightRatio,a=this.props,r=a.mimeType,d=a.transform,p=x.a.findDOMNode(this.refs.canvas).getContext("2d"),l=d.degrees%180!=0,c=l?this.image.height:this.image.width,h=l?this.image.width:this.image.height,m=o*c,u=s*h,g=i*c,b=n*h,f=p.getImageData(m,u,g,b),v=document.createElement("canvas");v.width=g,v.height=b,v.getContext("2d").putImageData(f,0,0),Object(A.b)(v,e,r,1)}drawImage(){if(!this.image)return;const e=x.a.findDOMNode(this.refs.canvas),t=this.image.width,o=this.image.height,s=this.props.transform,i=s.degrees%180!=0;e.width=i?o:t,e.height=i?t:o;const n=e.getContext("2d");n.clearRect(0,0,e.width,e.height),n.save(),n.setTransform(1,0,0,1,e.width/2,e.height/2),n.scale(s.scaleX,s.scaleY),n.rotate(s.degrees*Math.PI/180),n.drawImage(this.image,-t/2,-o/2),n.restore()}updateCanvasPosition(e){const t=e,o=t-this.lastTimestamp;if(o<this.frameRateInterval)return;this.lastTimestamp=t-o%this.frameRateInterval;const s=this.props.crop,i=s.leftRatio,n=s.topRatio,a=s.widthRatio,r=s.heightRatio,d=x.a.findDOMNode(this.refs.canvas),p=-50*a-100*i,l=-50*r-100*n,c=d.offsetTop,h=d.offsetLeft,m=d.offsetWidth,u=d.offsetHeight;this.props.setImageEditorCropBounds(c-u*-l/100,h-m*-p/100,c+u*(1+l/100),h+m*(1+p/100))}preventDrag(e){return e.preventDefault(),!1}render(){const e=this.props.crop,t=e.leftRatio,o=e.topRatio,s=e.widthRatio,i=e.heightRatio,n=this.props,a=n.isImageLoaded,r=n.showCrop,d={transform:"translate("+(-50*s-100*t)+"%, "+(-50*i-100*o)+"%)",maxWidth:85/s+"%",maxHeight:85/i+"%"},p=v()("image-editor__canvas",{"is-placeholder":!a});return l.a.createElement("div",{className:"image-editor__canvas-container"},l.a.createElement("canvas",{ref:"canvas",style:d,onMouseDown:this.preventDrag,className:p}),r&&l.a.createElement(T,null))}}a()(L,"propTypes",{src:d.a.string,mimeType:d.a.string,transform:d.a.shape({degrees:d.a.number,scaleX:d.a.number,scaleY:d.a.number}),crop:d.a.shape({topRatio:d.a.number,leftRatio:d.a.number,widthRatio:d.a.number,heightRatio:d.a.number}),setImageEditorCropBounds:d.a.func,setImageEditorImageHasLoaded:d.a.func,onLoadError:d.a.func,isImageLoaded:d.a.bool,showCrop:d.a.bool}),a()(L,"defaultProps",{transform:{degrees:0,scaleX:1,scaleY:1},crop:{cropTopRatio:0,cropLeftRatio:0,cropWidthRatio:1,cropHeightRatio:1},setImageEditorCropBounds:m.noop,setImageEditorImageHasLoaded:m.noop,onLoadError:m.noop,isImageLoaded:!1,showCrop:!0});var B=Object(c.b)(e=>{const t=Object(y.e)(e),o=Object(y.d)(e),s=o.src,i=o.mimeType,n=Object(y.b)(e),a=Object(y.g)(e),r=P(e);return{src:s,mimeType:i,transform:t,crop:n,isImageLoaded:a,showCrop:!(!a||!r)}},{setImageEditorCropBounds:_.h,setImageEditorImageHasLoaded:_.k},null,{withRef:!0})(L),k=o("./client/components/gridicon/index.jsx"),H=o("./client/components/popover/menu.jsx"),M=o("./client/components/popover/menu-item.jsx");class F extends p.Component{constructor(e){super(e),this.state={showAspectPopover:!1},this.setAspectMenuContext=this.setAspectMenuContext.bind(this),this.onAspectOpen=this.onAspectOpen.bind(this),this.onAspectClose=this.onAspectClose.bind(this),this.rotate=this.rotate.bind(this),this.flip=this.flip.bind(this)}rotate(){this.props.imageEditorRotateCounterclockwise()}flip(){this.props.imageEditorFlip()}onAspectOpen(e){e.preventDefault();const t=this.props,o=t.isAspectRatioDisabled,s=t.onShowNotice,i=t.translate;if(o){s(i("To change the aspect ratio, the height and width must be bigger than {{strong}}%(width)dpx{{/strong}}.",{args:{width:O.c.WIDTH,height:O.c.HEIGHT},components:{strong:l.a.createElement("strong",null)}}))}else this.setState({showAspectPopover:!0})}onAspectClose(e){this.setState({showAspectPopover:!1}),"string"==typeof e&&this.props.setImageEditorAspectRatio(e)}setAspectMenuContext(e){this.setState({popoverContext:e})}renderAspectMenu(){const e=this.state,t=e.popoverContext,o=e.showAspectPopover,s=this.props,i=s.translate,n=s.aspectRatio,a=s.allowedAspectRatios;if(!t||1===a.length)return;const r=[{action:O.a.FREE,label:i("Free")},{action:O.a.ORIGINAL,label:i("Original")},{action:O.a.ASPECT_1X1,label:i("Square")},{action:O.a.ASPECT_16X9,label:i("16:9")},{action:O.a.ASPECT_4X3,label:i("4:3")},{action:O.a.ASPECT_3X2,label:i("3:2")}];return l.a.createElement(H.a,{isVisible:o,onClose:this.onAspectClose,position:"top",context:t,className:"image-editor__toolbar-popover popover is-dialog-visible"},r.map(e=>-1!==a.indexOf(e.action)?l.a.createElement(M.a,{key:"image-editor-toolbar-aspect-"+e.action,action:e.action},n===e.action&&l.a.createElement(k.a,{icon:"checkmark",size:12}),e.label):null))}renderButtons(){const e=this.props,t=e.translate,o=e.allowedAspectRatios,s=e.isAspectRatioDisabled;return[{tool:"rotate",icon:"rotate",text:t("Rotate"),onClick:this.rotate},1===o.length?null:{tool:"aspect",ref:this.setAspectMenuContext,icon:"crop",text:t("Crop"),onClick:this.onAspectOpen,disabled:s},{tool:"flip-vertical",icon:"flip-vertical",text:t("Flip"),onClick:this.flip}].map(e=>{const t=v()("image-editor__toolbar-button",{"is-disabled":e&&e.disabled});return e?l.a.createElement("button",{key:"image-editor-toolbar-"+e.tool,ref:e.ref,className:t,onClick:e.onClick},l.a.createElement(k.a,{icon:e.icon}),l.a.createElement("span",null,e.text)):null})}render(){return l.a.createElement("div",{className:"image-editor__toolbar"},this.renderButtons(),this.renderAspectMenu())}}a()(F,"propTypes",{aspectRatio:d.a.string,imageEditorRotateCounterclockwise:d.a.func,imageEditorFlip:d.a.func,setImageEditorAspectRatio:d.a.func,allowedAspectRatios:d.a.array,onShowNotice:d.a.func,isAspectRatioDisabled:d.a.bool}),a()(F,"defaultProps",{imageEditorRotateCounterclockwise:m.noop,imageEditorFlip:m.noop,setImageEditorAspectRatio:m.noop,allowedAspectRatios:Object(m.values)(O.a),onShowNotice:m.noop,isAspectRatioDisabled:!1});var z=Object(c.b)(e=>{return{aspectRatio:Object(y.a)(e),isAspectRatioDisabled:!P(e)}},{imageEditorRotateCounterclockwise:_.d,imageEditorFlip:_.c,setImageEditorAspectRatio:_.g})(Object(b.localize)(F)),W=o("./client/components/button/index.jsx");class q extends p.Component{render(){const e=this.props,t=e.hasChanges,o=e.onCancel,s=e.src,i=e.onDone,n=e.onReset,a=e.translate,r=e.doneButtonText;return l.a.createElement("div",{className:"image-editor__buttons"},o&&l.a.createElement(W.a,{className:"image-editor__buttons-button",onClick:o,"data-e2e-button":"cancel"},a("Cancel")),l.a.createElement(W.a,{className:"image-editor__buttons-button",disabled:!t,onClick:n,"data-e2e-button":"reset"},a("Reset")),l.a.createElement(W.a,{className:"image-editor__buttons-button",disabled:!s,primary:!0,onClick:i,"data-e2e-button":"done","data-tip-target":"image-editor-button-done"},r||a(" Done ")))}}a()(q,"propTypes",{src:d.a.string,hasChanges:d.a.bool,resetImageEditorState:d.a.func,onDone:d.a.func,onCancel:d.a.func,onReset:d.a.func,doneButtonText:d.a.string}),a()(q,"defaultProps",{src:"",hasChanges:!1,resetImageEditorState:m.noop,onDone:m.noop,onCancel:m.noop,onReset:m.noop,doneButtonText:""});var V=Object(c.b)(e=>{return{src:Object(y.d)(e).src,hasChanges:Object(y.f)(e)}})(Object(b.localize)(q)),Z=o("./client/state/ui/selectors.js"),X=o("./client/state/sites/selectors.js"),U=o("./client/components/data/query-sites/index.jsx");function Y(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:O.b;return Object(m.includes)(t,e)||(e=Object(m.get)(t,"0",O.a.FREE)),Object(m.includes)(O.b,e)?e:Y(e)}o("./client/blocks/image-editor/style.scss");class G extends l.a.Component{constructor(){var e;super(...arguments),e=this,a()(this,"state",{noticeText:null,noticeStatus:"is-info"}),a()(this,"editCanvasRef",l.a.createRef()),a()(this,"setDefaultAspectRatio",()=>{const e=this.props,t=e.defaultAspectRatio,o=e.allowedAspectRatios;this.props.setImageEditorDefaultAspectRatio(Y(t,o))}),a()(this,"updateFileInfo",e=>{const t=this.props.site;let o,s="default",i="image/png",n="default";e&&(o=e.src||Object(A.s)(e,{photon:t&&!t.is_private}),s=e.file||g.a.basename(o),i=Object(A.h)(e)||i,n=e.title||n),this.props.resetImageEditorState(),this.props.setImageEditorFileInfo(o,s,i,n)}),a()(this,"convertBlobToImage",e=>{const t=this.props.onDone,o=document.createElement("img"),s=URL.createObjectURL(e),n=this.getImageEditorProps();o.onload=(()=>{URL.revokeObjectURL(s),t(null,e,i()({},n,{width:o.width,height:o.height}))}),o.onerror=(()=>{t(null,e,n)}),o.src=s}),a()(this,"onDone",()=>{const e=this.props,t=e.isImageLoaded,o=e.onDone;t?this.editCanvasRef.current.getWrappedInstance().toBlob(this.convertBlobToImage):o(new Error("Image not loaded yet."),null,this.getImageEditorProps())}),a()(this,"onCancel",()=>{this.props.onCancel(this.getImageEditorProps())}),a()(this,"onReset",()=>{this.props.resetImageEditorState(),this.props.onReset(this.getImageEditorProps())}),a()(this,"getImageEditorProps",()=>{const e=this.props,t=e.src,o=e.fileName,s=e.media,i={src:t,fileName:o,mimeType:e.mimeType,title:e.title,site:e.site,resetAllImageEditorState:this.props.resetAllImageEditorState};return s&&s.ID&&(i.ID=s.ID),i}),a()(this,"showNotice",function(t){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"is-info";e.setState({noticeText:t,noticeStatus:o})}),a()(this,"clearNoticeState",()=>{this.setState({noticeText:null,noticeStatus:"is-info"})}),a()(this,"renderNotice",()=>{if(!this.state.noticeText)return null;const e="is-info"===this.state.noticeStatus;return l.a.createElement(w.b,{status:this.state.noticeStatus,showDismiss:e,text:this.state.noticeText,isCompact:!1,onDismissClick:this.clearNoticeState,className:"image-editor__notice"})}),a()(this,"onLoadCanvasError",()=>{const e=this.props.translate;this.showNotice(e("Sorry, there was a problem loading the image. Please close this editor and try selecting the image again."),"is-error")})}componentWillReceiveProps(e){const t=this.props.media;e.media&&!Object(m.isEqual)(e.media,t)&&(this.props.resetAllImageEditorState(),this.updateFileInfo(e.media),this.setDefaultAspectRatio())}componentDidMount(){this.updateFileInfo(this.props.media),this.setDefaultAspectRatio()}render(){const e=this.props,t=e.className,o=e.siteId,s=e.allowedAspectRatios,i=this.state.noticeText,n=v()("image-editor",t);return l.a.createElement("div",{className:n},i&&this.renderNotice(),l.a.createElement(E.a,{onEscape:this.onCancel}),l.a.createElement(U.a,{siteId:o}),l.a.createElement("figure",null,l.a.createElement("div",{className:"image-editor__content"},l.a.createElement(B,{ref:this.editCanvasRef,onLoadError:this.onLoadCanvasError}),l.a.createElement(z,{onShowNotice:this.showNotice,allowedAspectRatios:s}),l.a.createElement(V,{onCancel:this.props.onCancel&&this.onCancel,onDone:this.onDone,onReset:this.onReset,doneButtonText:this.props.doneButtonText}))))}}a()(G,"propTypes",{media:d.a.object,siteId:d.a.number,onDone:d.a.func,onCancel:d.a.func,onReset:d.a.func,className:d.a.string,defaultAspectRatio:d.a.oneOf(O.b),allowedAspectRatios:d.a.arrayOf(d.a.oneOf(O.b)),site:d.a.object,fileName:d.a.string,setImageEditorFileInfo:d.a.func,setImageEditorDefaultAspectRatio:d.a.func,translate:d.a.func,isImageLoaded:d.a.bool}),a()(G,"defaultProps",{media:null,onDone:m.noop,onCancel:null,onReset:m.noop,isImageLoaded:!1,defaultAspectRatio:O.a.FREE,allowedAspectRatios:O.b,setImageEditorDefaultAspectRatio:m.noop});t.a=Object(c.b)((e,t)=>{let o=t.siteId;return o||(o=Object(Z.e)(e)),i()({},Object(y.d)(e),{site:Object(X.k)(e,o),isImageLoaded:Object(y.g)(e)})},(e,t)=>{const o={aspectRatio:Y(t.defaultAspectRatio,t.allowedAspectRatios)};return Object(h.b)({setImageEditorFileInfo:_.j,setImageEditorDefaultAspectRatio:_.i,resetImageEditorState:Object(m.partial)(_.f,o),resetAllImageEditorState:Object(m.partial)(_.e,o)},e)})(Object(b.localize)(G))},"./client/blocks/image-editor/style.scss":function(e,t,o){},"./client/components/drop-zone/index.jsx":function(e,t,o){"use strict";var s=o("./node_modules/@babel/runtime/helpers/defineProperty.js"),i=o.n(s),n=o("./node_modules/react-dom/index.js"),a=o.n(n),r=o("./node_modules/react/index.js"),d=o.n(r),p=o("./node_modules/prop-types/index.js"),l=o.n(p),c=o("./node_modules/react-redux/es/index.js"),h=o("./node_modules/classnames/index.js"),m=o.n(h),u=o("./client/components/gridicon/index.jsx"),g=o("./packages/i18n-calypso/dist/esm/index.js"),b=o("./node_modules/lodash/lodash.js"),f=o("./client/components/root-child/index.jsx");var v=o("./client/components/translatable/proptype.js");class E extends d.a.Component{constructor(){super(...arguments),i()(this,"state",{isDraggingOverDocument:!1,isDraggingOverElement:!1,lastVisibleState:!1}),i()(this,"resetDragState",()=>{(this.state.isDraggingOverDocument||this.state.isDraggingOverElement)&&(this.setState({isDraggingOverDocument:!1,isDraggingOverElement:!1}),this.toggleDropZoneReduxState(!1))}),i()(this,"toggleMutationObserver",()=>{this.disconnectMutationObserver(),this.state.isDraggingOverDocument&&(this.observer=new window.MutationObserver(this.detectNodeRemoval),this.observer.observe(document.body,{childList:!0,subtree:!0}))}),i()(this,"disconnectMutationObserver",()=>{this.observer&&(this.observer.disconnect(),delete this.observer)}),i()(this,"detectNodeRemoval",e=>{e.forEach(e=>{e.removedNodes.length&&(this.dragEnterNodes=Object(b.without)(this.dragEnterNodes,Array.from(e.removedNodes)))})}),i()(this,"toggleDraggingOverDocument",e=>{"dragenter"!==e.type||Object(b.includes)(this.dragEnterNodes,e.target)?"dragleave"===e.type&&(this.dragEnterNodes=Object(b.without)(this.dragEnterNodes,e.target)):this.dragEnterNodes.push(e.target);const t=window.CustomEvent&&e instanceof window.CustomEvent?e.detail:e,o=this.props.onVerifyValidTransfer(t.dataTransfer)&&this.dragEnterNodes.length;this.setState({isDraggingOverDocument:o,isDraggingOverElement:o&&(this.props.fullScreen||this.isWithinZoneBounds(t.clientX,t.clientY))}),window.CustomEvent&&e instanceof window.CustomEvent&&(this.dragEnterNodes=Object(b.without)(this.dragEnterNodes,window)),this.toggleDropZoneReduxState(!(!this.state.isDraggingOverDocument&&!this.state.isDraggingOverElement))}),i()(this,"toggleDropZoneReduxState",e=>{this.state.lastVisibleState!==e&&(e?this.props.showDropZone(this.props.dropZoneName):this.props.hideDropZone(this.props.dropZoneName),this.setState({lastVisibleState:e}))}),i()(this,"preventDefault",e=>{e.preventDefault()}),i()(this,"isWithinZoneBounds",(e,t)=>{if(!this.refs.zone)return!1;const o=this.refs.zone.getBoundingClientRect();return o.bottom!==o.top&&o.left!==o.right&&(e>=o.left&&e<=o.right&&t>=o.top&&t<=o.bottom)}),i()(this,"onDrop",e=>{e.dataTransfer&&e.dataTransfer.files.length,this.resetDragState(),e.preventDefault(),(this.props.fullScreen||a.a.findDOMNode(this.refs.zone).contains(e.target))&&(this.props.onDrop(e),this.props.onVerifyValidTransfer(e.dataTransfer)&&(e.dataTransfer&&this.props.onFilesDrop(Array.prototype.slice.call(e.dataTransfer.files)),e.stopPropagation()))}),i()(this,"renderContent",()=>{const e=this.props.textLabel?this.props.textLabel:this.props.translate("Drop files to upload");return d.a.createElement("div",{className:"drop-zone__content"},this.props.children?this.props.children:d.a.createElement("div",null,d.a.createElement("span",{className:"drop-zone__content-icon"},this.props.icon),d.a.createElement("span",{className:"drop-zone__content-text"},e)))})}componentDidMount(){this.dragEnterNodes=[],window.addEventListener("dragover",this.preventDefault),window.addEventListener("drop",this.onDrop),window.addEventListener("dragenter",this.toggleDraggingOverDocument),window.addEventListener("dragleave",this.toggleDraggingOverDocument),window.addEventListener("mouseup",this.resetDragState)}componentDidUpdate(e,t){t.isDraggingOverDocument!==this.state.isDraggingOverDocument&&this.toggleMutationObserver()}componentWillUnmount(){window.removeEventListener("dragover",this.preventDefault),window.removeEventListener("drop",this.onDrop),window.removeEventListener("dragenter",this.toggleDraggingOverDocument),window.removeEventListener("dragleave",this.toggleDraggingOverDocument),window.removeEventListener("mouseup",this.resetDragState),this.disconnectMutationObserver()}render(){const e=m()("drop-zone",this.props.className,{"is-active":this.state.isDraggingOverDocument||this.state.isDraggingOverElement,"is-dragging-over-document":this.state.isDraggingOverDocument,"is-dragging-over-element":this.state.isDraggingOverElement,"is-full-screen":this.props.fullScreen}),t=d.a.createElement("div",{ref:"zone",className:e},this.renderContent());return this.props.fullScreen?d.a.createElement(f.a,null,t):t}}i()(E,"propTypes",{className:l.a.string,fullScreen:l.a.bool,icon:l.a.node,onDrop:l.a.func,onVerifyValidTransfer:l.a.func,onFilesDrop:l.a.func,textLabel:v.a,translate:l.a.func,showDropZone:l.a.func.isRequired,hideDropZone:l.a.func.isRequired,dropZoneName:l.a.string}),i()(E,"defaultProps",{className:null,onDrop:b.noop,onVerifyValidTransfer:()=>!0,onFilesDrop:b.noop,fullScreen:!1,icon:d.a.createElement(u.a,{icon:"cloud-upload",size:48}),translate:b.identity,dropZoneName:null});const w={showDropZone:function(){return{type:"DROPZONE_SHOW",dropZoneName:arguments.length>0&&void 0!==arguments[0]?arguments[0]:null}},hideDropZone:function(e){return{type:"DROPZONE_HIDE",dropZoneName:e}}};t.a=Object(c.b)(null,w)(Object(g.localize)(E))},"./client/components/file-picker/index.jsx":function(e,t,o){"use strict";o.d(t,"a",function(){return l});var s=o("./node_modules/prop-types/index.js"),i=o.n(s),n=o("./node_modules/react/index.js"),a=o.n(n),r=o("./node_modules/lodash/lodash.js"),d=o("./node_modules/component-file-picker/index.js"),p=o.n(d);class l extends a.a.Component{constructor(e){super(e),this.showPicker=this.showPicker.bind(this)}showPicker(){this.props.onClick(),p()(Object(r.assign)({},this.props),this.props.onPick)}render(){return a.a.createElement("span",{className:"file-picker",onClick:this.showPicker},this.props.children)}}l.displayName="FilePicker",l.propTypes={multiple:i.a.bool,directory:i.a.bool,accept:i.a.string,onClick:i.a.func,onPick:i.a.func},l.defaultProps={multiple:!1,directory:!1,accept:null,onClick:r.noop,onPick:r.noop}},"./client/components/forms/form-checkbox/index.jsx":function(e,t,o){"use strict";var s=o("./node_modules/@babel/runtime/helpers/extends.js"),i=o.n(s),n=o("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),a=o.n(n),r=o("./node_modules/react/index.js"),d=o.n(r),p=o("./node_modules/classnames/index.js"),l=o.n(p);t.a=(e=>{let t=e.className,o=a()(e,["className"]);return d.a.createElement("input",i()({},o,{type:"checkbox",className:l()(t,"form-checkbox")}))})},"./client/components/forms/form-textarea/index.jsx":function(e,t,o){"use strict";var s=o("./node_modules/@babel/runtime/helpers/extends.js"),i=o.n(s),n=o("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),a=o.n(n),r=o("./node_modules/react/index.js"),d=o.n(r),p=o("./node_modules/classnames/index.js"),l=o.n(p);t.a=(e=>{let t=e.className,o=e.isError,s=e.isValid,n=e.children,r=a()(e,["className","isError","isValid","children"]);return d.a.createElement("textarea",i()({},r,{className:l()(t,"form-textarea",{"is-error":o,"is-valid":s})}),n)})},"./client/components/popover/menu.jsx":function(e,t,o){"use strict";var s=o("./node_modules/@babel/runtime/helpers/defineProperty.js"),i=o.n(s),n=o("./node_modules/react/index.js"),a=o.n(n),r=o("./node_modules/prop-types/index.js"),d=o.n(r),p=o("./client/components/popover/index.jsx");const l=e=>"HR"===e.tagName;class c extends n.Component{constructor(){var e;super(...arguments),e=this,i()(this,"menu",a.a.createRef()),i()(this,"_setPropsOnChild",e=>{if(null==e)return e;const t=e.props,o=t.action,s=t.onClick;return a.a.cloneElement(e,{action:null,onClick:()=>{s&&s(),this._onClose(o)}})}),i()(this,"_onShow",()=>{const e=this.menu.current;this._previouslyFocusedElement=document.activeElement,e&&e.focus()}),i()(this,"_getClosestSibling",function(t){let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const s=e.menu.current;let i=s.firstChild,n=s.lastChild;if(o||(i=s.lastChild,n=s.firstChild),t===s)return i;const a=t[o?"nextSibling":"previousSibling"]||n;return l(a)?e._getClosestSibling(a,o):a}),i()(this,"_onKeyDown",e=>{const t=e.target;let o,s=!1;switch(e.keyCode){case 9:this.props.onClose(),s=!0;break;case 38:o=this._getClosestSibling(t,!1),s=!0;break;case 40:o=this._getClosestSibling(t,!0),s=!0}o&&o.focus(),s&&e.preventDefault()}),i()(this,"_onClose",e=>{this._previouslyFocusedElement&&(this._previouslyFocusedElement.focus(),this._previouslyFocusedElement=null),this.props.onClose&&this.props.onClose(e)})}componentWillUnmount(){this._previouslyFocusedElement=null}render(){const e=this.props,t=e.popoverComponent,o=e.autoPosition,s=e.className,i=e.context,n=e.customPosition,r=e.isVisible,d=e.popoverTitle,p=e.position,l=e.rootClassName;return a.a.createElement(t,{onClose:this._onClose,onShow:this._onShow,autoPosition:o,className:s,context:i,customPosition:n,isVisible:r,popoverTitle:d,position:p,rootClassName:l},a.a.createElement("div",{ref:this.menu,role:"menu",className:"popover__menu",onKeyDown:this._onKeyDown,tabIndex:"-1"},a.a.Children.map(this.props.children,this._setPropsOnChild,this)))}}i()(c,"propTypes",{autoPosition:d.a.bool,isVisible:d.a.bool.isRequired,onClose:d.a.func.isRequired,position:d.a.string,className:d.a.string,rootClassName:d.a.string,popoverComponent:d.a.func,popoverTitle:d.a.string,customPosition:d.a.object}),i()(c,"defaultProps",{autoPosition:!0,position:"top",popoverComponent:p.a}),t.a=c}}]);