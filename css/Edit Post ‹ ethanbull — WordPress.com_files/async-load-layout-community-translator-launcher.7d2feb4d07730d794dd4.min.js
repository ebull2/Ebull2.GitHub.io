(window.webpackJsonp=window.webpackJsonp||[]).push([[85],{"./client/components/data/query-user-settings/index.jsx":function(t,e,n){"use strict";var a=n("./node_modules/react/index.js"),s=n("./node_modules/react-redux/es/index.js"),i=n("./client/state/user-settings/actions.js");e.a=Object(s.b)(null,{fetchUserSettings:i.b})(class extends a.Component{componentWillMount(){this.props.fetchUserSettings()}render(){return null}})},"./client/layout/community-translator/launcher.jsx":function(t,e,n){"use strict";n.r(e);var a=n("./node_modules/@babel/runtime/helpers/objectSpread.js"),s=n.n(a),i=n("./node_modules/@babel/runtime/helpers/defineProperty.js"),o=n.n(i),l=n("./node_modules/prop-types/index.js"),r=n.n(l),c=n("./packages/i18n-calypso/dist/esm/index.js"),d=n.n(c),u=n("./node_modules/react/index.js"),g=n.n(u),m=n("./client/components/gridicon/index.jsx"),p=n("./node_modules/react-redux/es/index.js"),b=n("./node_modules/debug/src/browser.js"),h=n.n(b),f=n("./node_modules/lodash/lodash.js"),j=n("./client/config/index.js"),y=n("./client/lib/load-script/index.js"),_=n("./client/lib/user/index.js"),E=n("./client/lib/viewport/index.js"),S=n("./client/lib/analytics/index.js"),v=n("./client/lib/i18n-utils/browser.js");const T=h()("calypso:community-translator"),w=new _.default,x={de_formal:"formal"},C={localeCode:"en",languageName:"English",pluralForms:"nplurals=2; plural=(n != 1)",contentChangedCallback(){},glotPress:{url:"https://translate.wordpress.com",project:"test",translation_set_slug:"default"}};let O,k,A,U=!1,D=!1;const R={isEnabled(){const t=w.get();return!!(t&&t.localeSlug&&Object(v.b)(t.localeSlug))&&(!(t.localeVariant&&!Object(v.b)(t.localeVariant))&&(!!U&&(!!A&&!!R.isValidBrowser())))},isActivated:()=>D,wrapTranslation(t,e,n){if(!this.isEnabled()||!this.isActivated()||n.textOnly)return e;if("object"!=typeof n&&(n={}),"string"!=typeof t)return T("unknown original format"),e;if("boolean"==typeof n.textOnly&&n.textOnly)return T('respecting textOnly for string "'+t+'"'),e;const a={className:"translatable","data-singular":t};"string"==typeof n.context&&(a["data-context"]=n.context),"string"==typeof n.plural&&(a["data-plural"]=n.plural);const s=Object.assign({},g.a.createElement("data",a,e));return s.toString=(()=>e),Object.freeze(s),s},init(t){const e=d.a.getLocale()||{"":{}},n=e[""],a=n.localeSlug,s=n.localeVariant;a&&e?this.updateTranslationData(a,e,s):T("trying to initialize translator without loaded language"),k||(Object(f.isUndefined)(t)||(U=t),U?this.isEnabled()?a&&e&&(T("Successfully initialized"),k=!0):T("not initializing, not enabled"):T("initialization failed because userSettings are not ready"))},updateTranslationData(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a=Object(j.a)("languages");if(C.localeCode===t)return T("skipping updating translation data with same localeCode"),!0;T("Translator Jumpstart: loading locale file for "+t),C.localeCode=t,C.pluralForms=e[""].plural_forms||e[""]["Plural-Forms"]||e[""]["plural-forms"]||C.pluralForms,C.currentUserId=w.data.ID;const s=Object(f.find)(a,e=>e.langSlug===t);s&&(C.languageName=s.name.replace(/^(?:[a-z]{2,3}|[a-z]{2}-[a-z]{2})\s+-\s+/,"")),this.setInjectionURL("community-translator.min.js"),C.glotPress.project="wpcom",C.glotPress.translation_set_slug=x[n]||"default"},setInjectionURL(t){T("setting injection url",O="https://widgets.wp.com/community-translator/"+t+"?v=1.160729")},toggle(){let t=!1;function e(){return D=!0,d.a.reRenderTranslations(),window.communityTranslator.load(),T("Translator activated"),!0}return C.contentChangedCallback=(()=>{t||(T("Translator notified of page change, but handler was not registered"),t=!0)}),window.translatorJumpstart=C,void 0===window.communityTranslator?O?(T("loading community translator"),Object(y.b)(O,function(t){t?T("Script "+t.src+" failed to load."):(T("Script loaded!"),window.communityTranslator.registerTranslatedCallback(R.updateTranslation),e())}),!1):(T("Community translator toggled before initialization"),D=!1,!1):(this.isActivated()?(window.communityTranslator.unload(),D=!1,d.a.reRenderTranslations(),T("Translator deactivated")):e(),this.isActivated())},updateTranslation(t){const e=d.a.getLocale(),n=t.key,a=t.plural,s=t.translations;T("Updating ",t.singular,"from",e[n],"to",[a].concat(s)),e[n]=[a].concat(s),d.a.setLocale(e)},isValidBrowser:()=>!Object(E.e)()};d.a.registerTranslateHook((t,e)=>R.wrapTranslation(e.original,t,e)),d.a.registerComponentUpdateHook(()=>{if("function"==typeof C.contentChangedCallback)return C.contentChangedCallback()}),d.a.on("change",R.init.bind(R)),w.on("change",R.init.bind(R));var V=R,N=n("./node_modules/store/dist/store.modern.js"),I=n.n(N),z=n("./client/components/dialog/index.jsx"),P=n("./client/state/selectors/get-user-settings.js");function L(t,e){return Object(f.get)(t,["userSettings","settings",e],null)}var F=n("./client/components/data/query-user-settings/index.jsx");class G extends g.a.PureComponent{constructor(){super(...arguments),o()(this,"state",{infoDialogVisible:!1,firstActivation:!0,isActive:V.isActivated(),isEnabled:V.isEnabled()}),o()(this,"onI18nChange",()=>{!this.state.isActive&&V.isActivated()?(this.setState({isActive:!0}),I.a.get("translator_hide_infodialog")||this.setState({infoDialogVisible:!0}),this.state.firstActivation&&(S.default.mc.bumpStat("calypso_translator_toggle","intial_activation"),this.setState({firstActivation:!1}))):this.state.isActive&&!V.isActivated()&&this.setState({isActive:!1})}),o()(this,"toggleInfoCheckbox",t=>{I.a.set("translator_hide_infodialog",t.target.checked)}),o()(this,"infoDialogClose",()=>{this.setState({infoDialogVisible:!1})}),o()(this,"toggle",t=>{t.preventDefault();const e=V.toggle();S.default.mc.bumpStat("calypso_translator_toggle",e?"on":"off"),this.setState({isActive:e})})}static getDerivedStateFromProps(t,e){return V.init(t.isUserSettingsReady),function(t){const e=t,n=e?"calypso_community_translator_enabled":"calypso_community_translator_disabled";A!==e&&void 0!==A&&(T(n),S.default.tracks.recordEvent(n,{locale:w.data.localeSlug})),A=e}(t.isTranslatorEnabled),e.isEnabled!==V.isEnabled()?s()({},e,{isEnabled:V.isEnabled()}):null}componentDidMount(){d.a.on("change",this.onI18nChange)}componentWillUnmount(){d.a.off("change",this.onI18nChange)}render(){let t,e="community-translator";this.state.isActive?(t=this.props.translate("Disable Translator"),e+=" is-active"):t=this.props.translate("Enable Translator");const n=[{action:"cancel",label:this.props.translate("Ok")}];return g.a.createElement("div",null,g.a.createElement(F.a,null),this.state.isEnabled&&g.a.createElement(z.a,{isVisible:this.state.infoDialogVisible,buttons:n,onClose:this.infoDialogClose,additionalClassNames:"community-translator__modal"},g.a.createElement("h1",null,this.props.translate("Community Translator")),g.a.createElement("p",null,this.props.translate("You have now enabled the translator. Right click the text to translate it.")),g.a.createElement("p",null,g.a.createElement("label",{htmlFor:"toggle"},g.a.createElement("input",{type:"checkbox",id:"toggle",onClick:this.toggleInfoCheckbox}),g.a.createElement("span",null,this.props.translate("Don't show again"))))),this.state.isEnabled&&g.a.createElement("div",{className:e},g.a.createElement("button",{className:"community-translator__button",onClick:this.toggle,title:this.props.translate("Community Translator")},g.a.createElement(m.a,{icon:"globe"}),g.a.createElement("div",{className:"community-translator__text"},t))))}}o()(G,"displayName","TranslatorLauncher"),o()(G,"propTypes",{translate:r.a.func});e.default=Object(p.b)(t=>({isUserSettingsReady:!!Object(P.a)(t),isTranslatorEnabled:L(t,"enable_translator")}))(Object(c.localize)(G))},"./client/state/selectors/get-user-settings.js":function(t,e,n){"use strict";function a(t){return t.userSettings.settings}n.d(e,"a",function(){return a})},"./client/state/user-settings/actions.js":function(t,e,n){"use strict";var a=n("./node_modules/debug/src/browser.js"),s=n.n(a),i=n("./node_modules/lodash/lodash.js"),o=(n("./client/state/selectors/get-user-settings.js"),n("./client/lib/formatting/index.js")),l=n("./client/state/data-layer/wpcom-http/utils.js");var r=n("./client/state/data-layer/wpcom-http/actions.js"),c=n("./client/state/data-layer/handler-registry.js");const d=new Set(["display_name","description","user_URL"]),u=t=>Object(i.mapValues)(t,(t,e)=>d.has(e)?Object(o.b)(t):t);Object(c.b)("state/data-layer/wpcom/me/settings/index.js",{USER_SETTINGS_REQUEST:[Object(l.a)({fetch:t=>Object(r.a)({apiVersion:"1.1",method:"GET",path:"/me/settings"},t),onSuccess:(t,e)=>m(e),onError:i.noop,fromApi:u})],USER_SETTINGS_SAVE:[Object(l.a)({fetch:function(t){return(e,n)=>{const a=t.settingsOverride||function(t){return t.userSettings.unsavedSettings}(n());Object(i.isEmpty)(a)||e(Object(r.a)({apiVersion:"1.1",method:"POST",path:"/me/settings",body:a},t))}},onSuccess:(t,e)=>{let a=t.settingsOverride;return t=>{t(m(u(e))),t(p(a?Object(i.keys)(a):null));const s=n("./client/lib/user/index.js");(s.default?s.default:s)().fetch()}},onError:i.noop,fromApi:u})]}),n.d(e,"b",function(){return g}),n.d(e,"c",function(){return m}),n.d(e,"a",function(){return p});s()("calypso:user:settings");const g=()=>({type:"USER_SETTINGS_REQUEST"}),m=t=>({type:"USER_SETTINGS_UPDATE",settingValues:t}),p=function(){return{type:"USER_SETTINGS_UNSAVED_CLEAR",settingNames:arguments.length>0&&void 0!==arguments[0]?arguments[0]:null}}}}]);